<!DOCTYPE html>
<html lang="zh-cn">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>使用脚本将英文rss转成中文rss | 一塘</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
  },
  options: {
    skipHtmlTags: ['script','noscript','style','textarea','pre','code']
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/about/">一塘</a></li>
      
      <li><a href="/post/">博客</a></li>
      
      <li><a href="/categories/">分类</a></li>
      
      <li><a href="/tags/">标签</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">使用脚本将英文rss转成中文rss</span></h1>


</div>

<div class="post-stats" style="text-align: right;">
   
  2022/05/08
  
</div>




<main>
<h2 id="前言">前言</h2>
<p>本文中我们将英文rss 自动转成中文 rss供ttrss使用。（利用谷歌翻译）</p>
<p>方便在手机上进行阅读或者收听。</p>
<center><img src="rss_google_translate/20220508-22-28-27.png" width="30%">
</center>
<!-- more -->
<h2 id="举例">举例</h2>
<p>国外有很多不错的rss源，比如:</p>
<ul>
<li><a href="http://www.mckinsey.com/insights/rss">McKinsey Insights &amp; Publications</a>
  <center><img src="rss_google_translate/20220508-22-18-23.png" width="50%">
</li>
</ul>
</center>
    转成中文rss
    <center><img src="rss_google_translate/20220508-22-20-48.png" width="50%">
</center>
<ul>
<li>
<p><a href="http://rss.acast.com/nature">Nature Podcast</a></p>
  <center><img src="rss_google_translate/20220508-22-25-04.png" width="50%">
</li>
</ul>
</center>
   转成中文rss
       <center><img src="rss_google_translate/20220508-22-26-36.png" width="50%">
</center>
<h2 id="脚本">脚本</h2>
<p>使用 Translate 和 BeautifulSoup 项目</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># coding:utf-8 </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pygtrans <span style="color:#f92672">import</span> Translate
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pip 安装</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pip install pygtrans BeautifulSoup -i https://pypi.org/simple</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ref:https://zhuanlan.zhihu.com/p/390801784</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ref:https://beautifulsoup.readthedocs.io/zh_CN/latest/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># client = Translate()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># text = client.translate(&#39;Google Translate&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># print(text.translatedText)  # 谷歌翻译</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib <span style="color:#f92672">import</span> request
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> feedparser
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>args <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv
</span></span><span style="display:flex;"><span>URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.mckinsey.com/insights/rss&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/home/xxx/www/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tran</span>(url<span style="color:#f92672">=</span>URL,out_dir<span style="color:#f92672">=</span>BASE<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;mckinsey_rss.xml&#34;</span>):
</span></span><span style="display:flex;"><span>    GT <span style="color:#f92672">=</span> Translate()
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>urlopen(url)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 变tag，以使用谷歌翻译</span>
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>content<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;title&gt;&#39;</span>, <span style="color:#e6db74">&#39;stitle&gt;&#39;</span>) <span style="color:#75715e">#谷歌翻译会将很多titile去掉，所以需要换一个tag</span>
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>content<span style="color:#f92672">.</span>replace( <span style="color:#e6db74">&#39;&lt;pubDate&gt;&#39;</span>,<span style="color:#e6db74">&#39;&lt;pubDate&gt;&lt;span translate=&#34;no&#34;&gt;&#39;</span>) 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 谷歌翻译对&lt;span translate=&#34;no&#34;&gt; &lt;/span&gt; 不翻译。</span>
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>content<span style="color:#f92672">.</span>replace( <span style="color:#e6db74">&#39;&lt;/pubDate&gt;&#39;</span>,<span style="color:#e6db74">&#39;&lt;/span&gt;&lt;/pubDate&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#print(content)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    _text <span style="color:#f92672">=</span> GT<span style="color:#f92672">.</span>translate(content)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(out_dir,<span style="color:#e6db74">&#39;w&#39;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>_text<span style="color:#f92672">.</span>translatedText
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 还原tag</span>
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>c<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;stitle&gt;&#39;</span>, <span style="color:#e6db74">&#39;title&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>c<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&lt;span translate=&#34;no&#34;&gt;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>c<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&lt;/span&gt;&lt;/pubDate&gt;&#39;</span>, <span style="color:#e6db74">&#39;&lt;/pubDate&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>write(c)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#f.write(content)</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;GT: &#34;</span><span style="color:#f92672">+</span> url <span style="color:#f92672">+</span><span style="color:#e6db74">&#34; &gt; &#34;</span><span style="color:#f92672">+</span> out_dir)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(args)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>    tran()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    tran(args[<span style="color:#ae81ff">1</span>],args[<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tran_nature</span>(url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://rss.acast.com/nature&#34;</span>,out_dir<span style="color:#f92672">=</span>BASE<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;nature_rss.xml&#34;</span>):
</span></span><span style="display:flex;"><span>    GT <span style="color:#f92672">=</span> Translate()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    html_doc<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>urlopen(url)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf8&#39;</span>)
</span></span><span style="display:flex;"><span>    soup <span style="color:#f92672">=</span> BeautifulSoup(html_doc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    items<span style="color:#f92672">=</span>soup<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#39;item&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># nature post内容太多，谷歌api翻译不了，去掉一些</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> idx,e <span style="color:#f92672">in</span> enumerate(items):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> idx <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>                e<span style="color:#f92672">.</span>decompose()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span> str(soup)
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>content<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;title&gt;&#39;</span>, <span style="color:#e6db74">&#39;stitle&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>content<span style="color:#f92672">.</span>replace( <span style="color:#e6db74">&#39;&lt;pubdate&gt;&#39;</span>,<span style="color:#e6db74">&#39;&lt;pubDate&gt;&lt;span translate=&#34;no&#34;&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>content<span style="color:#f92672">.</span>replace( <span style="color:#e6db74">&#39;&lt;/pubdate&gt;&#39;</span>,<span style="color:#e6db74">&#39;&lt;/span&gt;&lt;/pubdate&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#print(content)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    _text <span style="color:#f92672">=</span> GT<span style="color:#f92672">.</span>translate(content)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(out_dir,<span style="color:#e6db74">&#39;w&#39;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>_text<span style="color:#f92672">.</span>translatedText
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>c<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;stitle&gt;&#39;</span>, <span style="color:#e6db74">&#39;title&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>c<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&lt;span translate=&#34;no&#34;&gt;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>c<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&lt;/span&gt;&lt;/pubdate&gt;&#39;</span>, <span style="color:#e6db74">&#39;&lt;/pubDate&gt;&#39;</span>) <span style="color:#75715e"># 对于ttrss需要为pubDate才会识别正确</span>
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>c<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&amp;gt&#39;</span>,<span style="color:#e6db74">&#39;&gt;&#39;</span>) <span style="color:#75715e"># &amp;gt 会影响识别</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>write(c)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#f.write(content)</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;GT: &#34;</span><span style="color:#f92672">+</span> url <span style="color:#f92672">+</span><span style="color:#e6db74">&#34; &gt; &#34;</span><span style="color:#f92672">+</span> out_dir)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tran_nature()
</span></span></code></pre></div><h3 id="定时任务">定时任务</h3>
<blockquote>
<p>注意激活一下miniconda3 这个命令<code>source /home/xxx/miniconda3/bin/activate</code></p></blockquote>
<p>放到 <code>/etc/cron.daily/</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>source /home/xxx/miniconda3/bin/activate
</span></span><span style="display:flex;"><span>python /home/xxx/txxx.py
</span></span></code></pre></div><h2 id="其他">其他</h2>
<ul>
<li><a href="https://blog.csdn.net/wokuailewozihao/article/details/82021709">利用Google翻译实现网站国际化——js插件</a></li>
</ul>

</main>






  <footer>
  - END -
  
  <hr/>
  © 2025 一塘
  
  </footer>
  </body>
</html>

