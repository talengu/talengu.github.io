<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>linux代理的使用 | 一塘</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/about/>一塘</a></li><li><a href=/post/>博客</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>linux代理的使用</span></h1></div><div class=post-stats style=text-align:right>2018/07/24</div><main><h2 id=前言>前言</h2><p>最近要下载一个在youtube上的数据库，用来训练神经网络。走国内通道下载比较慢。于是，我使用了vps代理方式下载，速度取决于你的机器连接vps的网速。本文的主要内容有，实现shadowsocks 代理 ，tsocks 代理工具使用，可组合使用的一些下载工具如wget 和axel等。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 举个栗子</span>
</span></span><span style=display:flex><span>$ tsocks wget -c https://www.dropbox.com/s/minpyv59crdifk9/datasets.zip
</span></span></code></pre></div><p>嗯嗯，这个速度还不错！</p><center><img src=linux_proxy/1565246896718.png width=60%></center><p><strong>声明</strong>：本文以科学研究为目的，请勿滥用。</p><h2 id=1-shadowsocks>1 Shadowsocks</h2><p><strong>Shadowsocks</strong>是一个轻量级socks5代理工具。在linux平台，我们可使用 python 提供的包管理工具 pip <strong>安装 Shadowsocks</strong> ，如下。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># pip 安装 Shadowsocks</span>
</span></span><span style=display:flex><span>$ pip install shadowsocks
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 或者</span>
</span></span><span style=display:flex><span>$ pip install git+https://github.com/shadowsocks/shadowsocks.git@master
</span></span></code></pre></div><p>pip安装完之后，可能要重启终端，我们就有ssserver和sslocal小工具了。下面配置server或者client。一般，server配置在国外的vps上，client配置在本地国内机器上。</p><p>PS：其他平台安装 参考 shadowsocks官方 <a href=https://github.com/shadowsocks/shadowsocks/tree/master#install>install</a></p><h3 id=11-配置-shadowsocks-server>1.1 配置 Shadowsocks server</h3><p>按下面的三步走，即可。</p><ul><li><p>通过ssh连接到（Virtual Private Server）vps上，或者本地打开终端。</p></li><li><p>新建一个<strong>server_shadowsocks.json</strong>文件，内容如下：</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;server&#34;</span>:<span style=color:#e6db74>&#34;0.0.0.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;server_port&#34;</span>:<span style=color:#ae81ff>443</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;local_address&#34;</span>: <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;local_port&#34;</span>:<span style=color:#ae81ff>1080</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;password&#34;</span>:<span style=color:#e6db74>&#34;密码&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;timeout&#34;</span>:<span style=color:#ae81ff>300</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;method&#34;</span>:<span style=color:#e6db74>&#34;aes-256-cfb&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;fast_open&#34;</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>执行<code>ssserver -c server_shadowsocks.json</code></li></ul><p>说一点: 由于我们的下载任务是临时的，开个screen（终端复用工具）放在后台。当然你也可以设置为开机自启动，这里不再赘述。</p><h3 id=12-配置-shadowsocks-client>1.2 配置 Shadowsocks client</h3><ul><li><p>通过ssh连接到机器上，或者本地打开终端。</p></li><li><p>新建文件 <strong>client_shadowsocks.json</strong></p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;server&#34;</span>:<span style=color:#e6db74>&#34;服务器ip或域名&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;server_port&#34;</span>:<span style=color:#ae81ff>443</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;local_address&#34;</span>:<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;local_port&#34;</span>:<span style=color:#ae81ff>1280</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;password&#34;</span>:<span style=color:#e6db74>&#34;密码&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;timeout&#34;</span>:<span style=color:#ae81ff>300</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;method&#34;</span>:<span style=color:#e6db74>&#34;aes-256-cfb&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;fast_open&#34;</span>:<span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;workers&#34;</span>:<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>执行<code>sslocal -c client_shadowsocks.json</code>。</li></ul><p>说一点：推荐使用screen方式放在后台。当然也可以使用-d 参数放在后台运行。
<code>sslocal -c client_shadowsocks.json -d start</code></p><h2 id=2-tsocks>2 tsocks</h2><p>有些linux工具可能没有proxy的代理功能，或者不支持sock5代理，而用tsocks可以很好的解决这些问题。<strong>tsocks</strong> 是个终端代理工具，可以直接连接shadowsocks提供socks 5代理端口，有点类似于proxychains。</p><p>下面简单介绍下安装与使用：</p><ul><li>安装<strong>tsocks</strong><ul><li>linux安装tsocks 命令：<code>apt install tsocks</code></li><li>mac 安装参考 <a href=https://github.com/Anakros/homebrew-tsocks>homebrew-tsocks</a></li></ul></li><li>开启上面Shadowsocks的client放在后台。</li><li>修改tsocks 配置文件，在 <code>/etc/tsocks.conf</code> 文件的最后添加：</li></ul><pre tabindex=0><code>local = 192.168.1.0/255.255.255.0
server = 127.0.0.1
server_type = 5
server_port = 1080
</code></pre><h2 id=3-demo代理使用>3 Demo：代理使用</h2><h3 id=31-使用-tsocks>3.1 使用 tsocks</h3><p>在所需代理的命令前加个tsocks就行，如：
<code>tsocks wget -c xxxx</code>,<code>tsocks axel -n 10 -av xxxx</code>,<code>tsocks curl xxx</code></p><h3 id=32-使用-youtube-dl>3.2 使用 youtube-dl</h3><p>youtube-dl是批量下载youtube视频的好工具。youtube-dl 可以指定 proxy，<strong>可以不使用tsocks</strong>。</p><ul><li>安装youtube-dl</li></ul><pre tabindex=0><code>pip install --upgrade youtube-dl
</code></pre><ul><li><p>使用举个例子</p><ul><li>下载youtube视频</li></ul><pre tabindex=0><code>URL=https://www.youtube.com/playlist?list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax
./youtube-dl --proxy socks5://127.0.0.1:1280 ${URL}
# 在 client_shadowsocks.json 的 local_port 设置为1280，这儿也为1280
</code></pre><ul><li>下载里面的mp3</li></ul><pre tabindex=0><code>youtube-dl -x --audio-format mp3 https://www.youtube.com/watch?v=xpVfcZ0ZcFM
</code></pre></li></ul><p><strong>youtube-dl 中待解决的问题？</strong>
想只下载一个视频中的一部分，不用下载整个视频，太费vps流量了。暂未找到解决办法，我找到的一个跟问题很相似的issue，有朋友会整的，望告诉一下。<a href=https://github.com/rg3/youtube-dl/issues/4821>is it possible to download only desired time interval?</a></p><h3 id=33-使用-axel>3.3 使用 axel</h3><p>axel多线程下载。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tsocks axel -n <span style=color:#ae81ff>3</span> -a https://www.dropbox.com/s/minpyv59crdifk9/datasets.zip
</span></span></code></pre></div><pre tabindex=0><code>-n 3 : 3个线程下载
-a   : 有个进度条
</code></pre><p>其他方式：下载脚本 axel-bash.sh</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh -e  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># usage:  ./axel-batch.sh the-download-url.list  </span>
</span></span><span style=display:flex><span>cat $1 | <span style=color:#66d9ef>while</span> read LINE  
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -n <span style=color:#e6db74>&#34;</span>$LINE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>  
</span></span><span style=display:flex><span>	axel -n <span style=color:#ae81ff>3</span> -a <span style=color:#e6db74>`</span>echo $LINE<span style=color:#e6db74>`</span>  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>fi</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>  
</span></span></code></pre></div></main><footer>- END -<hr>© 2025 一塘</footer></body></html>