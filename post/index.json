[{"categories":["工具"],"content":"从2015年开始，我使用Hexo框架Next主题搭建，个人博客系统，正好十年。 框架和主题配置完成后，我只要关注markdown内容即可。\n在这使用过程中，遇到过一次大规模的js投毒，那一次hexo 编译不出。 hexo 和next 框架 变更实在是太快了，最近在github 的页面编译不出后，我修复无果，也懒得折腾了，在初步调研后，准备使用hugo和Hugo Xmin\n使用的是 hugo 与 hugo-xmin\nhugo 安装 hugo 可以直接下载二进制文件 https://github.com/gohugoio/hugo/releases?page=3\nhugo v0.146.7\nhugo-xmin 从git库中下载\nhttps://github.com/yihui/hugo-xmin\nc871e5665f5eceb919c8fdb284b73c7a07012646\n我个人是mac，使用的是docker debian镜像，在它上面安装二进制文件\ndocker pull --platform linux/arm64 debian:12-slim services: hugo: image: debian:12-slim volumes: - talengu.github.io:/blog - blog/posts:/blog/content/post working_dir: /blog ports: - 1313:1313 command: ./hugo_0.146.7_arm64 server --bind 0.0.0.0 stdin_open: true tty: true 其他docker镜像可使用 klakegg/hugo\nhugo 使用 ./hugo server \u0026ndash;bind 0.0.0.0 ./hugo build\ncd public git init git remote add origin git@github.com:talengu/talengu.github.io.git git checkout -b gh-pages git add . git commit -m \u0026#34;Deploy Hugo site\u0026#34; git push -f origin gh-pages 分类布局 categories folder name 放什么 life c0-life 旅行 / 阅读 / 随笔 math c1-math 概率 / 线代 / 算法 robotics c2-robotics 机器人 ai c3-ai LLM / CV / 实验记录 system c4-system 性能 / 架构 / OS 设计 linux c5-linux 内核、发行版、系统工具 network c6-network TCP/IP、抓包、协议 toolchain c7-toolchain gcc / musl / cmake / build / rss工具 programming c8-programming C / Python / 数据结构 添加评论 使用 giscus.app 按 giscus.app 官方进行操作即可 https://giscus.app/\n添加搜索 ","permalink":"/post/c7-toolchain/hugo-build/","summary":"\u003cp\u003e从2015年开始，我使用Hexo框架Next主题搭建，个人博客系统，正好十年。\n框架和主题配置完成后，我只要关注markdown内容即可。\u003c/p\u003e\n\u003cp\u003e在这使用过程中，遇到过一次大规模的js投毒，那一次hexo 编译不出。\nhexo 和next 框架 变更实在是太快了，最近在github 的页面编译不出后，我修复无果，也懒得折腾了，在初步调研后，准备使用\u003ca href=\"https://gohugo.io\"\u003ehugo\u003c/a\u003e和\u003ca href=\"https://www.gohugothemes.com/theme/yihui-hugo-xmin/\"\u003eHugo Xmin\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e使用的是 hugo 与 hugo-xmin\u003c/p\u003e\n\u003ch2 id=\"hugo-安装\"\u003ehugo 安装\u003c/h2\u003e\n\u003cp\u003ehugo 可以直接下载二进制文件 \u003ca href=\"https://github.com/gohugoio/hugo/releases?page=3\"\u003ehttps://github.com/gohugoio/hugo/releases?page=3\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ehugo v0.146.7\u003c/p\u003e\n\u003cp\u003ehugo-xmin 从git库中下载\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/yihui/hugo-xmin\"\u003ehttps://github.com/yihui/hugo-xmin\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ec871e5665f5eceb919c8fdb284b73c7a07012646\u003c/p\u003e\n\u003cp\u003e我个人是mac，使用的是docker debian镜像，在它上面安装二进制文件\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edocker pull --platform linux/arm64 debian:12-slim\n\u003c/code\u003e\u003c/pre\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eservices:\n  hugo:\n    image: debian:12-slim\n    volumes:\n      - talengu.github.io:/blog\n      - blog/posts:/blog/content/post\n    working_dir: /blog\n    ports:\n      - 1313:1313\n    command: ./hugo_0.146.7_arm64 server --bind 0.0.0.0\n    stdin_open: true\n    tty: true\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e其他docker镜像可使用 \u003ca href=\"https://hub.docker.com/r/klakegg/hugo/tags?name=debian\"\u003eklakegg/hugo\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"hugo-使用\"\u003ehugo 使用\u003c/h2\u003e\n\u003cp\u003e./hugo server \u0026ndash;bind 0.0.0.0\n./hugo build\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd public\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit init\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit remote add origin git@github.com:talengu/talengu.github.io.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit checkout -b gh-pages\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit add .\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit commit -m \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Deploy Hugo site\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit push -f origin gh-pages\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"分类布局\"\u003e分类布局\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003cstrong\u003ecategories\u003c/strong\u003e\u003c/th\u003e\n          \u003cth\u003efolder name\u003c/th\u003e\n          \u003cth\u003e\u003cstrong\u003e放什么\u003c/strong\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003elife\u003c/td\u003e\n          \u003ctd\u003ec0-life\u003c/td\u003e\n          \u003ctd\u003e旅行 / 阅读 / 随笔\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003emath\u003c/td\u003e\n          \u003ctd\u003ec1-math\u003c/td\u003e\n          \u003ctd\u003e概率 / 线代 / 算法\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003erobotics\u003c/td\u003e\n          \u003ctd\u003ec2-robotics\u003c/td\u003e\n          \u003ctd\u003e机器人\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eai\u003c/td\u003e\n          \u003ctd\u003ec3-ai\u003c/td\u003e\n          \u003ctd\u003eLLM / CV / 实验记录\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003esystem\u003c/td\u003e\n          \u003ctd\u003ec4-system\u003c/td\u003e\n          \u003ctd\u003e性能 / 架构 / OS 设计\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003elinux\u003c/td\u003e\n          \u003ctd\u003ec5-linux\u003c/td\u003e\n          \u003ctd\u003e内核、发行版、系统工具\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003enetwork\u003c/td\u003e\n          \u003ctd\u003ec6-network\u003c/td\u003e\n          \u003ctd\u003eTCP/IP、抓包、协议\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003etoolchain\u003c/td\u003e\n          \u003ctd\u003ec7-toolchain\u003c/td\u003e\n          \u003ctd\u003egcc / musl / cmake / build / rss工具\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eprogramming\u003c/td\u003e\n          \u003ctd\u003ec8-programming\u003c/td\u003e\n          \u003ctd\u003eC / Python / 数据结构\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"添加评论-使用-giscusapp\"\u003e添加评论 使用 giscus.app\u003c/h2\u003e\n\u003cp\u003e按 giscus.app 官方进行操作即可\n\u003ca href=\"https://giscus.app/\"\u003ehttps://giscus.app/\u003c/a\u003e\u003c/p\u003e","tags":["hugo","博客搭建"],"title":"Hugo搭建"},{"categories":["编程"],"content":"前言 本文原文发表于《广达杂志》（Quanta Magazine）。\n本文原文_发表于 《广达杂志》（Quanta Magazine）。_\n2021 年秋天的某个时候，罗格斯大学 （Rutgers University） 的本科生安德鲁·克拉皮文 （Andrew Krapivin） 遇到了一篇改变他生活的论文。当时，克拉皮文并没有多想。但两年后，当他终于抽出时间阅读这篇论文时（用他的话说，“只是为了好玩”），他的努力将导致对计算机科学中广泛使用的工具的重新思考。\n该论文的标题“Tiny Pointers”指的是箭头状实体，可以将您引导至计算机内存中的一条信息或元素。Krapivin 很快就想出了一种潜在的方法来进一步缩小指针，从而减少它们消耗的内存。但是，为了实现这一点，他需要一种更好的方法来组织指针将指向的数据。\n他转向了一种称为哈希表的常用数据存储方法。但在修补过程中，Krapivin 意识到他发明了一种新型的哈希表，这种表的运行速度比预期的要快 — 查找特定元素所需的时间和步骤更少。\n“Tiny Pointers”论文的合著者、Krapivin 在罗格斯大学的前教授 Martín Farach-Colton 最初对 Krapivin 的新设计持怀疑态度。哈希表是所有计算机科学中研究最深入的数据结构之一;这个预告听起来好得令人难以置信。但为了保险起见，他请了一位经常合作的人（也是《Tiny Pointers》的合著者），卡内基梅隆大学的威廉·库斯莫尔（William Kuszmaul）来看看他学生的发明。库斯莫尔有不同的反应。“你不只是想出了一个很酷的哈希表，”他记得对 Krapivin 说。“你居然彻底抹杀了一个 40 年前的猜想！”\nAndrew Krapivin 没有打算这样做，它颠覆了围绕哈希表的常见思维，哈希表是计算机科学中研究得最多的工具之一。\n照片：Phillip Ammon for Quanta Magazine\nKrapivin（现在是剑桥大学的研究生）、Farach-Colton（现在在纽约大学）和 Kuszmaul 在 2025 年 1 月的一篇论文中一起证明，这种新的哈希表确实可以比人们认为的更快地找到元素。他们这样做，就反驳了一个长期以来被认为是正确的猜想。\n“这是一篇重要的论文，”纽约市康奈尔理工学院的亚历克斯·康威（Alex Conway）说。“哈希表是我们拥有的最古老的数据结构之一。而且它们仍然是最有效的数据存储方式之一。然而，他说，关于它们如何运作仍然存在悬而未决的问题。“这篇论文以令人惊讶的方式回答了其中的几个问题。”\n哈希表在计算中无处不在，部分原因是它们的简单性和易用性。它们旨在允许用户执行三项作：“查询”（搜索）元素、删除元素或将元素插入空槽。第一个哈希表可以追溯到 1950 年代初，从那时起，计算机科学家一直在研究和使用它们。除其他外，研究人员希望弄清楚其中一些作的速度限制。例如，新的搜索或插入可能有多快？\nMartín Farach-Colton 帮助 Krapivin 证明他的新哈希表与一个长期存在的猜想相矛盾。\n摄影：Andrew Farach-Colton\n答案通常取决于在哈希表中查找空位所需的时间。反过来，这通常取决于哈希表的填充程度。充实度可以用总体百分比来描述——这个表格是 50%，那个表格是 90%——但研究人员经常处理更完整的表格。因此，他们可能会使用一个由 x 表示的整数来指定哈希表接近 100% 满的程度。如果 x 为 100，则表已满 99%。如果 x 为 1,000，则表已满 99.9%。这种填充度度量提供了一种便捷的方法来评估执行查询或插入等作需要多长时间。\n研究人员早就知道，对于某些常见的哈希表，进行最差的可能插入（例如，将项目放入最后一个剩余的空位）所需的预期时间与 x 成正比。“如果你的哈希表已经满了 99%，”Kuszmaul 说，“那么你必须查看大约 100 个不同的位置才能找到一个空闲位置是有道理的。\n在 1985 年的一篇论文中，后来获得 A.M. 图灵奖的计算机科学家 Andrew Yao 断言，在具有一组特定属性的哈希表中，查找单个元素或空点的最佳方法是随机遍历潜在点，这种方法称为统一探测。他还表示，在最坏的情况下，你正在寻找最后一个剩余的空位，你永远无法做得比 x 更好。40 年来，大多数计算机科学家都认为姚明的猜想是正确的。\n克拉皮文并没有被传统智慧所阻碍，原因很简单，他没有意识到这一点。“我在不知道姚明的猜想的情况下做了这件事，”他说。他对微小指针的探索导致了一种新型的哈希表，一种不依赖于统一探测的哈希表。对于这个新的哈希表，最坏情况下的查询和插入所需的时间与 （log x）2 成正比，比 x 快得多。这个结果直接与姚的猜想相矛盾。Farach-Colton 和 Kuszmaul 帮助 Krapivin 证明 （log x）2 是 Yao 所写的流行哈希表类别的最佳、无敌的边界。\n“这个结果很美，因为它解决并解决了这样一个经典问题，”卡内基梅隆大学的 Guy Blelloch 说。\n“他们不仅反驳了[姚明的猜想]，还为他的问题找到了最好的答案，”滑铁卢大学（University of Waterloo）的塞佩尔·阿萨迪（Sepehr Assadi）说。“我们本可以再过 40 年才知道正确的答案。”\n剑桥大学国王学院桥上的 Krapivin。他的新哈希表可以以前所未有的速度查找和存储数据。\n照片：Phillip Ammon 为 Quanta 杂志拍摄\n除了反驳姚明的猜想外，这篇新论文还包含了许多人认为更令人惊讶的结果。它与一个相关但略有不同的情况有关：在 1985 年，Yao 不仅研究了查询的最坏情况，还研究了所有可能的查询所花费的平均时间。他证明，具有某些属性的哈希表（包括那些标记为“贪婪”的哈希表，这意味着必须将新元素放置在第一个可用位置）永远无法实现比 log x 更好的平均时间。\nFarach-Colton、Krapivin 和 Kuszmaul 想看看同样的限制是否也适用于非贪婪哈希表。他们通过提供一个反例来证明它没有，一个非贪婪哈希表，平均查询时间比 log x 好得多。事实上，它根本不依赖于 x。“你会得到一个数字，”Farach-Colton 说，“它只是一个常数，不取决于哈希表的填充程度。无论哈希表的填充度如何，您都可以实现恒定的平均查询时间，这一事实完全出乎意料，即使对作者自己也是如此。\nConway 说，该团队的结果可能不会立即导致任何申请，但这并不是最重要的。“更好地了解这类数据结构很重要。你不知道这样的结果什么时候会解锁一些让你在练习中做得更好的东西。\n原文经 Quanta Magazine 许可转载，Quanta Magazine 是 Simons 基金会的独立编辑出版物 ，其使命是通过报道数学、物理和生命科学的研究发展和趋势来增强公众对科学的理解。\n","permalink":"/post/c8-programming/hash-tables-news/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文原文发表于《广达杂志》（Quanta Magazine）。\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.quantamagazine.org/undergraduate-upends-a-40-year-old-data-science-conjecture-20250210/\"\u003e\u003cem\u003e本文\u003c/em\u003e\u003c/a\u003e原文_发表于 \u003ca href=\"https://www.quantamagazine.org/\"\u003e《广达杂志》（Quanta Magazine\u003c/a\u003e）。_\u003c/p\u003e\n\u003cp\u003e2021 年秋天的某个时候，罗格斯大学 （Rutgers University） 的本科生安德鲁·克拉皮文 （Andrew Krapivin） 遇到了一篇改变他生活的论文。当时，克拉皮文并没有多想。但两年后，当他终于抽出时间阅读这篇论文时（用他的话说，“只是为了好玩”），他的努力将导致对计算机科学中广泛使用的工具的重新思考。\u003c/p\u003e\n  \u003c!-- more --\u003e\n\u003cp\u003e该论文的标题“\u003ca href=\"https://arxiv.org/abs/2111.12800\"\u003eTiny Pointers\u003c/a\u003e”指的是箭头状实体，可以将您引导至计算机内存中的一条信息或元素。Krapivin 很快就想出了一种潜在的方法来进一步缩小指针，从而减少它们消耗的内存。但是，为了实现这一点，他需要一种更好的方法来组织指针将指向的数据。\u003c/p\u003e\n\u003cp\u003e他转向了一种称为哈希表的常用数据存储方法。但在修补过程中，Krapivin 意识到他发明了一种新型的哈希表，这种表的运行速度比预期的要快 — 查找特定元素所需的时间和步骤更少。\u003c/p\u003e\n\u003cp\u003e“Tiny Pointers”论文的合著者、Krapivin 在罗格斯大学的前教授 \u003ca href=\"https://engineering.nyu.edu/faculty/martin-farach-colton\"\u003eMartín Farach-Colton\u003c/a\u003e 最初对 Krapivin 的新设计持怀疑态度。哈希表是所有计算机科学中研究最深入的数据结构之一;这个预告听起来好得令人难以置信。但为了保险起见，他请了一位经常合作的人（也是《Tiny Pointers》的合著者），卡内基梅隆大学的\u003ca href=\"https://csd.cmu.edu/people/faculty/william-kuszmaul\"\u003e威廉·库斯莫尔（William Kuszmaul\u003c/a\u003e）来看看他学生的发明。库斯莫尔有不同的反应。“你不只是想出了一个很酷的哈希表，”他记得对 Krapivin 说。“你居然彻底抹杀了一个 40 年前的猜想！”\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"4540c60338f01ec8cccbe2f8baa9f536_MD5.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eAndrew Krapivin 没有打算这样做，它颠覆了围绕哈希表的常见思维，哈希表是计算机科学中研究得最多的工具之一。\u003c/p\u003e\n\u003cp\u003e照片：Phillip Ammon for Quanta Magazine\u003c/p\u003e\n\u003cp\u003eKrapivin（现在是剑桥大学的研究生）、Farach-Colton（现在在纽约大学）和 Kuszmaul 在 \u003ca href=\"https://arxiv.org/abs/2501.02305\"\u003e2025 年 1 月\u003c/a\u003e的一篇论文中一起证明，这种新的哈希表确实可以比人们认为的更快地找到元素。他们这样做，就反驳了一个长期以来被认为是正确的猜想。\u003c/p\u003e\n\u003cp\u003e“这是一篇重要的论文，”纽约市康奈尔理工学院的\u003ca href=\"https://ajhconway.com/\"\u003e亚历克斯·康威（Alex Conway\u003c/a\u003e）说。“哈希表是我们拥有的最古老的数据结构之一。而且它们仍然是最有效的数据存储方式之一。然而，他说，关于它们如何运作仍然存在悬而未决的问题。“这篇论文以令人惊讶的方式回答了其中的几个问题。”\u003c/p\u003e\n\u003cp\u003e哈希表在计算中无处不在，部分原因是它们的简单性和易用性。它们旨在允许用户执行三项作：“查询”（搜索）元素、删除元素或将元素插入空槽。第一个哈希表可以追溯到 1950 年代初，从那时起，计算机科学家一直在研究和使用它们。除其他外，研究人员希望弄清楚其中一些作的速度限制。例如，新的搜索或插入可能有多快？\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"94be07a640f87d1921f3057b2e88b1c4_MD5.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eMartín Farach-Colton 帮助 Krapivin 证明他的新哈希表与一个长期存在的猜想相矛盾。\u003c/p\u003e\n\u003cp\u003e摄影：Andrew Farach-Colton\u003c/p\u003e\n\u003cp\u003e答案通常取决于在哈希表中查找空位所需的时间。反过来，这通常取决于哈希表的填充程度。充实度可以用总体百分比来描述——这个表格是 50%，那个表格是 90%——但研究人员经常处理更完整的表格。因此，他们可能会使用一个由 \u003cem\u003ex\u003c/em\u003e 表示的整数来指定哈希表接近 100% 满的程度。如果 \u003cem\u003ex\u003c/em\u003e 为 100，则表已满 99%。如果 \u003cem\u003ex\u003c/em\u003e 为 1,000，则表已满 99.9%。这种填充度度量提供了一种便捷的方法来评估执行查询或插入等作需要多长时间。\u003c/p\u003e","tags":["哈希","数学"],"title":"「转」本科生反驳 40 年前的猜想，发明新型哈希表"},{"categories":["工具"],"content":"前言 本文由 简悦 SimpRead 转码， 原文地址 https://sspai.com/post/89289\n作为喜欢阅读互联网长文的「上世代互联网遗老」，我一直保持着一个和现在互联网快消时代格格不入的爱好：偏爱长内容，这包括了我喜欢观看哪些具有丰富知识内容的长视频，收听播客节目以及阅读长篇的文章。尤其是长篇文章，往往是在我在碎片化的时间浏览公众号或者 RSS 订阅时，然后就会把这篇长文发到我的稍后读应用或者推送到我的 Kindle 邮箱中，等晚上做到书桌前仔细深度阅读。\n因此我一直都非常留意各家的稍后读 / 书签服务，从最早的 instapaper、Pocket 到后来使用 Kindle 的邮箱推送等都有尝试，只不过在国内这个互联网环境中难免会遇到网络访问稳定性的问题——毕竟这几种稍后读服务都来自国外开发商，经常会遇到发送微信公众号文章后重排版出错的情况，就更别提数据保留的安全性问题了。\n既然我已经在家中部署了 NAS，秉承「将数据保留在自己手上」的宗旨，我决定将稍后读 / 书签服务也进行自部署。而考虑到我实际的使用情况，我自部署的稍后读 / 书签服务需要满足以下几点：\n支持自部署，且部署方式容易。 可以在手机端 / 桌面端进行进行阅读。 可以在不同的平台将文章 / 网页发送到稍后读服务中。 解析处理网页内容的速度要很快。 而满足以上要求的就剩下了这款名为 Readeck 稍后读 / 书签服务。\n安装 Readeck 服务端 和其他自部署的服务一样，作为一款自部署优先服务，Readeck 官方直接就提供了 Docker 的部署方式，当然考虑到我自己家中的 NAS 是群晖的 DS218+，官方 Docker 套件本身功能比较弱，因此我还额外使用 Portainer 这个可视化的容器部署工具来进行部署，这样做的另一个好处就是，即便你的 NAS 不是群晖，只要支持容器，也可以采用类似的办法做部署。\n我这里依旧以群晖为参照，首先打开群晖的 File Station 中的 docker 目录，在目录下创建一个新文件夹并将其命名为 readeck（全部是小写字母）。\n然后在新创建的这个readeck 文件夹里面，在分别创建data以及db两个文件夹。这两个文件夹后面用来存储服务中所产生的数据。\n接下来我们就打开 Portainer 来进行服务容器的部署，这里打开并登录 Portainer，然后从左侧边栏中点击 Stacks，然后点击页面右上角的 Add Stack来添加。\n在新创建的 Stack 的 Name 里面填写readeck，然后在 Build method 这里选择 Web editor，接着在下面内容直接复制到编辑器中：\nversion: \u0026#34;3.9\u0026#34; services: readeck: container_name: Readeck image: codeberg.org/readeck/readeck:latest mem_limit: 8g cpu_shares: 1024 security_opt: - no-new-privileges:true restart: on-failure:5 ports: - 4522:8000 volumes: - /volume1/docker/readeck/data:/readeck:rw environment: READECK_USE_X_FORWARDED: true READECK_DATABASE_SOURCE: postgres://readeck:readeckpass@readeck-db:5432/readeck readeck-db: image: postgres:16 container_name: Readeck-DB hostname: readeck-db mem_limit: 1g cpu_shares: 768 security_opt: - no-new-privileges:true healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;pg_isready\u0026#34;, \u0026#34;-q\u0026#34;, \u0026#34;-d\u0026#34;, \u0026#34;readeck\u0026#34;, \u0026#34;-U\u0026#34;, \u0026#34;readeck\u0026#34;] timeout: 45s interval: 10s retries: 10 volumes: - /volume1/docker/readeck/db:/var/lib/postgresql/data:rw environment: POSTGRES_DB: readeck POSTGRES_USER: readeck POSTGRES_PASSWORD: readeckpass restart: on-failure:5 按照上面填写完成后，这里点击下方的「Deploy the stack」来部署容器，然后等待出现容器列表就表示部署成功了。\nP.S：有关 docker 文件存储路径也需要留意，如果你的 NAS 有多个卷，最好能够核对自己创建文件夹的绝对路径，从而避免出错。\n配置 Readeck 当容器正式启动后，这时打开浏览器并访问：http:// 你的 NAS 地址: 4522 ，如果可以访问到 Readeck 的登录页面就表示完全部署成功了，如果你和我一样，是部署到本地的 NAS 中的，那么如果想要从外网访问还需要通过 ddns 或者内网穿透的方式将服务暴露到公网中，这里我就不过多赘述了。\n在注册页面中首先输入你未来需要登录 Readeck 的账号和密码，最后点击 Finish installation 来完成最后的注册。登录后你就可以看到 readeck 的列表页面，这就表示你已经成功完成了全部的安装工作。而既然是一款稍后读应用，那么自然少不了就是测试一下他的阅读模式的处理能力，这里我直接在 Readeck 上点击上方添加地址处贴上少数派的某篇文章的链接，然后点击「Save Link」来保存链接。\n这个保存并处理的过程非常快，稍等片刻 Readeck 就会完成处理并添加好作者以及标题，甚至还会自动生成稍后读文章卡片的封面图，而点击进去后可以看出会将一些无用的元素都进行清理，保留成适合手机进行阅读的「阅读模式」的效果。同时你还可以对阅读的效果进行设置，比如选择字体、字号以及对行高进行设置。\n同时你还可以对不同的文章打上特定的标签，方便的进行进一步的分类归档操作，而在晚间阅读时如果你觉得背景比较刺眼，也可以点击侧栏中的更换主题来切换成暗色模式。\nReadeck 进阶用法：用更简单的方式发送文章 Readeck 服务部署完毕并且进行了基础设置，那么接下来我们发送需要稍后读的文章 / 网页了，毕竟如果每一次添加稍后读的文章链接都需要打开 readeck 并点击「Save Link」显然非常繁琐，事实上 Readeck 提供了和很多商业服务类似的方式，可以让我们非常方便的将看到的文章发送到 Readeck 中。\n使用浏览器的扩展程序发送文章 / 链接 如果你使用的是桌面浏览器来浏览网页内容，那么最为简单的办法就是通过浏览器的扩展程序，Readeck 提供了 Chrome/Firefox 两个主流浏览器的扩展程序，这里只需要在相应的扩展程度市场中下载安装，然后点击扩展程序后输入你的账户名、密码以及服务的具体地址，然后点击 Login 就可以完成登录绑定操作。\n登录完成后，当你需要将正在浏览的网页发送到 Readeck 时，就只需要点击扩展程序栏中的 Readeck 图标，然后等待其完成保存即可。如果不放心你还可以登录 Readeck 中，看看你点击发送的这篇文章是否已经被收藏进来了。\n在 iOS 上使用快捷指令来收藏文章 我习惯在手机端浏览器网页，会将合适的内容也会将其发送到稍后读中，这同样在 Readeck 中也可以这样操作，只不过由于 Readeck 并没有提供手机客户端，因此这里需要自己通过第三方工具来实现，至于 iOS 上则是通过快捷指令来进行操作。\n不过在使用快捷指令操作之前，我们首选需要为这些操作来创建新的 API 密钥，这里先登录你的 Readeck 服务，然后点击 Profile - API Token，然后点击「Create a new API token」来创建一个新的 API Token，这里只需要将生成的「Your API token」下面的字符串保留下来备用即可。\n接下来，使用 iOS 上的浏览器打开这个地址，然后点击「Download Shortcut」保存到你的快捷指令集中，接下来点击「Send Page To Readeck」这个快捷指令卡片的编辑按钮，在第一个注释下方的文本框中填写 Readeck 的公网访问地址，在第二个注释下方的文本框中，把刚才保存的 API Token 复制进去，然后点击右上角的完成来保存。\n那么如何发文章到 Readeck 呢？当你使用 Safari 浏览器访问网址时，点击下方的分享按钮并在分享菜单中选择 Send Page To Readeck，然后等待快捷指令跑完即可，这时候你再访问 Readeck 就会发现刚才在 Safari 浏览的网页已经被发送到 Readeck 中了。\n在 Android 上使用 HTTP Request Shortcuts 来收藏文章 相比于 iOS 上有系统级别的快捷指令，Android 上一直以来都没有系统级别的「脚本工具」，因此要想实现类似的操作将网页添加到 Readeck 就只能依赖第三方工具了，这里我们就需要用到这个 HTTP Request Shortcuts 这款应用来编写一个添加文章的脚本。\n首先还是打开 HTTP Request Shortcuts，首先点击右上角的汉堡菜单，点击「变量」来创建三个变量：\n第一个变量叫做readeck_shared_url，变量类型为「输入文本」，需要注意的是这个变量的高级设置里面需要勾选「允许分享」，要从分享获得的数据为「仅文本」。 第二个变量叫做readeck_url，变量类型是「常量」，这里需要填写值，这个值就是你部署的 Readeck 服务的公网地址。 第三个变量叫做readeck_token，变量类型是「常量」，这里也需要填写值，这个值就是前面我们从 readeck 的 API Token 中保存下来的 Token 值。 紧接着，点击主页右下角的 +然后选择「从头创建」来创建一个新的快捷方式，这里名称你可以随便命名，可以像我一样将其命名为「Add To Readeck」，然后在基本设置中，选择方法为Post，url 这里输入值{readeck_url}/api/bookmarks。\n在请求体 / 请求参数这里，这里设置返回体类型是参数（x-www-form-urlencoded），下方的参数为url，值是{readeck_shared_url}。\n在认证这里，选择认证方式为「令牌认证」，令牌为{readeck_token}。全部编辑好之后点击右上角的对勾确认保存，至此发送网页脚本就正式编辑完成了。\n那么怎么使用呢？这里只需要使用浏览器打开一篇文章，然后点击分享来展开 Android 系统的原生分享菜单，这里就可以看到刚刚我们创建的这个名为「Add To Readeck」的图标，点击后会提示该脚本已经执行，只要不报错就表示网页已经成功提交到 Readeck 中了，如果不确定可以到 Readeck 的文章列表中查看是否已经发送成功了。\nReadeck 进阶用法 2：在不同的平台使用不同的姿势阅读 既然文章都已经上传到 Readeck 中了，那么该如何进行阅读呢？和其他商业产品不同的是 Readeck 并没有推出专门的阅读客户端，不过好在 Readeck 提供了很多丰富的阅读方式，体验上还是相当不错的。\nReadeck 的准官方客户端：PWA 应用 如果只是用来阅读，那么实际上使用 Web 网页就完全够用，而 Readeck 也已经支持以 PWA 的形式进行安装，那么最为简单的方式就是将其安装成 PWA 应用——使用浏览器访问你部署的 Readeck 服务，桌面端点击地址栏的安装来将其安装成 PWA 应用，至于移动端也是类似。而整体体验下来个人觉得已经足够满足使用需求——尤其是 Readeck 的网页端也针对移动设备进行了优化，阅读沉浸感还是很不错的。\n在移动端通过支持 OPDS 的阅读应用来阅读 Readeck 原生支持 OPDS——通过访问路径的形式可以将保存的稍后读文章以电子书的形式发布，这样我们看文章的体验就会和通过电子书类似，那么如果你平时习惯在手机上通过阅读应用来看书，那么就可以将 Readeck 添加成书库在应用中阅读。\n这里，iOS 上可以使用这个名为 cantook 的应用来实现，打开这款应用并点击导航栏中的「书店」同时点击右上角的添加，然后再选择「手动添加书店」，在弹出的新建目录名称和链接对话框中，填写目录名称（这里随便写）以及目录链接（https:// 你的书库地址 / opds）后，然后点击添加，这时候再点击书店中的新保存的这个新书店，根据提示输入你的 readeck 的账户和密码，就可以顺利进入到目录中了，只不过进入阅读后你会发现还是访问的是 Readeck 的网页端而已。至于 Android 上，支持 OPDS 目录的阅读应用也有不少，比如静读天下也支持挂载 OPDS 目录，这里我就不过多的赘述了。\n总结 经过一段时间的试用，我正式将自部署的 Readeck 作为我的主要稍后读服务，并且实现了我接触的场景下全平台的发送网址 / 阅读解决方案，虽然相比商业化的稍后读服务需要自己手动配置多种服务，但由于是自部署的服务，数据安全和网络访问上其实要比商业化的服务要更为可靠，如果你和我一样之前使用的是海外的商业化的稍后读服务，不妨尝试自己部署 Readeck 让数据掌握在自己手中。\n关注 少数派小红书，感受精彩数字生活 🍃\n实用、好用的 正版软件，少数派为你呈现 🚀\n补充 nginx 对 readeck的 代理，即使用 xxx.com/read/ 访问。\ndocker-compose\nversion: \u0026#34;3.0\u0026#34; services: readeck: container_name: Readeck image: codeberg.org/readeck/readeck:latest security_opt: - no-new-privileges:true restart: on-failure:5 ports: - 4522:8000 volumes: - $HOME/docker_assets/readeck/data:/readeck:rw environment: READECK_USE_X_FORWARDED: 1 READECK_SERVER_PREFIX: /read READECK_DATABASE_SOURCE: postgres://readeck:readeckpass@readeck-db:5432/readeck readeck-db: image: postgres:12-alpine container_name: Readeck-DB hostname: readeck-db security_opt: - no-new-privileges:true healthcheck: test: - CMD - pg_isready - -q - -d - readeck - -U - readeck timeout: 45s interval: 10s retries: 10 volumes: - $HOME/docker_assets/readeck/db:/var/lib/postgresql/data:rw environment: POSTGRES_DB: readeck POSTGRES_USER: readeck POSTGRES_PASSWORD: readeckpass restart: on-failure:5 networks: {} location /read/ { proxy_pass http://127.0.0.1:4522/read/; proxy_set_header Host $host:$server_port; proxy_set_header X-Real-Scheme $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # WebSocket support proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_read_timeout 120s; proxy_next_upstream error; proxy_redirect off; proxy_buffering off; } config.toml\n[main] log_level = \u0026#34;info\u0026#34; secret_key = \u0026#34;\u0026#34; data_directory = \u0026#34;data\u0026#34; [server] \u0026lt;--- 这里保持默认就可以了 host = \u0026#34;0.0.0.0\u0026#34; port = 8000 [database] source = \u0026#34;postgres://readeck:readeckpass@readeck-db:5432/readeck\u0026#34; 开发文档 https://readeck.org/en/docs/dev\n","permalink":"/post/c7-toolchain/readeck-tips/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e本文由 \u003ca href=\"http://ksria.com/simpread/\"\u003e简悦 SimpRead\u003c/a\u003e 转码， 原文地址 \u003ca href=\"https://sspai.com/post/89289\"\u003ehttps://sspai.com/post/89289\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003c!-- more --\u003e\n\u003chr\u003e\n\u003cp\u003e作为喜欢阅读互联网长文的「上世代互联网遗老」，我一直保持着一个和现在互联网快消时代格格不入的爱好：偏爱长内容，这包括了我喜欢观看哪些具有丰富知识内容的长视频，收听播客节目以及阅读长篇的文章。尤其是长篇文章，往往是在我在碎片化的时间浏览公众号或者 RSS 订阅时，然后就会把这篇长文发到我的稍后读应用或者推送到我的 Kindle 邮箱中，等晚上做到书桌前仔细深度阅读。\u003c/p\u003e\n\u003cp\u003e因此我一直都非常留意各家的稍后读 / 书签服务，从最早的 instapaper、Pocket 到后来使用 Kindle 的邮箱推送等都有尝试，只不过在国内这个互联网环境中难免会遇到网络访问稳定性的问题——毕竟这几种稍后读服务都来自国外开发商，经常会遇到发送微信公众号文章后重排版出错的情况，就更别提数据保留的安全性问题了。\u003c/p\u003e\n\u003cp\u003e既然我已经在家中部署了 NAS，秉承「将数据保留在自己手上」的宗旨，我决定将稍后读 / 书签服务也进行自部署。而考虑到我实际的使用情况，我自部署的稍后读 / 书签服务需要满足以下几点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e支持自部署，且部署方式容易。\u003c/li\u003e\n\u003cli\u003e可以在手机端 / 桌面端进行进行阅读。\u003c/li\u003e\n\u003cli\u003e可以在不同的平台将文章 / 网页发送到稍后读服务中。\u003c/li\u003e\n\u003cli\u003e解析处理网页内容的速度要很快。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e而满足以上要求的就剩下了这款名为 Readeck 稍后读 / 书签服务。\u003c/p\u003e\n\u003ch3 id=\"安装-readeck-服务端\"\u003e\u003cstrong\u003e安装 Readeck 服务端\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003e和其他自部署的服务一样，作为一款自部署优先服务，Readeck 官方直接就提供了 Docker 的部署方式，当然考虑到我自己家中的 NAS 是群晖的 DS218+，官方 Docker 套件本身功能比较弱，因此我还额外使用 Portainer 这个可视化的容器部署工具来进行部署，这样做的另一个好处就是，即便你的 NAS 不是群晖，只要支持容器，也可以采用类似的办法做部署。\u003c/p\u003e\n\u003cp\u003e我这里依旧以群晖为参照，首先打开群晖的 File Station 中的 docker 目录，在目录下创建一个新文件夹并将其命名为 readeck（全部是小写字母）。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"069e4eb7887479dbd9965fe66592d07f_MD5.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e然后在新创建的这个\u003ccode\u003ereadeck\u003c/code\u003e 文件夹里面，在分别创建\u003ccode\u003edata\u003c/code\u003e以及\u003ccode\u003edb\u003c/code\u003e两个文件夹。这两个文件夹后面用来存储服务中所产生的数据。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"ba30f253cffcfa148f50a3034285873c_MD5.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e接下来我们就打开 Portainer 来进行服务容器的部署，这里打开并登录 Portainer，然后从左侧边栏中点击 Stacks，然后点击页面右上角的 \u003ccode\u003eAdd Stack\u003c/code\u003e来添加。\u003c/p\u003e","tags":["rss","知识管理"],"title":"「转」基于 Readeck 搭建个人稍后读/书签服务"},{"categories":["人工智能"],"content":"前言 “自然语言会成为下一代的编程语言，人人都能成为开发者。”\n4月16日，Create 2024百度AI开发者大会在深圳召开，百度创始人、董事长兼首席执行官李彦宏发表了《人人都是开发者》的主题演讲，描述了一个不再局限于编码技能的世界，而是以自然语言为媒介，人人都能参与创造的时代。\n演讲稿 大家好，欢迎参加Create 2024百度AI开发者大会，这是Create大会首次在粤港澳大湾区举办。今天现场来了5000多位开发者和科技爱好者。\n过去这一年，我跟很多创业者、开发者交流，感觉大家都处在一种“FOMO”状态，也就是Fear of Missing Out，既兴奋、又害怕错过。确实，大模型和生成式AI，将彻底改变开发者这个群体。\n过去，开发者用代码改变世界；未来，自然语言将成为新的通用编程语言，你只要会说话，就可以成为一名开发者，用自己的创造力改变世界。\n这一天并不遥远，我们看到，因为有了强大的基础大模型，有了很多低门槛，甚至零门槛的开发工具，开发者的生产力大大提高了。\n比如，基于文心大模型的智能代码助手Comate，不仅支持100多种语言和所有主流IDE平台，可以推荐代码、生成代码注释、查找代码缺陷、给出优化方案，还可以深度解读代码库、关联私域知识生成新的代码。上岗一年多，Comate已经走入了喜马拉雅、三菱电梯、软通动力等上万家企业，生成的代码采纳率达到了46%，百度每天新增的代码中，已经有27%是由Comate生成的。\n今天，你不会写代码，也可以做出一个AI应用；不用编程，也可以做出一个智能体。AI正在掀起一场创造力革命，未来开发应用就像拍个短视频一样简单，人人都是开发者，人人都是创造者。\n作为一家技术公司，百度的角色定位，就是尽可能地为大家提供所需的开发工具，不断提升整个社会的创造力。具体来说，我们提供1个强大的基础模型系列，就是文心大模型系列，这包括旗舰版的ERNIE3.5， ERNIE4.0， 也包括轻量版的ERNIE Speed、Lite、Tiny等等。\n我们还提供基于大模型来开发各种应用的工具，包括智能体开发工具AgentBuilder，AI原生应用开发工具AppBuilder，以及各种尺寸的模型定制工具ModelBuilder。这三个工具，都代表了先进生产力。下面，我会给大家一一展示。\n文心一言用户超2亿，文心大模型4.0工具版发布 首先讲一下，文心一言和文心大模型的最新进展：\n文心一言从去年3月16日发布，到今天是一年零一个月的时间。我们的用户数突破了2亿，API日均调用量也突破了2亿，服务的客户数达到了8.5万，利用千帆平台开发的AI原生应用数超过了19万。\n我们看看，大家都在用文心一言做什么？\n视频中的真人真事只是冰山一角。我们可以看到，文心一言正在改变更多人的工作和生活。\n支撑文心一言的基座模型，就是文心大模型。过去一年，它经历了从3.0版本到3.5，再到4.0版本的进化。文心4.0在理解、生成、逻辑、记忆四大能力方面，均达到了业界领军水平。\n近几个月来，文心大模型在代码生成、代码解释、代码优化等通用能力方面实现了进一步的显著提升，达到国际领先水平。\n今天，我们正式发布文心大模型4.0的工具版，现在，大家可以在工具版上，体验代码解释器功能，通过自然语言交互，就能实现对复杂数据和文件的处理与分析，还可以生成图表或文件，能够快速洞察数据中的特点、分析变化趋势、为后续的决策提供高效精准的支撑。\n文心大模型已经成为了中国最领先、应用最广泛的AI基础模型。\n不仅如此，相比一年前，文心大模型的算法训练效率提升到了原来的5.1倍，周均训练有效率达到98.8%，推理性能提升了105倍，推理的成本降到了原来的1%。\n也就是说，客户原来一天调用1万次，同样成本现在可以调用100万次。媒体可能不会因为成本下降99%而兴奋。但是企业也好，开发者也好，一旦用起来，最关注的就是效果和成本。\n我们能在提升性能的同时，把推理成本降到1%，正是因为百度在芯片、框架、模型、应用这四层架构上有着全栈的布局，通过端到端优化，不断地把成本打下来，让更多人都可以高效、低价地用大模型来做AI应用。\n毫无疑问，大模型相关的话题，在2024年依然会很热，各类技术突破还会不断涌现。媒体也会继续热衷于用“震撼发布”“史诗级更新”这样的标题进行渲染。但我想强调的是，大模型本身并不直接创造价值，基于大模型开发出来的AI应用才能满足真实的市场需求。\n分享开发AI原生应用的具体思路和工具：“踩了无数的坑，交了高昂学费” 今天我想跟大家分享的是一些基于大模型开发AI原生应用的具体思路和工具。这是我们百度根据过去一年的实践，踩了无数的坑，交了高昂的学费换来的。\n第一是MoE。未来大型的AI原生应用基本都是MoE架构，这里所说的MoE不是一般的学术概念，而是大小模型的混用，不依赖一个模型来解决所有问题。但什么时候调用小模型、什么时候调用大模型、什么时候不调用模型，这都是有技术含量的，要针对应用的不同场景做匹配。\n第二是小模型。小模型推理成本低，响应速度快，在一些特定场景中，经过SFT精调后的小模型，它的使用效果可以媲美大模型。这就是我们发布Speed，Lite、Tiny三个轻量模型的原因。我们通过大模型，压缩蒸馏出来一个基础模型，然后再用数据去训练，这比从头开始训小模型，效果要好很多，比基于开源模型训出来的模型效果更好，速度更快，成本更低。\n第三是智能体。智能体是当下很热的一个话题，随着智能体能力的提升，会不断催生出大量新的应用。智能体机制，包括理解、规划、反思和进化，它让机器像人一样思考和行动，可以自主完成复杂任务，在环境中持续学习、实现自我迭代和进化。在一些复杂系统中，我们还可以让不同的智能体互动，相互协作，更高质量地完成任务。这些智能体能力，我们已经开发出来了，并且向开发者全面开放。\n在MoE、小模型、智能体这三个方向上，百度都已经给大家做好了“开箱即用”的工具。下面，我就给大家介绍三种不同的工具，分别是：智能体开发工具AgentBuilder、AI原生应用开发工具AppBuilder、各种尺寸的模型定制工具ModelBuilder。\n智能体开发工具AgentBuilder 首先是智能体开发工具AgentBuilder。智能体可能是未来离每个人最近、最主流的大模型使用方式，基于强大的基础模型，智能体可以批量生成，应用在各种各样的场景。\n百度刚刚升级了文心智能体平台。截至目前，已经有3万多个智能体被创建、5万多名开发者和上万家企业入驻。我们的目标是，让每个人、每个组织都成为智能体的开发者，打造国内最完整的智能体生态。\n那如何实现这个目标呢？就是给大家提供零门槛的智能体开发工具AgentBuilder。\n下面我们就先以“新加坡旅游局”为例一起看看，一个智能体是如何做出来的。\n首先，我们打开文心智能体平台，创建页面有着零代码、低代码两种模式，新手可以直接选择“零代码模式”，用自然语言，几句话就能创建一个智能体。\n我们先给智能体起名叫“新加坡旅游局”，然后在设定里写明需要打造旅游方案、解答问题，提供酒店门票预订服务，这些设定都是用来指导智能体的，告诉它都能做什么。\n如果只需要基础智能体，平台会自动完成填写。但我们希望“新加坡旅游局”是一个专业的智能体，所以要进行高级配置。我可以把新加坡百科词条和官网链接都添加到知识库里，让它每天更新。然后添加一些工具，如酒店查询、景点门票购买等，增强它的服务能力。目前我们已经跟携程合作，提供了酒店、景点、票务等旅游服务工具。这样，一个新加坡旅游局的智能体就做好了，可以进一步预览、调优。\n现在打开百度APP，搜索“什么时候去新加坡人最少”，因为大家出去旅游都想避开人潮。智能体会综合多个来源的信息，生成一个答案，“1-3月人最少”。我们还可以点击智能体，和它进一步互动，比如去新加坡旅游的注意事项，推荐新加坡排名前三的酒店，还能让它直接预订新加坡环球影城的门票，一站式解决需求，大大节省了用户时间。\n除了新加坡之外，大连、沈阳等文旅类智能体也都在文心智能体平台上线，还有知识类、创作类、学习类、娱乐类等各式各样的智能体，这些都是用AgentBuilder做出来的。\n去年文心一言刚发布的时候，我就说过，文心一言会影响到每一家公司。因为它强大的自然语言理解能力、表达能力、推理能力，可以使任何一个公司都离自己的客户更近。\n今天，每一个商家、每一个客户，都能在百度拥有专属的智能体。整个过程完全不需要编程，通过类似提示词的信息输入，和简单的几步操作调优，就能迅速生成一个智能体，成为7X24小时在线的金牌业务员。\n我们来看一下，一个商家智能体是怎么做出来的。\n启德教育是家知名教育企业，在全国有60多家分支机构，还有很多海外分公司，覆盖国家广，对接待的话术要求很高。如何能全天24小时回复客户的咨询，并且提高接待水平、降低经营成本呢？\n启德教育利用百度的AgentBuilder，打造了专属的智能体。\n我们来看看，如何打造一个具备基本能力的智能体。很简单，在平台上填写智能体的头像、名称、经营业务范围和欢迎语，再设置一些需要用户提供的信息，比如年龄、学历。5分钟、零门槛，一个智能体就做好了。\n启德教育还希望这个智能体是个懂业务、懂学生的留学顾问。它可以针对学生的不同情况，比如想去美国还是澳洲、是硕士还是学士、雅思和托福考了多少分等等，做出专业分析，给出精准回答。我们可以通过添加知识、角色、工具这几大模块，来打造一个更高级的智能体。\n在知识模块中，上传私域知识，让平台实时解析，自动生成对话语料；在角色模块，把一些不在经营范围内的留学国家，增加到过滤方案中，可以提高用户线索的有效率；在工具模块，加入预约到店等服务。通过这样几步简单操作，一个拥有专业能力的启德教育智能体就做好了。\n现在，我们来搜索“澳洲留学申请条件”，可以看到智能体快速给出了需要的语言能力、专业选择等七大必备条件，还给能出相应的留学咨询方案，对各种难题都有问必答、有求必应。\n启德教育智能体非常的受欢迎，上线第一周，就成功分发了155万次，与用户交互了5.8万次，线索转化量直线增长、有效线索的转化成本明显降低，经营效率大幅提升。\n下面，我再给大家介绍一个家居行业的智能体。\n索菲亚是专注全屋定制的家居品牌。就像刚刚展示的，它也可以通过填写极其简单的信息，创建出一个基础的商家智能体。但对于家居行业，消费者的线下体验更重要，所以索菲亚希望能在线上打造出一个金牌销售，还原线下的接待体验。\n因此在进一步的设置中，它在角色模块，选择了数字人作为展示方式，然后给数字人选取了合适的背景和声音，并且结合平台的智能解析能力，自动总结了一套销售话术。最终打造出一位温柔亲切、话术专业的金牌销售，她能24小时满足用户的各种需求，提供高水准的服务体验。\n当百度搜索用户有装修诉求时，索菲亚智能体会利用文心大模型的能力，优先给出问题的答案。除此之外，她还会主动与客户确认具体需求，如装修类型、预算等，并推荐附近的线下门店。\n索菲亚商家智能体上线以来，有效线索成本下降了30%。也就是说，它获得一个有效客户，如果过去的成本是100块，现在只需要70块了。\n目前，已有超过1万个百度的客户拥有了商家智能体，涵盖了教育培训、房产家居、机械设备、商务服务等超过30个行业。\n上面，通过三个Demo，我展示了开发者和商家，如何利用AgentBuilder，制作不同行业智能体的过程。\n现在，制作一个智能体，真的就是分分钟的事。但问题来了！如果没流量、没分发、找不到、没人用，那么开发者和商家就没有收益，没有收益就没有动力。怎么解决这个痛点呢？\n我们的文心智能体平台，为开发者们提供了流量变现的通路。除了百度搜索，百度生态的其他产品，如小度、地图、贴吧、车机等，都能接入智能体的相关能力，为开发者解决流量分发的后顾之忧，获得实打实的收益。\n有分发，就会有数据反馈；有数据反馈，飞轮转起来，智能体就能够自主迭代，越用越聪明。文心智能体平台还上线了智能体的数据分析和问答调优模块，不久后还将有更多的新能力上线。文心智能体平台将通过分发-诊断-收益的数据飞轮，驱动智能体形成质量更优、流量更好、收益更大的正循环。\nAppBuilder：自然语言三步就能开发一个应用 下面，我给大家介绍第二个开发工具，AppBuilder。它是目前最好用的AI原生应用开发工具。在AppBuilder上面，我们提前封装和预置了开发AI原生应用所需的各种组件和框架，大幅降低开发门槛。\n最快只需三步，开发者就可以用自然语言开发出一个AI原生应用，并且能够便捷地发布、集成到各种各样的业务环境中。我们来看几个案例：\n今年年初，我们搞过一期AI原生应用开发挑战赛，赛题是利用AppBuilder打造一款“游乐场排队规划助手”，帮助游客更好地了解游乐场排队情况，设计个性化的游玩路线，在有限时间内获得最好的游玩体验。\n这期比赛的冠军选手，没写一行代码，就开发出了应用，拿到了百度提供的10万元大奖。这个题目如果会写代码的话，你写一个并不难，但是你一行代码都不写还能做出来，那还是非常依赖基础模型和AppBuilder这个工具的能力的。\n我们来看下，怎么用AppBuilder，把这个AI应用做出来。\n我们先回顾一下赛题。它假定了“环球影城”各个项目的排队时间和刺激指数，那么在有限的时间内获得刺激指数最高的体验，就是这期赛题要解决的问题。\n首先，打开AppBuilder的开发界面，给应用起名“游乐场排队助手”；第二步，我们在角色指令中描述具体要求，包括调用代码解释器、算出在固定时间内的最佳组合、输出结果等；第三步就是到工具组件中，把代码解释器添加进来，帮助运算。\n现在，我们来测下效果，在右侧输入问题“我有3个半小时时间，怎么玩最刺激？”，可以看到，代码解释器将这个问题翻译成了代码，再调用数据理解工具，对已知条件进行分析。经过一系列计算，得出将《哈利波特禁忌之旅》、《侏罗纪大冒险》、《霸天虎过山车》、《大黄蜂回旋机》，这四个项目组合游玩，效果最佳。测试没问题，点击发布，在零代码的情况下，一个应用就生成了。\n现在，AppBuilder又进一步升级了，在创建的过程中，全部可以通过“AI优化配置”功能，自动帮助开发者优化角色指令、组件配置等环节，进一步提高开发效率。\n我们再看一个例子。\n今年年初，华北电力大学提出，希望为全校师生提供智能化的专属服务。基于百度的AppBuilder，我们共同打造了一个华电AI助理，下面，我来给大家展示一下，华电AI助理是怎么做出来的：\n第一步：打开AppBuilder，进入创建页面，点击AI自动生成配置。首先为应用设置名称、简介、头像等基本信息。\n第二步：通过自然语言在角色指令中描述具体要求，包括任务、组件能力、要求与限制。\n第三步：插入自定义的图书借阅查询、课表查询、学生成绩查询等组件，让校园助手能够具备智能化服务的能力。之后再为校园助手添加一个开场白，这样应用就配置好了。\n接下来，我们在预览界面中，结合用户提问，对助手进行调试。比如询问四六级考试的报名时间，测试各组件自动调用的效果。\n大家可以看到，通过这些简单的操作，这个应用就构建完成了。目前已经小规模测试上线，接入了查制度、查课程，充饭卡、借书籍等高频场景，服务了学校广大师生。后续，我们将与华北电力大学一起，进一步深化应用合作，提供更为丰富便捷的服务。\n百度在跨模态方面，也有着多年技术积累。在AppBuilder上面，我们也提供了一定的跨模态能力，你只需要给一段文字，或者几句话，就可以快速创建绘画类的应用，像漫画、儿童画本等。\n过程也很简单：打开AppBuilder，点击进入“应用创建”，输入角色指令，选择“添加文生图”组件，再输入三个推荐问题，就可以点击发布了。应用做好后，我们只需要输入一个大概想要的角色或剧情，AppBuilder就可以自动生成故事、输出图画。\n百度文库最新推出的智能漫画和画本生成功能，就利用了AppBuilder上提供的这类组件。我们来看看，百度文库的漫画生成功能，是如何让每一个有创想的人，都能做出好作品的。\n以经典的《周处除三害》为例。\n打开百度文库，输入主题《周处除三害》，这在《晋书》和《世说新语》里都有写到，文库搜索后，会根据原文生成故事，我们也可以再对故事内容进行修改；然后点击右侧的AI工具栏，开始创建这篇漫画。\n进入漫画制作界面，文库将根据故事情节为我们自动生成漫画分镜；然后从光影、写实、卡通等多种风格中，选择最贴合故事的漫画风格；最后根据角色选择不同的人物形象，这样就完成了漫画的生成。\n漫画生成后，我们可以在百度文库的智能漫画编辑器里，浏览完整的漫画。同时，文库支持对每一个画面进行编辑、修改和精调，比如，在左侧选中画面“周处与白额虎”，点击编辑，增加画面描述“人物面容清晰，画面明亮”，就能精调出更符合需求的漫画。大家看到，百度文库的漫画功能在角色和场景的风格一致性方面，都做得非常出色。\n百度文库的智能漫画能力，极大地提高了创作漫画的效率，降低了漫画创作的成本和门槛，可以让更多有想法、有创意的人实现自己的漫画创作梦。\n不止生成漫画，百度文库现在还可以帮助用户零门槛的创作画本。大家可能不知道，中国小孩一年的人均绘本阅读量只有10本，而欧美国家是50本左右。现在，AI能够让完全没有绘画能力的父母，也可以为自己的孩子创作一个专属的儿童画本了。下面我们就来看一下这个图文并茂的有声画本吧！\n从去年开始，我们用AI重构了百度文库，使它成为用户“内容生产的起点”。如今，在AppBuilder的支持下，百度文库新推出的智能漫画和智能画本功能，更是把场景延伸到了更加有趣的跨模态创作领域。\n刚才我用三个案例，展示了如何用百度的AppBuilder，做出AI原生应用。大家应该能够感受到AppBuilder的两个明显优势：\n一是功能强大。依托文心4.0对指令的理解和遵循能力，我们的AppBuilder，能保证冷启动就能达到一个不错的水平，不会因为效果差，再花很长时间去调优，大大降低了开发门槛。依托检索增强技术RAG，在知识问答等典型场景，我们的问答准确率和友好回复程度都达到了95%以上，大幅超越其他同类产品。AppBuilder还提供丰富完整的组件工具，包括百度搜索等基于百度多年技术积累的AI能力组件、大模型能力组件，还有百度独家开放的业务组件等55个组件。以及一些主流场景的第三方API，比如航班查询、论文查询等。我们还刚刚支持了自定义组件，客户可以直接对接自己专有的任何工具和数据。这些丰富的组件，共同支撑起了AI原生应用的高效开发。\n二是简单易用。使用AppBuilder，只需三步即可快速创建应用、一键分发。我们也支持开源的SDK，方便大家进行二次开发。\n模型定制工具ModelBuilder：高效低价生产模型 下面我再介绍一下更适合专业开发者使用的工具，那就是ModelBuilder，它可以根据开发者的需求定制任意尺寸的模型，并根据细分场景对模型进一步精调SFT，这样就能达到更好的效果。对开发者来说，用好大模型很重要的一件事儿，就是掌握模型精调的方法。\n我们以教育行业的作文批改场景来举例。因为作文批改有明确的评分标准，并且不同年级对作文的要求和打分标准，也是不同的。这就需要模型精调，让大模型输出的结果，更符合特定的要求。\n我们就来看一下，ModelBuilder是如何实现作文批改的模型精调的。\n第一步：创建数据集。模型精调的效果很大程度依赖我们的数据质量。在这个案例中，原始数据只有180条，质量也不够高。我们就需要用到三个功能：数据清洗、数据标注和数据增强。数据清洗，可以快速去除数据的空缺、乱码等问题。数据标注方面，我们对作文增加了更多维度，比如内容深度、写作手法等评价。数据增强功能，可以生成同类但不重复的数据，进行数据扩充。扩充后，ModelBuilder给我们生成了920条高质量数据。\n第二步，就进入模型精调阶段了。首先，我们需要选择一个进行精调的基础模型，这里我们选择了ERNIE Speed作为基础模型。然后，我们根据平台推荐值来配置参数，这次数据接近1000条，按照推荐的迭代轮次，配置为10轮，然后就可以让模型开始训练了。\n第三步：把模型部署在平台上，这样整个精调过程就完成了。\n我们来用一篇中学作文，测试下精调后的模型效果。作文题目是《期待长大》，题材不限，不少于800字。\n我们将一篇学生的作文及批改格式要求，输入到精调前后的两个模型里。来看下，两个模型及老师点评三者的对比。可以看到，精调后的大模型拥有了更加专业的老师点评思维、更好地做了格式遵循。原本老师需要较长时间才能完成的作文批改任务，现在借助大模型，几秒钟就可以快速完成，大大地提升了给学生反馈的速度和效率。目前，这一类精调后的模型，已经在多个教育行业的头部企业中应用起来了。\n我前面谈到大型AI原生应用一般都是MoE。那么，该如何组合使用这些模型，获得最好的性价比呢？下面，我就用小度来展示一个MoE模型路由的案例。我们首先来看看，有了大模型的加持，小度是不是变得更聪明了：\nRobin：小度小度 小度：在呢\nRobin：今天有什么新闻？\n小度：小度播3-5条当日新闻快讯\nRobin：小度小度。听说你最近长本事了？ 小度：我不单能陪你聊天，还能做你的AI日程助手\nRobin：那我要来考考你了。帮我安排一下日程，今天活动结束后，我会和张总一起用晚餐，之后在酒店有个管理层的会议，大概需要1个半小时，希望10点之前可以结束。明早我准备晨跑，看看天气如何，然后上午8点有个早会，请帮我安排好日程。 小度：根据您需求，小度给您制定最优的日程安排如下\n您与张总晚餐安排在18：00-19：30，结束后，您将在20：00参加管理层会议，21:30左右结束 明早6点闹钟将提醒您起床去晨跑，跑步时长控制在1个小时以内，确保明早8点早会不迟到 明早天气晴朗，气温25度，建议您穿短袖外出，做好防晒 您看我能不能当你的秘书，我还有更多新技能呢 Robin：挺好的，很棒（向小度竖起大拇指），把这些日程同步到我的手机上吧。\n刚刚，我向小度提出了好几个问题，其中既有简单的新闻问询，也有复杂的日程安排需求。看起来是跟同一个小度在交流，其实背后调用了不同的模型。当它接受到我的问题后，先是由小模型ERNIE Tiny执行了“模型路由”的工作；对于天气问题，它根据天气查询的结果，调用基于ERNIE Lite打造的精调模型，也是经过SFT的ERNIE Lite，给出了穿衣建议；对于更复杂的日程安排，则调用了性能最好的大模型——文心4.0，来计算出从今晚到明早的各项事项安排。\n今天，我们提给小度的每个问题，都会这样分配给不同模型来执行，调用应用的API接口时，会用ERNIE Functions模型，给孩子讲题时，用文心大模型3.5或4.0，智能助理的打造则用了ERNIE Character模型，提高人设一致性、激发用户聊天欲望。\n通过这种大小模型的组合调度方式，小度不仅顺利完成了“换脑行动”，装上了全新的AI原生操作系统DuerOS X，而且形成了效果、速度和成本的最优组合，相比全部使用文心大模型的旗舰版，让响应速度提升2倍，成本下降了99%。刚才和我对话的这个小度添添AI平板机器人，昨天已经在各大平台全面开售，有兴趣的朋友们可以即刻下单体验了。\n这几个关于ModelBuilder的例子，展示的是百度高效低价生产模型的能力。因为有了最强大的基础模型文心4.0，我们可以根据需要，兼顾效果、响应速度、推理成本等各种考虑，裁剪出适合各种场景的更小尺寸模型，并且支持精调和post pretrain。这样通过降维裁剪出来的模型，比直接拿开源调出来的模型，同等尺寸下，效果明显更好，同等效果下，成本明显更低。大家以前用开源觉得开源便宜，其实在大模型场景下，开源是最贵的。所以开源模型会越来越落后。\n为了方便大家快速上手，ModelBuilder预置了最全面最丰富的大模型。包括了ERNIE3.5和ERNIE4.0，这是旗舰版的大模型，它适合通用的复杂场景，能力强大；还有三个轻量级的大模型， ERNIE Speed、Lite、Tiny；另外还有两个垂直场景的模型，ERNIE Character适合角色扮演；ERNIE Functions适合对话或问答场景中的外部工具使用和业务函数调用。当然ModelBuilder也支持国内外第三方主流模型，总数量达到77个，是国内拥有大模型数量最多的开发平台。\n第二届“文心杯”创业大赛正式启动：设5000万元特别大奖\n对于开发者，我们除了提供这些开发工具，还提供资金和资源方面的支持。\n去年5月份，百度启动了“文心杯”创业大赛，希望推动大模型生态繁荣，打造更有活力的生态系统，帮助创业者、开发者开发各种AI原生应用。第一届“文心杯”创业大赛，我们收到了近1000支创业团队报名，百度为其中的15支优胜团队，提供了近亿元的投资支持，并且在技术、团队和资源上持续提供全方位扶持。\n今天我宣布，第二届“文心杯”创业大赛正式启动。这次我们将扩大项目筛选范围、设置分赛场，面向全球市场及高校学子，招募创业创新团队，只要你的创业方向是AI原生应用，都可以在大赛官网报名参赛。同时，我们也加大了对创业者的支持力度，提供更充足的投资资金、更丰富的业务资源，还首次设立了“特别大奖”，特别优秀的项目将有机会获得最高5000万人民币的现金和资源支持。\n中国的创业者和开发者，非常善于利用新技术来开发应用。我相信，文心大模型将成为中国AI创业者和开发者的首选，越来越多的应用会建立在文心大模型之上。我也期待，更多创业者和开发者加入我们，一起构建繁荣的AI生态。\n视觉大模型最大的应用场景是自动驾驶\n前面我们谈到的这些工具和案例，大部分都是基于大语言模型的。面向未来，我认为多模态大模型，或者说文字、图片、语音、视频等多模态的融合，是基础模型非常重要的长期发展方向，是通往AGI的必经之路。百度在这些领域有着长期投入，并将及时更新技术进展。\n我有一个非常不一样的判断：视觉大模型最大的应用场景是自动驾驶。百度在这个方向上是最好的，是自动驾驶的全球领导者，我们不只训练AI如何生成视频，更训练AI理解真实世界发生的事情并预测未来。\n基于超过1亿公里的、中国复杂城市道路测试里程数据，百度训练出来了Apollo视觉感知大模型。它具备检测、跟踪、理解、建图四大基础能力。这让百度拥有了更智能、适应性更强、更安全的自动驾驶方案。\n百度地图也率先将视觉感知大模型应用到了制图领域。现在，全球最大规模的车道级地图数据，已经上线全国360座城市。只要百度地图导航能去的地方，智驾就都能开。\n今年春节后，百度的萝卜快跑实现了万里长江“第一跨”， 我们把服务从长江的北岸延伸到了南岸，在武汉的部分区域，我们已经实现了7X24小时的全天候运营，还计划年内在武汉部署1000台无人驾驶车辆。\n这是自动驾驶走向真正商业化的一个标志性事件，它不再仅仅是区域性的示范，而是进入到了城市级应用示范的新阶段。萝卜快跑在武汉覆盖了3000多平方公里、770万人口，是全球范围内最大规模的自动驾驶运营区域。\n“打包带走，随取随用”\n刚才，我给大家展示了百度文心大模型系列，以及三个开发工具——AgentBuilder、AppBuilder、ModelBuilder，他们组成了一个工具箱，你们可以马上打包带走，随取随用。\n此时此刻，我站在这里，其实也是一个开发者、一个创业者，跟大家一样兴奋。今天的中国，有10亿互联网用户，有强大的基础大模型，有足够多的AI应用场景，有全球最完备的产业体系，国家也在大力鼓励和支持“人工智能+”行动，每一个人，每一家企业，只需要充分利用这些工具，就可以释放无限的创造力和生产力。\n今天，人人都可以成为开发者。而未来，也必将是一个由开发者一起创造出来的未来。\n参考 ","permalink":"/post/c3-ai/everyone-developer/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e“自然语言会成为下一代的编程语言，人人都能成为开发者。”\u003c/p\u003e\n\u003cp\u003e4月16日，Create 2024百度AI开发者大会在深圳召开，百度创始人、董事长兼首席执行官李彦宏发表了《人人都是开发者》的主题演讲，描述了一个不再局限于编码技能的世界，而是以自然语言为媒介，人人都能参与创造的时代。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"演讲稿\"\u003e演讲稿\u003c/h2\u003e\n\u003cp\u003e大家好，欢迎参加Create 2024百度AI开发者大会，这是Create大会首次在粤港澳大湾区举办。今天现场来了5000多位开发者和科技爱好者。\u003c/p\u003e\n\u003cp\u003e过去这一年，我跟很多创业者、开发者交流，感觉大家都处在一种“FOMO”状态，也就是Fear of Missing Out，既兴奋、又害怕错过。确实，大模型和生成式AI，将彻底改变开发者这个群体。\u003c/p\u003e\n\u003cp\u003e过去，开发者用代码改变世界；未来，自然语言将成为新的通用编程语言，你只要会说话，就可以成为一名开发者，用自己的创造力改变世界。\u003c/p\u003e\n\u003cp\u003e这一天并不遥远，我们看到，因为有了强大的基础大模型，有了很多低门槛，甚至零门槛的开发工具，开发者的生产力大大提高了。\u003c/p\u003e\n\u003cp\u003e比如，基于文心大模型的智能代码助手Comate，不仅支持100多种语言和所有主流IDE平台，可以推荐代码、生成代码注释、查找代码缺陷、给出优化方案，还可以深度解读代码库、关联私域知识生成新的代码。上岗一年多，Comate已经走入了喜马拉雅、三菱电梯、软通动力等上万家企业，生成的代码采纳率达到了46%，百度每天新增的代码中，已经有27%是由Comate生成的。\u003c/p\u003e\n\u003cp\u003e今天，你不会写代码，也可以做出一个AI应用；不用编程，也可以做出一个智能体。AI正在掀起一场创造力革命，未来开发应用就像拍个短视频一样简单，人人都是开发者，人人都是创造者。\u003c/p\u003e\n\u003cp\u003e作为一家技术公司，百度的角色定位，就是尽可能地为大家提供所需的开发工具，不断提升整个社会的创造力。具体来说，我们提供1个强大的基础模型系列，就是文心大模型系列，这包括旗舰版的ERNIE3.5， ERNIE4.0， 也包括轻量版的ERNIE Speed、Lite、Tiny等等。\u003c/p\u003e\n\u003cp\u003e我们还提供基于大模型来开发各种应用的工具，包括智能体开发工具AgentBuilder，AI原生应用开发工具AppBuilder，以及各种尺寸的模型定制工具ModelBuilder。这三个工具，都代表了先进生产力。下面，我会给大家一一展示。\u003c/p\u003e\n\u003ch2 id=\"文心一言用户超2亿文心大模型40工具版发布\"\u003e文心一言用户超2亿，文心大模型4.0工具版发布\u003c/h2\u003e\n\u003cp\u003e首先讲一下，文心一言和文心大模型的最新进展：\u003c/p\u003e\n\u003cp\u003e文心一言从去年3月16日发布，到今天是一年零一个月的时间。我们的用户数突破了2亿，API日均调用量也突破了2亿，服务的客户数达到了8.5万，利用千帆平台开发的AI原生应用数超过了19万。\u003c/p\u003e\n\u003cp\u003e我们看看，大家都在用文心一言做什么？\u003c/p\u003e\n\u003cp\u003e视频中的真人真事只是冰山一角。我们可以看到，文心一言正在改变更多人的工作和生活。\u003c/p\u003e\n\u003cp\u003e支撑文心一言的基座模型，就是文心大模型。过去一年，它经历了从3.0版本到3.5，再到4.0版本的进化。文心4.0在理解、生成、逻辑、记忆四大能力方面，均达到了业界领军水平。\u003c/p\u003e\n\u003cp\u003e近几个月来，文心大模型在代码生成、代码解释、代码优化等通用能力方面实现了进一步的显著提升，达到国际领先水平。\u003c/p\u003e\n\u003cp\u003e今天，我们正式发布文心大模型4.0的工具版，现在，大家可以在工具版上，体验代码解释器功能，通过自然语言交互，就能实现对复杂数据和文件的处理与分析，还可以生成图表或文件，能够快速洞察数据中的特点、分析变化趋势、为后续的决策提供高效精准的支撑。\u003c/p\u003e\n\u003cp\u003e文心大模型已经成为了中国最领先、应用最广泛的AI基础模型。\u003c/p\u003e\n\u003cp\u003e不仅如此，相比一年前，文心大模型的算法训练效率提升到了原来的5.1倍，周均训练有效率达到98.8%，推理性能提升了105倍，推理的成本降到了原来的1%。\u003c/p\u003e\n\u003cp\u003e也就是说，客户原来一天调用1万次，同样成本现在可以调用100万次。媒体可能不会因为成本下降99%而兴奋。但是企业也好，开发者也好，一旦用起来，最关注的就是效果和成本。\u003c/p\u003e\n\u003cp\u003e我们能在提升性能的同时，把推理成本降到1%，正是因为百度在芯片、框架、模型、应用这四层架构上有着全栈的布局，通过端到端优化，不断地把成本打下来，让更多人都可以高效、低价地用大模型来做AI应用。\u003c/p\u003e\n\u003cp\u003e毫无疑问，大模型相关的话题，在2024年依然会很热，各类技术突破还会不断涌现。媒体也会继续热衷于用“震撼发布”“史诗级更新”这样的标题进行渲染。但我想强调的是，大模型本身并不直接创造价值，基于大模型开发出来的AI应用才能满足真实的市场需求。\u003c/p\u003e\n\u003ch2 id=\"分享开发ai原生应用的具体思路和工具踩了无数的坑交了高昂学费\"\u003e分享开发AI原生应用的具体思路和工具：“踩了无数的坑，交了高昂学费”\u003c/h2\u003e\n\u003cp\u003e今天我想跟大家分享的是一些基于大模型开发AI原生应用的具体思路和工具。这是我们百度根据过去一年的实践，踩了无数的坑，交了高昂的学费换来的。\u003c/p\u003e\n\u003cp\u003e第一是MoE。未来大型的AI原生应用基本都是MoE架构，这里所说的MoE不是一般的学术概念，而是大小模型的混用，不依赖一个模型来解决所有问题。但什么时候调用小模型、什么时候调用大模型、什么时候不调用模型，这都是有技术含量的，要针对应用的不同场景做匹配。\u003c/p\u003e\n\u003cp\u003e第二是小模型。小模型推理成本低，响应速度快，在一些特定场景中，经过SFT精调后的小模型，它的使用效果可以媲美大模型。这就是我们发布Speed，Lite、Tiny三个轻量模型的原因。我们通过大模型，压缩蒸馏出来一个基础模型，然后再用数据去训练，这比从头开始训小模型，效果要好很多，比基于开源模型训出来的模型效果更好，速度更快，成本更低。\u003c/p\u003e\n\u003cp\u003e第三是智能体。智能体是当下很热的一个话题，随着智能体能力的提升，会不断催生出大量新的应用。智能体机制，包括理解、规划、反思和进化，它让机器像人一样思考和行动，可以自主完成复杂任务，在环境中持续学习、实现自我迭代和进化。在一些复杂系统中，我们还可以让不同的智能体互动，相互协作，更高质量地完成任务。这些智能体能力，我们已经开发出来了，并且向开发者全面开放。\u003c/p\u003e\n\u003cp\u003e在MoE、小模型、智能体这三个方向上，百度都已经给大家做好了“开箱即用”的工具。下面，我就给大家介绍三种不同的工具，分别是：智能体开发工具AgentBuilder、AI原生应用开发工具AppBuilder、各种尺寸的模型定制工具ModelBuilder。\u003c/p\u003e\n\u003ch2 id=\"智能体开发工具agentbuilder\"\u003e智能体开发工具AgentBuilder\u003c/h2\u003e\n\u003cp\u003e首先是智能体开发工具AgentBuilder。智能体可能是未来离每个人最近、最主流的大模型使用方式，基于强大的基础模型，智能体可以批量生成，应用在各种各样的场景。\u003c/p\u003e\n\u003cp\u003e百度刚刚升级了文心智能体平台。截至目前，已经有3万多个智能体被创建、5万多名开发者和上万家企业入驻。我们的目标是，让每个人、每个组织都成为智能体的开发者，打造国内最完整的智能体生态。\u003c/p\u003e\n\u003cp\u003e那如何实现这个目标呢？就是给大家提供零门槛的智能体开发工具AgentBuilder。\u003c/p\u003e\n\u003cp\u003e下面我们就先以“新加坡旅游局”为例一起看看，一个智能体是如何做出来的。\u003c/p\u003e\n\u003cp\u003e首先，我们打开文心智能体平台，创建页面有着零代码、低代码两种模式，新手可以直接选择“零代码模式”，用自然语言，几句话就能创建一个智能体。\u003c/p\u003e\n\u003cp\u003e我们先给智能体起名叫“新加坡旅游局”，然后在设定里写明需要打造旅游方案、解答问题，提供酒店门票预订服务，这些设定都是用来指导智能体的，告诉它都能做什么。\u003c/p\u003e\n\u003cp\u003e如果只需要基础智能体，平台会自动完成填写。但我们希望“新加坡旅游局”是一个专业的智能体，所以要进行高级配置。我可以把新加坡百科词条和官网链接都添加到知识库里，让它每天更新。然后添加一些工具，如酒店查询、景点门票购买等，增强它的服务能力。目前我们已经跟携程合作，提供了酒店、景点、票务等旅游服务工具。这样，一个新加坡旅游局的智能体就做好了，可以进一步预览、调优。\u003c/p\u003e\n\u003cp\u003e现在打开百度APP，搜索“什么时候去新加坡人最少”，因为大家出去旅游都想避开人潮。智能体会综合多个来源的信息，生成一个答案，“1-3月人最少”。我们还可以点击智能体，和它进一步互动，比如去新加坡旅游的注意事项，推荐新加坡排名前三的酒店，还能让它直接预订新加坡环球影城的门票，一站式解决需求，大大节省了用户时间。\u003c/p\u003e\n\u003cp\u003e除了新加坡之外，大连、沈阳等文旅类智能体也都在文心智能体平台上线，还有知识类、创作类、学习类、娱乐类等各式各样的智能体，这些都是用AgentBuilder做出来的。\u003c/p\u003e\n\u003cp\u003e去年文心一言刚发布的时候，我就说过，文心一言会影响到每一家公司。因为它强大的自然语言理解能力、表达能力、推理能力，可以使任何一个公司都离自己的客户更近。\u003c/p\u003e\n\u003cp\u003e今天，每一个商家、每一个客户，都能在百度拥有专属的智能体。整个过程完全不需要编程，通过类似提示词的信息输入，和简单的几步操作调优，就能迅速生成一个智能体，成为7X24小时在线的金牌业务员。\u003c/p\u003e\n\u003cp\u003e我们来看一下，一个商家智能体是怎么做出来的。\u003c/p\u003e\n\u003cp\u003e启德教育是家知名教育企业，在全国有60多家分支机构，还有很多海外分公司，覆盖国家广，对接待的话术要求很高。如何能全天24小时回复客户的咨询，并且提高接待水平、降低经营成本呢？\u003c/p\u003e\n\u003cp\u003e启德教育利用百度的AgentBuilder，打造了专属的智能体。\u003c/p\u003e\n\u003cp\u003e我们来看看，如何打造一个具备基本能力的智能体。很简单，在平台上填写智能体的头像、名称、经营业务范围和欢迎语，再设置一些需要用户提供的信息，比如年龄、学历。5分钟、零门槛，一个智能体就做好了。\u003c/p\u003e\n\u003cp\u003e启德教育还希望这个智能体是个懂业务、懂学生的留学顾问。它可以针对学生的不同情况，比如想去美国还是澳洲、是硕士还是学士、雅思和托福考了多少分等等，做出专业分析，给出精准回答。我们可以通过添加知识、角色、工具这几大模块，来打造一个更高级的智能体。\u003c/p\u003e\n\u003cp\u003e在知识模块中，上传私域知识，让平台实时解析，自动生成对话语料；在角色模块，把一些不在经营范围内的留学国家，增加到过滤方案中，可以提高用户线索的有效率；在工具模块，加入预约到店等服务。通过这样几步简单操作，一个拥有专业能力的启德教育智能体就做好了。\u003c/p\u003e\n\u003cp\u003e现在，我们来搜索“澳洲留学申请条件”，可以看到智能体快速给出了需要的语言能力、专业选择等七大必备条件，还给能出相应的留学咨询方案，对各种难题都有问必答、有求必应。\u003c/p\u003e\n\u003cp\u003e启德教育智能体非常的受欢迎，上线第一周，就成功分发了155万次，与用户交互了5.8万次，线索转化量直线增长、有效线索的转化成本明显降低，经营效率大幅提升。\u003c/p\u003e\n\u003cp\u003e下面，我再给大家介绍一个家居行业的智能体。\u003c/p\u003e\n\u003cp\u003e索菲亚是专注全屋定制的家居品牌。就像刚刚展示的，它也可以通过填写极其简单的信息，创建出一个基础的商家智能体。但对于家居行业，消费者的线下体验更重要，所以索菲亚希望能在线上打造出一个金牌销售，还原线下的接待体验。\u003c/p\u003e\n\u003cp\u003e因此在进一步的设置中，它在角色模块，选择了数字人作为展示方式，然后给数字人选取了合适的背景和声音，并且结合平台的智能解析能力，自动总结了一套销售话术。最终打造出一位温柔亲切、话术专业的金牌销售，她能24小时满足用户的各种需求，提供高水准的服务体验。\u003c/p\u003e\n\u003cp\u003e当百度搜索用户有装修诉求时，索菲亚智能体会利用文心大模型的能力，优先给出问题的答案。除此之外，她还会主动与客户确认具体需求，如装修类型、预算等，并推荐附近的线下门店。\u003c/p\u003e\n\u003cp\u003e索菲亚商家智能体上线以来，有效线索成本下降了30%。也就是说，它获得一个有效客户，如果过去的成本是100块，现在只需要70块了。\u003c/p\u003e\n\u003cp\u003e目前，已有超过1万个百度的客户拥有了商家智能体，涵盖了教育培训、房产家居、机械设备、商务服务等超过30个行业。\u003c/p\u003e\n\u003cp\u003e上面，通过三个Demo，我展示了开发者和商家，如何利用AgentBuilder，制作不同行业智能体的过程。\u003c/p\u003e\n\u003cp\u003e现在，制作一个智能体，真的就是分分钟的事。但问题来了！如果没流量、没分发、找不到、没人用，那么开发者和商家就没有收益，没有收益就没有动力。怎么解决这个痛点呢？\u003c/p\u003e","tags":["百度","演讲","转载"],"title":"「转」人人都是开发者"},{"categories":["生活"],"content":"我被公司裁了。 我一手搭建起核心项目的底层框架，总算熬出头时，公司把我裁了。 CEO 当着全公司的面落井下石，羞辱我是滥竽充数。 他不知道，核心代码的故障只有我能修。 公司求我的日子比想象中来得更快。\n1\n「很遗憾地通知您，公司有人员调整，将结束与您的聘用关系。」 「您的门禁卡已经失效，请您立刻搬走全部个人物品。」 我一头雾水。 本以为被人事叫走只是开个小会，没想到是裁员通知。 三年前，公司只是不足20人的小企业。 我抓住虚拟交互的风口，一手搭建起核心项目的底层框架。 我无数个夜晚加班加点，做出第一款产品一Ribo，以眼镜或车窗为载体，实现所有外界环境与人的虚拟交互。 再也不用佩戴笨重的VR 设备，用户仿佛生活在科幻大片中。 Ribo 一经上市，就引爆市场。 无数代理商和开发商找我们合作。 Ribo 生态仿佛摩天大楼一般建设起来。 我们公司的规模也迅速从 20人扩张到5000人。 Ribo 如火如荼地发展，我们也抓紧更新迭代。我流连在技术网站中，把Ribo的系统升级成最前沿的高可用架构。 这个架构搭建时非常困难，因为掌握核心技术的人不多。 我全身心投入到工作中，无暇处理其他事。 陈炳就是那个时期被招进来的。 最开始他跟着我做些琐事。他这个人很圆滑，最擅长向上社交。 他的朋友圈都是跟大老板打高尔夫、跟产品经理喝下午茶。 Ribo 新产品要开发布会，通知我准备稿子。 我嫌麻烦。陈炳自告奋勇，主动写好稿子上直播。 他的口才好，又积极，让我专心处理技术，以后的发布会都让他去。 我乐得清静。我一心只想让Ribo 更好。 他宣称自己是 Ribo 的总工程师。久而久之，外界也默认了。 他靠着人脉一路高升，做到首席 CEO. 与此同时，我完成了Ribo的升级，工作总算轻松了一点。\n2\n有人问过我，陈炳的技术怎么样? 我说:「一般，他更擅长社交。」 这话传到了陈炳耳朵里。 说者无意，听者有心。 陈炳在发布会上以「总工程师」自居，不能容忍有人拆他的老底。 经济下行时期，很多科技公司都受到波及。 Ribo 的股票也有下降，公司传出裁员风波。 我做梦也想不到，第一个被裁掉的竟然是我。 我回到工位收拾东西，内心一片茫然。 门口传来「陈总好!」的声音，我抬头看，陈炳大腹便便地走过来。 可能是应酬太多，这三年，他迅速发福，成了一个油腻的中年胖子。 他笑眯眯地打招呼:「早，各位早啊!」 他晃到我面前，满脸惊讶:「咦，黎工怎么在收拾东西?」 有几人向我看过来。 陈炳仿佛突然想到什么，大声说:「黎工不会是被裁了吧!」 他一咋呼，整个办公室的同事都停下工作来看我。 我回答他:「对。我还得收拾东西，先失陪了。」 陈炳的话根本就不是对我说的。 他转过身，痛心疾首一般围着我转: 「可惜啊，黎工也是公司的老员工了!」 「公司有人员调整，竟然把黎工给裁了。我就不明白，这么多技术人员不裁，怎么偏偏要裁你呢?」 「难道公司考察了所有人的KPI吗?」 我不喜欢搞形式主义，平时的汇报总结能省则省，专心干活。 陈炳说的 KPI 就是那些形式主义的报告之一。 「我也算是跟黎工共事过，实在痛心。」 「但是公司不养闲人!」 「要是黎工走了，公司业务照常运转，大家就能发现是谁只拿工资不干活了!」 他越说声音越大，幸灾乐祸地斜眼瞟我。\n3\n迟钝如我，也能猜到是谁想让我滚了。 裁员名单本来就是上面下达的。 我一肚子暗火，给大学室友打电话: 「Pocky，你之前说的项目，还缺人吗?」 电话那头欣喜若狂: 「哎呀，黎神，你终于腾出手来关心我啦!」 「你尽管开口，你想做什么项目我投资什么。」 我不禁莞尔:「行，你现在有空吗，见面详聊。」 「有空。那我开车去你公司楼下接你。」\n4\n我抱着一个纸箱，在公司楼下等车。 三年不舍昼夜，到头来属于我的也仅有这一箱杂物。 陈炳刚开完会，满脸堆笑地送几个合作商出来。 陈炳看到我，啧啧称奇: 「干活不行，收拾得倒挺快。」 我已经不是 Ribo 的员工了，他也不是我上司。 但陈炳显然还没从上司的角色转换过来。 「介绍一下，王总，徐总，这位是我们技术部的员工。」 「前几年公司扩招，招聘门槛低。我们系统升级后极大降低了人员成本，平时摸鱼的员工就被优化掉了。」 「两位对新系统有兴趣，我们继续谈合作?」 两位老总是跟陈炳差不多的身材，他们站一块儿像三个汽油桶。 陈炳凑近我，从鼻子里出声: 「喂，黎泉，听说你刚在市区买了房子，贷款压力不小吧。」 「我是个念旧情的人。要不，你帮二位老板背包，原地做五百个俯卧撑。」 「要是你能做完，我就跟人事说，继续聘用你，怎么样?」 我伸手过去，啪啪作响地拍了拍陈炳的大肚腩。 「我看该做俯卧撑的是你。」 二位老板哈哈大笑。 陈炳胖脸涨红，正欲发作。一辆劳斯莱斯疾驰过来，停在我们面前。 车头升起小金人，车门打开，驾驶座坐着一个身穿白西装的帅哥。 三年不见，这小子更帅了。 Pocky 探出头，把墨镜往头顶一撩，殷勤地给我开后车门: 「黎神，快请上车!」 我抱着纸箱坐进去。 Pockv 估计 他阴阳怪气地说 「老板们继续工作吧。我们闲人已经到下班时间了!」 他说完关门，劳斯莱斯扬长而去。\n5\n芮文是我的大学室友，一个眼光毒辣的富二代。 他超爱同名饼干，在宿舍必叼着一根，被我们笑称「Pocky」。 毕业之后，他继承家族企业，到处搞投资。 该说他运气不错还是实力过硬呢，他一投一个准，竟把家里资产又翻了几番。 从前年开始，他就不断劝我合伙开公司。 我那时专心升级Ribo，一口回绝了他。 我坐在劳斯莱斯舒适的座椅里，内心暗暗惆怅。 车窗外，挂着彩虹商标的 Ribo 大厦渐行渐远。 Pocky 从后视镜看我，通过我的纸箱和表情，他就懂了。 「Ribo 高层猪油蒙心了吗，竟然把总工程师给裁了。」Pocky 开口说。 我在后视镜中与他对视:「你怎么知道我是总工程师?」 Ribo 开发涉及公司机密，我从不对外透露。 外界只能通过陈炳在发布会上的陈词，得知 Ribo 的发展计划。 Pocky乐了: 「你忘了我们大学时参加的竞赛了?」 「你说，你一直想给车窗装上虚拟交互软件，这样就不用分心看车载导航了。」 「你以这个想法写出了 Ribo的雏形，我们获得了金奖。」 「可惜当年没有配套的硬件系统，那个雏形只停留在概念阶段。」 确实有这回事。 我沉迷工作太久，大学时代就好像上辈子一样久远。 Pocky 心潮澎湃地说: 「当时我觉得你就是天神下凡!这个大腿我抱定了!」 我勉强笑了笑。 虚拟交互一直是我的梦想。 现实中美好的事物太少了，我想让幻想进入现实，把彩虹握在手中。 Rainbow,Ribo. Ribo 迅速崛起的三年，说不自豪是假的。 可惜，我的彩虹终究是一场幻觉。\n6\nPocky 问我: 「你下一步有什么打算?」 我: 「不知道。你最近在做什么项目?」 Pocky: 「当然是 AI 啊，现在大家都拼命卷AI呢! 」 我点点头，叹了一口气。 Pocky 心中了然，安慰我说:「先别忙工作，你休假一段时间吧。」 这么一说，我很久没休过长假了，确实该放松一下身心。 我:「我想乘最近的航班去马尔代夫。」 Pocky:「海钓是吧，我懂!不用乘航班，坐我的直升飞机去。」 我: 「行。你把AI 相关的立项方案发给我，我在飞机上看。」 Pocky: 「? 」 Pocky:「你们 INTJ 都这么恐怖吗?」 我简单收拾行李。等飞机时，我看到Pocky 在抛售股票。 「怎么了，这么急着出手?」 Pocky 目露精光，预言说: 「我跟你打赌，Ribo 最近必出事。你也赶紧把 Ribo 的股票抛了吧，还不知道跌多少。」 我不乐意了:「你就这么不信任我写的系统?」 Pocky:「不是。你小子只会自己做事不教人，也不爱留文档记录。」 「Ribo马上要发布新功能，会出大乱子的。」 我回想起来，新架构升级后隐患很多，我准备写总结分享给同事看。 那份总结现在还只写了一半。 陈炳只看到升级后维护成本低，那是在正常运转的情况下。 一旦出故障，除了我，没人能修。 我料到会出事，但也没想到是那么惨重的事故。 而且比我预想得还要快。\n7\n我当晚就入住了马尔代夫高档度假酒店。 Pocky 是真心想拉拢我，酒店和交通都安排好了。 套房面对大海，三面落地窗。 我把衣服和日用品摆出来，整理好。 刚收拾完，手机收到同事信息。 不对，已经是前同事了。 【黎哥，快看同事圈!] 同事圈是某职场 APP 的认证领域。 Ribo 的同事通过认证后都可以进入，通讯录经常会推荐一些熟人。 公司的大部分八卦，都能在同事圈第一时间得知。 我倒了一杯马提尼，在落地窗前打开同事圈。 [黎姓员工巧立名目中饱私囊，被抓后不服管理碰瓷CEO!] 匿名发帖人。 配图是我在公司楼前拍陈炳肚腩，面露讥讽。 我放大图片看，灾难级的表情管理。 我平时的脸色都这么冷吗? 难怪大家不敢跟我说话。 发帖人痛斥我的「罪状」有三条: 其一，推行毫无必要的技术创新，资金都进了自己口袋。 其二，不按时签到，迟到早退、KPI 不达标。 其三，不尊重公司领导，散播谣言。 评论炸开了锅: 【所以公司要裁员也是谣言，就只开了一粒老鼠屎?] [支持!把占着茅坑不拉屎的都开掉，公司才能越来越好!] [这人是技术部门负责人吗，看着眼熟。] [总工程师是陈总啊，技术部哪有什么负责人?] 我看了一圈，起哄的都是其他部门的人。 前同事愤愤不平地发消息: [黎哥，你离职得太突然，我们都觉得对你不公平。) 【你走后，人事把技术部的组长挨个叫去开会。] 【谁敢在网上发言，就无赔偿解除劳动合同!]\n8\n我能理解他们的苦衷。 现在经济形势不好，工资高不加班的公司越来越少了。 像Ribo 一样飞速发展的更是凤毛麟角。 老员工搭上青春和健康，好不容易换来高新高职位。 一旦被开，经济压力大，在业内风评也不好。 毕竟人脉圈子很小，一做背调，就什么都清楚了。 给我发消息的前同事叫丽丽，技术部为数不多的女员工。 丽丽狂暴输入中\u0026hellip;.. 【什么叫毫无必要的技术创新!新架构节省了多少人力!] 【以前做部署要一整天，现在一小时就搞定!] 【他懂什么技术啊?凭什么这样说黎哥!] 升级新系统确实烧了不少钱，但是条目透明，都是层层审批通过的。 紧急用钱的时候还是我自己掏的腰包。 至于后面两条，懂的都懂。 我看丽丽情绪失控，回了一句安慰她: 【别激动，跟我抱怨下就行了，在网上说话小心点，会被追踪到的。] 丽丽对陈炳意见大是有原因的。 当初她刚入职，同事们奔走相告:我们有女同事了! 丽丽是校招来的，年轻好学，端庄得体，很有人缘。 我让她先看看基建，学习标准流程。 陈炳经常来技术部视察，见到她，兴致勃勃地叫她过去: 「新人吗，来我考考你。」 陈炳拿一个刚出炉的新需求考她。 我觉得这完全超出对校招生的能力要求。 丽丽回答得磕磕巴巴:「就，先，先找同类项目的文档，分析容量、问 PM 要实现的效果\u0026hellip;\u0026hellip;」 陈炳嗤笑一声，打断她: 「不会就说不会，不要不懂装懂!」 「女孩子嘛，本来就技术经验不足，多向同事请教，确定了再回答!」 丽丽突然被训，不敢出声，眼中闪烁。 我走过去。 「新人回答得很好啊。」 「有新需求，先回顾经验、确认需求、分析数据，条理清晰，非常可行!」 我挠了挠头皮:「而且技术经验跟性别无关。男孩女孩都一样!」 丽丽的表情由惊恐转为惊喜。 陈炳一张肥脸耷拉下来，满眼嫌恶。 我:「技术部正好也在为这个新需求发愁呢。正好陈总提到，我想请教一下现在有进展吗?」 我当时真以为他有两把刷子。 没想到他纯粹是想在女同事面前显摆。 陈炳开始顾左右而言他。 他一会儿说 PM 催得急，一会儿说经费不足，最后借口要开会逃走了。 从那以后，丽丽就对陈炳的能力很鄙夷。\n9\n不过丽丽有一点说错了。 陈炳很清楚升级新系统非常必要。 他就算对我有再多不满，也忍到我完成升级后才赶我走。 我翻阅这条「举报」帖子，评论越来越多。 有挖苦的，有嘲笑的，有恶意揣测的。 就是没有一个知道真相的。 几分钟过去，「举报」帖热度上升到同事圈榜首。 我的个人信息、缺勤记录、敷衍的 KPI报告都贴上去了。 没落实到报告上的业绩被抹得干干净净。 按理说，暴露私人信息的帖子会被管理员删除。 但它光明正大地摆在那里，是谁授意的不需多言。 丽丽在语音里急哭了。 这个帖子只要还在，我就别想入职好公司。 陈炳不想让我在Ribo 待着，更不想让我去别家待着。 回想起来，陈炳曾多次暗示我夹起尾巴做人。 「黎工，你没当过管理层不懂，这个工作不是普通员工能干的!」 「我对外要公关，对内担风险，你根本想不到有多难!」 可惜我没听懂他的「提点」: 「但你的年新也不是普通员工能比的啊!」 他的「工作」是有成果的: 「总工程师」是他，「Ribo」是他一手搭建，管理层上上下下都跟他有交情。 终于，他找准时机，把我像垃圾一样扫地出门。\n10\n【黎哥，那你要怎么办啊!] 我能怎么办? 我只能坐专机来海边度假、住高档酒店看日出、吃好喝好回家自己当老板咯! 我从无到有拉起 Ribo用了三年。 再用三年超越它便是。 不过，知道还有人为我抱不平，在Ribo 的三年终归没有白费。 这是今天唯一值得高兴的事情。\n11\n酒店有 VIP 健身房，我健完身，回房间洗澡。 工作不忙之后，我又拾起健身的习惯，调整回健康作息。 浴室的镜子水汽氤氲，我捋起湿发，看到自己的胸腹恢复了肌肉轮廓。 工作虽说劳累，但充满价值感。我的头发依旧茂密，双目有神，身材也没走形。 幸好应酬的活儿都被陈炳承包了。 早上 6点，我神清气爽地起床，背着钓具出发。 我们包了游艇去海钓。 游艇马达声轰隆作响，我戴上墨镜，躺在甲板的躺椅上。 碧海蓝天，温度宜人，清新的海风拂过，我好像刚刚从地狱来到人间。 人生如逆旅，我亦是行人。 咔嚓\u0026ndash;咔嚓\u0026ndash; 我睁眼，Pocky 正用手机偷拍我。 「我心想哪来的帅哥钓鱼佬，竟是我黎神!」 「这照片留着当招聘宣传图，哪个小姑娘看了不迷糊?」 我蹦起来抢他手机。 「删了，马上!」 Pocky 化身卖艺的吗喽，一溜烟跑到船尾。 他对着手机啧啧称奇: 「你放松下来明明很帅，平时的脸色就又冷又臭，难怪有人看不顺眼。」 我想反驳，但想起「举报」帖上我的表情。 我闭嘴了。\n12\n今天是 Ribo 新功能发布的日子。 往常我都是紧张兮兮地守着发布会直播间。 现在我和 Pocky 并排坐在甲板上，守着钓竿。 「有了!有了!快收竿!」 水下的力道巨大，我按捺住激动的心情，费了九牛二虎之力拉起钓竿。 是条体长一米二的旗鱼! 我和 Pocky 还有游艇船长，三个大男人吱哇乱叫。 最后我抱着旗鱼，船长拿着米尺，Pocky为我拍下这张纪念照。 照片中我昂首挺胸，五官打架。 回去我少说能吹一年。 这时，Pocky 手机响个不停。 他接起来，听了几句，爆发出一声:「啊!」 他火速冲到我面前:「快看头条新闻，快!」 我看他的手机网页。 网页被「Ribo 全线瘫痪，用户数据丢失」新闻刷屏。 [Ribo 新功能发布异常，产品全线瘫痪.] [CEO 匆忙结束发布会，回应正在抢修，修复时间未知。] 【有用户反馈，偶尔登录Ribo 后发现自己账户一片空白。] [Ribo产品已应用到实际生活的方方面面，日常使用需要高额的会员费、内购插件费。如果本次异常影响到用户数据，无疑会给Ribo 公司带来重创!] 我知道事态严重，洗完手认真看。 我看了发布会录像、用户社区大量的报障信息。 结合升级过后留下的隐患，我倒推代码逻辑，大致明白了问题出在哪里。 Pocky 提醒我看手机，我才发现自己的手机没电关机了。 我给手机充上电，开机。 未接来电爆发! 无数的消息涌进来。 我已经能想象出办公室里鬼哭狼嚎的场景了。 我根本接不过来，干脆让它一直响。 过了一会儿，终于消停了。我接起一个产品部打来的电话。 我没耐心听官话，直接说: 「我只跟 CEO 陈炳通话。」\n13\n我又拒接了几通电话。 我看到来电是陈炳的号码，接起来。 陈炳语速极快，急得像热锅上的蚂蚁。 陈炳:「你知道了吧?」 我: 「你也知道了?」 陈炳:「什么我也知道，我早就知道了!」 我吃惊:「你怎么知道我钓到旗鱼?」 我直接把我抱着旗鱼的照片高清原图发过去。 陈炳蒙了。 陈炳:「不是，谁知道你钓到旗鱼啊!」\n14\n「那你现在知道我钓到旗鱼了!」 电话那头，陈炳气急败坏。 「黎泉，没人跟你开玩笑!」 「你应该看到新闻了，Ribo 这三年都没出过这么大的故障!」 「这可是你搞出来的系统，可用性太差了!」 他吵得太大声，在游艇甲板上回荡。 这兴师问罪的态度震撼到我。 什么时候了，他的第一反应竟然是甩锅。 我原本是想帮忙的，现在担忧的心情消失无踪。 只剩下尊重祝福。 我:「不关我的事，我只是一个拿工资不干活的闲人。毕竟那么多技术人员不裁，偏偏裁了我呢!」 我挂了电话，冷笑一声，继续钓鱼。 电话又响起来。 我拿远一点，开免提。 陈炳:「你身边有电脑吗，开个远程会议。」 我:「帮我拿饵来，咱再钓一条大鱼!」 陈炳提高声音: 「喂? 喂? 听不到吗，快加入会议!」 我:「船长，再往前开几海里吧。」 马达声轰鸣，盖过了陈炳的叫声。\n15\n我们欢声笑语地钓了一会儿鱼。 陈炳隔着电话应该也听出来我在度假。 业务故障固然令人难过，别人在度假尤其使他揪心。 不出十分钟，陈炳态度软化。 陈炳: 「黎工啊，你也不想看 Ribo 垮掉吧，帮帮忙吧!」 我是真不懂。领导当惯了，看谁都想指挥指挥? 我提醒他: 「陈总，我现在不拿Ribo 的工资，没必要给Ribo 干活，是不是?」 陈炳果断回答:「我马上给你恢复原职。那个帖子我也删掉。」 我:「哦…\u0026hellip;原来那个帖子是你写的啊。」 陈炳不作声。 估计汗流浃背了。 但他不愧在名利场里摸爬滚打许多年，懂得直击痛点。 「黎工，你对我个人有意见，没关系，等业务恢复怎么清算都可以。」 「但你想想技术部的同事，他们现在加班抢修，都要急疯了。业务不恢复，他们一刻也不能休息!」 我沉默了。 他是对的。Ribo 垮掉，对所有人都没好处。 我叹了一口气。 「陈总，说实话，这个故障我能修。」 不等他兴奋，我补充: 「但我现在在海上，信号很差，登录权限也没有。」 陈炳: 「好说!你需要叫谁搭把手，要什么权限，我马上办!」\n16\n陈炳紧锣密鼓地帮我准备。 我们的游艇也打道回府，在码头找了一家信号好的咖啡馆。 先前我被除名，账号直接都删干净了。 我需要开的权限太多，一时也开不全。 我把几个资深组长拉进会议，统筹进度。 陈炳旁听，一边不停地接电话汇报。 此时天色渐暗，国内时间已经是晚上十点。 故障发生五小时，仍未修复。 嘶嘶! Pocky冲我使眼色，打开股市大盘给我看 Ribo 的股价断崖式下跌，一点回暖的趋势都没有。 「幸亏抛了，我至少省出一辆车来!」Pocky 得意地说。 现在压力给到陈炳这边。 陈炳长吁短叹，连连擦汗。 「各位，麻烦快点，这个有预计修复时间吗?」 我甩他一句:「你行你上!」 陈炳不吱声了，安静如鸡。 又过了一个小时，我们总算有了进展。但陈炳坐不住了: 「现在要开董事会，一小时内能恢复业务吗?不然我不好汇报。」 加班到深夜的同事们怨气冲天，没空理他。 我直截了当:「没有!直接当着董事会的面修吧，省得跟他们汇报!」 陈炳没有办法，挂着远程会议去开董事会。\n17\n董事会开口就质问陈炳，什么时候能恢复业务。 陈炳这时突然展现出十二分自信，侃侃而谈，把耽误的时间都推到监控和运营部门身上。 董事会听他说，不出二十分钟必恢复，都放下心，开始讨论危机公关方案。 他们打算发公告说成人为误操作，推出几个替罪羊，然后补偿用户损失。 这是最能维护公司形象的补救办法。 我没想到，我们基层员工累死累活，养着这么一群搅屎棍。 连开诚布公都做不到。 幸好我溜了。 终于，我们修好了系统，可以进入测试阶段。 陈炳跳起来说修好了。 其他董事纷纷赞叹陈炳办事效率高。 陈炳恭维说是董事们指导有方，群策群力，践行公司核心价值观。 我没有那么乐观。我知道用户数据丢失的问题还没解决。 果然，一登录 Ribo，账户一片空白。 陈炳开始慌了。 董事会一片嘈杂。 「都安静!」越乱越烦，我让陈炳开外放，怒喝一声，会场总算安静下来。 我:「各位董事不用着急。数据库我们做了严格备份，只要回滚就好。」 我:「我没有数据库权限，辛苦陈总操作一下。」 陈炳手忙脚乱地打开电脑:「呃…….怎么操作?」 我说出操作方法。 陈炳做完回滚，声音发颤:「发布会之前的数据.……丢失索引了。」 丢失索引，意味着原本分门别类的数据乱成一锅粥。 我又大声叫「安静」。 我:「小问题。我们还有异地备份，是独立服务器，不受主集群影响的。」 我又告诉陈炳异地服务器的操作方法。 陈炳却没有马上操作。 他沉默了一会儿，轻声说:「异地服务器…\u0026hellip;上个月为了节省成本，取消了。」 会场鸦雀无声。 我压抑住怒火:「取消了?怎么没人来问问我的意见!」\n18\n陈炳颓然坐在桌前。 董事会奇怪地问陈炳，我是什么人，为什么总工程师要向我请教? 我哼了一声:「除了真正的总工程师，他还能向谁请教!」 陈炳没有反驳，默认了。 一位董事问我:「这位..….同志怎么称呼?」 我:「黎泉。」 董事:「黎泉同志，你下一步准备怎么办，数据库多久能恢复?」 我: 「我不知道。我在贵司任职的三年，从未出过事故。贵司这周一把我裁了，按理说，我不该过问贵司的事务，各自安好。我帮到这里已经牺牲了很多个人时间。就这样吧， 晚安。」 董事会听说我撂挑子了，齐声挽留。 董事:「谁把黎泉同志裁了?我要起诉他，全额赔偿公司损失!」 没有人承认。 无奈之下，我只能说出一个不是办法的办法。 现在没有数据备份，索引全丢，但万幸数据还在。 只能用笨办法，手写筛选条件，人工捞出数据。 这个工作量巨大而且枯燥。我交给同事之后，退出会议。\n19\n这次发布会事故，前前后后，用了12小时才修好。 Ribo 蒙受巨大损失，口碑滑铁卢，千万市值一夜蒸发。 而我的假期才过了一半。 董事会多次要求我恢复原职，我都拒绝了。 我已经对他们失望透顶。 同样失望的还有我的前同事们。 他们纷纷离职。失去劳动合同的制约，有人在网上爆出了这次事故的内幕。 Pocky 转发给我一些大V的评论: [听说裁员裁到大动脉，这次才修了这么久?] 【降本增笑了属于是。] 【对 Ribo 祛魅了，新出的功能一个比一个恶心!] 看到这些评论，我笑不出来。 Ribo 的管理层垃圾，但Ribo本身就像是我亲手带大的孩子。 做父母的，见不得别人说自家孩子不好。 我只能眼不见为净，全心投入与Pocky 合作的 AI项目中。\n20\nPocky 投资新项目的眼光确实毒辣。 短短一年，我们用独特的训练方法，训练出一个电竞主播AI。 它讲话幽默，操作犀利，在年轻人中很有人气。 年末有一个举世瞩目的电竞节，AI 加入了中国参赛队伍，勇夺冠军。 这个成绩吸引了一大波投资。 我抓住机会，训练出更多领域的主播AI。 主播 AI 出圈成功，成为大众知名的KOL，给公司创造巨额财富。AI本身的管理也非常简单，它们不耍大牌、不需要休息，也永远不会塌房。 年底财报出来，Pocky 激动万分: 「黎神!我们公司年度净利润翻了三十倍!」 「还被评为年度新星!调查显示，10-25岁的人群，每5人就有1人知道我们!」 我和 Pocky，还有董事会的各位分享了这一喜悦。 是的，有了 Ribo 的前车之鉴，我加入公司管理层，参与公司决策。 Pocky 努力纠正我不爱教人的坏习惯，让我把工作分配给业务部门，我自己重新学习经营管理。 我持有公司股份。财报一出，不仅Pocky 是富二代，我也成了富一代。 不过我欲求比较低，财富自由了，我也没什么实感。 「我们公司现在的市值，相当于几个Ribo?」我问 Pocky。 「二十个吧。」 Pocky 突然想起了什么: 「说到 Ribo 啊，他们已经连续低迷一年了。」 「他们最近在到处拉合作。我明天下午跟 Ribo 那边有洽谈会，你要来吗?」 21 洽谈会当天，我们提前来到夏利五星级酒店。 我嫌贵宾包厢闷，自己带着电脑坐到楼下大厅。 等得无聊，我打开电脑，写新功能的脚本。 一行人进入酒店大门。我觉得中间一人有些眼熟，但没有在意。 还是他先认出了我: 「这不是黎泉吗!别来无恙?」 我抬起头，见到一张满脸堆笑的胖脸。 我也笑了:「陈总，别来无恙啊!」 来人正是陈炳。 上次事故后，我拉黑了他所有的联系方式，从此再无联络。 他发际线后退，脸冒油光，长相越发着急。 我看他走在队伍中间，派头不复从前，也许是被降职了吧。 陈炳看到我在敲代码。 他流露出可惜的表情: 「黎工入职新公司以后这么忙啊。」 「其实以黎工的能力，做到管理层完全不是难事。」 他递出名片，硬塞到我手里。 「黎工要是累了，随时可以回Ribo。直接提我名字就行了。」 我拿着名片哭笑不得。 等到他们上楼谈了一会儿，我也写完收工， 贵宾包厢有一面玻璃墙正对楼梯，我远远看到，Ribo高层言辞激烈地给Pocky 介绍什么。 Pocky 不知是没兴趣，还是真饿了，弱小无助但能吃。\n22\n「我们的新产品订购率创历史新高!」 「如果有贵司授权，加入AI主播互动，绝对是双赢!」 我推门而入，径直坐到Pocky右手边。Ribo 高层止住话头。 Pocky 精神一振，介绍我: 「刘总，陈总，这位是我们公司首席执行CEO，黎总。」 刘总是生面孔，赶紧起立跟我握手。 陈炳筷子没拿稳，掉到地上发出清脆的一声响。 我还是不喜欢社交，但场面话还是要说的。 「两位客气了。其实我曾经就职Ribo，对贵司的印象很深。」 刘总: 「就职 Ribo? 哈哈，世界真小。请问黎总以前就职什么岗位啊?」 我笑着说:「基层员工。」 陈炳清了清喉咙，试图转移话题。 Pocky 看热闹不嫌事儿大，积极拱火: 「哎呀，要不怎么说贵司人才济济呢!我从贵司挖走一个基层员工来做CEO，草台班子唱戏，现在也混得风生水起!」 刘总一下子没接住话茬，满脸尴尬。 承认吧，说明自己这边识人不清，不重用人才。 不承认吧，是看不起对方水平，不给对方面子。 该说富二代从不为生活所迫，话中带刺，笑里藏刀，让人防不胜防。 我摆摆手，问他们刚才谈了什么。陈炳硬着头皮把给Pocky 讲过的又给我讲了一遍。 谈完后，Ribo 高层希望我们表态:「请问二位，有什么考虑吗?」 我用指节敲桌子，默默思考。 Ribo 的用户存量渐渐流失，只能通过不断拉联名合作，靠用户增量来维持。 这个合作对我们没有帮助。 Pocky 也示意我:算了。 可能不久的将来，Ribo 就会退出历史舞台了吧。 刘总和陈炳焦急地等待结果。\n23\n我:「我们可以合作，但有一个条件。」 刘总:「什么条件?」 我决定把决定权交给陈炳。我走到他身边，拍了拍他的肚腩。 「我跟陈总私交很深，我总是劝他锻炼身体。不然年纪上来，脂肪肝、三高都来了。」 「我是个念旧情的人。这样吧，陈总原地做五百个俯卧撑，我们就同意合作。」 说完，我到饭桌前的空地蹲下来，等着给陈炳计数。 要是有点底气的合作方这就会被气走了。 可惜 Ribo 已经岌岌可危了。 陈炳一向圆滑，不肯错失这个机会，又不想让自己太难堪。 他热情洋溢地站起来。 「没错，没错!黎总以前天天叫我一起健身。黎总离职后，我也没闲着，正好让黎总看看我的锻炼成果!」 他撸起袖子，趴下，小心地不弄皱高档西装裤。 「陈总准备好了吗?开始!」 「一! 二! 三! 四! 」 我认真给陈炳计数。他每次都是肚子先着地。 陈炳真的很想争取这次合作。他双臂发抖，满头大汗，还是憋着一口气做俯卧撑。 「二十!加油，很接近了!」 陈炳很久没有过这么大运动量。他咬牙坚持到三十个，体力不支倒在地上。 汗湿的白衬衫粘在他胸前。 陈炳顾不上维持体面，坐在地板上喘着粗气擦汗。 Pocky 和刘总也站起来，开着玩笑: 「哈哈哈，陈总要加强锻炼了!」 离开时，谁都没有再提合作的事。\n24\n「跟 Ribo 的合作，你怎么看?」 回去的路上，我问Pocky. Pocky 边开车边说:「拒绝了吧，没什么价值，耽误时间。」 我没搭腔，看向窗外。 光怪陆离的公司大楼匆匆掠过。Ribo 初创时只有一间办公室，为了节省物业水电费，大家都是把工作带回家加班。Ribo 终于成为这霓虹森林中的一员，随即又将泯然众人。 飞速前进的时代中，有谁会记得它呢。 「你还放不下啊。」 我从后视镜与 Pocky 目光交会:「放不下什么?」 Pocky 爽朗一笑:「你说自己念旧情，还真是没说错。」 我沉思片刻，开口说:「我想收购Ribo。现在为了生存，Ribo加了太多冗余功能。只要资金到位，我可以救活它。」 「好。」 Pocky 同意得很干脆。 我: 「你不怕烧钱?」 Pocky:「哪个大公司没有几个烧钱部门呢?而且创始人发话，我根本没在怕的。」 第二天，我和公司高层拜访了Ribo，商量收购事宜。\n25\n我们最终以超过市值30%的价格收购了Ribo。 我公司的董事会都不看好这次收购。 对于 Ribo 的员工来说倒是一件好事，所有人保留原职，待遇从优。 我浑身干劲，采集用户需求重新设计Ribo. Ribo 易主在市场上引起不小的震动。经济博主分析本次收购的意图，结合之前发布会事故的爆料，有人猜测，这是Ribo前总工程师的情怀向收购。 外面的猜测众说纷纭。我两耳不闻窗外事，很快通过了第一个方案。 收购后第一次发布会直播定在下个月。 董事会一致决定让我上直播。 「放心，稿子我会找人写好，你照着念就行了。」Pocky 安慰我。 我担心自己面瘫脸没有观众缘，推脱找个活跃的人去。 「没有人比你更合适。你也不想重蹈陈炳的覆辙吧!」 没办法，直到发布会当天，我还在紧张地练稿子。\n26\n今天就是发布会，我穿上一套定制西服，整理发型。 Pocky 在后台见到我，赞叹说:「果然是人靠衣装，你小子平时邋里邋遢，打扮起来也人模狗样的!」 谁平时邋里邋遢了! 但是有他这句话，我自信了不少，脚下生风地出门。 「哎，黎总小心!」 啪，滚烫的液体洒下来，我反射性地后撤。 面前，陈炳诚惶诚恐地端着咖啡:「我，我想给黎总送杯咖啡提提神，真对不起!」 他端着的咖啡洒了，演讲稿湿透看不清了。 我的眼神要喷出火来。 一杯美式咖啡洒了，两个人的衣服都没弄脏，都洒在演讲稿上。 简直蠢到我都不知道他是不是故意的。 此时距离发布会开始只有十分钟了。 我赶紧给 Pocky 发消息，让他把电子版传给我。 消息已送达，未读。 我给他打电话，他好像又静音随缘了。 也怪我疏忽。一份纸质演讲稿快翻烂了，唯独忘了要电子版。 时间到了。 助理喊我上台。 我定了定神，稿子可以没有，但绝对不能迟到。 我练了这么久，已经形成肌肉记忆了，问题不大。\n27\n上台后，台下黑压压的一片。灯光打在我脸上，晃得我阵阵发晕。 我看向二楼 VIP 席位。Pocky开了一杯香槟，向我招手。 不要提前开香槟啊，没看到我稿子都没了吗! 直播间鸦雀无声，所有人都等着我开口。 稿子上第一句话是什么? 「尊敬的各位领导」，还是「尊敬的各位观众」? 我想融化在台上，然后分批流淌出会场。 但是箭在弦上，不能不发。 我凑近麦克风: 「咳咳，喂，喂?能听清吗?」 「最近，有传言说，我才是Ribo 的总工程师。对此，我想澄清一下。」 「传言是对的!」 台下一片哗然。 我继续重拳出击:「好，好的。既然知道我是谁了，那就废话少说，直接看新功能!」 [\u0026hellip;\u0026hellip;这是旧版，完全是一坨屎,所以全撤了!」 「\u0026hellip;\u0026hellip;这是新增的,特别特别好,你们看这\u0026hellip;\u0026hellip;」 「\u0026hellip;\u0026hellip;天呐，不会真有人不爱这功能吧,我反正爱惨了!」 讲到兴奋处，我左脚绊右脚,在台上摔了个底朝天! 台下哄笑。我不管他们,爬起来拍了拍屁股，继续讲。 Pocky 的香槟杯子掉地上碎了，助理面无血色。但我完全沉浸在自己的世界里，越说越起劲。 我不知道的是，从我开始放飞后，直播间人数爆炸式上涨。 [精英人士都是这么接地气的吗，爱了爱了~1 【但是他提到Ribo的时候,眼睛在发光耶!] [哈哈哈，不讲话是男神,讲话是男神经。] 发布会时间结束，我还坐在台阶上，给前排观众讲辛酸的 Ribo 发家史。 助理叫了好几个壮汉才把我拖走。\n28\n我劳累过度，美美睡到第二天， 一进公司，我看到Pocky对着笔记本电脑咯咯笑。 电脑正在播放我的发布会鬼畜视频。 我怒从心头起:「谁发的,是不是陈炳!」我就要出门找他算账。 「不是他，你想多了。」Pocky拉住我，「是我发的。」 我:「?」 Pocky:「抱歉,没问过你的意见,但是……实在太魔性了，哈哈哈!」 Pocky 说着抱歉，实际眼泪都笑出来了。 「时代变了，大家都喜欢看乐子。我昨晚发的,今天已经到首页推荐了。」 我还是很生气，怨毒地盯着他不说话。 鬼畜视频在首页推荐榜上嘎嘎乱杀。 不多时，评论区出现我的全套表情包。 Pocky 摩拳擦掌:「想不到黎神这么有喜剧天赋,闷在公司当管理真是屈才了!」 他不放过任何一个出圈机会，立刻拿出一个立项: 「投放一个 Ribo 独占版黎总AI! 」 「外形、声音、语料库完美复刻黎总本人。黎神，辛苦你去做一下动捕。」 Pocky 用他的个人账号发布了这一创意,被疯狂转发。 下午我就被助理团抓走,包装成AI。\n29\n我忙得脚不沾地。 做完这个旗鱼特别版造型,还有一个发布会周年庆皮肤。 我的粉丝都劝我:不想当 KOL 的架构师不是好 CEO! 对，我还有粉丝团。这是我成为Ribo 独占版 AI 原型后才知道的。 粉丝团的管理也是公司运营的一部分,避免出现不良引导,扰乱舆论秩序。 其中战斗力最强的是「黎泉女友粉」的组织。 没想到，我连女友都没有，已经有女友粉了。 「黎泉女友粉」的粉头是 ID 为「沪圈你丽姐」的大V，也是现任的运营部门员工。 刚入职时唯唯诺诺的小姑娘,现在雷厉风行。 至于陈炳，他现在被降职成基层员工了。 他拿以前一半的工资，干两倍的活儿。 希望他现在能体会到普通员工的工作也不容易。 Pocky 还是到处招商投资。对于他来说，挣钱不是目的，做伯乐才是最大的乐趣。 Ribo 用了两年,终于不是公司里赔钱的部门了。 每年的发布会我都会上台。鬼畜视频常看常新。 Pocky 开会归来，双眼放光: 「韩方邀请我们的女团AI 去演出!趁此机会，做一个黎总女团限定版皮肤宣传吧!」 我做出步惊云惊恐状:「你不要过来啊!」\n(已完结)\n","permalink":"/post/c0-life/readings/caiyuanzengxiao/","summary":"\u003cp\u003e我被公司裁了。\n我一手搭建起核心项目的底层框架，总算熬出头时，公司把我裁了。\nCEO 当着全公司的面落井下石，羞辱我是滥竽充数。\n他不知道，核心代码的故障只有我能修。\n公司求我的日子比想象中来得更快。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e1\u003c/p\u003e\n\u003cp\u003e「很遗憾地通知您，公司有人员调整，将结束与您的聘用关系。」\n「您的门禁卡已经失效，请您立刻搬走全部个人物品。」\n我一头雾水。\n本以为被人事叫走只是开个小会，没想到是裁员通知。\n三年前，公司只是不足20人的小企业。\n我抓住虚拟交互的风口，一手搭建起核心项目的底层框架。\n我无数个夜晚加班加点，做出第一款产品一Ribo，以眼镜或车窗为载体，实现所有外界环境与人的虚拟交互。\n再也不用佩戴笨重的VR 设备，用户仿佛生活在科幻大片中。\nRibo 一经上市，就引爆市场。\n无数代理商和开发商找我们合作。\nRibo 生态仿佛摩天大楼一般建设起来。\n我们公司的规模也迅速从 20人扩张到5000人。\nRibo 如火如荼地发展，我们也抓紧更新迭代。我流连在技术网站中，把Ribo的系统升级成最前沿的高可用架构。\n这个架构搭建时非常困难，因为掌握核心技术的人不多。\n我全身心投入到工作中，无暇处理其他事。\n陈炳就是那个时期被招进来的。\n最开始他跟着我做些琐事。他这个人很圆滑，最擅长向上社交。\n他的朋友圈都是跟大老板打高尔夫、跟产品经理喝下午茶。\nRibo 新产品要开发布会，通知我准备稿子。\n我嫌麻烦。陈炳自告奋勇，主动写好稿子上直播。\n他的口才好，又积极，让我专心处理技术，以后的发布会都让他去。\n我乐得清静。我一心只想让Ribo 更好。\n他宣称自己是 Ribo 的总工程师。久而久之，外界也默认了。\n他靠着人脉一路高升，做到首席 CEO.\n与此同时，我完成了Ribo的升级，工作总算轻松了一点。\u003c/p\u003e\n\u003cp\u003e2\u003c/p\u003e\n\u003cp\u003e有人问过我，陈炳的技术怎么样?\n我说:「一般，他更擅长社交。」\n这话传到了陈炳耳朵里。\n说者无意，听者有心。\n陈炳在发布会上以「总工程师」自居，不能容忍有人拆他的老底。\n经济下行时期，很多科技公司都受到波及。\nRibo 的股票也有下降，公司传出裁员风波。\n我做梦也想不到，第一个被裁掉的竟然是我。\n我回到工位收拾东西，内心一片茫然。\n门口传来「陈总好!」的声音，我抬头看，陈炳大腹便便地走过来。\n可能是应酬太多，这三年，他迅速发福，成了一个油腻的中年胖子。\n他笑眯眯地打招呼:「早，各位早啊!」\n他晃到我面前，满脸惊讶:「咦，黎工怎么在收拾东西?」\n有几人向我看过来。\n陈炳仿佛突然想到什么，大声说:「黎工不会是被裁了吧!」\n他一咋呼，整个办公室的同事都停下工作来看我。\n我回答他:「对。我还得收拾东西，先失陪了。」\n陈炳的话根本就不是对我说的。\n他转过身，痛心疾首一般围着我转:\n「可惜啊，黎工也是公司的老员工了!」\n「公司有人员调整，竟然把黎工给裁了。我就不明白，这么多技术人员不裁，怎么偏偏要裁你呢?」\n「难道公司考察了所有人的KPI吗?」\n我不喜欢搞形式主义，平时的汇报总结能省则省，专心干活。\n陈炳说的 KPI 就是那些形式主义的报告之一。\n「我也算是跟黎工共事过，实在痛心。」\n「但是公司不养闲人!」\n「要是黎工走了，公司业务照常运转，大家就能发现是谁只拿工资不干活了!」\n他越说声音越大，幸灾乐祸地斜眼瞟我。\u003c/p\u003e","tags":["职场","转载","虚构故事"],"title":"「转」裁员增笑"},{"categories":["工具"],"content":"前言 自动翻译 rss，我利用github action开发了一下， 供大家玩乐。\n比如将： http://www.mckinsey.com/insights/rss -\u0026gt; mckinsey_rss.xml 将需要翻译的rss 连接放到 test.ini 配置 ，并提交。\nname：输出的xml名字 url：需要转换的url max：输出xml 最大item数 action：设置语言转换，默认auto转中文。多语言支持 action = “auto”，这里可以换成多种语言，支持语言列表见 pygtrans 如：action = \u0026ldquo;en-\u0026gt;zh-CN\u0026rdquo; 在 https://talengu.github.io/rss-translate/ 等待生成连接即可。\n注：\n需要github账号，修改配置文件。 更新周期为1天，且为随机时间点。通过github action实现，见 random.py 多语言支持 action = “auto”，这里可以换成多种语言，支持语言列表见 pygtrans 如：action = \u0026ldquo;en-\u0026gt;zh-CN\u0026rdquo; 欢迎大家使用！！！🐱\n","permalink":"/post/c7-toolchain/rss_translate/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e自动翻译 rss，我利用github action开发了一下， 供大家玩乐。\u003c/p\u003e\n\u003cp\u003e比如将：\n \u003ca href=\"http://www.mckinsey.com/insights/rss\"\u003ehttp://www.mckinsey.com/insights/rss\u003c/a\u003e -\u0026gt; \u003ca href=\"https://talengu.github.io/rss-translate/rss/mckinsey_rss.xml\"\u003emckinsey_rss.xml\u003c/a\u003e\n \n\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"image-20230202020105514.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e将需要翻译的rss 连接放到 \u003ca href=\"https://github.com/talengu/rss-translate/edit/main/test.ini\"\u003etest.ini\u003c/a\u003e 配置 ，并提交。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"image-20230202020439917.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ename：输出的xml名字\u003c/li\u003e\n\u003cli\u003eurl：需要转换的url\u003c/li\u003e\n\u003cli\u003emax：输出xml 最大item数\u003c/li\u003e\n\u003cli\u003eaction：设置语言转换，默认auto转中文。多语言支持 action = “auto”，这里可以换成多种语言，支持语言列表见 \u003ca href=\"https://pygtrans.readthedocs.io/zh_CN/latest/index.html\"\u003epygtrans\u003c/a\u003e 如：action = \u0026ldquo;en-\u0026gt;zh-CN\u0026rdquo;\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在 \u003ca href=\"https://talengu.github.io/rss-translate/\"\u003ehttps://talengu.github.io/rss-translate/\u003c/a\u003e 等待生成连接即可。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"image-20230202020620284.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e注：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e需要github账号，修改配置文件。\u003c/li\u003e\n\u003cli\u003e更新周期为1天，且为随机时间点。通过github action实现，见 \u003ca href=\"https://github.com/talengu/rss-translate/blob/main/.github/cron_random.py\"\u003erandom.py\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e多语言支持 action = “auto”，这里可以换成多种语言，支持语言列表见 \u003ca href=\"https://pygtrans.readthedocs.io/zh_CN/latest/index.html\"\u003epygtrans\u003c/a\u003e 如：action = \u0026ldquo;en-\u0026gt;zh-CN\u0026rdquo;\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e欢迎大家使用！！！🐱\u003c/p\u003e","tags":["rss","翻译"],"title":"rss翻译github脚本"},{"categories":["编程"],"content":"前言 c语言的字节对齐，机器的大小段模式的理解。\n计算机存储的基础知识。\n#include \u0026lt;stdio.h\u0026gt; typedef struct tm{ unsigned int a; }TM; typedef struct hp{ char a; unsigned char b; TM *t; unsigned short c; unsigned long d; }HP; int main(int argc, char *argv[]) { HP hp={ .a=0xa1, .b=0xb1, .c=0xc1c2, .d=0x1, }; unsigned char *p=\u0026amp;hp; printf(\u0026#34;sizeof(HP) = %lu\\n\u0026#34;,sizeof(HP) );\tfor (unsigned long i = 0; i \u0026lt; sizeof(HP); ++i) { printf(\u0026#34;%02x \u0026#34;,p[i] );\tif((i+1)%8==0) printf(\u0026#34;\\n\u0026#34;); } unsigned int d=hp.d; printf(\u0026#34;%d\u0026#34;,d); return 0; } //OUT || sizeof(HP) = 32 || a1 b1 00 00 00 00 00 00 || 00 00 00 00 00 00 00 00 || c2 c1 00 00 00 00 00 00 || 01 00 00 00 00 00 00 00 || 1 存储方式 HP hp={ .a=0xa1, .b=0xb1, .c=0xc1c2, .d=0xd1d2d3d4,//\u0026lt;-0x1 }; //OUT || sizeof(HP) = 32 || a1 b1 00 00 00 00 00 00 || 00 00 00 00 00 00 00 00 || c2 c1 00 00 00 00 00 00 || d4 d3 d2 d1 00 00 00 00 || 3520254932 字节对齐 //将 d 改为 d:1 typedef struct hp{ char a; unsigned char b; TM *t; unsigned short c; unsigned long d:1; //\u0026lt;--- unsigned long d; }HP; //OUT || 1 warning generated. || sizeof(HP) = 24 || a1 b1 00 00 00 00 00 00 || 00 00 00 00 00 00 00 00 || c2 c1 01 00 00 00 00 00 || 1 少占用了一个8字节。\n","permalink":"/post/c8-programming/c-struct/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003ec语言的字节对齐，机器的大小段模式的理解。\u003c/p\u003e\n\u003cp\u003e计算机存储的基础知识。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etypedef\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e tm{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e a;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}TM;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etypedef\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e hp{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e a;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e b;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tTM \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003et;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eshort\u003c/span\u003e c;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e d;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}HP;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e argc, \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargv[])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tHP hp\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.a\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.b\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xb1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xc1c2\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.d\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ep\u003cspan style=\"color:#f92672\"\u003e=\u0026amp;\u003c/span\u003ehp;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sizeof(HP) = %lu\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(HP) );\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(HP); \u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003ei) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%02x \u0026#34;\u003c/span\u003e,p[i] );\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e((i\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e d\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ehp.d;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d\u0026#34;\u003c/span\u003e,d);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e//OUT\n|| sizeof(HP) = 32\n|| a1 b1 00 00 00 00 00 00 \n|| 00 00 00 00 00 00 00 00 \n|| c2 c1 00 00 00 00 00 00 \n|| 01 00 00 00 00 00 00 00 \n|| 1\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"存储方式\"\u003e存储方式\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tHP hp\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.a\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.b\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xb1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xc1c2\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t.d\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xd1d2d3d4\u003c/span\u003e,\u003cspan style=\"color:#75715e\"\u003e//\u0026lt;-0x1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t};\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e//OUT\n|| sizeof(HP) = 32\n|| a1 b1 00 00 00 00 00 00 \n|| 00 00 00 00 00 00 00 00 \n|| c2 c1 00 00 00 00 00 00 \n|| d4 d3 d2 d1 00 00 00 00 \n|| 3520254932\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"字节对齐\"\u003e字节对齐\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//将 d 改为 d:1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etypedef\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e hp{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e a;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e b;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tTM \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003et;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eshort\u003c/span\u003e c;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003elong\u003c/span\u003e d:\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e//\u0026lt;--- unsigned long d;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e}HP;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e//OUT\n|| 1 warning generated.\n|| sizeof(HP) = 24\n|| a1 b1 00 00 00 00 00 00 \n|| 00 00 00 00 00 00 00 00 \n|| c2 c1 01 00 00 00 00 00 \n|| 1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e少占用了一个8字节。\u003c/p\u003e","tags":["c语言","数据结构"],"title":"c结构体对齐"},{"categories":["linux"],"content":"前言 当今时代，绝大多数企业的应用都是运行在 Linux 操作系统上，所以对应用进行性能诊断和性能优化时，离不开 Linux 的各种性能观测工具和性能优化工具。\n笔者使用过的常见的 Linux 性能观测和性能优化工具有：\ntop/uptime ps/pstree df/du/free/lsblk ip/ifconfig/ping/telnet route/dig/nslookup lsof/netstat/ss tcpdump/tshark/wireshark netstat/vmstat/iostat/pidstat/dstat/mpstat sar/sysctl/ethtool 最近在拜读国际著名的 LINUX 性能专家 Brendan Gregg 的个人博客和技术书籍，摘抄了如下九张图，一览 Linux 性能工具全景图，大家共勉！\n2. Linux 性能工具全景图 linux performance observability tools linux static performance tools linux performance benchmark tools linux performance tuning tools linux performance observability: sar linux performance observability: perf-tools linux bcc/BPF Tracing tools bpftrace/eBPF Tools BPF Performance Tools: Linux System and Application Observability 后记 更多 LINUX 性能资料，大家可以访问大师的个人网站和和技术书籍\nhttps://www.brendangregg.com/ 《性能之巅：洞悉系统、企业与云计算》（《Systems Performance: Enterprise and the Cloud, 2nd Edition (2020)》） 《洞悉 Linux 系统和应用性能》（《BPF Performance Tools》） ps: 要说 LINUX 内核近几年 (和今后几年）最引人注目的发展模块，那就是 bpf 了，完全值得花点精力学习跟进下。 如何更深入地学习 Linux？ - michaelli的回答 - 知乎 https://www.zhihu.com/question/23564190/answer/2795830055 ","permalink":"/post/c5-linux/linux/linux_tools/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e当今时代，绝大多数企业的应用都是运行在 Linux 操作系统上，所以对应用进行性能诊断和性能优化时，离不开 Linux 的各种性能观测工具和性能优化工具。\u003c/p\u003e\n\u003cp\u003e笔者使用过的常见的 Linux 性能观测和性能优化工具有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etop/uptime\u003c/li\u003e\n\u003cli\u003eps/pstree\u003c/li\u003e\n\u003cli\u003edf/du/free/lsblk\u003c/li\u003e\n\u003cli\u003eip/ifconfig/ping/telnet\u003c/li\u003e\n\u003cli\u003eroute/dig/nslookup\u003c/li\u003e\n\u003cli\u003elsof/netstat/ss\u003c/li\u003e\n\u003cli\u003etcpdump/tshark/wireshark\u003c/li\u003e\n\u003cli\u003enetstat/vmstat/iostat/pidstat/dstat/mpstat\u003c/li\u003e\n\u003cli\u003esar/sysctl/ethtool\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e最近在拜读国际著名的 LINUX 性能专家 Brendan Gregg 的个人博客和技术书籍，摘抄了如下九张图，一览 Linux 性能工具全景图，大家共勉！\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"2-linux-性能工具全景图\"\u003e\u003cstrong\u003e2. Linux 性能工具全景图\u003c/strong\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003elinux performance observability tools\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-2eadd97c53a3f20f255394c3d90ea914_r.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003elinux static performance tools\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-20032bac53c856c5733259eece5c2f76_r.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003elinux performance benchmark tools\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-de23423f2eb9deb5410b7128c933f9a9_r.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003elinux performance tuning tools\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-cdf37de145763b762ba5af1a620f9686_r.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003elinux performance observability: sar\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-eee71a6bf3865367741137da03031411_r.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003elinux performance observability: perf-tools\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-1c0134fefbb04597db98ae455a40fad5_r.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.zhihu.com/search?q=linux%20bcc\u0026amp;search_source=Entity\u0026amp;hybrid_search_source=Entity\u0026amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2795830055%7D\"\u003elinux bcc\u003c/a\u003e/BPF Tracing tools\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-ffe70303f4d64828ca931d987b12a6d8_r.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e","tags":["linux性能","转载"],"title":"「转」九张图一览 Linux 性能工具 全景图"},{"categories":["网络"],"content":"前言 tcp ip 协议族\n","permalink":"/post/c6-network/tcp-ip/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003etcp ip 协议族\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"tcp-ip-all.jpeg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e","tags":["三层路由","tcp/ip"],"title":"tcp ip 协议族"},{"categories":["网络"],"content":"摘要 本文介绍连接跟踪（connection tracking，conntrack，CT）的原理，应用，及其在 Linux 内核中的实现。\n代码分析基于内核 4.19。为使行文简洁，所贴代码只保留了核心逻辑，但都给出了代码 所在的源文件，如有需要请查阅。\n水平有限，文中不免有错误之处，欢迎指正交流。\n连接跟踪是许多网络应用的基础。例如，Kubernetes Service、ServiceMesh sidecar、 软件四层负载均衡器 LVS/IPVS、Docker network、OVS、iptables 主机防火墙等等，都依赖 连接跟踪功能。\n1.1 概念 连接跟踪，顾名思义，就是跟踪（并记录）连接的状态。\nFig 1.1. 连接跟踪及其内核位置示意图\n例如，上图是一台 IP 地址为 10.1.1.2 的 Linux 机器，我们能看到这台机器上有三条 连接：\n机器访问外部 HTTP 服务的连接（目的端口 80） 外部访问机器内 FTP 服务的连接（目的端口 21） 机器访问外部 DNS 服务的连接（目的端口 53） 连接跟踪所做的事情就是发现并跟踪这些连接的状态，具体包括：\n从数据包中提取元组（tuple）信息，辨别数据流（flow）和对应的连接（connection） 为所有连接维护一个状态数据库（conntrack table），例如连接的创建时间、发送 包数、发送字节数等等 回收过期的连接（GC） 为更上层的功能（例如 NAT）提供服务 需要注意的是，连接跟踪中所说的“连接”，概念和 TCP/IP 协议中“面向连接”（ connection oriented）的 “连接” 并不完全相同，简单来说：\nTCP/IP 协议中，连接是一个四层（Layer 4）的概念。 TCP 是有连接的，或称面向连接的（connection oriented），发送出去的包都要求对端应答（ACK），并且有重传机制 UDP 是无连接的，发送的包无需对端应答，也没有重传机制 CT 中，一个元组（tuple）定义的一条数据流（flow ）就表示一条连接（connection）。 后面会看到 UDP 甚至是 ICMP 这种三层协议在 CT 中也都是有连接记录的 但不是所有协议都会被连接跟踪 本文中用到 “连接” 一词时，大部分情况下指的都是后者，即 “连接跟踪” 中的“连接”。\n1.2 原理 了解以上概念之后，我们来思考下连接跟踪的技术原理。\n要跟踪一台机器的所有连接状态，就需要\n拦截（或称过滤）流经这台机器的每一个数据包，并进行分析。 根据这些信息建立起这台机器上的连接信息数据库（conntrack table）。 根据拦截到的包信息，不断更新数据库 例如，\n拦截到一个 TCP SYNC 包时，说明正在尝试建立 TCP 连接，需要创建一条新 conntrack entry 来记录这条连接 拦截到一个属于已有 conntrack entry 的包时，需要更新这条 conntrack entry 的收发包数等统计信息 除了以上两点功能需求，还要考虑性能问题，因为连接跟踪要对每个包进行过滤和分析 。性能问题非常重要，但不是本文重点，后面介绍实现时会进一步提及。\n之外，这些功能最好还有配套的管理工具来更方便地使用。\n1.3 设计：Netfilter Linux 的连接跟踪是在 Netfilter 中实现的。\nFig 1.2. Netfilter architecture inside Linux kernel\nNetfilter 是 Linux 内核中一个对数据 包进行控制、修改和过滤（manipulation and filtering）的框架。它在内核协议 栈中设置了若干 hook 点，以此对数据包进行拦截、过滤或其他处理。\n说地更直白一些，hook 机制就是在数据包的必经之路上设置若干检测点，所有到达这 些检测点的包都必须接受检测，根据检测的结果决定：\n放行：不对包进行任何修改，退出检测逻辑，继续后面正常的包处理 修改：例如修改 IP 地址进行 NAT，然后将包放回正常的包处理逻辑 丢弃：安全策略或防火墙功能 连接跟踪模块只是完成连接信息的采集和录入功能，并不会修改或丢弃数据包，后者是其 他模块（例如 NAT）基于 Netfilter hook 完成的。\nNetfilter 是最古老的内核框架之一，1998 年开始开发，2000 年合并到 2.4.x 内 核主线版本 [5]。\n1.4 设计：进一步思考 现在提到连接跟踪（conntrack），可能首先都会想到 Netfilter。但由上节讨论可知， 连接跟踪概念是独立于 Netfilter 的，Netfilter 只是 Linux 内核中的一种连接跟踪实现。\n换句话说，只要具备了 hook 能力，能拦截到进出主机的每个包，完全可以在此基础上自 己实现一套连接跟踪。\nFig 1.3. Cilium\u0026rsquo;s conntrack and NAT architectrue\n云原生网络方案 Cilium 在 1.7.4+ 版本就实现了这样一套独立的连接跟踪和 NAT 机制 （完备功能需要 Kernel 4.19+）。其基本原理是：\n基于 BPF hook 实现数据包的拦截功能（等价于 netfilter 里面的 hook 机制） 在 BPF hook 的基础上，实现一套全新的 conntrack 和 NAT 因此，即便卸载 Netfilter ，也不会影响 Cilium 对 Kubernetes ClusterIP、NodePort、ExternalIPs 和 LoadBalancer 等功能的支持 [2]。\n由于这套连接跟踪机制是独立于 Netfilter 的，因此它的 conntrack 和 NAT 信息也没有 存储在内核的（也就是 Netfilter 的）conntrack table 和 NAT table。所以常规的 conntrack/netstats/ss/lsof 等工具是看不到的，要使用 Cilium 的命令，例如：\n$ cilium bpf nat list $ cilium bpf ct list global 配置也是独立的，需要在 Cilium 里面配置，例如命令行选项 --bpf-ct-tcp-max。\n另外，本文会多次提到连接跟踪模块和 NAT 模块独立，但出于性能考虑，具体实现中 二者代码可能是有耦合的。例如 Cilium 做 conntrack 的垃圾回收（GC）时就会顺便把 NAT 里相应的 entry 回收掉，而非为 NAT 做单独的 GC。\n1.5 应用 来看几个 conntrack 的具体应用。\n1.5.1 网络地址转换（NAT） 网络地址转换（NAT），名字表达的意思也比较清楚：对（数据包的）网络地址（IP + Port）进行转换。\nFig 1.4. NAT 及其内核位置示意图\n例如上图中，机器自己的 IP 10.1.1.2 是能与外部正常通信的，但 192.168 网段是私有 IP 段，外界无法访问，也就是说源 IP 地址是 192.168 的包，其应答包是无 法回来的。因此，\n当源地址为 192.168 网段的包要出去时，机器会先将源 IP 换成机器自己的 10.1.1.2 再发送出去； 收到应答包时，再进行相反的转换。 这就是 NAT 的基本过程。\nDocker 默认的 bridge 网络模式就是这个原理 [4]。每个容器会分一个私有网段的 IP 地址，这个 IP 地址可以在宿主机内的不同容器之间通信，但容器流量出宿主机时要进行 NAT。\nNAT 又可以细分为几类：\nSNAT：对源地址（source）进行转换 DNAT：对目的地址（destination）进行转换 Full NAT：同时对源地址和目的地址进行转换 以上场景属于 SNAT，将不同私有 IP 都映射成同一个 “公有 IP”，以使其能访问外部网络服 务。这种场景也属于正向代理。\nNAT 依赖连接跟踪的结果。连接跟踪最重要的使用场景就是 NAT。\n四层负载均衡（L4LB） 再将范围稍微延伸一点，讨论一下 NAT 模式的四层负载均衡。\n四层负载均衡是根据包的四层信息（例如 src/dst ip, src/dst port, proto）做流量分发。\nVIP（Virtual IP）是四层负载均衡的一种实现方式：\n多个后端真实 IP（Real IP）挂到同一个虚拟 IP（VIP）上 客户端过来的流量先到达 VIP，再经负载均衡算法转发给某个特定的后端 IP 如果在 VIP 和 Real IP 节点之间使用的 NAT 技术（也可以使用其他技术），那客户端访 问服务端时，L4LB 节点将做双向 NAT（Full NAT），数据流如下图所示：\nFig 1.5. L4LB: Traffic path in NAT mode [3]\n1.5.2 有状态防火墙 有状态防火墙（stateful firewall）是相对于早期的无状态防火墙（stateless firewall）而言的：早期防火墙只能写 drop syn to port 443 或者 allow syn to port 80 这种非常简单直接 的规则，没有 flow 的概念，因此无法实现诸如 “如果这个 ack 之前已经有 syn， 就 allow，否则 drop” 这样的规则，使用非常受限 [6]。\n显然，要实现有状态防火墙，就必须记录 flow 和状态，这正是 conntrack 做的事情。\n来看个更具体的防火墙应用：OpenStack 主机防火墙解决方案 —— 安全组（security group）。\nOpenStack 安全组 简单来说，安全组实现了虚拟机级别的安全隔离，具体实现是：在 node 上连接 VM 的 网络设备上做有状态防火墙。在当时，最能实现这一功能的可能就是 Netfilter/iptables。\n回到宿主机内网络拓扑问题： OpenStack 使用 OVS bridge 来连接一台宿主机内的所有 VM。 如果只从网络连通性考虑，那每个 VM 应该直接连到 OVS bridge br-int。但这里问题 就来了 [7]：\n（较早版本的）OVS 没有 conntrack 模块， Linux 中有 conntrack 模块，但基于 conntrack 的防火墙工作在 IP 层（L3），通过 iptables 控制， 而 OVS 是 L2 模块，无法使用 L3 模块的功能， 最终结果是：无法在 OVS （连接虚拟机）的设备上做防火墙。\n所以，2016 之前 OpenStack 的解决方案是，在每个 OVS 和 VM 之间再加一个 Linux bridge ，如下图所示，\nFig 1.6. Network topology within an OpenStack compute node, picture from Sai\u0026rsquo;s Blog\nLinux bridge 也是 L2 模块，按道理也无法使用 iptables。但是，它有一个 L2 工具 ebtables，能够跳转到 iptables，因此间接支持了 iptables，也就能用到 Netfilter/iptables 防火墙的功能。\n这种暴力堆砌的方式不仅丑陋、增加网络复杂性，而且会导致性能问题。因此， RedHat 在 2016 年提出了一个 OVS conntrack 方案 [7]，从那以后，才有可能干掉 Linux bridge 而仍然具备安全组的功能。\n1.6 小结 以上是理论篇，接下来看一下内核实现。\nNetfilter 由几个模块构成，其中最主要的是连接跟踪（CT）模块和网络地址转换（NAT）模块。\nCT 模块的主要职责是识别出可进行连接跟踪的包。 CT 模块独立于 NAT 模块，但主要目的是服务于后者。\n2.1 Netfilter 框架 5 个 hook 点 图 2.1. The 5 hook points in netfilter framework\n如上图所示，Netfilter 在内核协议栈的包处理路径上提供了 5 个 hook 点，分别是：\n// include/uapi/linux/netfilter_ipv4.h #define NF_IP_PRE_ROUTING 0 /* After promisc drops, checksum checks. */ #define NF_IP_LOCAL_IN 1 /* If the packet is destined for this box. */ #define NF_IP_FORWARD 2 /* If the packet is destined for another interface. */ #define NF_IP_LOCAL_OUT 3 /* Packets coming from a local process. */ #define NF_IP_POST_ROUTING 4 /* Packets about to hit the wire. */ #define NF_IP_NUMHOOKS 5 用户可以在这些 hook 点注册自己的处理函数（handlers）。当有数据包经过 hook 点时， 就会调用相应的 handlers。\n另外还有一套 NF_INET_ 开头的定义，include/uapi/linux/netfilter.h。 这两套是等价的，从注释看，NF_IP_ 开头的定义可能是为了保持兼容性。\nenum nf_inet_hooks { NF_INET_PRE_ROUTING, NF_INET_LOCAL_IN, NF_INET_FORWARD, NF_INET_LOCAL_OUT, NF_INET_POST_ROUTING, NF_INET_NUMHOOKS }; hook 返回值类型 hook 函数对包进行判断或处理之后，需要返回一个判断结果，指导接下来要对这个包做什 么。可能的结果有：\n// include/uapi/linux/netfilter.h #define NF_DROP 0 // 已丢弃这个包 #define NF_ACCEPT 1 // 接受这个包，结束判断，继续下一步处理 #define NF_STOLEN 2 // 临时 hold 这个包，不用再继续穿越协议栈了。常见的情形是缓存分片之后的包（等待重组） #define NF_QUEUE 3 // 应当将包放到队列 #define NF_REPEAT 4 // 当前处理函数应当被再次调用 hook 优先级 每个 hook 点可以注册多个处理函数（handler）。在注册时必须指定这些 handlers 的优先级，这样触发 hook 时能够根据优先级依次调用处理函数。\n2.2 过滤规则的组织 iptables 是配置 Netfilter 过滤功能的用户空间工具。为便于管理， 过滤规则按功能分为若干 table：\nraw filter nat mangle 这不是本文重点。更多信息可参考 (译) 深入理解 iptables 和 netfilter 架构\n连接跟踪模块用于维护可跟踪协议（trackable protocols）的连接状态。 也就是说，连接跟踪针对的是特定协议的包，而不是所有协议的包。 稍后会看到它支持哪些协议。\n3.1 重要结构体和函数 重要结构体：\nstruct nf_conntrack_tuple {}: 定义一个 tuple。 struct nf_conntrack_man {}：tuple 的 manipulable part。 struct nf_conntrack_man_proto {}：manipulable part 中协议相关的部分。 struct nf_conntrack_l4proto {}: 支持连接跟踪的协议需要实现的方法集（以及其他协议相关字段）。 struct nf_conntrack_tuple_hash {}：哈希表（conntrack table）中的表项（entry）。 struct nf_conn {}：定义一个 flow。 重要函数：\nhash_conntrack_raw()：根据 tuple 计算出一个 32 位的哈希值（hash key）。\nnf_conntrack_in()：连接跟踪模块的核心，包进入连接跟踪的地方。\nresolve_normal_ct() -\u0026gt; init_conntrack() -\u0026gt; ct = __nf_conntrack_alloc(); l4proto-\u0026gt;new(ct)\n创建一个新的连接记录（conntrack entry），然后初始化。\nnf_conntrack_confirm()：确认前面通过 nf_conntrack_in() 创建的新连接（是否被丢弃）。\n3.2 struct nf_conntrack_tuple {}：元组（Tuple） Tuple 是连接跟踪中最重要的概念之一。\n一个 tuple 定义一个单向（unidirectional）flow。内核代码中有如下注释：\n//include/net/netfilter/nf_conntrack_tuple.h\nA tuple is a structure containing the information to uniquely identify a connection. ie. if two packets have the same tuple, they are in the same connection; if not, they are not.\n结构体定义 //include/net/netfilter/nf_conntrack_tuple.h // 为方便 NAT 的实现，内核将 tuple 结构体拆分为 \u0026#34;manipulatable\u0026#34; 和 \u0026#34;non-manipulatable\u0026#34; 两部分 // 下面结构体中的 _man 是 manipulatable 的缩写 // ude/uapi/linux/netfilter.h union nf_inet_addr { __u32 all[4]; __be32 ip; __be32 ip6[4]; struct in_addr in; struct in6_addr in6; /* manipulable part of the tuple */ / }; struct nf_conntrack_man { / union nf_inet_addr u3; --\u0026gt;--/ union nf_conntrack_man_proto u; --\u0026gt;--\\ \\ // include/uapi/linux/netfilter/nf_conntrack_tuple_common.h u_int16_t l3num; // L3 proto \\ // 协议相关的部分 }; union nf_conntrack_man_proto { __be16 all;/* Add other protocols here. */ struct { __be16 port; } tcp; struct { __be16 port; } udp; struct { __be16 id; } icmp; struct { __be16 port; } dccp; struct { __be16 port; } sctp; struct { __be16 key; } gre; }; struct nf_conntrack_tuple { /* This contains the information to distinguish a connection. */ struct nf_conntrack_man src; // 源地址信息，manipulable part struct { union nf_inet_addr u3; union { __be16 all; /* Add other protocols here. */ struct { __be16 port; } tcp; struct { __be16 port; } udp; struct { u_int8_t type, code; } icmp; struct { __be16 port; } dccp; struct { __be16 port; } sctp; struct { __be16 key; } gre; } u; u_int8_t protonum; /* The protocol. */ u_int8_t dir; /* The direction (for tuplehash) */ } dst; // 目的地址信息 }; Tuple 结构体中只有两个字段 src 和 dst，分别保存源和目的信息。src 和 dst 自身也是结构体，能保存不同类型协议的数据。以 IPv4 UDP 为例，五元组分别保存在如下字段：\ndst.protonum：协议类型 src.u3.ip：源 IP 地址 dst.u3.ip：目的 IP 地址 src.u.udp.port：源端口号 dst.u.udp.port：目的端口号 CT 支持的协议 从以上定义可以看到，连接跟踪模块目前只支持以下六种协议：TCP、UDP、ICMP、DCCP、SCTP、GRE。\n注意其中的 ICMP 协议。大家可能会认为，连接跟踪模块依据包的三层和四层信息做 哈希，而 ICMP 是三层协议，没有四层信息，因此 ICMP 肯定不会被 CT 记录。但实际上 是会的，上面代码可以看到，ICMP 使用了其头信息中的 ICMP type和 code 字段来 定义 tuple。\n3.3 struct nf_conntrack_l4proto {}：协议需要实现的方法集合 支持连接跟踪的协议都需要实现 struct nf_conntrack_l4proto {} 结构体 中定义的方法，例如 pkt_to_tuple()。\n// include/net/netfilter/nf_conntrack_l4proto.h struct nf_conntrack_l4proto { u_int16_t l3proto; /* L3 Protocol number. */ u_int8_t l4proto; /* L4 Protocol number. */ // 从包（skb）中提取 tuple bool (*pkt_to_tuple)(struct sk_buff *skb, ... struct nf_conntrack_tuple *tuple); // 对包进行判决，返回判决结果（returns verdict for packet） int (*packet)(struct nf_conn *ct, const struct sk_buff *skb ...); // 创建一个新连接。如果成功返回 TRUE；如果返回的是 TRUE，接下来会调用 packet() 方法 bool (*new)(struct nf_conn *ct, const struct sk_buff *skb, unsigned int dataoff); // 判断当前数据包能否被连接跟踪。如果返回成功，接下来会调用 packet() 方法 int (*error)(struct net *net, struct nf_conn *tmpl, struct sk_buff *skb, ...); ... }; 3.4 struct nf_conntrack_tuple_hash {}：哈希表项 conntrack 将活动连接的状态存储在一张哈希表中（key: value）。\nhash_conntrack_raw() 根据 tuple 计算出一个 32 位的哈希值（key）：\n// net/netfilter/nf_conntrack_core.c static u32 hash_conntrack_raw(struct nf_conntrack_tuple *tuple, struct net *net) { get_random_once(\u0026amp;nf_conntrack_hash_rnd, sizeof(nf_conntrack_hash_rnd)); /* The direction must be ignored, so we hash everything up to the * destination ports (which is a multiple of 4) and treat the last three bytes manually. */ u32 seed = nf_conntrack_hash_rnd ^ net_hash_mix(net); unsigned int n = (sizeof(tuple-\u0026gt;src) + sizeof(tuple-\u0026gt;dst.u3)) / sizeof(u32); return jhash2((u32 *)tuple, n, seed ^ ((tuple-\u0026gt;dst.u.all \u0026lt;\u0026lt; 16) | tuple-\u0026gt;dst.protonum)); } 注意其中是如何利用 tuple 的不同字段来计算哈希的。\nnf_conntrack_tuple_hash 是哈希表中的表项（value）:\n// include/net/netfilter/nf_conntrack_tuple.h // 每条连接在哈希表中都对应两项，分别对应两个方向（egress/ingress） // Connections have two entries in the hash table: one for each way struct nf_conntrack_tuple_hash { struct hlist_nulls_node hnnode; // 指向该哈希对应的连接 struct nf_conn，采用 list 形式是为了解决哈希冲突 struct nf_conntrack_tuple tuple; // N 元组，前面详细介绍过了 }; 3.5 struct nf_conn {}：连接（connection） Netfilter 中每个 flow 都称为一个 connection，即使是对那些非面向连接的协议（例 如 UDP）。每个 connection 用 struct nf_conn {} 表示，主要字段如下：\n// include/net/netfilter/nf_conntrack.h // include/linux/skbuff.h ------\u0026gt; struct nf_conntrack { | atomic_t use; // 连接引用计数？ | }; struct nf_conn { | struct nf_conntrack ct_general; struct nf_conntrack_tuple_hash tuplehash[IP_CT_DIR_MAX]; // 哈希表项，数组是因为要记录两个方向的 flow unsigned long status; // 连接状态，见下文 u32 timeout; // 连接状态的定时器 possible_net_t ct_net; struct hlist_node nat_bysource; // per conntrack: protocol private data struct nf_conn *master; union nf_conntrack_proto { / /* insert conntrack proto private data here */ u_int32_t mark; /* 对 skb 进行特殊标记 */ / struct nf_ct_dccp dccp; u_int32_t secmark; / struct ip_ct_sctp sctp; / struct ip_ct_tcp tcp; union nf_conntrack_proto proto; ----------\u0026gt;----/ struct nf_ct_gre gre; }; unsigned int tmpl_padto; }; 连接的状态集合 enum ip_conntrack_status：\n// include/uapi/linux/netfilter/nf_conntrack_common.h enum ip_conntrack_status { IPS_EXPECTED = (1 \u0026lt;\u0026lt; IPS_EXPECTED_BIT), IPS_SEEN_REPLY = (1 \u0026lt;\u0026lt; IPS_SEEN_REPLY_BIT), IPS_ASSURED = (1 \u0026lt;\u0026lt; IPS_ASSURED_BIT), IPS_CONFIRMED = (1 \u0026lt;\u0026lt; IPS_CONFIRMED_BIT), IPS_SRC_NAT = (1 \u0026lt;\u0026lt; IPS_SRC_NAT_BIT), IPS_DST_NAT = (1 \u0026lt;\u0026lt; IPS_DST_NAT_BIT), IPS_NAT_MASK = (IPS_DST_NAT | IPS_SRC_NAT), IPS_SEQ_ADJUST = (1 \u0026lt;\u0026lt; IPS_SEQ_ADJUST_BIT), IPS_SRC_NAT_DONE = (1 \u0026lt;\u0026lt; IPS_SRC_NAT_DONE_BIT), IPS_DST_NAT_DONE = (1 \u0026lt;\u0026lt; IPS_DST_NAT_DONE_BIT), IPS_NAT_DONE_MASK = (IPS_DST_NAT_DONE | IPS_SRC_NAT_DONE), IPS_DYING = (1 \u0026lt;\u0026lt; IPS_DYING_BIT), IPS_FIXED_TIMEOUT = (1 \u0026lt;\u0026lt; IPS_FIXED_TIMEOUT_BIT), IPS_TEMPLATE = (1 \u0026lt;\u0026lt; IPS_TEMPLATE_BIT), IPS_UNTRACKED = (1 \u0026lt;\u0026lt; IPS_UNTRACKED_BIT), IPS_HELPER = (1 \u0026lt;\u0026lt; IPS_HELPER_BIT), IPS_OFFLOAD = (1 \u0026lt;\u0026lt; IPS_OFFLOAD_BIT), IPS_UNCHANGEABLE_MASK = (IPS_NAT_DONE_MASK | IPS_NAT_MASK | IPS_EXPECTED | IPS_CONFIRMED | IPS_DYING | IPS_SEQ_ADJUST | IPS_TEMPLATE | IPS_OFFLOAD), }; 3.6 nf_conntrack_in()：进入连接跟踪 Fig. Netfilter 中的连接跟踪点\n如上图所示，Netfilter 在四个 Hook 点对包进行跟踪：\nPRE_ROUTING 和 LOCAL_OUT：调用 nf_conntrack_in() 开始连接跟踪， 正常情况下会创建一条新连接记录，然后将 conntrack entry 放到 unconfirmed list。\n为什么是这两个 hook 点呢？因为它们都是新连接的第一个包最先达到的地方，\nPRE_ROUTING 是外部主动和本机建连时包最先到达的地方 LOCAL_OUT 是本机主动和外部建连时包最先到达的地方 POST_ROUTING 和 LOCAL_IN：调用 nf_conntrack_confirm() 将 nf_conntrack_in() 创建的连接移到 confirmed list。\n同样要问，为什么在这两个 hook 点呢？因为如果新连接的第一个包没有被丢弃，那这 是它们离开 netfilter 之前的最后 hook 点：\n外部主动和本机建连的包，如果在中间处理中没有被丢弃，LOCAL_IN 是其被送到应用（例如 nginx 服务）之前的最后 hook 点 本机主动和外部建连的包，如果在中间处理中没有被丢弃，POST_ROUTING 是其离开主机时的最后 hook 点 下面的代码可以看到这些 handler 是如何注册到 Netfilter hook 点的：\n// net/netfilter/nf_conntrack_proto.c /* Connection tracking may drop packets, but never alters them, so make it the first hook. */ static const struct nf_hook_ops ipv4_conntrack_ops[] = { { .hook = ipv4_conntrack_in, // 调用 nf_conntrack_in() 进入连接跟踪 .pf = NFPROTO_IPV4, .hooknum = NF_INET_PRE_ROUTING, // PRE_ROUTING hook 点 .priority = NF_IP_PRI_CONNTRACK, }, { .hook = ipv4_conntrack_local, // 调用 nf_conntrack_in() 进入连接跟踪 .pf = NFPROTO_IPV4, .hooknum = NF_INET_LOCAL_OUT, // LOCAL_OUT hook 点 .priority = NF_IP_PRI_CONNTRACK, }, { .hook = ipv4_confirm, // 调用 nf_conntrack_confirm() .pf = NFPROTO_IPV4, .hooknum = NF_INET_POST_ROUTING, // POST_ROUTING hook 点 .priority = NF_IP_PRI_CONNTRACK_CONFIRM, }, { .hook = ipv4_confirm, // 调用 nf_conntrack_confirm() .pf = NFPROTO_IPV4, .hooknum = NF_INET_LOCAL_IN, // LOCAL_IN hook 点 .priority = NF_IP_PRI_CONNTRACK_CONFIRM, }, }; nf_conntrack_in() 是连接跟踪模块的核心。\n// net/netfilter/nf_conntrack_core.c unsigned int nf_conntrack_in(struct net *net, u_int8_t pf, unsigned int hooknum, struct sk_buff *skb) { struct nf_conn *tmpl = nf_ct_get(skb, \u0026amp;ctinfo); // 获取 skb 对应的 conntrack_info 和连接记录 if (tmpl || ctinfo == IP_CT_UNTRACKED) { // 如果记录存在，或者是不需要跟踪的类型 if ((tmpl \u0026amp;\u0026amp; !nf_ct_is_template(tmpl)) || ctinfo == IP_CT_UNTRACKED) { NF_CT_STAT_INC_ATOMIC(net, ignore); // 无需跟踪的类型，增加 ignore 计数 return NF_ACCEPT; // 返回 NF_ACCEPT，继续后面的处理 } skb-\u0026gt;_nfct = 0; // 不属于 ignore 类型，计数器置零，准备后续处理 } struct nf_conntrack_l4proto *l4proto = __nf_ct_l4proto_find(...); // 提取协议相关的 L4 头信息 if (l4proto-\u0026gt;error != NULL) { // skb 的完整性和合法性验证 if (l4proto-\u0026gt;error(net, tmpl, skb, dataoff, pf, hooknum) \u0026lt;= 0) { NF_CT_STAT_INC_ATOMIC(net, error); NF_CT_STAT_INC_ATOMIC(net, invalid); goto out; } } repeat: // 开始连接跟踪：提取 tuple；创建新连接记录，或者更新已有连接的状态 resolve_normal_ct(net, tmpl, skb, ... l4proto); l4proto-\u0026gt;packet(ct, skb, dataoff, ctinfo); // 进行一些协议相关的处理，例如 UDP 会更新 timeout if (ctinfo == IP_CT_ESTABLISHED_REPLY \u0026amp;\u0026amp; !test_and_set_bit(IPS_SEEN_REPLY_BIT, \u0026amp;ct-\u0026gt;status)) nf_conntrack_event_cache(IPCT_REPLY, ct); out: if (tmpl) nf_ct_put(tmpl); // 解除对连接记录 tmpl 的引用 } 大致流程：\n尝试获取这个 skb 对应的连接跟踪记录 判断是否需要对这个包做连接跟踪，如果不需要，更新 ignore 计数（conntrack -S 能看到这个计数）， 返回 NF_ACCEPT；如果需要，就初始化这个 skb 的引用计数。 从包的 L4 header 中提取信息，初始化协议相关的 struct nf_conntrack_l4proto {} 变量，其中包含了该协议的连接跟踪相关的回调方法。 调用该协议的 error() 方法检查包的完整性、校验和等信息。 调用 resolve_normal_ct() 开始连接跟踪，它会创建新 tuple，新 conntrack entry，或者更新已有连接的状态。 调用该协议的 packet() 方法进行一些协议相关的处理，例如对于 UDP，如果 status bit 里面设置了 IPS_SEEN_REPLY 位，就会更新 timeout。timeout 大小和协 议相关，越小越越可以防止 DoS 攻击（DoS 的基本原理就是将机器的可用连接耗尽） 3.7 init_conntrack()：创建新连接记录 如果连接不存在（flow 的第一个包），resolve_normal_ct() 会调用 init_conntrack ，后者进而会调用 new() 方法创建一个新的 conntrack entry。\n// include/net/netfilter/nf_conntrack_core.c // Allocate a new conntrack static noinline struct nf_conntrack_tuple_hash * init_conntrack(struct net *net, struct nf_conn *tmpl, const struct nf_conntrack_tuple *tuple, const struct nf_conntrack_l4proto *l4proto, struct sk_buff *skb, unsigned int dataoff, u32 hash) { struct nf_conn *ct; // 从 conntrack table 中分配一个 entry，如果哈希表满了，会在内核日志中打印 // \u0026#34;nf_conntrack: table full, dropping packet\u0026#34; 信息，通过 `dmesg -T` 能看到 ct = __nf_conntrack_alloc(net, zone, tuple, \u0026amp;repl_tuple, GFP_ATOMIC, hash); l4proto-\u0026gt;new(ct, skb, dataoff); // 协议相关的方法 local_bh_disable(); // 关闭软中断 if (net-\u0026gt;ct.expect_count) { exp = nf_ct_find_expectation(net, zone, tuple); if (exp) { /* Welcome, Mr. Bond. We\u0026#39;ve been expecting you... */ __set_bit(IPS_EXPECTED_BIT, \u0026amp;ct-\u0026gt;status); /* exp-\u0026gt;master safe, refcnt bumped in nf_ct_find_expectation */ ct-\u0026gt;master = exp-\u0026gt;master; ct-\u0026gt;mark = exp-\u0026gt;master-\u0026gt;mark; ct-\u0026gt;secmark = exp-\u0026gt;master-\u0026gt;secmark; NF_CT_STAT_INC(net, expect_new); } } /* Now it is inserted into the unconfirmed list, bump refcount */ // 至此这个新的 conntrack entry 已经被插入 unconfirmed list nf_conntrack_get(\u0026amp;ct-\u0026gt;ct_general); nf_ct_add_to_unconfirmed_list(ct); local_bh_enable(); // 重新打开软中断 if (exp) { if (exp-\u0026gt;expectfn) exp-\u0026gt;expectfn(ct, exp); nf_ct_expect_put(exp); } return \u0026amp;ct-\u0026gt;tuplehash[IP_CT_DIR_ORIGINAL]; } 每种协议需要实现自己的 l4proto-\u0026gt;new() 方法，代码见：net/netfilter/nf_conntrack_proto_*.c。 例如 TCP 协议对应的 new() 方法是：\n// net/netfilter/nf_conntrack_proto_tcp.c /* Called when a new connection for this protocol found. */ static bool tcp_new(struct nf_conn *ct, const struct sk_buff *skb, unsigned int dataoff) { if (new_state == TCP_CONNTRACK_SYN_SENT) { memset(\u0026amp;ct-\u0026gt;proto.tcp, 0, sizeof(ct-\u0026gt;proto.tcp)); /* SYN packet */ ct-\u0026gt;proto.tcp.seen[0].td_end = segment_seq_plus_len(ntohl(th-\u0026gt;seq), skb-\u0026gt;len, dataoff, th); ct-\u0026gt;proto.tcp.seen[0].td_maxwin = ntohs(th-\u0026gt;window); ... } 如果当前包会影响后面包的状态判断，init_conntrack() 会设置 struct nf_conn 的 master 字段。面向连接的协议会用到这个特性，例如 TCP。\n3.8 nf_conntrack_confirm()：确认包没有被丢弃 nf_conntrack_in() 创建的新 conntrack entry 会插入到一个 未确认连接（ unconfirmed connection）列表。\n如果这个包之后没有被丢弃，那它在经过 POST_ROUTING 时会被 nf_conntrack_confirm() 方法处理，原理我们在分析过了 3.6 节的开头分析过了。 nf_conntrack_confirm() 完成之后，状态就变为了 IPS_CONFIRMED，并且连接记录从 未确认列表移到正常的列表。\n之所以把创建一个新 entry 的过程分为创建（new）和确认（confirm）两个阶段 ，是因为包在经过 nf_conntrack_in() 之后，到达 nf_conntrack_confirm() 之前 ，可能会被内核丢弃。这样会导致系统残留大量的半连接状态记录，在性能和安全性上都 是很大问题。分为两步之后，可以加快半连接状态 conntrack entry 的 GC。\n// include/net/netfilter/nf_conntrack_core.h /* Confirm a connection: returns NF_DROP if packet must be dropped. */ static inline int nf_conntrack_confirm(struct sk_buff *skb) { struct nf_conn *ct = (struct nf_conn *)skb_nfct(skb); int ret = NF_ACCEPT; if (ct) { if (!nf_ct_is_confirmed(ct)) ret = __nf_conntrack_confirm(skb); if (likely(ret == NF_ACCEPT)) nf_ct_deliver_cached_events(ct); } return ret; } confirm 逻辑，省略了各种错误处理逻辑：\n// net/netfilter/nf_conntrack_core.c /* Confirm a connection given skb; places it in hash table */ int __nf_conntrack_confirm(struct sk_buff *skb) { struct nf_conn *ct; ct = nf_ct_get(skb, \u0026amp;ctinfo); local_bh_disable(); // 关闭软中断 hash = *(unsigned long *)\u0026amp;ct-\u0026gt;tuplehash[IP_CT_DIR_REPLY].hnnode.pprev; reply_hash = hash_conntrack(net, \u0026amp;ct-\u0026gt;tuplehash[IP_CT_DIR_REPLY].tuple); ct-\u0026gt;timeout += nfct_time_stamp; // 更新连接超时时间，超时后会被 GC atomic_inc(\u0026amp;ct-\u0026gt;ct_general.use); // 设置连接引用计数？ ct-\u0026gt;status |= IPS_CONFIRMED; // 设置连接状态为 confirmed __nf_conntrack_hash_insert(ct, hash, reply_hash); // 插入到连接跟踪哈希表 local_bh_enable(); // 重新打开软中断 nf_conntrack_event_cache(master_ct(ct) ? IPCT_RELATED : IPCT_NEW, ct); return NF_ACCEPT; } 可以看到，连接跟踪的处理逻辑中需要频繁关闭和打开软中断，此外还有各种锁， 这是短连高并发场景下连接跟踪性能损耗的主要原因？。\nNAT 是与连接跟踪独立的模块。\n4.1 重要数据结构和函数 重要数据结构：\n支持 NAT 的协议需要实现其中的方法：\nstruct nf_nat_l3proto {} struct nf_nat_l4proto {} 重要函数：\nnf_nat_inet_fn()：NAT 的核心函数，在除 NF_INET_FORWARD 之外的其他 hook 点都会被调用。 4.2 NAT 模块初始化 // net/netfilter/nf_nat_core.c static struct nf_nat_hook nat_hook = { .parse_nat_setup = nfnetlink_parse_nat_setup, .decode_session = __nf_nat_decode_session, .manip_pkt = nf_nat_manip_pkt, }; static int __init nf_nat_init(void) { nf_nat_bysource = nf_ct_alloc_hashtable(\u0026amp;nf_nat_htable_size, 0); nf_ct_helper_expectfn_register(\u0026amp;follow_master_nat); RCU_INIT_POINTER(nf_nat_hook, \u0026amp;nat_hook); } MODULE_LICENSE(\u0026#34;GPL\u0026#34;); module_init(nf_nat_init); 4.3 struct nf_nat_l3proto {}：协议相关的 NAT 方法集 // include/net/netfilter/nf_nat_l3proto.h struct nf_nat_l3proto { u8 l3proto; // 例如，AF_INET u32 (*secure_port )(const struct nf_conntrack_tuple *t, __be16); bool (*manip_pkt )(struct sk_buff *skb, ...); void (*csum_update )(struct sk_buff *skb, ...); void (*csum_recalc )(struct sk_buff *skb, u8 proto, ...); void (*decode_session )(struct sk_buff *skb, ...); int (*nlattr_to_range)(struct nlattr *tb[], struct nf_nat_range2 *range); }; 4.4 struct nf_nat_l4proto {}：协议相关的 NAT 方法集 // include/net/netfilter/nf_nat_l4proto.h struct nf_nat_l4proto { u8 l4proto; // Protocol number，例如 IPPROTO_UDP, IPPROTO_TCP // 根据传入的 tuple 和 NAT 类型（SNAT/DNAT）修改包的 L3/L4 头 bool (*manip_pkt)(struct sk_buff *skb, *l3proto, *tuple, maniptype); // 创建一个唯一的 tuple // 例如对于 UDP，会根据 src_ip, dst_ip, src_port 加一个随机数生成一个 16bit 的 dst_port void (*unique_tuple)(*l3proto, tuple, struct nf_nat_range2 *range, maniptype, struct nf_conn *ct); // If the address range is exhausted the NAT modules will begin to drop packets. int (*nlattr_to_range)(struct nlattr *tb[], struct nf_nat_range2 *range); }; 各协议实现的方法，见：net/netfilter/nf_nat_proto_*.c。例如 TCP 的实现：\n// net/netfilter/nf_nat_proto_tcp.c const struct nf_nat_l4proto nf_nat_l4proto_tcp = { .l4proto = IPPROTO_TCP, .manip_pkt = tcp_manip_pkt, .in_range = nf_nat_l4proto_in_range, .unique_tuple = tcp_unique_tuple, .nlattr_to_range = nf_nat_l4proto_nlattr_to_range, }; 4.5 nf_nat_inet_fn()：进入 NAT NAT 的核心函数是 nf_nat_inet_fn()，它会在以下 hook 点被调用：\nNF_INET_PRE_ROUTING NF_INET_POST_ROUTING NF_INET_LOCAL_OUT NF_INET_LOCAL_IN 也就是除了 NF_INET_FORWARD 之外其他 hook 点都会被调用。\n在这些 hook 点的优先级：Conntrack \u0026gt; NAT \u0026gt; Packet Filtering。 连接跟踪的优先级高于 NAT 是因为 NAT 依赖连接跟踪的结果。\nFig. NAT\nunsigned int nf_nat_inet_fn(void *priv, struct sk_buff *skb, const struct nf_hook_state *state) { ct = nf_ct_get(skb, \u0026amp;ctinfo); if (!ct) // conntrack 不存在就做不了 NAT，直接返回，这也是我们为什么说 NAT 依赖 conntrack 的结果 return NF_ACCEPT; nat = nfct_nat(ct); switch (ctinfo) { case IP_CT_RELATED: case IP_CT_RELATED_REPLY: /* Only ICMPs can be IP_CT_IS_REPLY. Fallthrough */ case IP_CT_NEW: /* Seen it before? This can happen for loopback, retrans, or local packets. */ if (!nf_nat_initialized(ct, maniptype)) { struct nf_hook_entries *e = rcu_dereference(lpriv-\u0026gt;entries); // 获取所有 NAT 规则 if (!e) goto null_bind; for (i = 0; i \u0026lt; e-\u0026gt;num_hook_entries; i++) { // 依次执行 NAT 规则 if (e-\u0026gt;hooks[i].hook(e-\u0026gt;hooks[i].priv, skb, state) != NF_ACCEPT ) return ret; // 任何规则返回非 NF_ACCEPT，就停止当前处理 if (nf_nat_initialized(ct, maniptype)) goto do_nat; } null_bind: nf_nat_alloc_null_binding(ct, state-\u0026gt;hook); } else { // Already setup manip if (nf_nat_oif_changed(state-\u0026gt;hook, ctinfo, nat, state-\u0026gt;out)) goto oif_changed; } break; default: /* ESTABLISHED */ if (nf_nat_oif_changed(state-\u0026gt;hook, ctinfo, nat, state-\u0026gt;out)) goto oif_changed; } do_nat: return nf_nat_packet(ct, ctinfo, state-\u0026gt;hook, skb); oif_changed: nf_ct_kill_acct(ct, ctinfo, skb); return NF_DROP; } 首先查询 conntrack 记录，如果不存在，就意味着无法跟踪这个连接，那就更不可能做 NAT 了，因此直接返回。\n如果找到了 conntrack 记录，并且是 IP_CT_RELATED、IP_CT_RELATED_REPLY 或 IP_CT_NEW 状态，就去获取 NAT 规则。如果没有规则，直接返回 NF_ACCEPT，对包不 做任何改动；如果有规则，最后执行 nf_nat_packet，这个函数会进一步调用 manip_pkt 完成对包的修改，如果失败，包将被丢弃。\nMasquerade NAT 模块\n一般配置方式：Change IP1 to IP2 if matching XXX。 高级配置方式：Change IP1 to dev1's IP if matching XXX，这种方式称为 Masquerade。 Masquerade 优缺点：\n优点：当设备（网卡）的 IP 地址发生变化时，NAT 规则无需做任何修改。 缺点：性能比第一种方式要差。 4.6 nf_nat_packet()：执行 NAT // net/netfilter/nf_nat_core.c /* Do packet manipulations according to nf_nat_setup_info. */ unsigned int nf_nat_packet(struct nf_conn *ct, enum ip_conntrack_info ctinfo, unsigned int hooknum, struct sk_buff *skb) { enum nf_nat_manip_type mtype = HOOK2MANIP(hooknum); enum ip_conntrack_dir dir = CTINFO2DIR(ctinfo); unsigned int verdict = NF_ACCEPT; statusbit = (mtype == NF_NAT_MANIP_SRC? IPS_SRC_NAT : IPS_DST_NAT) if (dir == IP_CT_DIR_REPLY) // Invert if this is reply dir statusbit ^= IPS_NAT_MASK; if (ct-\u0026gt;status \u0026amp; statusbit) // Non-atomic: these bits don\u0026#39;t change. */ verdict = nf_nat_manip_pkt(skb, ct, mtype, dir); return verdict; } static unsigned int nf_nat_manip_pkt(struct sk_buff *skb, struct nf_conn *ct, enum nf_nat_manip_type mtype, enum ip_conntrack_dir dir) { struct nf_conntrack_tuple target; /* We are aiming to look like inverse of other direction. */ nf_ct_invert_tuplepr(\u0026amp;target, \u0026amp;ct-\u0026gt;tuplehash[!dir].tuple); l3proto = __nf_nat_l3proto_find(target.src.l3num); l4proto = __nf_nat_l4proto_find(target.src.l3num, target.dst.protonum); if (!l3proto-\u0026gt;manip_pkt(skb, 0, l4proto, \u0026amp;target, mtype)) // 协议相关处理 return NF_DROP; return NF_ACCEPT; } 5.1 查看 / 加载 / 卸载 nf_conntrack 模块 $ modinfo nf_conntrack filename: /lib/modules/5.15.0-46-generic/kernel/net/netfilter/nf_conntrack.ko license: GPL alias: nf_conntrack-10 alias: nf_conntrack-2 alias: ip_conntrack srcversion: 30B45E5822722ACEDE23A4B depends: nf_defrag_ipv6,libcrc32c,nf_defrag_ipv4 retpoline: Y intree: Y name: nf_conntrack vermagic: 5.15.0-46-generic SMP mod_unload modversions sig_id: PKCS#7 signer: Build time autogenerated kernel key sig_key: 17:6F:92:2F:58:6B:B2:28:13:DC:71:DC:5A:97:EE:BA:D8:4B:C7:DE sig_hashalgo: sha512 signature: 0B:32:AA:93:F4:31:52:9C:FE:0D:80:B4:F6:7C:30:63:4C:F6:03:AA: ... E9:1F:45:C6:77:C2:29:99:B4:3D:1A:D2 parm: tstamp:Enable connection tracking flow timestamping. (bool) parm: acct:Enable connection tracking flow accounting. (bool) parm: nf_conntrack_helper:Enable automatic conntrack helper assignment (default 0) (bool) parm: expect_hashsize:uint parm: enable_hooks:Always enable conntrack hooks (bool) 卸载：\n$ rmmod nf_conntrack_netlink nf_conntrack 重新加载：\n$ modprobe nf_conntrack # 加载时还可以指定额外的配置参数，例如： $ modprobe nf_conntrack nf_conntrack_helper=1 expect_hashsize=131072 5.2 sysctl 配置项 $ sysctl -a | grep nf_conntrack net.netfilter.nf_conntrack_acct = 0 net.netfilter.nf_conntrack_buckets = 262144 # hashsize = nf_conntrack_max/nf_conntrack_buckets net.netfilter.nf_conntrack_checksum = 1 net.netfilter.nf_conntrack_count = 2148 ... # DCCP options net.netfilter.nf_conntrack_events = 1 net.netfilter.nf_conntrack_expect_max = 1024 ... # IPv6 options net.netfilter.nf_conntrack_generic_timeout = 600 net.netfilter.nf_conntrack_helper = 0 net.netfilter.nf_conntrack_icmp_timeout = 30 net.netfilter.nf_conntrack_log_invalid = 0 net.netfilter.nf_conntrack_max = 1048576 # conntrack table size ... # SCTP options net.netfilter.nf_conntrack_tcp_be_liberal = 0 net.netfilter.nf_conntrack_tcp_loose = 1 net.netfilter.nf_conntrack_tcp_max_retrans = 3 net.netfilter.nf_conntrack_tcp_timeout_close = 10 net.netfilter.nf_conntrack_tcp_timeout_close_wait = 60 net.netfilter.nf_conntrack_tcp_timeout_established = 21600 net.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120 net.netfilter.nf_conntrack_tcp_timeout_last_ack = 30 net.netfilter.nf_conntrack_tcp_timeout_max_retrans = 300 net.netfilter.nf_conntrack_tcp_timeout_syn_recv = 60 net.netfilter.nf_conntrack_tcp_timeout_syn_sent = 120 net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120 net.netfilter.nf_conntrack_tcp_timeout_unacknowledged = 300 net.netfilter.nf_conntrack_timestamp = 0 net.netfilter.nf_conntrack_udp_timeout = 30 net.netfilter.nf_conntrack_udp_timeout_stream = 180 5.3 监控 丢包监控 /proc/net/stat 下面有一些关于 conntrack 的详细统计：\n$ cat /proc/net/stat/nf_conntrack entries searched found new invalid ignore delete delete_list insert insert_failed drop early_drop icmp_error expect_new expect_create expect_delete search_restart 000008e3 00000000 00000000 00000000 0000309d 001e72d4 00000000 00000000 00000000 00000000 00000000 00000000 000000ee 00000000 00000000 00000000 000368d7 000008e3 00000000 00000000 00000000 00007301 002b8e8c 00000000 00000000 00000000 00000000 00000000 00000000 00000170 00000000 00000000 00000000 00035794 000008e3 00000000 00000000 00000000 00001eea 001e6382 00000000 00000000 00000000 00000000 00000000 00000000 00000059 00000000 00000000 00000000 0003f166 ... 此外，还可以用 conntrack 命令：\n$ conntrack -S cpu=0 found=0 invalid=743150 ignore=238069 insert=0 insert_failed=0 drop=195603 early_drop=118583 error=16 search_restart=22391652 cpu=1 found=0 invalid=2004 ignore=402790 insert=0 insert_failed=0 drop=44371 early_drop=34890 error=0 search_restart=1225447 ... ignore：不需要做连接跟踪的包（回忆前面，只有特定协议的包才会做连接跟踪） conntrack table 使用量监控 可以定期采集系统的 conntrack 使用量，\n$ cat /proc/sys/net/netfilter/nf_conntrack_count 257273 并与最大值比较：\n$ cat /proc/sys/net/netfilter/nf_conntrack_max 262144 6.1 连接太多导致 conntrack table 被打爆 现象 业务层（应用层）现象 存在随机、偶发的新建连接超时（connect timeout）。\n例如，如果业务用的是 Java，那对应的是 jdbc4.CommunicationsException communications link failure 之类的错误。\n已有连接正常。\n也就是没有 read timeout 或 write timeout 之类的报错，报错都集中为 connect timeout。\n网络层现象 抓包会看到三次握手的第一个 SYN 包被宿主机静默丢弃了。\n需要注意的是，常规的网卡统计（ifconfig）和内核统计（/proc/net/softnet_stat） 无法反映出这些丢包。\n1s+ 之后出发 SYN 重传，或者还没重传连接就关闭了。\n第一个 SYN 的重传是 1s，这个是内核代码里写死的，不可配置（具体实现见 附录）。\n再考虑到其他一些耗时，第一次重传的实际间隔要大于 1s。 如果客户端设置的超时时间很小，例如 1.05s，那可能来不及重传连接就被关闭了，然后向上层报 connect timeout 错误。\n操作系统层现象 内核日志中有如下报错：\n$ demsg -T [Tue Apr 6 18:12:30 2021] nf_conntrack: nf_conntrack: table full, dropping packet [Tue Apr 6 18:12:30 2021] nf_conntrack: nf_conntrack: table full, dropping packet [Tue Apr 6 18:12:30 2021] nf_conntrack: nf_conntrack: table full, dropping packet ... 另外，cat /proc/net/stat/nf_conntrack 或 conntrack -S 能看到有 drop 统计。\n确认 conntrack table 被打爆 遇到以上现象，基本就是 conntrack 表被打爆了。确认：\n$ cat /proc/sys/net/netfilter/nf_conntrack_count 257273 $ cat /proc/sys/net/netfilter/nf_conntrack_max net.netfilter.nf_conntrack_max = 262144 如果有 conntrack count 监控会看的更清楚，因为我们命令行查看时，高峰可能过了。\n解决方式 优先级从高到低：\n调大 conntrack 表\n运行时配置（经实际测试，不会对现有连接造成影响）：\n$ sysctl -w net.netfilter.nf_conntrack_max=524288 $ sysctl -w net.netfilter.nf_conntrack_buckets=131072 # 推荐配置 hashsize=nf_conntrack_count/4 持久化配置：\n$ echo \u0026#39;net.netfilter.nf_conntrack_max = 524288\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf $ echo \u0026#39;net.netfilter.nf_conntrack_buckets = 131072\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf 影响：连接跟踪模块会多用一些内存。具体多用多少内存，可参考 附录。\n减小 GC 时间\n还可以调小 conntrack 的 GC（也叫 timeout）时间，加快过期 entry 的回收。\nnf_conntrack 针对不同 TCP 状态（established、fin_wait、time_wait 等）的 entry 有不同的 GC 时间。\n例如，默认的 established 状态的 GC 时间是 423000s（5 天）。设置成这么长的 可能原因是：TCP/IP 协议中允许 established 状态的连接无限期不发送任何东西（但仍然活着） [8]，协议的具体实现（Linux、BSD、Windows 等）会设置各自允许的最大 idle timeout。为防止 GC 掉这样长时间没流量但实际还活着的连接，就设置一个足够保守的 timeout 时间。[8] 中建议这个值不小于 2 小时 4 分钟（作为对比和参考， Cilium 自己实现的 CT 中，默认 established GC 是 6 小时）。 但也能看到一些厂商推荐比这个小得多的配置，例如 20 分钟。\n如果对自己的网络环境和需求非常清楚，那可以将这个时间调到一个合理的、足够小的值； 如果不是非常确定的话，还是建议保守一些，例如设置 6 个小时 —— 这已经比默认值 5 天小多了。\n$ sysctl -w net.netfilter.nf_conntrack_tcp_timeout_established = 21600 持久化：\n$ echo \u0026#39;net.netfilter.nf_conntrack_tcp_timeout_established = 21600\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf 其他几个 timeout 值（尤其是 nf_conntrack_tcp_timeout_time_wait，默认 120s）也可以适当调小， 但还是那句话：如果不确定潜在后果，千万不要激进地调小。\n连接跟踪是一个非常基础且重要的网络模块，但只有在少数场景下才会引起普通开发者的注意。\n例如，L4LB 短时高并发场景下，LB 节点每秒接受大量并发短连接，可能导致 conntrack table 被打爆。此时的现象是：\n客户端和 L4LB 建连失败，失败可能是随机的，也可能是集中在某些时间点。 客户端重试可能会成功，也可能会失败。 在 L4LB 节点抓包看，客户端过来的 TCP SYNC 包 L4LB 收到了，但没有回 ACK。即，包 被静默丢弃了（silently dropped）。 此时的原因可能是 conntrack table 太小，也可能是 GC 不够及 时，甚至是 GC 有 bug。\n8.1 第一个 SYN 包的重传间隔计算（Linux 4.19.118 实现） 调用路径：tcp_connect() -\u0026gt; tcp_connect_init() -\u0026gt; tcp_timeout_init()。\n// net/ipv4/tcp_output.c /* Do all connect socket setups that can be done AF independent. */ static void tcp_connect_init(struct sock *sk) { inet_csk(sk)-\u0026gt;icsk_rto = tcp_timeout_init(sk); ... } // include/net/tcp.h static inline u32 tcp_timeout_init(struct sock *sk) { // 获取 SYN-RTO：如果这个 socket 上没有 BPF 程序，或者有 BPF 程序但执行失败，都返回 -1 // 除非用户自己编写 BPF 程序并 attach 到 cgroup/socket，否则这里都是没有 BPF 的，因此这里返回 -1 timeout = tcp_call_bpf(sk, BPF_SOCK_OPS_TIMEOUT_INIT, 0, NULL); if (timeout \u0026lt;= 0) // timeout == -1，接下来使用默认值 timeout = TCP_TIMEOUT_INIT; // 宏定义，等于系统的 HZ 数，也就是 1 秒，见下面 return timeout; } // include/net/tcp.h #define TCP_RTO_MAX ((unsigned)(120*HZ)) #define TCP_RTO_MIN ((unsigned)(HZ/5)) #define TCP_TIMEOUT_MIN (2U) /* Min timeout for TCP timers in jiffies */ #define TCP_TIMEOUT_INIT ((unsigned)(1*HZ)) /* RFC6298 2.1 initial RTO value */ 8.2 根据 nf_conntrack_max 计算 conntrack 模块所需的内存 $ cat /proc/slabinfo | head -n2; cat /proc/slabinfo | grep conntrack slabinfo - version: 2.1 # name \u0026lt;active_objs\u0026gt; \u0026lt;num_objs\u0026gt; \u0026lt;objsize\u0026gt; \u0026lt;objperslab\u0026gt; \u0026lt;pagesperslab\u0026gt; : tunables \u0026lt;limit\u0026gt; \u0026lt;batchcount\u0026gt; \u0026lt;sharedfactor\u0026gt; : slabdata \u0026lt;active_slabs\u0026gt; \u0026lt;num_slabs\u0026gt; \u0026lt;sharedavail\u0026gt; nf_conntrack 512824 599505 320 51 4 : tunables 0 0 0 : slabdata 11755 11755 0 其中的 objsize 表示这个内核对象（这里对应的是 struct nf_conn）的大小， 单位是字节，所以以上输出表明每个 conntrack entry 占用 320 字节的内存空间。\n如果忽略内存碎片（内存分配单位为 slab），那不同 size 的 conntrack table 占用的内存如下：\nnf_conntrack_max=512K: 512K * 320Byte = 160MB nf_conntrack_max=1M: 1M * 320Byte = 320MB 更精确的计算，可以参考 [9]。\nNetfilter connection tracking and NAT implementation. Proc. Seminar on Network Protocols in Operating Systems, Dept. Commun. and Networking, Aalto Univ. 2013. Cilium: Kubernetes without kube-proxy L4LB for Kubernetes: Theory and Practice with Cilium+BGP+ECMP Docker bridge network mode Wikipedia: Netfilter Conntrack tales - one thousand and one flows How connection tracking in Open vSwitch helps OpenStack performance NAT Behavioral Requirements for TCP, RFC5382 Netfilter Conntrack Memory Usage ","permalink":"/post/c6-network/conntrack/","summary":"\u003ch2 id=\"摘要\"\u003e摘要\u003c/h2\u003e\n\u003cp\u003e本文介绍连接跟踪（connection tracking，conntrack，CT）的原理，应用，及其在 Linux 内核中的实现。\u003c/p\u003e\n\u003cp\u003e代码分析基于内核 \u003ccode\u003e4.19\u003c/code\u003e。为使行文简洁，所贴代码只保留了核心逻辑，但都给出了代码 所在的源文件，如有需要请查阅。\u003c/p\u003e\n\u003cp\u003e水平有限，文中不免有错误之处，欢迎指正交流。\u003c/p\u003e\n\u003cp\u003e连接跟踪是许多网络应用的基础。例如，Kubernetes Service、ServiceMesh sidecar、 软件四层负载均衡器 LVS/IPVS、Docker network、OVS、iptables 主机防火墙等等，都依赖 连接跟踪功能。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"11-概念\"\u003e1.1 概念\u003c/h2\u003e\n\u003cp\u003e连接跟踪，顾名思义，就是\u003cstrong\u003e跟踪（并记录）连接的状态\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"node-conntrack.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eFig 1.1. 连接跟踪及其内核位置示意图\u003c/p\u003e\n\u003cp\u003e例如，上图是一台 IP 地址为 \u003ccode\u003e10.1.1.2\u003c/code\u003e 的 Linux 机器，我们能看到这台机器上有三条 连接：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e机器访问外部 HTTP 服务的连接（目的端口 80）\u003c/li\u003e\n\u003cli\u003e外部访问机器内 FTP 服务的连接（目的端口 21）\u003c/li\u003e\n\u003cli\u003e机器访问外部 DNS 服务的连接（目的端口 53）\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e连接跟踪所做的事情就是发现并跟踪这些连接的状态，具体包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e从数据包中提取\u003cstrong\u003e元组\u003c/strong\u003e（tuple）信息，辨别\u003cstrong\u003e数据流\u003c/strong\u003e（flow）和对应的\u003cstrong\u003e连接\u003c/strong\u003e（connection）\u003c/li\u003e\n\u003cli\u003e为所有连接维护一个\u003cstrong\u003e状态数据库\u003c/strong\u003e（conntrack table），例如连接的创建时间、发送 包数、发送字节数等等\u003c/li\u003e\n\u003cli\u003e回收过期的连接（GC）\u003c/li\u003e\n\u003cli\u003e为更上层的功能（例如 NAT）提供服务\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e需要注意的是，\u003cstrong\u003e连接跟踪中所说的“连接”，概念和 TCP/IP 协议中“面向连接”（ connection oriented）的 “连接” 并不完全相同\u003c/strong\u003e，简单来说：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTCP/IP 协议中，连接是一个四层（Layer 4）的概念。\n\u003cul\u003e\n\u003cli\u003eTCP 是有连接的，或称面向连接的（connection oriented），发送出去的包都要求对端应答（ACK），并且有重传机制\u003c/li\u003e\n\u003cli\u003eUDP 是无连接的，发送的包无需对端应答，也没有重传机制\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCT 中，一个元组（tuple）定义的一条数据流（flow ）就表示一条连接（connection）。\n\u003cul\u003e\n\u003cli\u003e后面会看到 UDP 甚至是 \u003cstrong\u003eICMP 这种三层协议在 CT 中也都是有连接记录的\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e但\u003cstrong\u003e不是所有协议都会被连接跟踪\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e本文中用到 “连接” 一词时，大部分情况下指的都是后者，即 “连接跟踪” 中的“连接”。\u003c/p\u003e","tags":["连接跟踪","三层路由"],"title":"「转」连接跟踪（conntrack）：原理、应用及 Linux 内核实现"},{"categories":["linux"],"content":" 原文地址 blog.csdn.net @hhhhhyyyyy8 @4.15.1\n前言 linux 内核源代码变动怎么这么大，handle_bridge 函数居然没有了，本来接着准备以 3.9.1 分析的，但发现和后面的又变了，还是以 4.15.1 现在电脑上用的版本分析吧。\nlinux kernel：4.15.1\nbest of best [link](https://upload.wikimedia.org/wikipedia/commons/3/37/Netfilter-packet-flow.svg)\n先看三张图片\nIMG skb桥转发蓝图 IMG linux TCP/IP L2层数据包接收流程 IMG 浅析ebtables的概念和一些基本应用 tips: linux 内核版本不一样，流程函数会发生细微改变。\n1. br_handle_frame() 作用：\n对于需要转发的报文，调用 NF_BR_PRE_ROUTING 处钩子函数，结束后，进入 br_handle_frame_finish() 函数；\n对于 STP 报文，调用 NF_BR_LOCAL_IN 处钩子函数，结束后，进入 br_handle_local_finish() 函数，在 br_handle_local_finish() 函数中会调用 br_pass_frame_up() 函数。\n//linux/net/bridge/br_input.c /* * Return NULL if skb is handled * note: already called with rcu_read_lock */ rx_handler_result_t br_handle_frame(struct sk_buff **pskb) { struct net_bridge_port *p; struct sk_buff *skb = *pskb; const unsigned char *dest = eth_hdr(skb)-\u0026gt;h_dest; br_should_route_hook_t *rhook; /*如果是环回地址，直接返回RX_HANDLER_PASS*/ if (unlikely(skb-\u0026gt;pkt_type == PACKET_LOOPBACK)) return RX_HANDLER_PASS; /*判断源MAC地址是否是有效的地址，不是直接丢弃，源MAC地址不能是多播地址和全0地址*/ if (!is_valid_ether_addr(eth_hdr(skb)-\u0026gt;h_source)) goto drop; /*判断是否是共享数据包，若是则clone该数据包；若clone时分配内存出错，返回NULL*/ skb = skb_share_check(skb, GFP_ATOMIC); if (!skb) return RX_HANDLER_CONSUMED; /*获取dev对应的网桥端口*/ p = br_port_get_rcu(skb-\u0026gt;dev); if (p-\u0026gt;flags \u0026amp; BR_VLAN_TUNNEL) { if (br_handle_ingress_vlan_tunnel(skb, p, nbp_vlan_group_rcu(p))) goto drop; } /*特殊MAC地址处理*/ //如果目的mac地址是本地链路地址link local reserved addr (01:80:c2:00:00:0X) STP报文 if (unlikely(is_link_local_ether_addr(dest))) { u16 fwd_mask = p-\u0026gt;br-\u0026gt;group_fwd_mask_required; /* * See IEEE 802.1D Table 7-10 Reserved addresses * * Assignment\tValue * Bridge Group Address\t01-80-C2-00-00-00 * (MAC Control) 802.3\t01-80-C2-00-00-01 * (Link Aggregation) 802.3\t01-80-C2-00-00-02 * 802.1X PAE address\t01-80-C2-00-00-03 * * 802.1AB LLDP 01-80-C2-00-00-0E * * Others reserved for future standardization */ fwd_mask |= p-\u0026gt;group_fwd_mask; switch (dest[5]) { case 0x00:\t/* Bridge Group Address */ /* If STP is turned off, then must forward to keep loop detection */ if (p-\u0026gt;br-\u0026gt;stp_enabled == BR_NO_STP || fwd_mask \u0026amp; (1u \u0026lt;\u0026lt; dest[5])) goto forward; *pskb = skb; __br_handle_local_finish(skb); return RX_HANDLER_PASS; case 0x01:\t/* IEEE MAC (Pause) */ goto drop; case 0x0E:\t/* 802.1AB LLDP */ fwd_mask |= p-\u0026gt;br-\u0026gt;group_fwd_mask; if (fwd_mask \u0026amp; (1u \u0026lt;\u0026lt; dest[5])) goto forward; *pskb = skb; __br_handle_local_finish(skb); return RX_HANDLER_PASS; default: /* Allow selective forwarding for most other protocols */ fwd_mask |= p-\u0026gt;br-\u0026gt;group_fwd_mask; if (fwd_mask \u0026amp; (1u \u0026lt;\u0026lt; dest[5])) goto forward; } /* Deliver packet to local host only */ /*调用NF_BR_LOCAL_IN处钩子函数，结束后，进入br_handle_local_finish函数*/ NF_HOOK(NFPROTO_BRIDGE, NF_BR_LOCAL_IN, dev_net(skb-\u0026gt;dev), NULL, skb, skb-\u0026gt;dev, NULL, br_handle_local_finish); return RX_HANDLER_CONSUMED; } forward: switch (p-\u0026gt;state) { //网桥端口处于转发状态 case BR_STATE_FORWARDING: rhook = rcu_dereference(br_should_route_hook); if (rhook) { if ((*rhook)(skb)) { *pskb = skb; return RX_HANDLER_PASS; } dest = eth_hdr(skb)-\u0026gt;h_dest; } /* fall through */ /*网桥端口处于学习状态，处于转发状态也会执行下面的代码，因为上面的case没有break。*/ case BR_STATE_LEARNING: /*数据包目的MAC为网桥的Mac，发往本地的数据包*/ if (ether_addr_equal(p-\u0026gt;br-\u0026gt;dev-\u0026gt;dev_addr, dest)) skb-\u0026gt;pkt_type = PACKET_HOST; /*调用NF_BR_PRE_ROUTING处钩子函数，结束后进入br_handle_frame_finish函数*/ NF_HOOK(NFPROTO_BRIDGE, NF_BR_PRE_ROUTING, dev_net(skb-\u0026gt;dev), NULL, skb, skb-\u0026gt;dev, NULL, br_handle_frame_finish); break; default: drop: kfree_skb(skb); } return RX_HANDLER_CONSUMED; } 相关函数\nrx_handler_result_t 枚举类型 enum rx_handler_result { RX_HANDLER_CONSUMED, RX_HANDLER_ANOTHER, RX_HANDLER_EXACT, RX_HANDLER_PASS, }; typedef enum rx_handler_result rx_handler_result_t; is_valid_ether_addr() /** * is_valid_ether_addr - Determine if the given Ethernet address is valid * @addr: Pointer to a six-byte array containing the Ethernet address * * Check that the Ethernet address (MAC) is not 00:00:00:00:00:00, is not * a multicast address, and is not FF:FF:FF:FF:FF:FF. * * Return true if the address is valid. * * Please note: addr must be aligned to u16. */ static inline bool is_valid_ether_addr(const u8 *addr) { /* FF:FF:FF:FF:FF:FF is a multicast address so we don\u0026#39;t need to * explicitly check for it here. */ return !is_multicast_ether_addr(addr) \u0026amp;\u0026amp; !is_zero_ether_addr(addr); } br_handle_local_finish() br_handle_local_finish() 函数中调用 br_pass_fame_up() 函数。\n/* note: already called with rcu_read_lock */ static int br_handle_local_finish(struct net *net, struct sock *sk, struct sk_buff *skb) { struct net_bridge_port *p = br_port_get_rcu(skb-\u0026gt;dev); __br_handle_local_finish(skb); BR_INPUT_SKB_CB(skb)-\u0026gt;brdev = p-\u0026gt;br-\u0026gt;dev; br_pass_frame_up(skb); return 0; } 2. br_handle_frame_finish() 作用：\n网桥设备是否处于混杂模式，如果是，则会发一份到本地进行处理\n如果是广播包，则会进行广播洪泛，并会发一份到本地处理\n如果是组播包，则根据组播表进行组播转发，并发一份数数包到本地处理\n如果是单播包，发往本地的单播包则送到本地处理，在 fdb 表中可以找到转发表项的单播包则进行转发，未知单播包在广播域内进行洪泛\n//linux/net/bridge/br_input.c /* note: already called with rcu_read_lock */ int br_handle_frame_finish(struct net *net, struct sock *sk, struct sk_buff *skb) { struct net_bridge_port *p = br_port_get_rcu(skb-\u0026gt;dev); enum br_pkt_type pkt_type = BR_PKT_UNICAST; struct net_bridge_fdb_entry *dst = NULL; struct net_bridge_mdb_entry *mdst; bool local_rcv, mcast_hit = false; const unsigned char *dest; struct net_bridge *br; u16 vid = 0; /*如果网桥端口不存在或者网桥端口状态为BR_STATE_DISABLED，则丢弃*/ if (!p || p-\u0026gt;state == BR_STATE_DISABLED) goto drop; /*判断是否允许进入桥内，如果没有开启VLAN则所有数据包都可以进入， 如果开启了VLAN,则根据VLAN相应的规则，从桥上进行数据包转发。*/ if (!br_allowed_ingress(p-\u0026gt;br, nbp_vlan_group_rcu(p), skb, \u0026amp;vid)) goto out; nbp_switchdev_frame_mark(p, skb); /* insert into forwarding database after filtering to avoid spoofing */ br = p-\u0026gt;br; /*如果网桥端口标志有BR_LEARNING,则更新fdb表。 一般新建网桥端口p-\u0026gt;flags=BR_LEARNING| BR_FLOOD | BR_MCAST_FLOOD | BR_BCAST_FLOOD*/ if (p-\u0026gt;flags \u0026amp; BR_LEARNING) br_fdb_update(br, p, eth_hdr(skb)-\u0026gt;h_source, vid, false); //发往本地数据包标记，!!的作用是转换为bool值 local_rcv = !!(br-\u0026gt;dev-\u0026gt;flags \u0026amp; IFF_PROMISC); dest = eth_hdr(skb)-\u0026gt;h_dest; /*目的地址为多播地址*/ if (is_multicast_ether_addr(dest)) { /* by definition the broadcast is also a multicast address */ /*如果目的地址是广播地址，将数据包也发往本地一份*/ if (is_broadcast_ether_addr(dest)) { pkt_type = BR_PKT_BROADCAST; local_rcv = true; } else { pkt_type = BR_PKT_MULTICAST; //igmp snooping留给网桥子系统的外部接口函数， //当网桥接收了igmp数据包后就会调用该函数进行后续处理 if (br_multicast_rcv(br, p, skb, vid)) goto drop; } } //如果网桥端口状态此时还是BR_STATE_LEARNING,则丢弃。 if (p-\u0026gt;state == BR_STATE_LEARNING) goto drop; //将网桥所属的net_device放入skb的私有数据中（struct br_input_skb_cb） BR_INPUT_SKB_CB(skb)-\u0026gt;brdev = br-\u0026gt;dev; if (IS_ENABLED(CONFIG_INET) \u0026amp;\u0026amp; (skb-\u0026gt;protocol == htons(ETH_P_ARP) || skb-\u0026gt;protocol == htons(ETH_P_RARP))) { br_do_proxy_suppress_arp(skb, br, vid, p); } else if (IS_ENABLED(CONFIG_IPV6) \u0026amp;\u0026amp; skb-\u0026gt;protocol == htons(ETH_P_IPV6) \u0026amp;\u0026amp; br-\u0026gt;neigh_suppress_enabled \u0026amp;\u0026amp; pskb_may_pull(skb, sizeof(struct ipv6hdr) + sizeof(struct nd_msg)) \u0026amp;\u0026amp; ipv6_hdr(skb)-\u0026gt;nexthdr == IPPROTO_ICMPV6) { struct nd_msg *msg, _msg; msg = br_is_nd_neigh_msg(skb, \u0026amp;_msg); if (msg) br_do_suppress_nd(skb, br, vid, p, msg); } switch (pkt_type) { //组播包 case BR_PKT_MULTICAST: //获取组播转发项，设置local_rcv为true，组播包也要发往本地一份。 mdst = br_mdb_get(br, skb, vid); if ((mdst || BR_INPUT_SKB_CB_MROUTERS_ONLY(skb)) \u0026amp;\u0026amp; br_multicast_querier_exists(br, eth_hdr(skb))) { if ((mdst \u0026amp;\u0026amp; mdst-\u0026gt;host_joined) || br_multicast_is_router(br)) { local_rcv = true; br-\u0026gt;dev-\u0026gt;stats.multicast++; } mcast_hit = true; } else { local_rcv = true; br-\u0026gt;dev-\u0026gt;stats.multicast++; } break; //单播包 case BR_PKT_UNICAST: //根据目的MAC地址查找fdb表，看是否有对应的表项 dst = br_fdb_find_rcu(br, dest, vid); default: break; } //如果找到目的MAC对应的表项 if (dst) { unsigned long now = jiffies; //送入上层处理 if (dst-\u0026gt;is_local) return br_pass_frame_up(skb); if (now != dst-\u0026gt;used) dst-\u0026gt;used = now; //根据fdb转发表项进行转发，若这里local_rcv 为1,（即端口处于混杂模式IFF_PROMISC），则会克隆一份再转发 //传入的第一个参数dst-\u0026gt;dst 即为要转发的目的端口 br_forward(dst-\u0026gt;dst, skb, local_rcv, false); } else { //进行广播或者组播洪泛 if (!mcast_hit) br_flood(br, skb, pkt_type, local_rcv, false); else br_multicast_flood(mdst, skb, local_rcv, false); } //local_rcv标记为1，送入上层处理。 if (local_rcv) return br_pass_frame_up(skb); out: return 0; drop: kfree_skb(skb); goto out; } 3.br_pass_frame_up 数据包的目的 MAC 是本地的单播报文，广播，组播和网桥处于混杂模式时，报文都会通过 br_pass_frame_up 函数交由上层处理。\n作用：\n调用 NF_BR_LOCAL_IN 处钩子函数，最后调用 br_netif_receive_skb 函数，绕一圈后，交友上层处理。\n//linux/net/bridge/br_input.c static int br_pass_frame_up(struct sk_buff *skb) { struct net_device *indev, *brdev = BR_INPUT_SKB_CB(skb)-\u0026gt;brdev; struct net_bridge *br = netdev_priv(brdev); struct net_bridge_vlan_group *vg; struct pcpu_sw_netstats *brstats = this_cpu_ptr(br-\u0026gt;stats); //统计网桥设备上的收包流量数据 u64_stats_update_begin(\u0026amp;brstats-\u0026gt;syncp); brstats-\u0026gt;rx_packets++; brstats-\u0026gt;rx_bytes += skb-\u0026gt;len; u64_stats_update_end(\u0026amp;brstats-\u0026gt;syncp); //获取网桥设备上的VLAN组 vg = br_vlan_group_rcu(br); /* Bridge is just like any other port. Make sure the * packet is allowed except in promisc modue when someone * may be running packet capture. */ if (!(brdev-\u0026gt;flags \u0026amp; IFF_PROMISC) \u0026amp;\u0026amp; !br_allowed_egress(vg, skb)) { kfree_skb(skb); return NET_RX_DROP; } //记录数据包的收包网络设备 indev = skb-\u0026gt;dev; //将数据包的收包设备改为网桥设备 //当再次进入__netif_receive_skb_core时就不会再次进入桥处理了，因为网桥上没有注册rx_handler 函数 skb-\u0026gt;dev = brdev; //配置数据包vlan相关信息 skb = br_handle_vlan(br, NULL, vg, skb); if (!skb) return NET_RX_DROP; /* update the multicast stats if the packet is IGMP/MLD */ //如果数据包是组播，更新组播数据包的统计信息 br_multicast_count(br, NULL, skb, br_multicast_igmp_type(skb), BR_MCAST_DIR_TX); //调用NF_BR_LOCAL_IN处钩子函数，最后调用br_netif_receive_skb函数。 return NF_HOOK(NFPROTO_BRIDGE, NF_BR_LOCAL_IN, dev_net(indev), NULL, skb, indev, NULL, br_netif_receive_skb); } 再次进入 netif_receive_skb，由于 skb-dev 被设置成了 bridge，而 bridge 设备的 rx_handler 函数是没有被设置的，所以就不会再次进入 bridge 逻辑，而直接进入了主机上层协议栈。\n相关函数\nbr_netif_receive_skb() 可以看到在 br_netif_receive_skb() 函数中调用了 netif_receive_skb() 函数。\nstatic int br_netif_receive_skb(struct net *net, struct sock *sk, struct sk_buff *skb) { br_drop_fake_rtable(skb); return netif_receive_skb(skb); } 4. br_forward() 不是发往本地的数据包，但在 fdb 表中能找到对应的表项，则进行转发 br_forward()，若在 fdb 表中找不到对应表项就进行洪泛 br_blood().\n作用：\n主要是调用__br_forward() 转发报文\n//linux/net/bridge/br_forward.c /** * br_forward - forward a packet to a specific port * @to: destination port * @skb: packet being forwarded * @local_rcv: packet will be received locally after forwarding * @local_orig: packet is locally originated * * Should be called with rcu_read_lock. */ void br_forward(const struct net_bridge_port *to, struct sk_buff *skb, bool local_rcv, bool local_orig) { //should_deliver测试是否应该将该包转发出去 if (to \u0026amp;\u0026amp; should_deliver(to, skb)) { //如果local_rcv为1，表明端口为混杂模式，先clone一份数据包再进行转发 if (local_rcv) deliver_clone(to, skb, local_orig); else __br_forward(to, skb, local_orig); return; } if (!local_rcv) kfree_skb(skb); } 5. __br_forward() 作用:\n__br_forward() 函数根据数据包的来源（local_orig）分别进入不同的钩子点，如果数据包是从本地发出的，则进入 NF_BR_LOCAL_OUT，如果不是本地发出的，则进入 NF_BR_FORWARD 钩子，最后都进入 br_forward_finish() 函数。\n//linux/net/bridge/br_forward.c static void __br_forward(const struct net_bridge_port *to, struct sk_buff *skb, bool local_orig) { struct net_bridge_vlan_group *vg; struct net_device *indev; struct net *net; int br_hook; //获取vlan组，这个组中有许多的vlanid，br_handle_vlan函数就是要在这个组中查找自己的vid vg = nbp_vlan_group_rcu(to); //添加vlan的相关配置 skb = br_handle_vlan(to-\u0026gt;br, to, vg, skb); if (!skb) return; //记录数据包的原始收包网络设备 indev = skb-\u0026gt;dev; //将skb的dev修改为出口网络设备 skb-\u0026gt;dev = to-\u0026gt;dev; /*如果local_orig标志位(判断是否从本地发出的数据包)为false，就进入NF_BR_FORWARD钩子 若为true，就进入NF_BR_LOCAL_OUT钩子点*/ if (!local_orig) { if (skb_warn_if_lro(skb)) { kfree_skb(skb); return; } //不是本地发出的数据包，进入NF_BR_FORWARD br_hook = NF_BR_FORWARD; skb_forward_csum(skb); net = dev_net(indev); } else { if (unlikely(netpoll_tx_running(to-\u0026gt;br-\u0026gt;dev))) { if (!is_skb_forwardable(skb-\u0026gt;dev, skb)) { kfree_skb(skb); } else { skb_push(skb, ETH_HLEN); br_netpoll_send_skb(to, skb); } return; } //若是本地发出的数据包，进入NF_BR_LOCAL_OUT处理 br_hook = NF_BR_LOCAL_OUT; net = dev_net(skb-\u0026gt;dev); indev = NULL; } //进入钩子点，最后执行br_forward_finish函数。 NF_HOOK(NFPROTO_BRIDGE, br_hook, net, NULL, skb, indev, skb-\u0026gt;dev, br_forward_finish); } 6. br_forward_finish() br_forward_finish() 函数比较简单，调用 NF_BR_POST_ROUTING 处的钩子函数，最后进入 br_dev_queue_push_xmit 函数。\n//linux/net/bridge/br_forward.c int br_forward_finish(struct net *net, struct sock *sk, struct sk_buff *skb) { return NF_HOOK(NFPROTO_BRIDGE, NF_BR_POST_ROUTING, net, sk, skb, NULL, skb-\u0026gt;dev, br_dev_queue_push_xmit); } 7. br_dev_queue_push_xmit 在 br_dev_queue_push_xmit() 中，会先 skb_push(skb,ETH,HLEN); 将 data 指向二层头部，然后调用 dev_queue_xmit() 发送报文。\n//linux/net/bridge/br_forward.c int br_dev_queue_push_xmit(struct net *net, struct sock *sk, struct sk_buff *skb) { if (!is_skb_forwardable(skb-\u0026gt;dev, skb)) goto drop; //注意这句操作 skb_push(skb, ETH_HLEN); br_drop_fake_rtable(skb); if (skb-\u0026gt;ip_summed == CHECKSUM_PARTIAL \u0026amp;\u0026amp; (skb-\u0026gt;protocol == htons(ETH_P_8021Q) || skb-\u0026gt;protocol == htons(ETH_P_8021AD))) { int depth; if (!__vlan_get_protocol(skb, skb-\u0026gt;protocol, \u0026amp;depth)) goto drop; skb_set_network_header(skb, depth); } dev_queue_xmit(skb); return 0; drop: kfree_skb(skb); return 0; } 8. br_flood br_flood() 也是调用 __br_forward() 函数转发报文。\n//linux/net/bridge/br_forward.c /* called under rcu_read_lock */ void br_flood(struct net_bridge *br, struct sk_buff *skb, enum br_pkt_type pkt_type, bool local_rcv, bool local_orig) { u8 igmp_type = br_multicast_igmp_type(skb); struct net_bridge_port *prev = NULL; struct net_bridge_port *p; /*遍历网桥设备的port_list，取出所有的网桥端口*/ list_for_each_entry_rcu(p, \u0026amp;br-\u0026gt;port_list, list) { /* Do not flood unicast traffic to ports that turn it off, nor * other traffic if flood off, except for traffic we originate */ switch (pkt_type) { case BR_PKT_UNICAST: if (!(p-\u0026gt;flags \u0026amp; BR_FLOOD)) continue; break; case BR_PKT_MULTICAST: if (!(p-\u0026gt;flags \u0026amp; BR_MCAST_FLOOD) \u0026amp;\u0026amp; skb-\u0026gt;dev != br-\u0026gt;dev) continue; break; case BR_PKT_BROADCAST: if (!(p-\u0026gt;flags \u0026amp; BR_BCAST_FLOOD) \u0026amp;\u0026amp; skb-\u0026gt;dev != br-\u0026gt;dev) continue; break; } /* Do not flood to ports that enable proxy ARP */ /*代理arp*/ if (p-\u0026gt;flags \u0026amp; BR_PROXYARP) continue; if ((p-\u0026gt;flags \u0026amp; (BR_PROXYARP_WIFI | BR_NEIGH_SUPPRESS)) \u0026amp;\u0026amp; BR_INPUT_SKB_CB(skb)-\u0026gt;proxyarp_replied) continue; prev = maybe_deliver(prev, p, skb, local_orig); if (IS_ERR(prev)) goto out; if (prev == p) br_multicast_count(p-\u0026gt;br, p, skb, igmp_type, BR_MCAST_DIR_TX); } if (!prev) goto out; if (local_rcv) deliver_clone(prev, skb, local_orig); else __br_forward(prev, skb, local_orig); return; out: if (!local_rcv) kfree_skb(skb); } 9. br_mulicast_flood() 以后再分析，肚子饿了。\n//linux/net/bridge/br_forward.c /* called with rcu_read_lock */ void br_multicast_flood(struct net_bridge_mdb_entry *mdst, struct sk_buff *skb, bool local_rcv, bool local_orig) { struct net_device *dev = BR_INPUT_SKB_CB(skb)-\u0026gt;brdev; u8 igmp_type = br_multicast_igmp_type(skb); struct net_bridge *br = netdev_priv(dev); struct net_bridge_port *prev = NULL; struct net_bridge_port_group *p; struct hlist_node *rp; rp = rcu_dereference(hlist_first_rcu(\u0026amp;br-\u0026gt;router_list)); p = mdst ? rcu_dereference(mdst-\u0026gt;ports) : NULL; while (p || rp) { struct net_bridge_port *port, *lport, *rport; lport = p ? p-\u0026gt;port : NULL; rport = rp ? hlist_entry(rp, struct net_bridge_port, rlist) : NULL; if ((unsigned long)lport \u0026gt; (unsigned long)rport) { port = lport; if (port-\u0026gt;flags \u0026amp; BR_MULTICAST_TO_UNICAST) { maybe_deliver_addr(lport, skb, p-\u0026gt;eth_addr, local_orig); goto delivered; } } else { port = rport; } prev = maybe_deliver(prev, port, skb, local_orig); delivered: if (IS_ERR(prev)) goto out; if (prev == port) br_multicast_count(port-\u0026gt;br, port, skb, igmp_type, BR_MCAST_DIR_TX); if ((unsigned long)lport \u0026gt;= (unsigned long)port) p = rcu_dereference(p-\u0026gt;next); if ((unsigned long)rport \u0026gt;= (unsigned long)port) rp = rcu_dereference(hlist_next_rcu(rp)); } if (!prev) goto out; if (local_rcv) deliver_clone(prev, skb, local_orig); else __br_forward(prev, skb, local_orig); return; out: if (!local_rcv) kfree_skb(skb); } 参考 ebtables/iptables interaction on a Linux-based bridge @ebtables @2.4.x kernel\nIptables DNAT实现broadcast与unicast之间相互映射 @sxd2001 分析ebtables 的redirect 和 iptables 的redirect\nLinux-4.20.8内核桥收包源码解析（七）\u0026ndash;本地（br_pass_frame_up）or 转发（br_forward） @lw_yang @Linux-4.20.8\nLinux 3.10 kernel bridge转发逻辑 @lvyilong316 @Linux 3.10 kernel\nkernel 网桥代码分析 @海枫 @ 2.6.24.4\n桥数据包处理函数——br_handle_frame_finish（七） @不留你的名字\nBridge实现 @SuperKing @linux 2.6.18\nLInux下桥接模式详解三 @jack.chen @linux 3.10.1\n协议栈报文接收之netif_receive_skb函数分析 @one_clouder @Linux4.1.12\n","permalink":"/post/c5-linux/linux/linux-bridge-forward/","summary":"\u003cblockquote\u003e\n\u003cp\u003e原文地址 \u003ca href=\"https://blog.csdn.net/hhhhhyyyyy8/article/details/102133863\"\u003eblog.csdn.net\u003c/a\u003e\n@hhhhhyyyyy8 @4.15.1\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003elinux 内核源代码变动怎么这么大，handle_bridge 函数居然没有了，本来接着准备以 3.9.1 分析的，但发现和后面的又变了，还是以 4.15.1 现在电脑上用的版本分析吧。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003elinux kernel：4.15.1\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ebest of best [\u003ca href=\"url\"\u003elink\u003c/a\u003e](\u003ca href=\"https://upload.wikimedia.org/wikipedia/commons/3/37/Netfilter-packet-flow.svg\"\u003ehttps://upload.wikimedia.org/wikipedia/commons/3/37/Netfilter-packet-flow.svg\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"Netfilter-packet-flow5.svg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e先看三张图片\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://blog.csdn.net/NW_NW_NW/article/details/76153027\"\u003eIMG skb桥转发蓝图\u003c/a\u003e\n\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"20191005153149853.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://blog.csdn.net/u012247418/article/details/90137663\"\u003eIMG linux TCP/IP L2层数据包接收流程\u003c/a\u003e\n\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"t_70.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.cnblogs.com/xuanxuanBOSS/p/11424290.html\"\u003eIMG 浅析ebtables的概念和一些基本应用\u003c/a\u003e\n\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"netfilter.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003etips: linux 内核版本不一样，流程函数会发生细微改变。\u003c/p\u003e\u003c/blockquote\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"1-br_handle_frame\"\u003e1. br_handle_frame()\u003c/h2\u003e\n\u003cp\u003e作用：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e对于需要转发的报文，调用 \u003ccode\u003eNF_BR_PRE_ROUTING\u003c/code\u003e 处钩子函数，结束后，进入 \u003ccode\u003ebr_handle_frame_finish()\u003c/code\u003e 函数；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e对于 STP 报文，调用 \u003ccode\u003eNF_BR_LOCAL_IN\u003c/code\u003e 处钩子函数，结束后，进入 \u003ccode\u003ebr_handle_local_finish()\u003c/code\u003e 函数，在 \u003ccode\u003ebr_handle_local_finish()\u003c/code\u003e 函数中会调用 \u003ccode\u003ebr_pass_frame_up()\u003c/code\u003e 函数。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//linux/net/bridge/br_input.c\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e * Return NULL if skb is handled\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e * note: already called with rcu_read_lock\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003erx_handler_result_t\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebr_handle_frame\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e sk_buff \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003epskb)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e net_bridge_port \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ep;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e sk_buff \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eskb \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003epskb;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003edest \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeth_hdr\u003c/span\u003e(skb)\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eh_dest;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ebr_should_route_hook_t\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003erhook;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e/*如果是环回地址，直接返回RX_HANDLER_PASS*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eunlikely\u003c/span\u003e(skb\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003epkt_type \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e PACKET_LOOPBACK))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e RX_HANDLER_PASS;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e/*判断源MAC地址是否是有效的地址，不是直接丢弃，源MAC地址不能是多播地址和全0地址*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eis_valid_ether_addr\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eeth_hdr\u003c/span\u003e(skb)\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eh_source))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e drop;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e/*判断是否是共享数据包，若是则clone该数据包；若clone时分配内存出错，返回NULL*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tskb \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eskb_share_check\u003c/span\u003e(skb, GFP_ATOMIC);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003eskb)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e RX_HANDLER_CONSUMED;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e/*获取dev对应的网桥端口*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebr_port_get_rcu\u003c/span\u003e(skb\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003edev);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eflags \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e BR_VLAN_TUNNEL) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ebr_handle_ingress_vlan_tunnel\u003c/span\u003e(skb, p,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t  \u003cspan style=\"color:#a6e22e\"\u003enbp_vlan_group_rcu\u003c/span\u003e(p)))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e drop;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e/*特殊MAC地址处理*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e//如果目的mac地址是本地链路地址link local reserved addr (01:80:c2:00:00:0X) STP报文\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eunlikely\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eis_link_local_ether_addr\u003c/span\u003e(dest))) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tu16 fwd_mask \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003ebr\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003egroup_fwd_mask_required;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * See IEEE 802.1D Table 7-10 Reserved addresses\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * Assignment\t\t \t\tValue\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * Bridge Group Address\t\t01-80-C2-00-00-00\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * (MAC Control) 802.3\t\t01-80-C2-00-00-01\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * (Link Aggregation) 802.3\t01-80-C2-00-00-02\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * 802.1X PAE address\t\t01-80-C2-00-00-03\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * 802.1AB LLDP \t\t01-80-C2-00-00-0E\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t * Others reserved for future standardization\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tfwd_mask \u003cspan style=\"color:#f92672\"\u003e|=\u003c/span\u003e p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003egroup_fwd_mask;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eswitch\u003c/span\u003e (dest[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e]) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x00\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e/* Bridge Group Address */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#75715e\"\u003e/* If STP is turned off,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\t\t\t   then must forward to keep loop detection */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003ebr\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003estp_enabled \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e BR_NO_STP \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    fwd_mask \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1u\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e dest[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e]))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e forward;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003epskb \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e skb;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003e__br_handle_local_finish\u003c/span\u003e(skb);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e RX_HANDLER_PASS;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x01\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e/* IEEE MAC (Pause) */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e drop;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x0E\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e/* 802.1AB LLDP */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\tfwd_mask \u003cspan style=\"color:#f92672\"\u003e|=\u003c/span\u003e p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003ebr\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003egroup_fwd_mask;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (fwd_mask \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1u\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e dest[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e]))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e forward;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003epskb \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e skb;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003e__br_handle_local_finish\u003c/span\u003e(skb);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e RX_HANDLER_PASS;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#75715e\"\u003e/* Allow selective forwarding for most other protocols */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\tfwd_mask \u003cspan style=\"color:#f92672\"\u003e|=\u003c/span\u003e p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003ebr\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003egroup_fwd_mask;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (fwd_mask \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1u\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e dest[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e]))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e forward;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e/* Deliver packet to local host only */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e/*调用NF_BR_LOCAL_IN处钩子函数，结束后，进入br_handle_local_finish函数*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eNF_HOOK\u003c/span\u003e(NFPROTO_BRIDGE, NF_BR_LOCAL_IN, \u003cspan style=\"color:#a6e22e\"\u003edev_net\u003c/span\u003e(skb\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003edev),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\tNULL, skb, skb\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003edev, NULL, br_handle_local_finish);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e RX_HANDLER_CONSUMED;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eforward:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eswitch\u003c/span\u003e (p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003estate) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e//网桥端口处于转发状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e BR_STATE_FORWARDING:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\trhook \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ercu_dereference\u003c/span\u003e(br_should_route_hook);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (rhook) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e ((\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003erhook)(skb)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003epskb \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e skb;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e RX_HANDLER_PASS;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\tdest \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeth_hdr\u003c/span\u003e(skb)\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003eh_dest;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e/* fall through */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e/*网桥端口处于学习状态，处于转发状态也会执行下面的代码，因为上面的case没有break。*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e BR_STATE_LEARNING:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e/*数据包目的MAC为网桥的Mac，发往本地的数据包*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eether_addr_equal\u003c/span\u003e(p\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003ebr\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003edev\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003edev_addr, dest))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\tskb\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003epkt_type \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e PACKET_HOST;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e/*调用NF_BR_PRE_ROUTING处钩子函数，结束后进入br_handle_frame_finish函数*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003eNF_HOOK\u003c/span\u003e(NFPROTO_BRIDGE, NF_BR_PRE_ROUTING,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#a6e22e\"\u003edev_net\u003c/span\u003e(skb\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003edev), NULL, skb, skb\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003edev, NULL,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\tbr_handle_frame_finish);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edrop:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#a6e22e\"\u003ekfree_skb\u003c/span\u003e(skb);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e RX_HANDLER_CONSUMED;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e相关函数\u003c/p\u003e","tags":["netfilter框架","二层桥"],"title":"「转」Linux内核数据包bridge上转发流程"},{"categories":["linux"],"content":" 原文地址 cloud.tencent.com\n最近使用 tcpdump 的时候突然想到这个问题。因为我之前只存在一些一知半解的认识：比如直接镜像了网卡的包、在数据包进入内核前就获取了。但这些认识真的正确么？针对\u0026hellip;\n最近使用 tcpdump 的时候突然想到这个问题。因为我之前只存在一些一知半解的认识：比如直接镜像了网卡的包、在数据包进入内核前就获取了。但这些认识真的正确么？针对这个问题，我进行了一番学习探究。\n先说结论：通过 PF_PACKET 这个特殊的套接字协议，直接接收来自链路层的帧。数据包并非没有进入内核，而是在进入内核后直接跳过了内核中三层 / 四层的协议栈，直达套接字接口，被应用层的 tcpdump 所使用。实际上，在网卡驱动程序通知内核接受到数据帧的时候，数据包就已经进入了内核处理流程。具体的区别，可以见下图。\n内核网络协议栈示意图\n先来看看，普通的套接字的收包路径在内核中是怎么样。\n以最常见的以太网网卡，当网卡接口接收到了一个帧，那么接受者知道它一定包含了一个 Ethernet 报头。封包在协议栈向上传递过程中，一定会在报头中包含一个字段，指出下一阶段的处理应该使用哪一个协议。 以太网卡拥有特定的 MAC 地址，在监听数据帧的时候，当看到帧的目的 MAC 地址与自己的地址或者链路层广播地址（FF:FF:FF:FF:FF:FF）相匹配，就会通过 DMA 把该帧读取到内存中的 ring buffer。\n当一个数据帧被写入到内存后，将产生一个硬件中断请求，以通知 CPU 收到了数据包。操作系统为了减少硬中断产生的次数，会采用一个软中断 (softirq) 唤醒 NAPI 子系统。这样会产生一个单独的线程，调用网卡驱动注册的 poll 方法收包，同时禁止网卡产生新的硬中断，这样的效果便是一次中断可以接收多个包。一旦软终端代码判断有 softirq 处于 pending 状态，便会调用软终端处理函数 net_rx_action。\n中断处理函数会在处理循环中调用 NAPI poll 来接收数据包。poll 方法会分配一个 sk_buff 数据结构（include/linux/skbuff.h），表示该数据包的内核视图。然后将数据从缓冲区提取到新建的 sk_buff 中，并对其中的 protocol 字段做初始化，该字段用以识别特定的协议。之后这个字段会被 netif_receive_skb 内核函数查询，用来确定该执行哪个函数来处理三层的封包。字段涉及协议的值都列在了 include/uapi/linux/if_ether.h 中，名字形如 ETH_P_XXX，比如 ip 协议为 ETH_P_IP。而有一种特殊情况，单一封包可以传递给多个处理函数，这就是 tcpdump 等网络嗅探应用会用到的 ETH_P_ALL。\n软终端处理循环的最后是通过 netif_receive_skb 函数将将数据交给 TCP/IP 协议栈的。它会从数据包包头中取出协议信息，然后遍历注册在这个协议上的回调函数列表。这里的列表值得一提，分别是 ptype_all 和 ptype_base。他们是 hash table 数据结构，分别对应通用数据包（ETH_P_ALL 类型）和特定协议的数据包（ETH_P_XXX 类型），其中存放着指向对应协议处理函数的指针，当收到该类型的数据包时便调用对应的处理函数。\n因此，以 IP 数据包为例，当 ETH_P_IP 类型数据包出队后，软中断处理程序 net_rx_action 最终会在 ptype_base 列表中找到 IP 协议的处理函数 ip_rcv() 并调用它，完成数据包向上提交到协议栈。这里略过 IP 协议栈的处理过程，简而言之，在经过 IP 数据包完整性校验、Netfilter 子系统（iptables 的底层实现）、路由子系统等等一些列流程之后，开始准备送往高层协议。这里的处理和 net_rx_action 很相似，从 IP 数据包头部提取出协议类型后，通过名为 inet_protos 的哈希来寻找高层协议的处理函数，每个高层协议都对应一个处理函数，型如 tcp_v4_rcv(), udp_rcv() 等。\n四层协议以较为简单的 UDP 为例，udp_rcv 会对 udp 包进行合法性校验，然后查找是否有愿意接收此数据包的套接字，如果找到，__udp_queue_rcv_skb 会将包放到 socket 的接收队列。最后，所有在这个 socket 上等待数据的进程都会收到通过 sk_data_ready 函数处理的通知。\n以上是一个数据包穿越协议栈到达 socket 的简要过程，实际的内核处理过程会复杂的多，这里只是做简要的描述。以引入本文的主角：PF_PACKET 协议数据包在内核中的处理路径。\n当创建 PF_PACKET 套接字时，与协议相关的数据包类型将被同时注册进 ptype_all 和 ptype_base，接受函数为 packet_rcb()。此时，net_rx_action 函数会拦截所有进入机器的包，并同样通过 netif_receive_skb 函数遍历 ptype_all 后，传递给 PF_PACKET 接受函数。值得一提的是，tcpdump 依赖的 libpcap 库并非使用原始套接字 + recvfrom 的方式收包，而是在内核空间分配一块内核缓冲区，然后用户空间调用 mmap 系统调用映射到用户空间。\n参考资料 Monitoring and Tuning the Linux Networking Stack: Receiving Data\nInside the Linux Packet Filter\n图解 linux tcpdump\n《深入理解 Linux 网络技术内幕》\n","permalink":"/post/c5-linux/linux/how-tcpdump/","summary":"\u003cblockquote\u003e\n\u003cp\u003e原文地址 \u003ca href=\"https://cloud.tencent.com/developer/article/1879646\"\u003ecloud.tencent.com\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e最近使用 tcpdump 的时候突然想到这个问题。因为我之前只存在一些一知半解的认识：比如直接镜像了网卡的包、在数据包进入内核前就获取了。但这些认识真的正确么？针对\u0026hellip;\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e最近使用 tcpdump 的时候突然想到这个问题。因为我之前只存在一些一知半解的认识：比如直接镜像了网卡的包、在数据包进入内核前就获取了。但这些认识真的正确么？针对这个问题，我进行了一番学习探究。\u003c/p\u003e\n\u003cp\u003e先说结论：通过 PF_PACKET 这个特殊的套接字协议，直接接收来自链路层的帧。数据包\u003cstrong\u003e并非没有\u003c/strong\u003e进入内核，而是在进入内核后直接跳过了内核中三层 / 四层的协议栈，直达套接字接口，被应用层的 tcpdump 所使用。实际上，在网卡驱动程序通知内核接受到数据帧的时候，数据包就已经进入了内核处理流程。具体的区别，可以见下图。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"1620.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e内核网络协议栈示意图\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e先来看看，普通的套接字的收包路径在内核中是怎么样。\u003c/p\u003e\n\u003cp\u003e以最常见的以太网网卡，当网卡接口接收到了一个帧，那么接受者知道它一定包含了一个 Ethernet 报头。封包在协议栈向上传递过程中，一定会在报头中包含一个字段，指出下一阶段的处理应该使用哪一个协议。 以太网卡拥有特定的 MAC 地址，在监听数据帧的时候，当看到帧的目的 MAC 地址与自己的地址或者链路层广播地址（FF:FF:FF:FF:FF:FF）相匹配，就会通过 DMA 把该帧读取到内存中的 ring buffer。\u003c/p\u003e\n\u003cp\u003e当一个数据帧被写入到内存后，将产生一个硬件中断请求，以通知 CPU 收到了数据包。操作系统为了减少硬中断产生的次数，会采用一个软中断 (softirq) 唤醒 NAPI 子系统。这样会产生一个单独的线程，调用网卡驱动注册的 poll 方法收包，同时禁止网卡产生新的硬中断，这样的效果便是一次中断可以接收多个包。一旦软终端代码判断有 softirq 处于 pending 状态，便会调用软终端处理函数 net_rx_action。\u003c/p\u003e\n\u003cp\u003e中断处理函数会在处理循环中调用 NAPI poll 来接收数据包。poll 方法会分配一个 sk_buff 数据结构（include/linux/skbuff.h），表示该数据包的内核视图。然后将数据从缓冲区提取到新建的 sk_buff 中，并对其中的 protocol 字段做初始化，该字段用以识别特定的协议。之后这个字段会被 netif_receive_skb 内核函数查询，用来确定该执行哪个函数来处理三层的封包。字段涉及协议的值都列在了 include/uapi/linux/if_ether.h 中，名字形如 ETH_P_XXX，比如 ip 协议为 ETH_P_IP。而有一种特殊情况，单一封包可以传递给多个处理函数，这就是 tcpdump 等网络嗅探应用会用到的 ETH_P_ALL。\u003c/p\u003e","tags":["tcpdump","转载"],"title":"「转」tcpdump是在哪儿抓到的包？"},{"categories":["工具"],"content":"前言 统计ttrss的使用数据。\n月度mark文件分析 OK TODO：\n全年阅读报告 doing 按月保存mark的内容 账号 密码 和你docker文件里面的一致。\n# 按月来保存 import html2text # psycopg2 head import psycopg2 # pip3 install psycopg2-binary # ref:https://blog.csdn.net/Haiqiang1995/article/details/89069791 def get_from_dataset(cmd_sql): conn = None try: # read database configuration params = { \u0026#39;host\u0026#39;: \u0026#34;?????\u0026#34;, \u0026#39;user\u0026#39;: \u0026#34;????\u0026#34;, \u0026#39;password\u0026#39;: \u0026#34;????\u0026#34;, \u0026#39;dbname\u0026#39;: \u0026#34;ttrss\u0026#34;, \u0026#39;port\u0026#39;: ??00 } # connect to the PostgresQL database conn = psycopg2.connect(**params) # create a new cursor object cur = conn.cursor() # execute the SELECT statement print(cmd_sql) cur.execute(cmd_sql) blob = cur.fetchall() # blob = cur.fetchone() #open(path_to_dir + str(blob[0]) + \u0026#39;.jpg\u0026#39;, \u0026#39;wb\u0026#39;).write(blob[1]) # close the communication with the PostgresQL database cur.close() except (Exception, psycopg2.DatabaseError) as error: print(error) finally: if conn is not None: conn.close() print(\u0026#34;get_from_dataset success\u0026#34;) return blob _s=\u0026#34;ref_id,feed_id,last_read,last_marked\u0026#34; cmd_sql=\u0026#34;SELECT %s FROM public.ttrss_user_entries Where marked=TRUE AND last_marked BETWEEN \u0026#39;2022-04-01\u0026#39; And \u0026#39;2022-5-01\u0026#39;\u0026#34; % _s # 可以自己改日期 g_content=\u0026#34;\u0026#34; for _e in sorted(get_from_dataset(cmd_sql),key=lambda x:x[3]): [ref_id,feed_id,last_read,last_marked] = _e _s=\u0026#34;id,title,link,updated,content\u0026#34; cmd_sql=\u0026#34;SELECT %s FROM public.ttrss_entries WHERE id = %s\u0026#34; % (_s,ref_id) [id,title,link,updated,content] =get_from_dataset(cmd_sql)[0] g_content += \u0026#34;# [%s](%s)\\n\u0026#34;%(title,link) g_content +=\u0026#34;pubdata:%s\\n\u0026#34;%str(updated) g_content +=\u0026#34;markdate:%s\\n\u0026#34;%str(last_marked) g_content+=html2text.html2text(content) g_content+=\u0026#34;\\n\\n\u0026#34; D=\u0026#34;C:\\\\Users\\\\talen\\\\Desktop\\\\\u0026#34; with open(D+\u0026#34;cc.md\u0026#34;,\u0026#39;w\u0026#39;,encoding=\u0026#39;utf-8\u0026#39;) as f: f.write(g_content) ","permalink":"/post/c7-toolchain/rss-ttrss-statics/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\n统计ttrss的使用数据。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e月度mark文件分析 OK\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTODO：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e全年阅读报告 doing\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"按月保存mark的内容\"\u003e按月保存mark的内容\u003c/h2\u003e\n\u003cp\u003e账号 密码 和你docker文件里面的一致。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 按月来保存\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e html2text\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# psycopg2 head\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e psycopg2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# pip3 install psycopg2-binary\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ref:https://blog.csdn.net/Haiqiang1995/article/details/89069791\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eget_from_dataset\u003c/span\u003e(cmd_sql):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    conn \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# read database configuration\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        params \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;host\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;?????\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;user\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;????\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;password\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;????\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;dbname\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ttrss\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;port\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e??\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e00\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# connect to the PostgresQL database\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        conn \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e psycopg2\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003econnect(\u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003eparams)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# create a new cursor object\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cur \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e conn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecursor()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# execute the SELECT statement\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(cmd_sql)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cur\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexecute(cmd_sql)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        blob \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e cur\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efetchall()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# blob = cur.fetchone()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e#open(path_to_dir + str(blob[0]) + \u0026#39;.jpg\u0026#39;, \u0026#39;wb\u0026#39;).write(blob[1])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# close the communication with the PostgresQL database\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cur\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eclose()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eException\u003c/span\u003e, psycopg2\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eDatabaseError) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e error:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(error)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efinally\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e conn \u003cspan style=\"color:#f92672\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            conn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eclose()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;get_from_dataset success\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e blob\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e_s\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ref_id,feed_id,last_read,last_marked\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmd_sql\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;SELECT \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e  FROM public.ttrss_user_entries Where marked=TRUE AND last_marked BETWEEN \u0026#39;2022-04-01\u0026#39; And \u0026#39;2022-5-01\u0026#39;\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e _s\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 可以自己改日期\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eg_content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e _e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e sorted(get_from_dataset(cmd_sql),key\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003elambda\u003c/span\u003e x:x[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e]):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [ref_id,feed_id,last_read,last_marked] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e _e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    _s\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;id,title,link,updated,content\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    cmd_sql\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;SELECT \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e FROM public.ttrss_entries WHERE id = \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e (_s,ref_id)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    [id,title,link,updated,content] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eget_from_dataset(cmd_sql)[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    g_content \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;# [\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e](\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e(title,link)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    g_content \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pubdata:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003estr(updated)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    g_content \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;markdate:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003estr(last_marked)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    g_content\u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003ehtml2text\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehtml2text(content)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    g_content\u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;C:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eUsers\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003etalen\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eDesktop\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(D\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;cc.md\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e,encoding\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf-8\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(g_content)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","tags":["python","rss","知识管理"],"title":"rss统计 基于ttrss的PostgresQL数据库"},{"categories":["工具"],"content":"前言 本文中我们将英文rss 自动转成中文 rss供ttrss使用。（利用谷歌翻译）\n方便在手机上进行阅读或者收听。\n举例 国外有很多不错的rss源，比如:\nMcKinsey Insights \u0026amp; Publications 转成中文rss Nature Podcast\n转成中文rss 脚本 使用 Translate 和 BeautifulSoup 项目\n# coding:utf-8 from pygtrans import Translate from bs4 import BeautifulSoup # pip 安装 # pip install pygtrans BeautifulSoup -i https://pypi.org/simple # ref:https://zhuanlan.zhihu.com/p/390801784 # ref:https://beautifulsoup.readthedocs.io/zh_CN/latest/ # client = Translate() # text = client.translate(\u0026#39;Google Translate\u0026#39;) # print(text.translatedText) # 谷歌翻译 import sys from urllib import request import feedparser args = sys.argv URL=\u0026#34;http://www.mckinsey.com/insights/rss\u0026#34; BASE=\u0026#34;/home/xxx/www/\u0026#34; def tran(url=URL,out_dir=BASE+\u0026#34;mckinsey_rss.xml\u0026#34;): GT = Translate() content= request.urlopen(url).read().decode(\u0026#39;utf8\u0026#39;) # 变tag，以使用谷歌翻译 content=content.replace(\u0026#39;title\u0026gt;\u0026#39;, \u0026#39;stitle\u0026gt;\u0026#39;) #谷歌翻译会将很多titile去掉，所以需要换一个tag content=content.replace( \u0026#39;\u0026lt;pubDate\u0026gt;\u0026#39;,\u0026#39;\u0026lt;pubDate\u0026gt;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;) # 谷歌翻译对\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt; \u0026lt;/span\u0026gt; 不翻译。 content=content.replace( \u0026#39;\u0026lt;/pubDate\u0026gt;\u0026#39;,\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubDate\u0026gt;\u0026#39;) #print(content) _text = GT.translate(content) with open(out_dir,\u0026#39;w\u0026#39;,encoding=\u0026#39;utf-8\u0026#39;) as f: c=_text.translatedText # 还原tag c=c.replace(\u0026#39;stitle\u0026gt;\u0026#39;, \u0026#39;title\u0026gt;\u0026#39;) c=c.replace(\u0026#39;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;, \u0026#39;\u0026#39;) c=c.replace(\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubDate\u0026gt;\u0026#39;, \u0026#39;\u0026lt;/pubDate\u0026gt;\u0026#39;) f.write(c) #f.write(content) print(\u0026#34;GT: \u0026#34;+ url +\u0026#34; \u0026gt; \u0026#34;+ out_dir) if len(args)==1: tran() else: tran(args[1],args[2]) def tran_nature(url=\u0026#34;http://rss.acast.com/nature\u0026#34;,out_dir=BASE+\u0026#34;nature_rss.xml\u0026#34;): GT = Translate() html_doc=request.urlopen(url).read().decode(\u0026#39;utf8\u0026#39;) soup = BeautifulSoup(html_doc) items=soup.find_all(\u0026#39;item\u0026#39;) # nature post内容太多，谷歌api翻译不了，去掉一些 for idx,e in enumerate(items): if idx \u0026gt;8: e.decompose() content= str(soup) content=content.replace(\u0026#39;title\u0026gt;\u0026#39;, \u0026#39;stitle\u0026gt;\u0026#39;) content=content.replace( \u0026#39;\u0026lt;pubdate\u0026gt;\u0026#39;,\u0026#39;\u0026lt;pubDate\u0026gt;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;) content=content.replace( \u0026#39;\u0026lt;/pubdate\u0026gt;\u0026#39;,\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubdate\u0026gt;\u0026#39;) #print(content) _text = GT.translate(content) with open(out_dir,\u0026#39;w\u0026#39;,encoding=\u0026#39;utf-8\u0026#39;) as f: c=_text.translatedText c=c.replace(\u0026#39;stitle\u0026gt;\u0026#39;, \u0026#39;title\u0026gt;\u0026#39;) c=c.replace(\u0026#39;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;, \u0026#39;\u0026#39;) c=c.replace(\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubdate\u0026gt;\u0026#39;, \u0026#39;\u0026lt;/pubDate\u0026gt;\u0026#39;) # 对于ttrss需要为pubDate才会识别正确 c=c.replace(\u0026#39;\u0026amp;gt\u0026#39;,\u0026#39;\u0026gt;\u0026#39;) # \u0026amp;gt 会影响识别 f.write(c) #f.write(content) print(\u0026#34;GT: \u0026#34;+ url +\u0026#34; \u0026gt; \u0026#34;+ out_dir) tran_nature() 定时任务 注意激活一下miniconda3 这个命令source /home/xxx/miniconda3/bin/activate\n放到 /etc/cron.daily/\n#!/bin/bash source /home/xxx/miniconda3/bin/activate python /home/xxx/txxx.py 其他 利用Google翻译实现网站国际化——js插件 ","permalink":"/post/c7-toolchain/rss-google-translate/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e本文中我们将英文rss 自动转成中文 rss供ttrss使用。（利用谷歌翻译）\u003c/p\u003e\n\u003cp\u003e方便在手机上进行阅读或者收听。\u003c/p\u003e\n\u003ccenter\u003e\u003cimg src=\"rss-google-translate/20220508-22-28-27.png\" width=\"30%\"\u003e\n\u003c/center\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"举例\"\u003e举例\u003c/h2\u003e\n\u003cp\u003e国外有很多不错的rss源，比如:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://www.mckinsey.com/insights/rss\"\u003eMcKinsey Insights \u0026amp; Publications\u003c/a\u003e\n  \u003ccenter\u003e\u003cimg src=\"rss-google-translate/20220508-22-18-23.png\" width=\"50%\"\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/center\u003e\n    转成中文rss\n    \u003ccenter\u003e\u003cimg src=\"rss-google-translate/20220508-22-20-48.png\" width=\"50%\"\u003e\n\u003c/center\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"http://rss.acast.com/nature\"\u003eNature Podcast\u003c/a\u003e\u003c/p\u003e\n  \u003ccenter\u003e\u003cimg src=\"rss-google-translate/20220508-22-25-04.png\" width=\"50%\"\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/center\u003e\n   转成中文rss\n       \u003ccenter\u003e\u003cimg src=\"rss-google-translate/20220508-22-26-36.png\" width=\"50%\"\u003e\n\u003c/center\u003e\n\u003ch2 id=\"脚本\"\u003e脚本\u003c/h2\u003e\n\u003cp\u003e使用 Translate 和 BeautifulSoup 项目\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# coding:utf-8 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e pygtrans \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Translate\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e bs4 \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e BeautifulSoup\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# pip 安装\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# pip install pygtrans BeautifulSoup -i https://pypi.org/simple\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ref:https://zhuanlan.zhihu.com/p/390801784\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ref:https://beautifulsoup.readthedocs.io/zh_CN/latest/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# client = Translate()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# text = client.translate(\u0026#39;Google Translate\u0026#39;)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# print(text.translatedText)  # 谷歌翻译\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e urllib \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e request\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e feedparser\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eargs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eURL\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://www.mckinsey.com/insights/rss\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBASE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/home/xxx/www/\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etran\u003c/span\u003e(url\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eURL,out_dir\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eBASE\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mckinsey_rss.xml\u0026#34;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    GT \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Translate()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e request\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurlopen(url)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf8\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# 变tag，以使用谷歌翻译\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtent\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;title\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;stitle\u0026gt;\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#75715e\"\u003e#谷歌翻译会将很多titile去掉，所以需要换一个tag\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtent\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace( \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;pubDate\u0026gt;\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;pubDate\u0026gt;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;\u003c/span\u003e) \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# 谷歌翻译对\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt; \u0026lt;/span\u0026gt; 不翻译。\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtent\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace( \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/pubDate\u0026gt;\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubDate\u0026gt;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e#print(content)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    _text \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e GT\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etranslate(content)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(out_dir,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e,encoding\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf-8\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e_text\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etranslatedText\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# 还原tag\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;stitle\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;title\u0026gt;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubDate\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/pubDate\u0026gt;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(c)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e#f.write(content)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;GT: \u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e url \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34; \u0026gt; \u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e out_dir)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(args)\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    tran()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    tran(args[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e],args[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etran_nature\u003c/span\u003e(url\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://rss.acast.com/nature\u0026#34;\u003c/span\u003e,out_dir\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eBASE\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;nature_rss.xml\u0026#34;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    GT \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Translate()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    html_doc\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003erequest\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurlopen(url)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf8\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    soup \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BeautifulSoup(html_doc)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    items\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esoup\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efind_all(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;item\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# nature post内容太多，谷歌api翻译不了，去掉一些\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e idx,e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e enumerate(items):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e idx \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecompose()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e str(soup)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtent\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;title\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;stitle\u0026gt;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtent\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace( \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;pubdate\u0026gt;\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;pubDate\u0026gt;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    content\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003econtent\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace( \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/pubdate\u0026gt;\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubdate\u0026gt;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e#print(content)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    _text \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e GT\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etranslate(content)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(out_dir,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e,encoding\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf-8\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e_text\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etranslatedText\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;stitle\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;title\u0026gt;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;span translate=\u0026#34;no\u0026#34;\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/span\u0026gt;\u0026lt;/pubdate\u0026gt;\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;/pubDate\u0026gt;\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#75715e\"\u003e# 对于ttrss需要为pubDate才会识别正确\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026amp;gt\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026gt;\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#75715e\"\u003e# \u0026amp;gt 会影响识别\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(c)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e#f.write(content)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;GT: \u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e url \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34; \u0026gt; \u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e out_dir)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etran_nature()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"定时任务\"\u003e定时任务\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意激活一下miniconda3 这个命令\u003ccode\u003esource /home/xxx/miniconda3/bin/activate\u003c/code\u003e\u003c/p\u003e","tags":["python","rss","知识管理"],"title":"使用脚本将英文rss转成中文rss"},{"categories":["网络"],"content":" 本文由 简悦 SimpRead 转码， 原文地址 juejin.cn\n0. 前言 在学习 ipsec 过程中，一般都会涉及到 ipsec 的局限性：ipsec 协议是一种点对点协议，不支持组播，也不能保护组播、广播报文。因此 ipsec 协议无法用于音视频会议等场合，此时通常的解决办法是采用 GRE Over IPSec .\n给出的解释是：GRE 协议可以封装组播、广播报文，但是无法对业务内容进行加密；而 ipsec 可以对报文进行加密，但是无法封装组播和广播报文。因此将两种协议结合，因而 GRE over IPSec 协议应运而生。 但是我找了很多资料 (其实没有多少)，都没有找到为什么 GRE 协议支持封装组播和广播报文，而 ipsec 不行；他们作为点对点协议，为什么 GRE 可以而 IPsec 不行呢？因为没有找到答案，所以不能证实自己的想法正确与否，于是通过搭建 GRE 隧道环境，学习 Linux 内核中 GRE 隧道的操作配置原则，希望能从中得到些许启发。\n搭建 GRE 隧道环境实际上是很简单的，因为 Linux 内核已经支持了 GRE 隧道，因此直接在虚拟机 (ubuntu 和 CentOS) 里进行简单的配置即可完成操作。\n1. Linux 内核支持的隧道类型 目前 Linux 内核已经支持多种隧道类型，包括：IPIP 隧道，GRE 隧道，\u0026hellip; 。其余这几个我也没见过。当然除了这几种，还有 ipsec 协议，l2tp 协议，可以的是我目前都还没有用过，实在是暴殄天物，罪过罪过\n下面通过搭建两组拓扑环境，来学习 GRE 隧道的基本规则，然后在此基础上分析下 GRE 和 IPSEC 在组播和广播报文封装的表现出不同行为的可能原因 (另写一遍文章喽)。\n2. GRE 隧道跨 (公) 网连接相同子网地址主机 2.1 拓扑环境 家里设备有限，只有一台电脑，还是通过无线网卡来上网的，因此拓扑环境比较寒酸，其实这些并不重要，只需明白我的两台虚拟机 Ubantu 和 CentOS 通过桥接的方式连在一起，网络上可以通讯即可。\n现在，我准备将两个地址分别为 10.1.2.1/24、10.1.2.2/24 的两台主机 (假的，只是个 IP 地址而已) 通过 GRE 隧道连接起来进行通讯。原则上这两个地址属于不同的子网中(Ubantu 中的子网和 CentOS 中的子网，只是这两个子网的网段相同仅此而已)，无法直接通讯。\n2.1 ubuntu 配置 首先，我确定了下该虚拟机中是否存在 gre 相关的接口，结果当然是没有了。\nroot@ubuntu:/home/toney# ifconfig -a ens33: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 192.168.1.10 netmask 255.255.255.0 broadcast 192.168.1.255 inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11 prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 2409:8a00:18e9:810:f8dd:500e:b1a:463b prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 fe80::8e84:574c:7a8b:440a prefixlen 64 scopeid 0x20\u0026lt;link\u0026gt; ether 00:0c:29:fb:db:ad txqueuelen 1000 (Ethernet) RX packets 3581 bytes 1030105 (1.0 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 1177 bytes 114532 (114.5 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73\u0026lt;UP,LOOPBACK,RUNNING\u0026gt; mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10\u0026lt;host\u0026gt; loop txqueuelen 1000 (Local Loopback) RX packets 160 bytes 12920 (12.9 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 160 bytes 12920 (12.9 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 复制代码 2.1.1 添加 GRE 隧道 ip tunnel add Tunnel-1 mode gre remote 192.168.1.13 local 192.168.1.10\n添加 GRE 隧道时, 需要指定隧道的名称，我这里叫做 Tunnel-1; 因为要搭建 GRE 类型隧道，因此 mode 为 gre。 而 GRE 隧道的地址为 192.168.1.13\u0026lt;========\u0026gt;192.168.1.10。\n由于是第一次执行此命令，底层实际上安装上了 gre 隧道相关的驱动。用户只有在此基础上才能配置 GRE 隧道，不过，无需担心，内核自动完成。\n如果在添加隧道时不指定 remote 和 local 地址，也是可以的，它实际上是只是安装 gre 隧道相关驱动。下面是添加隧道时没有指定 remote 和 local 地址时的结果：\nroot@ubantu:/home/toney# ip tunnel add Tunnel-1 cannot determine tunnel mode (ipip, gre, vti or sit) root@ubantu:/home/toney# ifconfig -a ens33: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 192.168.1.10 netmask 255.255.255.0 broadcast 192.168.1.255 inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11 prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 2409:8a00:18e9:810:200d:99e2:4f3d:cb6f prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 fe80::8e84:574c:7a8b:440a prefixlen 64 scopeid 0x20\u0026lt;link\u0026gt; ether 00:0c:29:fb:db:ad txqueuelen 1000 (Ethernet) RX packets 5038 bytes 5896155 (5.8 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 2744 bytes 309264 (309.2 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73\u0026lt;UP,LOOPBACK,RUNNING\u0026gt; mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10\u0026lt;host\u0026gt; loop txqueuelen 1000 (Local Loopback) RX packets 164 bytes 15044 (15.0 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 164 bytes 15044 (15.0 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 root@ubantu:/home/toney# ip tunnel add Tunnel-1 mode gre add tunnel \u0026#34;gre0\u0026#34; failed: File exists root@ubantu:/home/toney# ifconfig -a ens33: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 192.168.1.10 netmask 255.255.255.0 broadcast 192.168.1.255 inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11 prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 2409:8a00:18e9:810:200d:99e2:4f3d:cb6f prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 fe80::8e84:574c:7a8b:440a prefixlen 64 scopeid 0x20\u0026lt;link\u0026gt; ether 00:0c:29:fb:db:ad txqueuelen 1000 (Ethernet) RX packets 5097 bytes 5900501 (5.9 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 2766 bytes 311496 (311.4 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 erspan0: flags=4098\u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1450 ether 00:00:00:00:00:00 txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 gre0: flags=128\u0026lt;NOARP\u0026gt; mtu 1452 unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 txqueuelen 1000 (UNSPEC) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 gretap0: flags=4098\u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1462 ether 00:00:00:00:00:00 txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73\u0026lt;UP,LOOPBACK,RUNNING\u0026gt; mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10\u0026lt;host\u0026gt; loop txqueuelen 1000 (Local Loopback) RX packets 164 bytes 15044 (15.0 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 164 bytes 15044 (15.0 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 root@ubantu:/home/toney# root@ubantu:/home/toney# lsmod | grep gre ip_gre 28672 0 ip_tunnel 24576 1 ip_gre gre 16384 1 ip_gre root@ubantu:/home/toney# 复制代码 如果输入完整的命令，则会成功添加上 Tunnel-1 隧道：\nroot@ubantu:/home/toney# ifconfig -a Tunnel-1: flags=144\u0026lt;POINTOPOINT,NOARP\u0026gt; mtu 1476 unspec C0-A8-01-0A-00-00-00-87-00-00-00-00-00-00-00-00 txqueuelen 1000 (UNSPEC) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 ens33: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 192.168.1.10 netmask 255.255.255.0 broadcast 192.168.1.255 inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11 prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 2409:8a00:18e9:810:200d:99e2:4f3d:cb6f prefixlen 64 scopeid 0x0\u0026lt;global\u0026gt; inet6 fe80::8e84:574c:7a8b:440a prefixlen 64 scopeid 0x20\u0026lt;link\u0026gt; ether 00:0c:29:fb:db:ad txqueuelen 1000 (Ethernet) RX packets 5745 bytes 5947674 (5.9 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 2965 bytes 329731 (329.7 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 erspan0: flags=4098\u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1450 ether 00:00:00:00:00:00 txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 gre0: flags=128\u0026lt;NOARP\u0026gt; mtu 1452 unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 txqueuelen 1000 (UNSPEC) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 gretap0: flags=4098\u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1462 ether 00:00:00:00:00:00 txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73\u0026lt;UP,LOOPBACK,RUNNING\u0026gt; mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10\u0026lt;host\u0026gt; loop txqueuelen 1000 (Local Loopback) RX packets 169 bytes 15509 (15.5 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 169 bytes 15509 (15.5 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 复制代码 2.1.2 配置 GRE 隧道接口 IP ip addr add 10.1.2.1/24 dev Tunnel-1\n或者\nifconfig Tunnel-1 10.1.2.1/24\n从添加隧道结果来看，Tunnel-1 接口虽然已经成功添加，但是处于 down 状态，此外也没有 IP 地址。 不，等等，那我们在添加隧道时指定的 remote 和 local 是什么呢？\n它是经过 GRE 隧道封装后的报文 IP 地址，但是针对什么报文进行封装，目前我们尚未配置。\n配置此接口 IP 的目的是：为了确定哪些报文需要进入 GRE 接口，然后进行隧道封装。为什么需要添加 IP 呢？ 因为我们是通过路由将报文引入到 Tunnel-1 接口的, 如果不填 IP，那么我路由的下一条该写成什么呢， 是吧。\n2.1.3 激活 GRE 隧道接口 IP ifconfig Tunnel-1 up\n或者\nip link set Tunnel-1 up\n至于配置接口 IP 和是否 up 接口，没有什么先后顺序，把他们当做不同的 eth 接口处理即可。\n2.2 CentOS 配置 CentOS 虚拟机的配置和 Ubantu 的配置完全相同，安照此步骤操作即可。\nip tunnel add Tunnel-1 mode gre local 192.168.1.13 remote 192.168.1.10\nip link set Tunnel-1 up\nip addr add 10.1.2.2/24 dev Tunnel-1\n查看配置结果 r 如下：\n[root@toney toney]# [root@toney toney]# [root@toney toney]# ifconfig Tunnel-1 Link encap:UNSPEC HWaddr C0-A8-01-0D-FF-FF-90-6D-00-00-00-00-00-00-00-00 inet addr:10.1.2.2 P-t-P:10.1.2.2 Mask:255.255.255.0 UP POINTOPOINT RUNNING NOARP MTU:1476 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:0 (0.0 b) TX bytes:0 (0.0 b) eth0 Link encap:Ethernet HWaddr 00:0C:29:DA:34:3C inet addr:192.168.1.13 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: 2409:8a00:18e9:810:20c:29ff:feda:343c/64 Scope:Global inet6 addr: fe80::20c:29ff:feda:343c/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:3571 errors:0 dropped:0 overruns:0 frame:0 TX packets:781 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:236685 (231.1 KiB) TX bytes:71021 (69.3 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:4 errors:0 dropped:0 overruns:0 frame:0 TX packets:4 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:240 (240.0 b) TX bytes:240 (240.0 b) 复制代码 路由表信息如下：\n2.3 ping 包测试通讯链路 这里有一点需要注意：Linux 系统可能开了 iptables 过滤功能，因此在 ping 时出现了类似 \u0026ldquo;ICMP host 192.168.1.13 unreachable - admin prohibited, length 116\u0026rdquo; 信息，详情如下：\n百度一下, 在两台虚拟机上都执行如下操作即可：\niptables -F\n然后在 ping 包测试，数据可通：\n至此，基本 GRE 隧道环境搭建成功。\n3. GRE 隧道跨 (公) 网连接不同子网地址主机 3.1 拓扑环境 目的： 通过 GRE 隧道将 20.1.2.1/24、20.1.3.2/24 两个子网连接起来进行通讯。\n3.2 Ubantu 配置 3.2.1 配置 ens33 子接口 IP ifconfig eth0:1 192.168.100.1/24\n查看接口配置如下：\n3.2.2 添加另一个 GRE 隧道接口并 up ip tunnel add Tunnel-2 mode gre local 192.168.100.1 remote 192.168.100.2\nifconfig Tunnel-2 up\n3.2.3 配置隧道接口 IP ifconfig Tunnel-2 20.1.2.1/24\n3.2.4 添加对端子网路由表 由于本端没有对端子网 20.1.3.0/24 的路由，因此需要添加路由，将该网段报文引入到 Tunnel-2 接口，这样便可以通过 GRE 隧道进行封装。\nroute add -net 20.1.3.0/24 gw 20.1.2.1\n3.3 CentOS 配置 3.3.1 配置 ens33 子接口 IP ifconfig ens33:1 192.168.100.2/24\n3.3.2 添加另一个 GRE 隧道接口并 up ip tunnel add Tunnel-2 mode gre remote 192.168.100.1 local 192.168.100.2\nifconfig Tunnel-2 up\n结果如下：\n3.3.3 配置隧道接口 IP ifconfig Tunnel-2 20.1.3.1/24\n3.3.4 添加对端子网路由表 由于本端没有对端子网 20.1.2.0/24 的路由，因此需要添加路由，将该网段报文引入到 Tunnel-2 接口，这样便可以通过 GRE 隧道进行封装。\nroute add -net 20.1.2.0/24 gw 20.1.3.1\n3.4 ping 测试链路连通性 ​\n","permalink":"/post/c6-network/gre-test/","summary":"\u003cblockquote\u003e\n\u003cp\u003e本文由 \u003ca href=\"http://ksria.com/simpread/\"\u003e简悦 SimpRead\u003c/a\u003e 转码， 原文地址 \u003ca href=\"https://juejin.cn/post/6988645230987706398\"\u003ejuejin.cn\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"e31bac5bcb1347a59142486adaf94e30.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch2 id=\"0-前言\"\u003e0. 前言\u003c/h2\u003e\n\u003cp\u003e在学习 ipsec 过程中，一般都会涉及到 ipsec 的局限性：ipsec 协议是一种点对点协议，不支持组播，也不能保护组播、广播报文。因此 ipsec 协议无法用于音视频会议等场合，此时通常的解决办法是采用 \u003cstrong\u003eGRE Over IPSec\u003c/strong\u003e .\u003c/p\u003e\n\u003cp\u003e给出的解释是：GRE 协议可以封装组播、广播报文，但是无法对业务内容进行加密；而 ipsec 可以对报文进行加密，但是无法封装组播和广播报文。因此将两种协议结合，因而 GRE over IPSec 协议应运而生。 但是我找了很多资料 (其实没有多少)，都没有找到为什么 GRE 协议支持封装组播和广播报文，而 ipsec 不行；他们作为点对点协议，为什么  GRE 可以而 IPsec  不行呢？因为没有找到答案，所以不能证实自己的想法正确与否，于是通过搭建 GRE 隧道环境，学习 Linux 内核中 GRE 隧道的操作配置原则，希望能从中得到些许启发。\u003c/p\u003e\n\u003cp\u003e搭建 GRE 隧道环境实际上是很简单的，因为 Linux 内核已经支持了 GRE 隧道，因此直接在虚拟机 (ubuntu 和 CentOS) 里进行简单的配置即可完成操作。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"db260d2dc98445f9988f1c768ca3e744.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch2 id=\"1-linux-内核支持的隧道类型\"\u003e1. Linux 内核支持的隧道类型\u003c/h2\u003e\n\u003cp\u003e目前 Linux 内核已经支持多种隧道类型，包括：IPIP 隧道，GRE 隧道，\u0026hellip; 。其余这几个我也没见过。当然除了这几种，还有 ipsec 协议，l2tp 协议，可以的是我目前都还没有用过，实在是暴殄天物，罪过罪过\u003c/p\u003e","tags":["隧道","gre","转载"],"title":"「转」GRE隧道测试"},{"categories":["工具"],"content":"前言 在 “二零年RSS杂谈”中说到，我想建立一种信息的获取系统，免受广告和推荐算法的困扰。\n我希望其的功能包括：\n多终端 Web、PC、 mobile的同步 全文获取能力 可自定义过滤规则 RSS源自定义 方案：\nRSS源 rsshub RSS服务 ttrss RSS电脑手机软件：Android的Readably、Feedme，mac的reeder等等。windows上我暂时没有发现，我用的是ttrss的web界面。 rsshub 是由 DIYgod 开发的开源RSS源生成工具，RSShub原始的网站可能不稳定，所以我选择了自己搭建。\nttrss 是一个rss源管理配置的工具，可获取全文，可自定义过滤规则。\n本教程我们将完成在window电脑通过docker安装，ttrss与全文插件、rsshub的过程。\n服务器的成本还是有点小贵的，我们可以在本地搭建整个服务，即利用docker安装这些服务，开机的时候记得启动这些服务。 不爽点：\n需要后台开启docker服务，使得其自动更新信息 没有公网ip的情况下，无法全网连接服务 最终ttrss界面 在这里我已经添加一些rss源了。\ndocker windows安装 从docker 官网 下载windows版本安装。完成后，在图标区会有一个鲸鱼船。\n我们使用docker-compose 来进行下一步 网站服务的安装。将下面的资料保存到sdocker-compose.yml 然后利用docker-compose方法安装。\nversion: \u0026#34;2\u0026#34; services: service.rsshub: image: diygod/rsshub container_name: rsshub ports: - \u0026#34;1200:1200\u0026#34; volumes: - rsshub_data:/app/lib restart: always service.rss: image: wangqiru/ttrss:latest container_name: ttrss ports: - 8118:80 environment: - SELF_URL_PATH=http://127.0.0.1:8118/ # please change to your own domain - DB_HOST=database.postgres - DB_PORT=5432 - DB_NAME=ttrss - DB_USER=postgres - DB_PASS=ttrss # please change the password - ENABLE_PLUGINS=auth_internal,fever # auth_internal is required. Plugins enabled here will be enabled for all users as system plugins - FEED_LOG_QUIET=true stdin_open: true tty: true restart: always command: sh -c \u0026#39;sh /wait-for.sh $$DB_HOST:$$DB_PORT -- php /configure-db.php \u0026amp;\u0026amp; exec s6-svscan /etc/s6/\u0026#39; database.postgres: image: postgres:alpine container_name: postgres environment: - POSTGRES_PASSWORD=ttrss # please change the password volumes: - postgres_data:/var/lib/postgresql/data # persist postgres data to ~/postgres/data/ on the host restart: always service.mercury: # set Mercury Parser API endpoint to `service.mercury:3000` on TTRSS plugin setting page image: wangqiru/mercury-parser-api:latest container_name: mercury ports: - 3000:3000 restart: always volumes: postgres_data: rsshub_data: 在地址栏输入cmd，我们就可以打开cmd界面了，然后运行docker-compose up -d ，就可以自动安装全部内容了。\n在地址栏输入cmd 然后回车，我们就能进入cmd界面，然后使用docker-compose，进行安装，网速好的话，安装很快。\n安装完毕我们就可以使用了，下面是其资源占用情况。\n内容 占用内存空间（M） mercury 全文获取ttrss插件 66.8 postgres ttrss数据库 6.8 ttrss ttrss工具 30.2 rsshub rsshub各种b站源等等 142.4 246.2 打开 http://127.0.0.1:8118/\n默认账户：admin 密码：password，请第一时间更改。\n在chrome安装 rsshub radar 并设置到本机的rsshub地址，ttrss地址，如上。\n打开bilibili up主的主页就能订阅了，订阅到ttrss。\n这里有问题。需要解决。\n本次安装教程到此结束，下期我们介绍全文获取功能，手机app的联动，即ttrss的设置问题\n","permalink":"/post/c7-toolchain/rss-local-install/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e在 “\u003ca href=\"c0-life/talk-rss-2020.md\"\u003e二零年RSS杂谈\u003c/a\u003e”中说到，我想建立一种信息的获取系统，免受广告和推荐算法的困扰。\u003c/p\u003e\n\u003cp\u003e我希望其的功能包括：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e多终端 Web、PC、 mobile的同步\u003c/li\u003e\n\u003cli\u003e全文获取能力\u003c/li\u003e\n\u003cli\u003e可自定义过滤规则\u003c/li\u003e\n\u003cli\u003eRSS源自定义\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e方案：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRSS源 rsshub\u003c/li\u003e\n\u003cli\u003eRSS服务  ttrss\u003c/li\u003e\n\u003cli\u003eRSS电脑手机软件：Android的Readably、Feedme，mac的reeder等等。windows上我暂时没有发现，我用的是ttrss的web界面。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- more --\u003e\n\u003cp\u003ersshub 是由 DIYgod 开发的开源RSS源生成工具，RSShub原始的网站可能不稳定，所以我选择了自己搭建。\u003c/p\u003e\n\u003cp\u003ettrss 是一个rss源管理配置的工具，可获取全文，可自定义过滤规则。\u003c/p\u003e\n\u003cp\u003e本教程我们将完成在window电脑通过docker安装，ttrss与全文插件、rsshub的过程。\u003c/p\u003e\n\u003cp\u003e服务器的成本还是有点小贵的，我们可以在本地搭建整个服务，即利用docker安装这些服务，开机的时候记得启动这些服务。\n不爽点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e需要后台开启docker服务，使得其自动更新信息\u003c/li\u003e\n\u003cli\u003e没有公网ip的情况下，无法全网连接服务\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"最终ttrss界面\"\u003e最终ttrss界面\u003c/h2\u003e\n\u003cp\u003e在这里我已经添加一些rss源了。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"image-20200626135803804.png\" \n     alt=\"image-20200626135803804\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch2 id=\"docker-windows安装\"\u003edocker windows安装\u003c/h2\u003e\n\u003cp\u003e从\u003ca href=\"https://www.docker.com/products/docker-desktop\"\u003edocker 官网\u003c/a\u003e 下载windows版本安装。完成后，在图标区会有一个鲸鱼船。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"image-20200626141604658.png\" \n     alt=\"image-20200626141604658\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e我们使用docker-compose 来进行下一步 网站服务的安装。将下面的资料保存到s\u003ccode\u003edocker-compose.yml\u003c/code\u003e 然后利用docker-compose方法安装。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yml\" data-lang=\"yml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eversion\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eservice.rsshub\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ediygod/rsshub\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ersshub\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1200:1200\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ersshub_data:/app/lib\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ealways\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eservice.rss\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ewangqiru/ttrss:latest\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ettrss\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e8118\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e80\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSELF_URL_PATH=http://127.0.0.1:8118/\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# please change to your own domain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eDB_HOST=database.postgres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eDB_PORT=5432\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eDB_NAME=ttrss\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eDB_USER=postgres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eDB_PASS=ttrss\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# please change the password\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eENABLE_PLUGINS=auth_internal,fever\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# auth_internal is required. Plugins enabled here will be enabled for all users as system plugins\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eFEED_LOG_QUIET=true\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003estdin_open\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003etty\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ealways\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ecommand\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003esh -c \u0026#39;sh /wait-for.sh $$DB_HOST:$$DB_PORT -- php /configure-db.php \u0026amp;\u0026amp; exec s6-svscan /etc/s6/\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003edatabase.postgres\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003epostgres:alpine\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003epostgres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ePOSTGRES_PASSWORD=ttrss\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# please change the password\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003epostgres_data:/var/lib/postgresql/data\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# persist postgres data to ~/postgres/data/ on the host\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ealways\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eservice.mercury\u003c/span\u003e: \u003cspan style=\"color:#75715e\"\u003e# set Mercury Parser API endpoint to `service.mercury:3000` on TTRSS plugin setting page\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ewangqiru/mercury-parser-api:latest\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003emercury\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e3000\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e3000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ealways\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003epostgres_data\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ersshub_data\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"image-20200626140114783.png\" \n     alt=\"image-20200626140114783\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e","tags":["rss","知识管理"],"title":"本地安装rss"},{"categories":["编程"],"content":"背景 对关注性能的程序开发人员而言，一个好的计时部件既是益友，也是良师。计时器既可以作为程序组件帮助程序员精确的控制程序进程，又是一件有力的调试武器，在有经验的程序员手里可以尽快的确定程序的性能瓶颈，或者对不同的算法作出有说服力的性能比较。\n在Windows平台下，常用的计时器有两种，一种是timeGetTime多媒体计时器，它可以提供毫秒级的计时。但这个精度对很多应用场合而言还是太粗糙了。另一种是QueryPerformanceCount计数器，随系统的不同可以提供微秒级的计数。对于实时图形处理、多媒体数据流处理、或者实时系统构造的程序员，善用QueryPerformanceCount/QueryPerformanceFrequency是一项基本功。\n本文要介绍的，是另一种直接利用Pentium CPU内部时间戳进行计时的高精度计时手段。以下讨论主要得益于《Windows图形编程》一书，第15页－17页，有兴趣的读者可以直接参考该书。关于RDTSC指令的详细讨论，可以参考Intel产品手册。本文仅仅作抛砖之用。\n在 Intel Pentium以上级别的CPU中，有一个称为“时间戳（Time Stamp）”的部件，它以64位无符号整型数的格式，记录了自CPU上电以来所经过的时钟周期数。由于目前的CPU主频都非常高，因此这个部件可以达到纳秒级的计时精度。这个精确性是上述两种方法所无法比拟的。\n在Pentium以上的CPU中，提供了一条机器指令RDTSC（Read Time Stamp Counter）来读取这个时间戳的数字，并将其保存在EDX:EAX寄存器对中。由于EDX:EAX寄存器对恰好是Win32平台下C++语言保存函数返回值的寄存器，所以我们可以把这条指令看成是一个普通的函数调用。像这样：\ninline unsigned __int64 GetCycleCount() { __asm RDTSC } 但是不行，因为RDTSC不被C++的内嵌汇编器直接支持，所以我们要用_emit伪指令直接嵌入该指令的机器码形式0X0F、0X31，如下：\ninline unsigned __int64 GetCycleCount() { __asm _emit 0x0F __asm _emit 0x31 } 以后在需要计数器的场合，可以像使用普通的Win32 API一样，调用两次GetCycleCount函数，比较两个返回值的差，像这样：\nunsigned long t; t = (unsigned long)GetCycleCount(); //Do Something time-intensive ... t -= (unsigned long)GetCycleCount(); 《Windows图形编程》第15页编写了一个类，把这个计数器封装起来。有兴趣的读者可以去参考那个类的代码。作者为了更精确的定时，做了一点小小的改进，把执行RDTSC指令的时间，通过连续两次调用GetCycleCount函数计算出来并保存了起来，以后每次计时结束后，都从实际得到的计数中减掉这一小段时间，以得到更准确的计时数字。但我个人觉得这一点点改进意义不大。在我的机器上实测，这条指令大概花掉了几十到100多个周期，在Celeron 800MHz的机器上，这不过是十分之一微秒的时间。对大多数应用来说，这点时间完全可以忽略不计；而对那些确实要精确到纳秒数量级的应用来说，这个补偿也过于粗糙了。\n这个方法的优点是：\n高精度。可以直接达到纳秒级的计时精度（在1GHz的CPU上每个时钟周期就是一纳秒），这是其他计时方法所难以企及的。\n成本低。timeGetTime函数需要链接多媒体库 winmm.lib，QueryPerformance*函数根据MSDN的说明，需要硬件的支持（虽然我还没有见过不支持的机器）和KERNEL库的支持，所以二者都只能在Windows平台下使用（关于DOS平台下的高精度计时问题，可以参考《图形程序开发人员指南》，里面有关于控制定时器8253的详细说明）。但RDTSC指令是一条CPU指令，凡是i386平台下Pentium以上的机器均支持，甚至没有平台的限制（我相信i386版本UNIX和Linux下这个方法同样适用，但没有条件试验），而且函数调用的开销是最小的。\n具有和CPU主频直接对应的速率关系。一个计数相当于1/(CPU主频Hz数)秒，这样只要知道了CPU的主频，可以直接计算出时间。这和 QueryPerformanceCount不同，后者需要通过QueryPerformanceFrequency获取当前计数器每秒的计数次数才能换算成时间。\n这个方法的缺点是：\n现有的C/C++编译器多数不直接支持使用RDTSC指令，需要用直接嵌入机器码的方式编程，比较麻烦。\n数据抖动比较厉害。其实对任何计量手段而言，精度和稳定性永远是一对矛盾。如果用低精度的timeGetTime来计时，基本上每次计时的结果都是相同的；而RDTSC指令每次结果都不一样，经常有几百甚至上千的差距。这是这种方法高精度本身固有的矛盾。\n关于这个方法计时的最大长度，我们可以简单的用下列公式计算：\n自CPU上电以来的秒数 = RDTSC读出的周期数 / CPU主频速率（Hz） 64位无符号整数所能表达的最大数字是1.8×10^19，在我的Celeron 800上可以计时大约700年（书中说可以在200MHz的Pentium上计时117年，这个数字不知道是怎么得出来的，与我的计算有出入）。无论如何，我们大可不必关心溢出的问题。\n下面是几个小例子，简要比较了三种计时方法的用法与精度\n//Timer1.cpp 使用了RDTSC指令的Timer类//KTimer类的定义可以参见《Windows图形编程》P15 //编译行：CL Timer1.cpp /link USER32.lib #include \u0026lt;stdio.h\u0026gt; #include \u0026#34;KTimer.h\u0026#34; main() { unsigned t; KTimer timer; timer.Start(); Sleep(1000); t = timer.Stop(); printf(\u0026#34;Lasting Time: %d\\n\u0026#34;,t); } //Timer2.cpp 使用了timeGetTime函数 //需包含\u0026lt;mmsys.h\u0026gt;，但由于Windows头文件错综复杂的关系 //简单包含\u0026lt;windows.h\u0026gt;比较偷懒：） //编译行：CL timer2.cpp /link winmm.lib #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; main() { DWORD t1, t2; t1 = timeGetTime(); Sleep(1000); t2 = timeGetTime(); printf(\u0026#34;Begin Time: %u\\n\u0026#34;, t1); printf(\u0026#34;End Time: %u\\n\u0026#34;, t2); printf(\u0026#34;Lasting Time: %u\\n\u0026#34;,(t2-t1)); } //Timer3.cpp 使用了QueryPerformanceCounter函数 //编译行：CL timer3.cpp /link KERNEl32.lib #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; main() { LARGE_INTEGER t1, t2, tc; QueryPerformanceFrequency(\u0026amp;tc); printf(\u0026#34;Frequency: %u\\n\u0026#34;, tc.QuadPart); QueryPerformanceCounter(\u0026amp;t1); Sleep(1000); QueryPerformanceCounter(\u0026amp;t2); printf(\u0026#34;Begin Time: %u\\n\u0026#34;, t1.QuadPart); printf(\u0026#34;End Time: %u\\n\u0026#34;, t2.QuadPart); printf(\u0026#34;Lasting Time: %u\\n\u0026#34;,( t2.QuadPart- t1.QuadPart)); } //////////////////////////////////////////////// //以上三个示例程序都是测试1秒钟休眠所耗费的时间 //测试环境：Celeron 800MHz / 256M SDRAM // Windows 2000 Professional SP2 // Microsoft Visual C++ 6.0 SP5 //////////////////////////////////////////////// 以下是Timer1的运行结果，使用的是高精度的RDTSC指令\nLasting Time: 804586872 以下是Timer2的运行结果，使用的是最粗糙的timeGetTime API\nBegin Time: 20254254 End Time: 20255255 Lasting Time: 1001 以下是Timer3的运行结果，使用的是QueryPerformanceCount API\nFrequency: 3579545 Begin Time: 3804729124 End Time: 3808298836 Lasting Time: 3569712 古人说，触类旁通。从一本介绍图形编程的书上得到一个如此有用的实时处理知识，我感到非常高兴。有美不敢自专，希望大家和我一样喜欢这个轻便有效的计时器。\n","permalink":"/post/c8-programming/soft-run-time/","summary":"\u003ch2 id=\"背景\"\u003e背景\u003c/h2\u003e\n\u003cp\u003e对关注性能的程序开发人员而言，一个好的计时部件既是益友，也是良师。计时器既可以作为程序组件帮助程序员精确的控制程序进程，又是一件有力的调试武器，在有经验的程序员手里可以尽快的确定程序的性能瓶颈，或者对不同的算法作出有说服力的性能比较。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e在Windows平台下，常用的计时器有两种，一种是\u003ccode\u003etimeGetTime\u003c/code\u003e多媒体计时器，它可以提供毫秒级的计时。但这个精度对很多应用场合而言还是太粗糙了。另一种是\u003ccode\u003eQueryPerformanceCount\u003c/code\u003e计数器，随系统的不同可以提供微秒级的计数。对于实时图形处理、多媒体数据流处理、或者实时系统构造的程序员，善用\u003ccode\u003eQueryPerformanceCount/QueryPerformanceFrequency\u003c/code\u003e是一项基本功。\u003c/p\u003e\n\u003cp\u003e本文要介绍的，是另一种直接利用\u003ccode\u003ePentium CPU\u003c/code\u003e内部时间戳进行计时的高精度计时手段。以下讨论主要得益于\u003ccode\u003e《Windows图形编程》\u003c/code\u003e一书，第15页－17页，有兴趣的读者可以直接参考该书。关于RDTSC指令的详细讨论，可以参考Intel产品手册。本文仅仅作抛砖之用。\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003eIntel Pentium\u003c/code\u003e以上级别的CPU中，有一个称为“时间戳（Time   Stamp）”的部件，它以64位无符号整型数的格式，记录了自CPU上电以来所经过的时钟周期数。由于目前的CPU主频都非常高，因此这个部件可以达到纳秒级的计时精度。这个精确性是上述两种方法所无法比拟的。\u003c/p\u003e\n\u003cp\u003e在Pentium以上的CPU中，提供了一条机器指令RDTSC（Read Time   Stamp Counter）来读取这个时间戳的数字，并将其保存在EDX:EAX寄存器对中。由于\u003ccode\u003eEDX:EAX\u003c/code\u003e寄存器对恰好是Win32平台下C++语言保存函数返回值的寄存器，所以我们可以把这条指令看成是一个普通的函数调用。像这样：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e  inline   unsigned   __int64   GetCycleCount()   \n  {   \n    __asm   RDTSC   \n  }   \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e但是不行，因为RDTSC不被C++的内嵌汇编器直接支持，所以我们要用_emit伪指令直接嵌入该指令的机器码形式\u003ccode\u003e0X0F\u003c/code\u003e、\u003ccode\u003e0X31\u003c/code\u003e，如下：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e  inline   unsigned   __int64   GetCycleCount()   \n  {   \n    __asm   _emit   0x0F   \n    __asm   _emit   0x31   \n  }   \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e以后在需要计数器的场合，可以像使用普通的Win32   API一样，调用两次GetCycleCount函数，比较两个返回值的差，像这样：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e  unsigned   long   t;   \n  t   =   (unsigned   long)GetCycleCount();   \n  //Do   Something   time-intensive   ...   \n  t   -=   (unsigned   long)GetCycleCount();   \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003e《Windows图形编程》\u003c/code\u003e第15页编写了一个类，把这个计数器封装起来。有兴趣的读者可以去参考那个类的代码。作者为了更精确的定时，做了一点小小的改进，把执行\u003ccode\u003eRDTSC\u003c/code\u003e指令的时间，通过连续两次调用\u003ccode\u003eGetCycleCount\u003c/code\u003e函数计算出来并保存了起来，以后每次计时结束后，都从实际得到的计数中减掉这一小段时间，以得到更准确的计时数字。但我个人觉得这一点点改进意义不大。在我的机器上实测，这条指令大概花掉了几十到100多个周期，在\u003ccode\u003eCeleron 800MHz\u003c/code\u003e的机器上，这不过是十分之一微秒的时间。对大多数应用来说，这点时间完全可以忽略不计；而对那些确实要精确到纳秒数量级的应用来说，这个补偿也过于粗糙了。\u003c/p\u003e\n\u003cp\u003e这个方法的优点是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e高精度。可以直接达到纳秒级的计时精度（在1GHz的CPU上每个时钟周期就是一纳秒），这是其他计时方法所难以企及的。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e成本低。\u003ccode\u003etimeGetTime\u003c/code\u003e函数需要链接多媒体库 \u003ccode\u003ewinmm.lib\u003c/code\u003e，\u003ccode\u003eQueryPerformance*\u003c/code\u003e函数根据MSDN的说明，需要硬件的支持（虽然我还没有见过不支持的机器）和KERNEL库的支持，所以二者都只能在Windows平台下使用（关于DOS平台下的高精度计时问题，可以参考\u003ccode\u003e《图形程序开发人员指南》\u003c/code\u003e，里面有关于控制定时器8253的详细说明）。但\u003ccode\u003eRDTSC\u003c/code\u003e指令是一条CPU指令，凡是i386平台下Pentium以上的机器均支持，甚至没有平台的限制（我相信i386版本UNIX和Linux下这个方法同样适用，但没有条件试验），而且函数调用的开销是最小的。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e具有和CPU主频直接对应的速率关系。一个计数相当于1/(CPU主频Hz数)秒，这样只要知道了CPU的主频，可以直接计算出时间。这和   \u003ccode\u003eQueryPerformanceCount\u003c/code\u003e不同，后者需要通过\u003ccode\u003eQueryPerformanceFrequency\u003c/code\u003e获取当前计数器每秒的计数次数才能换算成时间。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这个方法的缺点是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e现有的C/C++编译器多数不直接支持使用RDTSC指令，需要用直接嵌入机器码的方式编程，比较麻烦。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e数据抖动比较厉害。其实对任何计量手段而言，精度和稳定性永远是一对矛盾。如果用低精度的\u003ccode\u003etimeGetTime\u003c/code\u003e来计时，基本上每次计时的结果都是相同的；而\u003ccode\u003eRDTSC\u003c/code\u003e指令每次结果都不一样，经常有几百甚至上千的差距。这是这种方法高精度本身固有的矛盾。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e关于这个方法计时的最大长度，我们可以简单的用下列公式计算：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e自CPU上电以来的秒数   =   RDTSC读出的周期数   /   CPU主频速率（Hz）   \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e64位无符号整数所能表达的最大数字是\u003ccode\u003e1.8×10^19\u003c/code\u003e，在我的\u003ccode\u003eCeleron   800\u003c/code\u003e上可以计时大约700年（书中说可以在200MHz的Pentium上计时117年，这个数字不知道是怎么得出来的，与我的计算有出入）。无论如何，我们大可不必关心溢出的问题。\u003c/p\u003e","tags":["软件运行","时间","转载"],"title":"「转」window软件运行时间"},{"categories":["工具"],"content":"anki使用 - 自建 anki server 当初想设计好用的英语背诵软件，现在发现了anki人家功能全部实现，还要啥自行车。\n我当时设计的单词勇士开源Android软件： https://github.com/talengu/WordWarrior 现在已弃坑。\n我们当然选用docker compose 来安装，相当丝滑。\n在使用Anki过程中，主要工作是制作卡组，我们可以只关心内容而不关心技术。\ndocker compose # docker-compose.yml version: \u0026#34;2\u0026#34; services: service.anki: image: kuklinistvan/anki-sync-server container_name: anki-container ports: - 8121:27701 volumes: - ~/anki-sync-server:/app/data # anki data restart: always docker-compose up -d 登陆container docker exec -it anki-container /bin/sh ./ankisyncctl.py lsuser - list users ./ankisyncctl.py adduser \u0026lt;username\u0026gt; - add a new user ./ankisyncctl.py deluser \u0026lt;username\u0026gt; - delete a user ./ankisyncctl.py passwd \u0026lt;username\u0026gt; - change password of a user 客户端 mac/win 客户端 从官网下载 anki mac版本 2.1.21 (f1734a47) / Windows PC 客户端\n中文网：http://www.ankichina.net/\n工具-\u0026gt;附加组件-\u0026gt;获取插件，输入 代码：2124817646\n插件下载完成后设置ip地址，点击设置。\n{ \u0026#34;msyncUrl\u0026#34;: \u0026#34;http://127.0.0.1:27701/msync/\u0026#34;, \u0026#34;syncUrl\u0026#34;: \u0026#34;http://127.0.0.1:27701/sync/\u0026#34; } 重启anki，同步并输入输入自定义服务器中配置的账户\nAndroid客户端 - AnkiDroid 首先配置服务器地址信息，打开设置-\u0026gt;高级设置-\u0026gt;自定义同步服务器，输入同步地址 和 媒体文件同步地址。\n# 同步地址 http://127.0.0.1:27701/ # 媒体文件同步地址 http://127.0.0.1:27701/msync/ 然后打开 设置-\u0026gt;AnkiDroid常用设置-\u0026gt;AnkiWeb账户，输入在服务器里面设置的账户和密码。PS：可在服务器重置密码。\n图1 图2 coco20000 anki 包 https://www.dazhuanlan.com/2019/11/20/5dd54a6571f01/\n使用 Docker 安装 export ANKI_SYNC_DATA_DIR=$HOME/anki-sync-server export HOST_PORT=27701 mkdir -p \u0026#34;$ANKI_SYNC_DATA_DIR\u0026#34; #export DOCKER_USER=root #chown \u0026#34;$DOCKER_USER\u0026#34; \u0026#34;$ANKI_SYNC_DATA_DIR\u0026#34; chmod 700 \u0026#34;$ANKI_SYNC_DATA_DIR\u0026#34; docker run -itd \\ -v \u0026#34;$ANKI_SYNC_DATA_DIR\u0026#34;:/app/data \\ -p \u0026#34;$HOST_PORT\u0026#34;:27701 \\ --name anki-container \\ --restart always \\ kuklinistvan/anki-sync-server:latest ","permalink":"/post/c7-toolchain/anki-tips/","summary":"\u003ch2 id=\"anki使用---自建-anki--server\"\u003eanki使用 - 自建 anki  server\u003c/h2\u003e\n\u003cp\u003e当初想设计好用的英语背诵软件，现在发现了anki人家功能全部实现，还要啥自行车。\u003c/p\u003e\n\u003cp\u003e我当时设计的单词勇士开源Android软件：\n\u003ca href=\"https://github.com/talengu/WordWarrior\"\u003ehttps://github.com/talengu/WordWarrior\u003c/a\u003e\n现在已弃坑。\u003c/p\u003e\n\u003cp\u003e我们当然选用docker compose 来安装，相当丝滑。\u003c/p\u003e\n\u003cp\u003e在使用Anki过程中，主要工作是制作卡组，我们可以只关心内容而不关心技术。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"docker-compose\"\u003edocker compose\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# docker-compose.yml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eversion\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eservice.anki\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ekuklinistvan/anki-sync-server\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eanki-container\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e8121\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e27701\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e~/anki-sync-server:/app/data\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# anki data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ealways\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edocker-compose up -d \n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"登陆container\"\u003e登陆container\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edocker exec -it anki-container /bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./ankisyncctl.py lsuser             - list users\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./ankisyncctl.py adduser \u0026lt;username\u0026gt; - add a new user\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./ankisyncctl.py deluser \u0026lt;username\u0026gt; - delete a user\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./ankisyncctl.py passwd \u0026lt;username\u0026gt;  - change password of a user\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"客户端\"\u003e客户端\u003c/h2\u003e\n\u003cimg src=\"anki-tips/image-20200424005627732.png\" alt=\"image-20200424005627732\" style=\"zoom:33%;\" /\u003e\n\u003ch3 id=\"macwin-客户端\"\u003emac/win 客户端\u003c/h3\u003e\n\u003cp\u003e从官网下载 anki mac版本 2.1.21 (f1734a47) / Windows PC 客户端\u003c/p\u003e","tags":["anki","技巧","知识管理"],"title":"知识记忆软件anki的使用"},{"categories":["linux"],"content":" ref:Ubuntu完全教程，让你成为Ubuntu高手！ todo整理\nUbuntu的发音 Ubuntu，源于非洲祖鲁人和科萨人的语言，发作 oo-boon-too 的音。了解发音是有意义的，您不是第一个为此困惑的人，当然，也不会是最后一个：）\n大多数的美国人读 ubuntu 时，将 u 作为元音发音，类似单词 who 或者 boo ，重音在第二个音节即 u\u0026rsquo;buntu ，oo-boon-too 。\n如果您喜欢撒哈拉，喜欢它令人窒息的温柔、梦幻般的寂寥还有张扬恣肆的旷远，您大可在第一个 u，后面带些嗡嗡声： oom-boon-too。\nUbuntu的中文发音大约为： 乌班图\nUbuntu的涵义 Ubuntu这个单词源自非洲，意谓“班图精神”────谁都不是一座孤岛，自成一体。每个人都包孕于人类，因他人存在而存在，因他人幸福而幸福。\nUbuntu当前版本 Ubuntu Linux v6.06 LTS (Dapper Drake)\nLTS：Long Term Support\nDapper Drake：当前版本的开发代号\nUbuntu的特点 Ubuntu 完全基于 Linux 操作系统， 可以免费得到社区及专业机构的支持。庞大的社区是它成长的沃土，请向这片动人的热忱敞开心扉。\nUbuntu 社区恪守 Ubuntu 理念：自由！软件应是自由的，应尊重人类的自由意志，它与人类之间不应有任何隔膜。本地语种，功能限制，自主改进的权利……都不应成为使用的障碍或负担。\n自由，让 Ubuntu 与传统的私有软件从根本上不同: 免费不能用来遮羞，您有权修正它，直到满意为止。\nUbuntu 适合桌面和服务器。当前 Ubuntu 发布版支持 PC (Intel x86), 64-bit PC (AMD64) 和 PowerPC (Apple iBook 和 Powerbook, G4 和 G5) 架构。\nUbuntu 包涵了超过 16,000 种软件， 核心的桌面系统却只有一张光盘， Ubuntu 覆盖了所有的桌面应用程序,\n从文字处理，电子表格到 web 服务器和开发设计环境一应俱全。 详情查看 Ubuntu 桌面 和 Ubuntu 服务器的介绍。\nUbuntu相对其它Linux发行版的主要特点 基于Debian/Linux，使用 APT 包管理系统。\n相对于Fedora Code： APT 包管理系统优雅地解决了依赖问题，并且可以从容的在线安装升级\n相对于Debian：软件更新积极，而Debian较保守。\n相对于Gentoo：基本无需编译，省力、省时、省心。\n基本操作 进入系统\n在登录界面中输入您的用户名，然后系统将提问您的密码\n输入您的密码后，回车，稍事等待，您便可以进入Ubuntu系统\n点击桌面左上角的图标，您可以打开一个菜单（或者使用 Alt+F1 组合键）\n如果您想退出系统，可以点击该图标\n在桌面上方启动栏中，包含了一些常用程序的启动图标这些图标也可以在开始菜单中找到\n现在点击FireFox图标，您便可以使用FireFox浏览器冲浪\n或者按下 Alt+F2 组合键，弹出一个运行命令对话框。输入 firefox 后回车，同样可以启动FireFox\n在菜单中找到 终端\n点击它便开启了一个终端窗口，您可以在终端窗口中运行命令\n也可以在控制台中输入命令。使用 Ctrl+Alt+[F1F6] ，您可以切换到16号控制台\n使用 Ctrl+Alt+F7 可以返回图形界面（您可以使用 Ctrl+Alt+BackSpace 将图形界面关闭）\n命令行提示符\nuser@ubuntu:~$ 为命令提示符， @ 之前的部分为当前用户ID， @ 与 : 之间的部分，为您的主机名称， : 与 $ 之间的部分，为当前的路径。\n退出系统\n您可以点击这一个图标来退出系统\n也可以在终端或者控制台中输入命令\nsudo halt\n系统会提问您密码，输入正确密码，便可以退出系统\n在以后的章节中，如果我们提示您输入命令，那么您即可以在终端中输入，也可以在控制台中输入。如果只是启动应用程序，还可以使用 Alt+F2 组合键。\n安装 分区概念 首先我们需要知道，硬盘分区的存在，是由硬盘的物理特性决定的，并不会因为不同的操作系统而有所改变。\n请您把一块硬盘想象为一本书……即便您不喜欢读书，您也一定非常熟悉它，所有的书都是相同的，包括我们使用的课本……您肯定非常熟悉\n一本完整的书，通常包括书名、索引和正文。\n如果您需要Linux，您首先需要找到一本书名为《linux》的书，书名相当于硬盘中的MBR，也就是主引导纪录。不同的是，MBR可以是几个书名合在一起，类似于《XX合订本》。这部分内容暂时还没有什么实用价值，您只需要大概的了解。\n而正文，就是硬盘中纪录的数据，这也非常容易理解，且对于安装系统并没有什么影响，所以现在我们来了解索引\n索引相当于硬盘中的分区表，书中的每一个章节，相当于硬盘中的一个分区，它起始和结束的页次，都可以在索引中找到。试想，如果阅读一本撕掉索引的书，您将很难找到您想阅读的部分。同样，如果没有分区表，操作系统也不能够在硬盘上定位数据的位置。\n由于历史的原因，硬盘中的分区表大小受到了限制，最多只可以容纳四个分区（主分区）。如果一本书，它的索引最多只能有四个章节，那不是太可怕了么？很多书的内容远远不止四个章节啊！\n于是聪明的人们想到了一个变通的办法，就是利用其中的一个章节，来存储其它部分的索引。比如第一章是前言，第二章是其它部分的索引，我们翻到第二章，呵呵，这里是第二个索引，因为只有第一个索引受四个章节的限制，所以这个索引的内容可以非常的详尽。第二个索引就是分区表中的扩展分区了，其中定义的章节，就是硬盘中的逻辑分区，不是很难理解吧？\n明白了这一点，我们来看看Linux和Windows对于分区不同的表示方法：\n可能您已经很熟悉Windows了，它使用盘符来表示分区，比如 C: D: E:，每一个分区使用一个盘符来标识，而且顺序可以颠倒， D:并不一定就是您系统中的第二个分区。（如果您给第二个分区分配最后一个硬盘盘符，把所有的盘符按顺序排列好，并且重装一次系统，您就会理解什么叫作“头疼”了：）\n而在Linux中，分区是这样表示的\n/dev/hda /dev/hda1 /dev/hda2 /dev/hda5/ dev/sdb1 以 /dev/hda5 为例:\n因为在Linux中，每一个设备都是用 /dev/ 文件夹下的一个文件来表示，所以 /dev/hda5 中， /dev/ 表示的是根目录下的dev目录，我们来看剩下的部分 hda5 。\n前两位的字母 hd 表示这是一块IDE硬盘，如果是 sd ，则代表SATA硬盘，或者闪存等外设。\n第三位的字母 a 表示这是该类型接口上的第一个设备。同理， b、c、d…… 分别代表该类型接口上的第二三四……个设备。例如 hdc 表示第二个IDE接口上的主硬盘（每个IDE接口上允许一个主设备和一个从设备）。\n第四位的数字 5，并不表示这是该硬盘中的第5个分区，而是第一个逻辑分区。因为在Linux中，为了避免不必要的混乱，分区的顺序是不能改变的，分区标识则由它们在硬盘中的位置决定。系统又要为所有可能的主分区预留标识，所以 1-4 一定不会是逻辑分区， 5 则是第一个逻辑分区，以此类推。\n安装中的注意事项 在Ubuntu系统的安装过程中，您需要选择系统目录的挂载点。\n我们知道，安装Windows时，我们可以选择把系统安装在哪一个分区，把系统挂载到分区上。而在ubuntu/Linux中则相反，我们要把分区挂载到系统中。当我们使用Windows的安装方式，把系统挂载到分区上，我们就不可能把Windows目录放在C盘，而把MyDocuments目录放到其它分区。您或者出于习惯，或者出于数据安全方面的考虑，通常把文档放到其它分区中。但是Windows下很多软件保存文件的默认目录就是MyDocument目录，这就比较不方便。\n在系统安装完成后，我们还是可以将MyDocuments目录转移到其它分区中，不过有点麻烦，可能许多朋友还不知道怎么去作……而任何一种Linux系统时，当然包括Ubuntu，我们可以在系统安装时就把分区挂载到目录下， /home 目录相当于Windows的MyDocuments ，我们可以把 /dev/hda5 挂载到此目录下，这样我们往 /home目录里存东西的时候，其实保存在第一个扩展分区中。如果再一次安装系统，只要把这个分区挂载到 /home目录下，那么进入新系统就像回家一样，真是太棒了。\n理论上来讲，您可以将分区挂载到任何目录下面，您可以自定义挂载的路径。但是我们并不推荐您这么作，因为那没有任何意义。系统安装程序向您建议的挂载目录，通常也是我们向您建议的，现在我们来了解一下，这些目录通常都是用来作什么的：\n/ 根目录，唯一必须挂载的目录。不要有任何的犹豫，选一个分区，挂载它！（在绝大多数情况下，有2G的容量应该是够用了。当然了，很多东西都是多多益善的：） Swap 交换分区，可能不是必须的，不过按照传统，并且照顾到您的安全感，还是挂载它吧。它的容量只要大于您的物理内存就可以了，如果超过了您物理内存两倍的容量，那绝对是一种浪费。 /home 前面已经介绍过了，这是您的家目录，通常您自己创建的文件，都保存在这里，您最好给它分配一个分区 /usr 应用程序目录。大部分的软件都安装在这里。如果您计划安装许多软件，建议您也给它分配一个分区 /var 如果您要作一些服务器方面的应用，可以考虑给它分配一个较大的分区 /boot 如果您的硬盘不支持LBA模式（我想那不太可能:），您最好挂载它，如果挂载硬盘的第一个分区，应该比较稳妥。一般来说，挂载的分区只要100M大小就足够了 在文件系统这一环节中，我们建议您选择： ReiserFS\n也许您注意到了，Windows中，盘符既用于表示硬件（硬盘上的分区）,又用于表示系统中的路径。而Linux中，硬件就是硬件，路径就是路径，不会混淆在一起，简单直接！\nLinux基础 Shell 可能您早已能够熟练的使用GUI（图形用户界面），例如您可以使用鼠标双击一个图标，来打开或者执行它。\n我们来看这个过程: 您使用鼠标定位桌面上的一个程序图标，按下左键两次。系统读取鼠标指针的位置，并且判断该位置下图标的涵义，根据预设的双击动作，运行程序或者打开文件。\n这一套GUI系统，便是一种Shell，它的作用是实现人机交互。如果我们不能够控制电脑，那么电脑还不如电视机好玩，不是么？电视机也可以选择频道（电视机的遥控器，也是一种人机交互的界面，不过相对于电脑，确实是相当简单了：）\n易于上手、界面直观是GUI的优点，但是GUI为不意味着简单！或许您有类似经历: 桌面上有几十个程序的启动图标，也知道它们的名字，但是翻出一个来，并不是一件轻松的事情。\n我的Windows系统中，桌面上摆满了各种图标，每当启动一个程序的时候，我都很是困扰。后来尝试了 音速启动 这类的程序启动管理器，效果还是差强人意。\n在我的不懈努力下，这个难道最终得到了解决： 将快捷方式名称简化，放到特定目录下，使用 Win+R 组合键呼出 运行对话框，键入快捷方式的名称来运行该程序。比如 反恐精英 的快捷方式为 cs ，我把它放在 Windows 目录下; 运行 cs命令，就可以去维护世界和平了。\n这么多快捷方式，统统放到 Windows 目录下，非常混乱。因此，我在D盘建立了一个名为 path的目录，并把它的路径加入到环境变量的 path 项中，快捷方式放在 D:\\path目录中。即便重装系统，只要在环境变量中重新加入此路径，原来的程序大多可以直接以命令来运行……我的许多朋友强烈要示我帮他们设定这种启动方式，因为这确实很方便：）\n其实在Linux下，所有的程序都可以通过命令运行。虽然Linux也有GUI，但是它并不比Windows的GUI更优秀！上面只是简单的介绍了CLI（命令行界面）相对GUI的优越之处，使用CLI还有更多的好处，您会慢慢体会到的。\n当然了，在您的印象中，CLI一定非常的不友善，缺少亲和力，冷漠而拒人于千里之外……您和CLI之间甚至有代沟的存在：）\n命令 坦白的说，冷不丁见到那么老长的一串命令，谁都会毛骨悚然。\n也许您使用过DOS，留下这种印象：命令先放一边，光是正确的输入目录、文件名都够瞧的。而且DOS不区分大小写，要是像Linux一样区分大小写，那多恐怖啊！！！\n其实Linux命令行具有补全功能，非常实用。假设有这样一个命令：\ncommand path/file 如果只有一个以 c 起始的命令，键入 c ，再按一次 tab 键，系统将自动补全该命令余下的部分。 只要 c tab 两次按键，就可以完成 command 的输入。\n如果不只一个 c 起始的命令，那么您可以按两次 tab 键，系统会列出所有符合条件的选项，也就是以 c 起始的所有命令。进一步输入 o ，如果只有一个以 co 起始的命令（一直输入，直到项符合条件的选项唯一），再按一次 tab ，命令就被补全完整。\n路径和文件名也可以通过 tab 键来补全。还有一种 遍历补全 的方式，如果您的文件名是中文，而您不想切换输入法；甚至您的文件名中出现乱码，无法输入，这时 遍历补全 就可以大显身手了。这部分内容我们稍后再谈：）\n现在我们来了解命令的语法结构，这一部分相当重要，您可得看仔细。\n我们知道，任何语言都有特定的语法结构，以我们的中文为例：\n我们郑重地推荐您Ubuntu/Linux！ 这个句子的语法尽管简单，却是大部分的命令行采用的句型。让我们看一下，这个句子里都有些什么：\n我们 主语，Linux命令的执行者只有一个，所以主语一概省略。\n推荐 一个动词，作为谓语而存在。Linux命令中，这一部分是必须的。这一部分也是不同命令之间最根本的区别方式，所以它通常作为命令名，写在最前面。键入 date 命令，您可以查看当前的时间日期。（ 应用程序-\u0026gt;附件-\u0026gt;终端 ）\n郑重的 状语，用来修饰谓语。与之相对应，Linux命令可以使用参数来精细调节程序的行为。为了与命令的操作对象相区别，参数前通常要加 - 或者 \u0026ndash; 符号。原则上，在命令名之后，参数的位置可以随意，但是为了养成一个良好的习惯，我们建议您在命令名后直接跟参数。\n您 Ubuntu/linux 这两个部分都是宾语，它们是命令的操作对象。大部分的命令只有一个操作对象，也有一些命令是双宾语结构的，具有一个直接宾语和一个间接宾语。比如 拷贝 这个命令 cp (copy)\n分隔符 我们的汉语是象形文字，没有分隔符。但是所有的拼音文字中都有分隔符，来分隔单词。Linux命令中同样使用空格作分隔符。\ncp a /home 表示把当前目录下的 a 文件，拷贝到 /home 目录下。（命令的不同部分使用空格分隔，连续的空格视为一个空格）\n上面的那句话，翻译成Linux的命令，应该是这个样子的：\n推荐 \u0026ndash;郑重的 您 Ubuntu/Linux （按照传统，“-”后跟简写为单个字母的参数，“\u0026ndash;”后跟完整单词的参数。不过也有例外：）\n哈，Linux的命令也蛮简单吧？\nLinux程序、进程 或许您会这样想，Linux命令的句型确实不难，但是那么多命令，我怎么知道它们都是作什么的呢？而且不同的系统中，可以使用的命令似乎也不太一样，这真让人困惑……\n其实Linux的命令，运行的是Linux系统中的程序。只要您已安装了程序，您就可以通过命令来运行它，并且可以使用参数来精细的调整它的运行状态。也可以通过点击启动图标来运行，不过启动图标不能够方便的调整参数，并不是很方便。\n举一个例子：\nmplayer -shuffle -loop 3 -playlist mymp3.list 可能您运行上面命令，系统会提示您 无法找到命令，那是因为您没有安装mplayer这个程序。mplayer是我见过的支持格式最多的播放器，几乎任何已知格式的多媒体文件，都可以使用mplayer来播放。它包含一个图形界面的前端，您可以在菜单中找到它，鼠标点击运行;也可以通过执行命令来运行它的命令行版本。\n如果您的系统中没有mplayer播放器，我们建议您安装一个。关于程序的安装，请参阅 软件安装 。\n上面命令中， mplayer 调用了mplayer播放器程序。参数 -shuffle 表示随机播放， -loop 表示循环播放，后面的3 为循环的次数，如果为 0 ,则一直播放。 -playlist 表示播放列表中的曲目。我们可以把mp3的路径放到 mymp3.list文件中，让mplayer来播放它们。\n进程 为运行中的程序，是程序在内存中的镜像。\n好了，现在您已经了解了 Shell 、 命令 、 程序 、 进程 的概念，您基本上也就了解了Linux（Linux系统真是非常简洁，而且容易理解：）。\n但只知道这些，您并不能顺畅使用。接下来的章节中，我们来进一步介绍它的细节。\nLinux系统简介 路径 路径分为绝对路径和相对路径。\n绝对路径的起始点为根目录 / ，例如 /usr/local/bin 就是绝对路径，它指向系统中一个绝对的位置，不受其它因素影响。\n相对路径的起始点为当前目录，如果您现在位于 /usr 目录，那么相对路径 local/bin 所指示的位置为 /usr/local/bin\n也就是说，相对路径所指示的位置，除了相对路径本身，还受到当前位置的影响。例如Linux系统中常见的目录 /bin 、 /usr/bin、 /usr/local/bin，如果只有一个相对路径 bin，那么它指示的位置可能上面三个目录中的任意一个，也可能是其它目录。\n如果我告诉您到 bin 目录寻找一个文件，您可能搞不清楚是哪一个 bin 目录。只有当前位置确定，相对路径指示的位置才能够确定。\n现在我说， /usr/local 目录下，它的相对路径 bin 中有某个文件，这样就比较明确了。\n在相对路径中 . 表示当前目录， .. 表示当前目录的上一级目录。\n假设您安装了一个程序，它的主程序没有被放置到上面三个 bin 目录中的任何一个，或者其它系统能够找到的地方，您就得告诉系统，它的可执行文件在哪里。\n可以使用绝对路径，例如： /home/user/bin/可执行文件\n或者定位到 /home/user/bin 目录，使用相对目录来定位它 ./可执行文件\n如果您定位到了它的子目录，比如 /home/user/bin/gui，您可以使用 .. 来表示它的上级目录 ../可执行文件\n路径相关命令\ncd (change directory) 更改目录。 pwd (print working directory)显示当前路径。 ls (list) 显示当前目录中的文件列表。 请尝试以下操作：\ncd /etc 进入“/etc”目录，这里使用的是绝对路径 pwd 显示当前路径，这个命令返回结果“/etc” cd init.d 进入“/etc”目录的子目录“init.d”，这里使用的是相对路径 cd .. 进入上一级目录“/etc” cd ../home “/etc” 目录的上一级目录为“/”，它的子目录“home”为“/home” cd - 回到上一次的目录，我们在“/etc”目录跳转到“/home”目录，所以这次是回到“/etc”目录 cd ~ “~”代表当前用户的“$HOME”目录，也就是“/home/{用户名}”目录。 ls 在任何时候，您都可以使用“ls”命令，来了解当前目录下都有哪些文件。 远程路径：\n远程路径的表示方法为 协议://用户名:密码@位置/路径:端口\n大多数的远程路径可以使用默认端口匿名访问，由此用户名、密码、端口通常不需要填写。例如：\nhttp://www.ubuntu.org.cn/.../index.html\n要求身份验证的远程路径，您可以使用下面的方式访问:\nftp://user:passwd@ftp.ubuntu.org.cn:21 软件 Linux中没有***注册表***这个概念。安装软件，理论上讲，只要拷贝所有相关文件，并运行它的主程序就可以了。\n按照传统，一个软件通常分别拷贝到同级目录下的 bin、etc、lib、share等文件夹。\nBin 可执行文件，程序的可执行文件通常在这个目录下。在环境变量中设定搜索路径，就可以直接执行，而不需要定位其路径。 Etc 配置文件，大部分系统程序的配置文件保存于 /etc 目录，便于集中修改。 Lib 库文件，集中在一起，方便共享给不同程序。相较不同的软件单独保存库文件，能够节约一些磁盘空间。 Share 程序运行所需要的其它资源，例如图标、文本。这部分文件是专有的，不需要共享；而且目录结构相对复杂，混放在一起比较混乱，所以单独存放。 还有一些软件，占用一个单独的目录，所有的资源都在这个目录中。类似于Windows下的绿色软件，不推荐在Linux系统下这样作。\n执行时，系统找不到可执行文件（搜索所有路径，资源开销过大，是不现实的），需要定位其位置，像这样 /home/user/bin/可执行文件 ，不够方便。\n许多系统软件需要协作运行，配置文件分别保存，定位它们非常麻烦\n如果程序使用的库文件，像图形库文件，都单独存放，那么磁盘空间的浪费会非常严重。\n有一些大型软件，或者您布署的重要应用，您可以将它们单独安装在一个文件夹下。（通常源码安装支持这种方式，将在 软件安装 部分介绍）\n配置方式 Linux下没有类似 注册表 的系统，系统和软件都可以通过纯文本的配置文件进行设置。\n事实上，图形界面的配置工具，通常就是以图形界面的方式修改配置文件，适合设置一些比较简单的程序。如果软件有几千个可以配置的选项，全部作成菜单，想象一下……开始发抖吧……\n图形界面的配置工具，可以看作特定配置文件专用编辑器。您一样可以使用通用文本编辑器来编辑配置文件，比如 Nano、Gedit、Knote、Vim或者Emacs等等。不考虑阅读、修改配置文本占用的时间，直接修改配置文件甚至更迅速。\n如果只是要修改某一常用选项，而且时常修改，比如主机的IP地址。使用文本编辑器，您要找到相应的配置文件，还要在配置文件中找到相应的选项，会浪费掉您的时间和耐性。\n图形配置工具经常会受各种因素制约，比如网络服务器中不提供图形服务，图形界面不够稳定……这时，您可以使用命令行的配置工具来完成这些工作。\n例如： 修改主机IP地址，可以使用ifconfig这个程序，执行下面的命令：\nifconfig eth0 192.168.0.1 在以后的章节中，如果我们提示您修改某一文件，例如 /etc/fstab ，您可以使用任何顺手的文本编辑器打开它。\n隐藏文件 Linux下，名称中第一个字符为 . 的文件或者文件夹，系统默认情况下将它们隐藏起来，\n您可以尝试以下操作：\ncd ~ 进入您的用户目录 ls 查看当前目录下的文件列表 ls -a 查看所有文件的文件列表（包括隐藏文件）。 现在，您可以看到许多文件名以 . 起始的文件或者文件夹了吧？使用 ls 命令无法显示它们\n如果您只想查看隐藏文件，而不包括这两个特殊目录，您可以使用 ls 命令的参数 -A （ls -A）\n每个目录下都包含两个特殊目录 . 和 .. 。您也许猜到了， . 代表当前目录， .. 代表上一级目录。目录是一种特殊类型的文件！\n文件类型\nLinux系统主要根据文件头信息来判断文件类型，扩展名并非决定因素。\n现在使用 ls -l 命令，查看详细信息格式的文件列表，您将会看到如下内容：\ntotal 5 drwxr-x--- 4 user group 4096 Mar 10 00:37 filename drwxr-xr-x 21 user group 4096 Mar 10 20:16 文件名 -rw------- 1 user group 524 Mar 10 00:40 a -rw-r--r-- 1 user group 24 Jun 11 2000 b drwx------ 2 user group 4096 Mar 9 11:06 c 共显示了七列信息，从左至右依次为：权限、文件数、归属用户、归属群组、文件大小、创建日期、文件名称\n其中要特别留意的是第一列：\ndrwxr-xr-x 一共有10个位置，可以分为4组：\nd rwx r-x r-x 第一组只有一个字符：\n** d* *文件夹* ** -* *普通文件* ** l* *链接* ** b* *块设备文件* ** c* *字符设备文件。* 剩下的3组分别为归属用户、归属群组、其它用户或群组对于该文件的权限。我们看它的格式\nrwx rwx rwx ** r* *可读* ** w* *可写* ** x* *可执行* 它们的顺便不能颠倒，某一位置为空(-)，则表示不具有相应的权限。\n说明：Linux下的可执行文件并不是由扩展名（例如 .exe ）决定的，而是由其可执行权限位决定。\n权限\n我们已经知道了，文件的权限分为 r （可读）、 w （可写）、 x （可执行）三种类型，而一个文件可以针对归属用户，归属群组，其它用户用户或群组分别设定权限。\n这种权限管理的方式灵活、简单、严密、明晰。尽管如此，在最初的阶段，可能会有一点小小的不适。因为它无所不在，而您习惯了的Windows的权限管理却不是这样（非常混乱，大多数时间形同虚设，偶尔用到却让人伤透脑筋）。\n使用 chmod 命令更改文件的权限，使用 chown 来更改文件的归属。例如：\nchmod 755 xxx\nchmod a+x xxx\nchown user:group xxx 用来更改文件的归属用户，也可以同时更改其归属群组\nchgrp group xxx 用来更改文件的归属群组\n上面命令中的 755 和 a+x 是两种类型的表达式\n我们将后面章节中详细介绍 权限管理 用户管理\n执行命令的权限\n有一些命令，普通用户也可以执行，但是只有root用户才能执行成功，这是为什么呢？\n例如在系统中增加一个新用户 useradd\nls -l /usr/sbin/useradd\n可以看到：\n-rwxr-xr-x 1 root root 56156 2006-04-03 21:37 /usr/sbin/useradd\n明明所有的用户都可以执行嘛？\n这是因为， useradd 命令是修改 /etc/passwd 文件的一个工具，来看看这个文件：\nls -l /etc/passwd\n-rw-r\u0026ndash;r\u0026ndash; 1 root root 1835 2006-06-24 17:58 /etc/passwd\n原来只有root用户才能写入修改结果，非root用户执行 useradd 命令当然不会有结果。\n执行命令的身份\n默认情况下，您的命令提示符末位为 $ ，这表示您将以普通用户的身份执行命令。\n您可以使用 su （switch user）这个命令来切换其它用户。\n例如 su root ，切换到root用户，如果 su 命令后面没有切换目标，那么这个命令默认切换到root用户。\n现在您执行 su 这个命令，系统会提示您输入密码，请输入管理员的密码。这个时候，您会发现命令提示符末位变成了 # ，您将以root用户的身份执行命令。\nUbuntu系统默认会随机设定系统的root密码，这样会更安全一些，这个时候您可以执行“sudo”命令，输入当前用户密码后，暂时以root\n用户的身份执行命令。（前提是sudoer列表中要包含您的ID。您在安装Ubuntu系统时创建的用户，默认具有“sudo”权限）\n如果您能够执行“sudo”命令，那么您也就拥有了root权限。在后面的章节中，如果我们提到了“root权限”，那么您可以通过以上两种方式来实现\n命令行 Shell、Console、Terminal\n在前面的章节中，我们曾提到，电视机的遥控器，也是一种人机交互的界面，算是一种Shell。\n但是这个概念并不准确，遥控器只是向Shell发送指令的工具，Shell接收到遥控器发出指令后，将指令转换为系统命令，由系统来执行。\n例如我们按的遥控器上的 数字键1 ,遥控器将 切换为1频道 的指令发送到Shell，Shell将指令转换为系统可以识别的 频道1 ，系统执行它，您就可以观看1频道的电视节目了。\n通常每台电视机只有一种Shell，比如有的电视机系统具有“画中画”的功能，那么Shell中便有相应的功能定义，您可以通过遥控器上的“画中画”功能键来开启它。假设您的电视机没有此功能，Shell中也就没有相应的功能定义。拥有一个带“画中画”功能控制键的遥控器，即便信号兼容，您还是不能够使用这一功能：）\n不用遥控器也可以控制电视机，假设您的遥控器丢了，您还可以走到电视机前，使用机身上的控制面板来控制它（相当于使用Linux的控制台）。但是您一定不喜欢这种方式，除非您想锻炼身体：）\n在Linux系统中，由于图形界面和控制台的分辨率通常不一致，所以切换时要有一个延时。对于我们中文用户来讲，控制台下中文的显示也比较麻烦。而且控制台显示内容通常不如终端显示的全面。\n所以我们推荐您使用终端来执行命令，它使用起来感觉很像遥控器：）\nrxvt-unicode\n通常情况下，您买一台电视机，只能获得一个遥控器。虽然它为您的电视机量身定作，能够最大限度发挥电视机的能力，但您却不一定喜欢它。说不定这个遥控器体形太大，持握不方便;或者它体形太小，容易失踪;又或者它的按键要么太硬，要么太软;它的键盘要么太大，要么太小……您一般也可以容忍，毕竟遥控器使用频率并不算高：）\n如果您的终端有些地方不讨您喜欢，比如说响应太慢，或者不能正常显示中文……那就难以忍受了，您应该换一个其它的试试。\n在前面的章节，我们介绍您使用的终端为Gnome-Termianl，它是系统默认使用的终端，显示中文不错，不过响应比较慢，您可能已经处于水深火热之中了。。。\n我们推荐您使用urxvt（mlterm也是不错的选择）\n您可以使用 sudo apt-get install rxvt-unicode 命令来安装它。\nurxvt 启动它 （urxvt不支持控制台，您得在图形界面下启动它。终端、Alt+F2，建议您在启动栏里新建一个启动图标）\nrxvt-unicode还支持“服务器/客户端”的运行模式：\nurxvtd 启动一个守护进程daemon（支持控制台）\nurxvtc 启动客户端client。多个客户端可以同时连接到一个urxvtd，以达到节省系统资源的目的。\n或许您对rxvt的默认设置不满意，您可以修改用户配置文件 ~/.Xresources 来设定它。修改全局配置文件 /etc/X11/Xresources/Xresources ，则对所有用户生效，只有root才可以修改此文件。\n这里有一些简单的选项：（以 ! 起始的行是注释，您可以直接拷贝此文件的内容）\n!!============================================================================= !! RXVT-unicode setting !!============================================================================= !设置字体分辨率 Xft.dpi:96 !窗口大小 Rxvt.geometry: 80x40+80+80 !颜色 Rxvt.background:#333333 Rxvt.foreground:antiquewhite Rxvt.inheritPixmap:False Rxvt.colorBD:yellow Rxvt.colorUL:antiquewhite !滚动条 Rxvt.scrollBar:True Rxvt.scrollBar_left:True Rxvt.scrollBar_floating:False Rxvt.scrollstyle:next Rxvt.scrollColor:#999999 !屏幕缓冲 Rxvt.saveLines:30000 Rxvt.color12:DodgerBlue Rxvt.font:7x14,xft:AR PL New Sung !输入法一般设置为xim !inputMethod:xim;Scim除外 !输入法样式可选:Root(置底) OverTheSpot(跟随) OffTheSpot OnTheSpot，后两种不是所有的都支持 Rxvt.preeditType:Root Tip：右键点击启动栏， 添加自启动器 ， 自定义程序 ，便可以在添加自己的启动图标。\n在线帮助系统 您可以使用命令 man 或者 info 来阅读Linux命令的在线文档。命令的格式非常简单：\nman xxx\n大部分命令手册为英文版，如果您的英文不太好，或许有些困难。在后面的 系统管理 章节中，我们会尽力向您介绍命令的使用方法。\n说明：在使用“man”浏览器的时候，一些快捷键您可能会用到：\nCtrl+f(orward) 向下翻一页 Ctrl+d(own) 向下翻半页 Ctrl+b(ackward) 向上翻一页 Ctrl+u(p) 向上翻半页 / 查找 q(uit) 退出 以上为VI风格的键绑定。您也可以使用Emacs风格的键绑定\nbash 好了，现在我们换了一个遥控器，感觉顺手多了。现在来操练一下，下载一首mp3：\n我们使用 wget 这个程序，它非常可靠，完全值得您信赖。\n首先找到一个可以下载的地址，复制链接，在终端窗口内点击鼠标中键，把它粘贴进去。\n现在终端中大概是这种情形：\nhttp://www.download.net/xxx.mp3\n按下 Ctrl+a 组合键，我们发现光标移动到了行首。输入 wget 和 空格\nwget http://www.download.net/xxx.mp3 回车后，终端中出现一些信息，不一会儿工夫，mp3便下载完成。\n使用 Ctrl+a 组合键，我们就不需要使用方向键来移动光标，方向键每次只能移动一个字符，没有效率\n您还可以使用 Ctrl+f 向前移动光标， Ctrl+b 向后移动光标， Ctrl+e 将光标移动到行末……………… （键绑定）\nNote Linux的图形界面中，鼠标中键通常执行“粘贴”的操作，如果您的鼠标没有中键，您可以左右键同时按下。\n中止正在运行的程序\n如果一个命令持续时间很长，以致于不能够进行其它操作，可以使用 Ctrl+c 来强行中止它。\nCtrl+s\n出于意外，有时您会按下 Ctrl+s 这个组合键，Shell便被冻结。尝试使用 Ctrl+q 组合键，看能否恢复正常。\n键绑定 等等，有必要记这么多快捷键么？都这么复杂！\n我们强烈建议您记住，以大幅度的提高操作效率。而且这是readline控件的键绑定，在任何使用readline控件的程序中，您都可以使用它们。例如bash、lftp、gdb等程序;同时，Linux下最著名的Emacs编辑器，也是这种风格的键绑定（其实是readline使用了Emacs风格的键绑定才对），甚至FireFox中，也可以使用类似风格的快捷键！（Linux下主要有两种风格的键绑定，一种是VI风格，另一种是Emacs风格，我们会在 简明VIM教程中介绍）\n现在列举一些ReadLine的键绑定，您可以自行尝试。（运行 man readline 命令，来查看ReadLine手册）\n先来了解一些约定：\n\\C-a 表示 Ctrl+a \\M-a 表示 Meta+a Meta键在PC中通常为ALT键 A 表示 Shift+a （下面括号中的\\A代表Alt，\\S代表Shift） 移动命令： \\C-a 移动到行首 Aheah \\C-e 移动到行末 End \\C-f 向前移动一个字符 Forward *\\C-b* *向后移动一个字符* *Backward \\M-f* *向前移动一个单词* *\\M-b* *向后移动一个单词* *\\C-l* *清空屏幕* *cLear* *这两个命令也可以理解为移动命令* *\\C-p* *上翻，前一条命令* *Previous* *\\C-n* *下翻，后一条命令* *Next* *编辑命令：* *\\C-d* *删除光标后的一个字符* *\\M-d* *删除光标后的一个单词* *Delete* *\\BackSpace* *删除光标前的一个字符* *\\M-BackSpace* *删除光标前的一个单词* *\\C-k* *删除光标至行末的部分* *Kill \\C-u* *删除光标至行首的部分* *Unix-line-discard* *\\C-w* *删除光标前的一个单词* *Word \\C-y* *粘贴（最后删除的对象）* *Yank \\C--* *撤消* 搜索历史纪录： *\\C-r* *连续使用* *``C-r``* *可以查找下一个* *\\M-p \\M-n* 补全： *\\Tab* *使用频率最高的功能！* *\\C-o* *遍历补全* *（未定义）* *\\M-? M-=* *列出所有可能选项，相当于按两次**Tab**键（**M-**？* *实际按键为**\\A+\\S+/**）* *\\M-#* *注释掉当前命令，用于将当前命令暂存于历史纪录列表（**\\A+\\S+3**）* *\\M-!* *补全命令，通常用来补全子命令，例如* *``sudo``* *的子命令（**\\A+\\S+1**）* *\\M-~* *补全用户名（**\\A+\\S+`**）* *\\M-@* *补全主机名（**\\A+\\S+2**）* *\\M-$* *补全变量（**\\A+\\S+4**）* *\\M-_* *补全历史纪录中的纪录（**\\A+\\S+-**）* *\\M-** *将所有可能选项放到命令行中（**\\A+\\S+8**）* 自定义键绑定 通过修改 /etc/inputrc 文件，可以更改键绑定。建议您使用默认的键绑定，以避免不必要的烦恼。当然了，Emacs风格的键绑定是通用的，随时都有可能用到。\n在文件中添加该行，可以将ReadLine的键绑定设为VI风格。（Bash、Lftp等使用ReadLine的软件同时生效）\nset editing-mode vi 找到这一行：\n$if mode=emacs\n在它的下面添加如下内容\n\u0026ldquo;\\C-o\u0026rdquo;: menu-complete\n###这两行不是必须的，视情况而定###\n\u0026ldquo;\\c-p\u0026rdquo;: non-incremental-reverse-search-history\n\u0026ldquo;\\c-n\u0026rdquo;: non-incremental-forward-search-history\n重新登录Shell，您就可以使用 \\C-o （Ctrl+o）来遍历补全。假如您的文件名为中文，或者出现乱码时，您可以使用 \\M-*\n将所有文件名放入命令行，再删除多余的，这真是麻烦极了！所以您可以使用 \\C-o 遍历补全，将所有可能的选项轮流放入命令行。\n或者使用Vim编辑器编辑 /etc/inputrc 文件，在插入模式下使用 Ctrl+v 组合键。按下 Ctrl+o ，这时编辑区新增一个 ^O 字符，等价于 \\C-o\n通配符 使用 ? 代表任意单个字符。例如 ???lo ，表示 lo 前有三个字符，它可以匹配 Hello\n使用 * 代表随意几个任意字符。例如*.iso，代表所有 iso 格式的文件。\n说明：您可以将遍历补全和通配符结合使用，以提高效率。\n例如：\ncd */ 则遍历补全只补全文件夹\nchmview *.chm 则遍历补全只补全chm文件\n任务管理 \u0026amp; 在命令的末尾加上一个 \u0026amp; 符号，表示背景任务，例如：\nwget http://www.download.net/xxx/mp3 \u0026amp; ; 使用 ; 将多个命令连结起来，则表示任务按顺序执行\n\u0026amp;\u0026amp; 使用 \u0026amp;\u0026amp; 将多个命令连结起来，则表示只有前面的命令执行成功，后面的命令才能得以执行\n`` `\u0026lt;命令\u0026gt;` ，如果一个命令中包含以 `` （Esc键下方的按键）括起来的子命令，那么子命令将被优先执行，执行结果被代入上一级命令继续执行，例如创建一个以当前时间命名的文件：\ntouch `date +%m.%d_%H:%M:%S` touch 命令能够创建一个文件，它的操作对象，为 date +%m%d%H%M%S 命令的输出 06.06_06:06:60\n这样，我们创建了一个名为 06.06_06:06:60 的文件（六月六日六时六分刚过六十秒-_-!）\nCtrl+z\n将当前Shell中的任务挂起\n这个时候任务的状态为\n[1]+ Stopped xxx\nBg\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-将挂起的任务背景运行。这时它的状态为[1]+ xxx \u0026amp;\nFg\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-将背景任务调到前台执行jobs\n方括号中的数字为命令的任务编号，您可以使用 jobs 命令来查看所有背景任务\n如果后台运行多个任务，您可以在 bg 或者 fg 后跟任务编号，作为操作对象，例如：bg 2\n管道、重定向\n\u0026gt;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;重定向符号，它的作用是将命令的输出重定向到一个文件中。比如我们想把命令 ls 的结果保存为 FileList 文件，作一个清单，我们可以使用重定向符号来完成它：\nls -l \u0026gt; FileList\n\u0026gt;\u0026gt;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;-作用与 \u0026gt; 基本相同，不同点在于， \u0026raquo; 以追加的方式，将命令的输出写入文件的末尾。\n\u0026lt;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash;是从文件到命令的重定向，将文件的内容作为命令的输入。\n|\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;为管道符号，它的作用是将前一个命令的输出，作为下一个命令的输入。假设一个目录下的文件太多，使用 ls命令不能够在屏幕中完全显示，这个时候您可以将 ls 命令的输出，通过管道符号，作为浏览器 less 的输入。就可以使用浏览器的功能翻页、查找：ls -al | less\n说明： less 浏览器的键绑定几乎与 man 相同，请参阅 在线帮助系统\n脱字符 Shell中的一些功能是通过特殊符号作为控制字符来实现的，上面已经介绍了很多了。这产生一个问题，如果一个文件名中，刚好包含了这些字符，比如 ; ，就很难对它进行操作。使用 less 浏览这个文件\nless ;xxx\nless 会很快返回一个错误信息，因为并没有一个文件名作为操作对象。接着，Shell会报告，系统中没有 xxx 这个命令。\n这是因为Shell将文件名中的 ; 解析为按顺序执行命令。\n或者您的文件名以空白起始，而在Shell中，无论多少个空格，都将被解析为一个分隔符。您甚至不是使用命令重命名此文件。\n这个时候就要用到脱字符 \\ 了，它能够将一个具有特殊涵义的字符转换普通字符。上面的两个任务，可以在文件名中每个特殊字符前加一个 \\ ，像这样\nless ;xxx\nless \\ \\xxx\nless ;\\ \u0026amp;\\xxx\n说明：也可以使用 \u0026quot; 将文件名括起来，例如 less \u0026ldquo;; \u0026amp;xxx\u0026rdquo; ，在很多情况下，这样甚至更方便。\n脱字符在Shell中也可以作为换行符，在一个命令的末尾添加一个 \\ ，然后回车，在下一行继续输入命令剩余的部分，将一个命令拆分为多行且不影响它的执行（如果执行一个很长的命令，请将它拆分为多行以便于阅读）\n事实上换行符也符合脱字符的定义。回车键有两个涵义，一个是 执行 （Enter），另一个 换行 （折线箭头）。在Shell中它作为控制字符 执行 ，使用脱字符后，它便代表排版字符 换行 了。\nFish the friendly interactive shell\n正如它的名字，Fish是一款非常友好的Shell，大力推荐！使用命令 sudo apt-get install fish 安装它。完成后，运行命令 fish 切换到fish， exit 返回bash。\n简单介绍一下它的优点：\n1.自动补全、语法高亮 bash的自动补全默认只是补全命令、路径，如果想补全变量、参数等，通常需要使用复杂的组合键（见上面bash的介绍），即便您能够记住它们，快\n速准确的按下这些组合键，也是一种严峻的考验。而FISH的自动补全可以自动识别语法，补全正确的内容。并且具有语法高亮的功能，比如用MPLAYER放\nMP3：\nmpl(ayer) -l(oop) (0)\n-sh(uffle) -pl(aylist) (mp3_playlist)\n一阵猛按 键，一个蛮长的命令就完成了。\n补全结果不唯一时给出的提示中含有简短的说明，这样通常也不用看帮助了：）比如：\nmplayer -l\n后，自动将参数补全为 -lo 然后给出提示\n-{lo}adidx (Load index from file) -{lo}op (Loop playback) {花括号中为青色文字}\n它的语法高亮功能十分有用，如果你输入的命令是正确的，则用青色显示，正确的参数用白色显示，错误的则一律用红色。\n2.方便的历史纪录搜索 还是上面的那个命令\nmplayer -loop 0 -shuffle -playlist mp3_playlist\n用上翻配合下翻浏览命令历史，直到找到这个命令，当然那样太慢了。\n还可以输入以上命令中的某一部分，如 uffle 只要翻一次就可以找到了\n（还可以META＋上翻在已输入部分中插入某一历史单词）\n3.文件夹历史纪录 dirh （dir history）就可以显示当前会话中进入的文件夹纪录\n使用 prevd 和 nextd 跳转\n假如曾进入过1 2 3 4 5 这几个文件夹， prevd 4 可以让你在 5 中直接跳到 1\n4.其它的功能 fish基本是兼容bash的。键绑定也非常的相似，少数的键绑定不尽一致，例如：\n\\C-h 删除光标前的一个字符（bash为退格键，不方便）\n修改 /etc/fish_inputrc 这个文件，增加以下行：\n\u0026ldquo;\\C-n\u0026rdquo;: history-search-forward\n\u0026ldquo;\\C-p\u0026rdquo;: history-search-backward\n现在使用Ctrl+p上翻，使用Ctrl+n下翻。如果已经在命令行中输入字符，那么Ctrl+p就是在历史纪录向上查找您输入的字符，Ctrl+n为向下查找，非常的方便。\n设定您的默认Shell\n如果能够拥有root权限，可以直接修改 /etc/passwd 文件。找到您用户ID起始的行\nuser:x:1000:112:user,,,:/home/user:/bin/bash\n最后一个字段为登录后的默认Shell， /bin/bash 是程序 bash 的主程序路径。 fish 主程序的路径通常为 /usr/bin/fish 。\n/etc/shells 中列出系统中所有可用Shell（ /bin/false 代表禁用Shell）\n也可以使用如下命令更改您的默认Shell\nchsh -s /usr/bin/fish\n（需要输入您的密码）\nTip：可以使用 whereis xxx 命令，来查找 xxx 程序的安装位置，详见搜索\n设定命令的搜索路径\n使用 echo $PATH ，可以显示 $PATH 变量，输出如下：\n/usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin /usr/bin/X11 /usr/games /usr/X11R6/bin\n它是一个环境变量，代表执行命令时，Shell的搜索路径。\n执行一个命令时，Shell会到 $PATH 变量定义的路径去搜索，并运行与命令同名的可执行文件。如果程序、脚本等可执行文件并不在上面的路径中，就必须使用绝对路径或者相对路径定位可执行文件。\n例如：\n/usr/local/mplayer -menu xxx.rmvb\n/etc/init.d/powernowd start\ncd /usr/local/ \u0026amp;\u0026amp; ./mplayer -menu xxx.rmvb\n可以修改 /etc/environment 文件来设定您的命令搜索路径，找到 PATH 起始的行\nPATH=\u0026quot;/usr/local/sbin:/usr/local/bin:/usr/sbin\u0026quot;\n在双引号中添加您的自定义路径，并以 : 分隔。\nUbuntu系统简介 Ubuntu系统目录结构 以下为Ubuntu目录的主要目录结构，您稍微了解它们都包含了哪些文件就可以了，不需要记忆。\n/ 根目录 │ ├boot/ 启动文件。所有与系统启动有关的文件都保存在这里 │ └grub/ Grub引导器相关的文件 │ ├dev/ 设备文件 ├proc/ 内核与进程镜像 │ ├mnt/ 临时挂载 ├media/ 挂载媒体设备 │ ├root/ root用户的$HOME目录 ├home/ │ ├user/ 普通用户的$HOME目录 │ └.../ │ ├bin/ 系统程序 ├sbin/ 管理员系统程序 ├lib/ 系统程序库文件 ├etc/ 系统程序和大部分应用程序的全局配置文件 │ ├init.d/ SystemV风格的启动脚本 │ ├rcX.d/ 启动脚本的链接，定义运行级别 │ ├network/ 网络配置文件 │ ├X11/ 图形界面配置文件 ├usr/ │ ├bin/ 应用程序 │ ├sbin/ 管理员应用程序 │ ├lib/ 应用程序库文件 │ ├share/ 应用程序资源文件 │ ├src/ 应用程序源代码 │ ├local/ │ │ ├soft/ 用户程序 │ │ └.../ 通常使用单独文件夹 │ ├X11R6/ 图形界面系统 │ ├var/ 动态数据 │ ├temp/ 临时文件 ├lost+found/ 磁盘修复文件 启动流程 Linux系统主要通过以下步骤启动：\n1.读取MBR的信息，启动Boot Manager Windows使用NTLDR作为Boot\nManager，如果您的系统中安装多个版本的Windows，您就需要在NTLDR中选择您要进入的系统。\nLinux通常使用功能强大，配置灵活的GRUB作为Boot Manager，我们将在启动管理章节中向您介绍它的使用方式。\n2.加载系统内核，启动init进程 init进程是Linux的根进程，所有的系统进程都是它的子进程。\n3.init进程读取 /etc/inittab文件中的信息，并进入预设的运行级别，按顺序运行该运行级别对应文件夹下的脚本。脚本通常以 start 参数启动，并指向一个系统中的程序。 通常情况下， /etc/rcS.d/ 目录下的启动脚本首先被执行，然后是 /etc/rcN.d/ 目录。例如您设定的运行级别为3,那么它对应的启动目录为 /etc/rc3.d/ 。\n4.根据 /etc/rcS.d/文件夹中对应的脚本启动 Xwindow服务器 xorg Xwindow为Linux下的图形用户界面系统。\n5.启动登录管理器，等待用户登录 Ubuntu系统默认使用GDM作为登录管理器，您在登录管理器界面中输入用户名和密码后，便可以登录系统。（您可以在 /etc/rc3.d/ 文件夹中找到一个名为 S13gdm 的链接）\n更改运行级别 在 /etc/inittab 文件中找到如下内容：\n# The default runlevel. id:2:initdefault: # 这一行中的数字 2 ,为系统的运行级别，默认的运行级别涵义如下： # 0 关机 1 单用户维护模式 2~5 多用户模式 6 重启 服务管理 更改启动服务\n在运行级别对应的文件夹中，您可以看到许多文件名以 S## 和 K## 起始的启动脚本链接。例如：\n/etc/rcS.d/S35mountall.sh 挂载文件系统 /etc/rcS.d/S40networking 启用网络支持 /etc/rc2.d/S13gdm 启动登录管理器 /etc/rc2.d/S20makedev 创建设备文件 /etc/rc2.d/S23xinetd 启动超级进程 init进程将以 start 为参数，按文件名顺序执行所有以 S## 起始的脚本。脚本名称中的数字越小，它将被越早执行。例如在\n/etc/rc2.d/ 文件夹中， S13gdm 文件名中的数字小于 S23xinetd , S13gdm 将比 S23xinetd 先执行。\n如果一个脚本链接，以 K## 起始，表示它将以 stop 参数被执行。如果相应服务没有启动，则不执行该脚本。例如：\n/etc/rc2.d/K20powernowd 针对某种硬件的电源管理支持\n如果您想禁止某一服务在启动时自动运行，您可以将相应运行级别中的脚本由 S##xxx 重命名为 K##xxx 。\n手动控制服务\n您也可以手动运行带有以下参数的启动脚本，来控制系统服务。\n- start 启动 - stop 停止 - restart 重启 例如：\n/etc/rc2.d/K20powernowd start 有时您并不清楚当前运行级别，该运行级别下未必有相应脚本；而且此类脚本的前三位字符并不固定，不便于记忆。这时，可以直接使用\n/etc/init.d/ 文件夹中的启动脚本（ /etc/rcX.d/ 中的启动脚本链接到 /etc/init.d/\n文件夹下相应脚本），这也是推荐的方式。\n例如：\n/etc/init.d/powernowd start\nNote：以上命令的位置并没有包含在环境变量的搜索路径中，所以要输入完整路径。\n常用系统服务 acpi-support 高级电源管理支持 acpid acpi守护程序.这两个用于电源管理，非常重要 alsa 声音子系统 alsa-utils anacron cron的子系统，将系统关闭期间的计划任务，在下一次系统运行时执行。 apmd acpi的扩展 atd 类似于cron的任务调度系统。建议关闭 binfmt-support 核心支持其他二进制的文件格式。建议开启 bluez-utiles 蓝牙设备支持 bootlogd 启动日志。开启它 cron 任务调度系统，建议开启 cupsys 打印机子系统。 dbus 消息总线系统(message bus system)。非常重要 dns-clean 使用拨号连接时，清除dns信息。 evms 企业卷管理系统（Enterprise Volumn Management system） fetchmail 邮件用户代理守护进程，用于收取邮件 gdm gnome登录和桌面管理器。 Gdomap gpm 终端中的鼠标支持。 halt 别动它。 hdparm 调整硬盘的脚本，配置文件为 /etc/hdparm.conf。 hibernate 系统休眠 hotkey-setup 笔记本功能键支持。支持类型包括： HP, Acer, ASUS, Sony, Dell, 和IBM hotplug and hotplug-net 即插即用支持，比较复杂，建议不要动它 hplip HP打印机和图形子系统 ifrename 网络接口重命名脚本。如果您有十块网卡，您应该开启它 inetd 在文件 /etc/inetd.conf 中，注释掉所有你不需要的服务。如果该文件不包含任何服务，那关闭它是很安全的。 klogd 重要。 linux-restricted-modules-common 受限模块支持。 /lib/linux-restricted-modules/ 文件夹中的模块为受限模块。例如某些驱动程序，如果您没有使用受限模块，就不需要开启它。 lvm 逻辑卷管理系统支持。 makedev 创建设备文件，非常重要。 mdamd 磁盘阵列 module-init-tools 从/etc/modules加载扩展模块，建议开启。 networking 网络支持。按 /etc/network/interfaces 文件预设激活网络，非常重要。 ntpdate 时间同步服务，建议关闭。 pcmcia pcmcia设备支持。 powernowd 移动CPU节能支持 ppp and ppp-dns 拨号连接 readahead 预加载库文件。 reboot 别动它 resolvconf 自动配置DNS rmnologin 清除nologin rsync rsync守护程序 sendsigs 在重启和关机期间发送信号 single 激活单用户模式 ssh ssh守护程序。建议开启 stop-bootlogd 在2，3，4，5运行级别中停止bootlogd服务 sudo 检查sudo状态。重要 sysklogd 系统日志 udev \u0026amp; udev-mab 用户空间dev文件系统（userspace dev filesystem）。重要 umountfs 卸载文件系统 urandom 随机数生成器 usplash 开机画面支持 vbesave 显卡BIOS配置工具。保存显卡的状态 xorg-common 设置X服务ICE socket。 adjtimex 调整核心时钟的工具 dirmngr 证书列表管理工具,和gnupg一起工作。 hwtools irqs优化工具 libpam-devperm 系统崩溃之后，用于修理设备文件许可的守护程序。 lm-sensors 板载传感器支持 mdadm-raid 磁盘陈列管理器 screen-cleanup 清除开机屏幕的脚本 xinetd 管理其他守护进程的一个inetd超级守护程序 重要配置文件 无论任何情况下，修改配置文件之前，先备份它！\n建议使用这个命令：\nsudo cp xxx xxx_`date +%y%m%d_%H:%M` 当然这很麻烦，您可以新建一个名为 bak 的文件，内容如下：\n#!/bin/bash sudo cp $1 $1_`date +%y%m%d_%H:%M` 把它放在您能够记住的目录下，比如 /home ，执行命令 sh /home/bak xxx ，就可以将当前文件夹下的文件 xxx 另存为 xxx_yymmdd_HH:MM 的格式了\n全局配置文件\n系统初始化\n/etc/inittab 运行级别、控制台数量 /etc/timezone 时区 /etc/inetd.conf 超级进程\n文件系统\n/etc/fstab 开机时挂载的文件系统 /etc/mtab 当前挂载的文件系统\n用户系统\n/etc/passwd 用户信息 /etc/shadow 用户密码 /etc/group 群组信息\n/etc/gshadow 群组密码 /etc/sudoers Sudoer列表（请使用“visudo”命令修改此文件，而不要直接编辑）\nShell\n/etc/shell 可用Shell列表 /etc/inputrc ReadLine控件设定 /etc/profile 用户首选项\n/etc/bash.bashrc bash配置文件\n系统环境\n/etc/environment 环境变量 /etc/updatedb.conf 文件检索数据库配置信息 /etc/issue 发行信息\n/etc/issue.net /etc/screenrc 屏幕设定\n网络\n/etc/iftab 网卡MAC地址绑定 /etc/hosts 主机列表 /etc/hostname 主机名\n/etc/resolv.conf 域名解析服务器地址 /etc/network/interfaces 网卡配置文件\n用户配置文件\n/etc/ 目录下的文件，只有root用户才有权修改。应用软件的全局配置文件，通常普通用户也不能够修改，如果要通过配置软件，来适应特殊需求，您可以修改用户配置文件。\n用户配置文件通常为全局配置文件的同名隐藏文件，放在$HOME目录下，例如：\n/etc/inputrc /home/user/.inputrc\n/etc/vim/vimrc /home/user/.vim/vimrc\n也有少数例外，通常是系统程序\n软件安装 DPKG Linux系统中，软件通常以源代码或者预编译包的形式提供。\n软件源代码需要编译为二进制的机器代码才能够使用，安装比较耗时，不过您可以自行调节编译选项，决定需要的功能或组件，或者针对硬件平台作一些优化。\n预编译的软件包，通常是由软件的发布者进行编译，您只要将软件拷贝到系统中就可以了。考虑到预编译软件包的适用性，预编译软件包通常不会针对某种硬件平台优化。它所包含的功能和组件也是通用的组合。\nUbuntu系统中，软件通常以 deb 格式的包文件发布，它是一种预编译软件包。deb包中除了包含已编译的软件，通常还包括软件的拷贝路径、对其它软件包的依赖关系纪录、比较通用的配置文件以及软件的描述、版本、作者、类别、占用空间等信息。\ndeb软件包命令遵行如下约定：\nsoft_ver-rev_arch.deb soft 软件包名称 ver 软件版本号 revUbuntu 修订版本号 arch 目标架构名称 例如： azureus_2.4.0.2-0ubuntu2_all.deb\n您需要使用 dpkg 命令来管理deb软件包：\ndpkg -i | --install xxx.deb 安装deb软件包 dpkg -r | --remove xxx.deb 删除软件包 dpkg -r -P | --purge xxx.deb 连同配置文件一起删除 dpkg -I | -info xxx.deb 查看软件包信息 dpkg -L xxx.deb 查看包内文件 dpkg -l 查看系统中已安装软件包信息 dpkg-reconfigure xxx 重新配置软件包 有些时候，您使用 dpkg 安装一个软件包，系统会提示您该软件包依赖其它软件包。这时，您先安装其它软件包，直到满足依赖关系为止。或者同时安装多个软件包\ndpkg -i aaa.deb bbb.deb ccc.deb APT 如果一个软件依赖关系过于复杂，使用 dpkg\n来安装它，并不是一个明智的选择，这个时候您就需要用到APT软件包管理系统。APT可以自动的检查依赖关系，通过您预设的方式来获得相关软件包，并自动\n安装配置它。事实上，在多数情况下，我们推荐您使用APT软件包管理系统。\nAPT系统需要一个软件信息数据库和至少一个存放着大量deb包的软件仓库，我们称之为 源 。 源 可以是网络服务器，安装CD或者本地软件仓库。您需要修改 /etc/apt/sources.list 文件，使APT系统能够连接到 源。\n从以下页面中获得网络安装源的列表，并且根据您的网络环境，选择速度较快的源。\nhttp://wiki.ubuntu.org.cn/%E5%BF%AB%E9%80%9F%E......%97/DapperDrake\nAPT系统主要包括 apt-get 和 apt-cache 等命令。通常是复合命令，包含若干个子命令。\napt-get install xxx 安装xxx -d 仅下载 -f 强制安装 apt-get remove xxx 卸载xxx apt-get update 更新软件信息数据库 apt-get upgrade 进行系统升级 apt-cache search 搜索软件包 说明：建议您经常使用 sudo apt-get update 命令来更新您的软件信息数据库\nAPT系统修复 由于各种意外，APT系统可能会出现问题，使用如下命令，尝试进行修复：apt-get -f install\n源码包 对于绝大多数软件，我们建议您使用APT系统来安装它。在少数情况下，例如某软件没有以deb包的格式发布，或者需要定制适合自己的软件，您可以通过编译源代码的方式安装它。\n首先需要下载软件的源码包，并且将它解包为一些源代码文件。并了便于管理，建议将下载的源码包移动到 /usr/local/src/ 目录下，并在这里解包。\nsudo mv xxx.tar.gz /usr/local/src 移动源码包 cd /usr/local/src 进入“/usr/local/src/”目录 sudo tar -xzvf xxx.tar.gz 解包源码 cd xxx_ver/ 进行解包后的源码目录 源码目录中通常有一个 configure 脚本，用来配置即将开始的编译过程。您可以执行它\nsudo ./configure [--prefix=/usr/loca/xxx ......] 它会自动检测软件的编译环境和依赖关系，并且生成 Makefile 文件。\n使用带参数的命令 ./configure --help ，或者阅读 INSTALL 文件，查看该脚本允许的参数。例如使用\n--prefix=/usr/local/xxx 参数，将软件的安装目录设定为 /usr/local/xxx/。（如果一定要将软件安装在单独目录下，建议您安装在这里）\n现在执行 make 命令，系统会根据 Makefile 文件中的设定，通过 make 工具调用编译器和所需资源文件，将源代码编译成目标文件。\nsudo make\n执行 make install 命令， make 工具会自动连接目标文件和库文件，将最终生成的文件拷贝到 Makefile 文件设定的路径中，并且完成更改文件的属性，删除残留文件等活动。\nsudo make install 现在，编译安装已经完成，为了更方便的使用它，需要给程序的可执行文件作一个符号链接。\nsudo ln -sf /usr/local/xxx/可执行文件 /usr/local/bin/可执行文件 Tip:为了顺利的进行编译，至少需要安装 build-essential 软件包。 sudo apt-get install build-essential\nXwindow简介 Xwindow是工作站图形系统的工业标准，它有多种不同的实现，Ubuntu系统中使用的为Xorg。\n（比较前卫的图形界面系统XGL，实际代替X服务器的作用，另外还有与之配套的窗口管理器）\n历史 当然，Xwindow有悠久的历史和传统，不过那不在我们讨论的范围。您要注意的有两点：\nXwindow 和 Xbox 中的“X”本意是不同的， X 只是 W 后的一个字母，差不多应该这样理解，Xwindow 是 Window 的接班人 （注意，Window不是Windows）\n同样，也不要把 Xwindow 说成是 Xwindows，那是一种亵渎！一切伟大的创造，都应得到应有的理解和尊重。\n架构及原理 Xwindow使用服务器－客户端架构。无论本地图形界面，还是远程图形界面，都以同样的流程工作。这样便不需要分别进行设计和维护，极大的提高了网络透明性。\n本地X客户端 ┐ ┌ 键盘 远程X客户端 ┼ X协议 ─ X服务器 ─ 硬件规范 ┼ 鼠标 远程X客户端 ┘ └ 显示器 Xserver Xwindow系统服务器端，通过驱动程序（硬件规范）来管理硬件资源。\n例如：当我们移动鼠标时，通过驱动程序，向 Xserver 发送信息：\n“向右移动200点，向上移动100点”（向右上移动）；“按下左键”……\nXserver作出如下响应：\n1、上一次鼠标停止的坐标为600,500\n2、向右200，向上100。现在鼠标位于坐标800,600\n3、坐标800,600处，为窗口Firefox的“关闭”按钮\n4、根据预设动作，将 “点击Firefox窗口的关闭按钮” 翻译为 “关闭窗口Firefox”\n5、向X客户端Firefox发送一个“退出”消息\n6、Xserver通过显示子系统（显卡、显示器），全程显示鼠标的位置和移动\n* 事实上，向程序发送“退出”信号，通常窗口管理器完成……为了描述方便，这里暂不区分。稍后，我们将向您介绍 窗口管理器 的其它一些细节。\n大多数的鼠标不需要专门的驱动程序，因为它们符合某一硬件规范，例如：有四个移动方向和三个键\nXclient Xwindow系统客户端，通过X协议，实现与Xserver 的交互。\n例如：\n1、Xclient （假设Firefox） 接收Xserver的消息： 输入焦点在地址栏的范围内，“ubuntu.org.cn”，回车\n2、Firefox根据预设动作，将这些消息识别为 “打开链接 ubuntu.org.cn”\n3、Firefox向域名服务器请求 链接 “ubuntu.org.cn”。域名服务器将这个请求转换为 “http://ubuntu.org.cn/” 和 IP地址211.148.131.7，发送回 Firefox\n4、Firefox将 “http://ubuntu.org.cn/”显示在地址栏（向Xserver发送请求，在地址栏位置显示这个地址）\n5、Firefox向地址 211.148.131.7 请示显示页面。\n6、Firefox将服务器发送回的页面显示在主窗口中\nXprotocol Xwindow系统协议，Xserver和Xclient之间进行通信的规则\n窗口管理器 Window Manager，一种特殊的Xclient。\n使用窗口管理器时，Xserver并不直接与其它Xclient通信，而是通过WM中转，当一些消息被定义为WM指令时，它们会被拦截。例如Alt+F4关闭窗口、拖动标题栏……\n消息“打开链接 ubuntu.org.cn”，具体内容如下：\n输入焦点在地址栏的范围内，“ubuntu.org.cn”，回车\nXserver并不能直接判断焦点，而是这样：\n1、Xserver向WM发送位置和点击的信息，WM根据当前的“焦点策略”确定激活（最上层）的窗口为Firefox\n2、Xserver将Firefox显示在最上层，高亮显示它的标题栏\n3、在窗口Firefox内点击地址栏，或者 Ctrl+L，Xserver将位置信息发送给WM，WM再发送给Firefox\n4、Firefox判断当前焦点后，显示一个闪动的文字输入光标\n5、Firefox将输入光标通过WM发送给Xserver，Xserver在屏幕相应位置进行显示\n那么，“窗口管理器”到底能作些什么呢？其实它所作的一切都是管理窗口。例如：\n1.最上层的窗口会把其它窗口挡住\n2.它通常是一个“已激活窗口”，根据不同的“焦点策略”，窗口管理器确定被激活的窗口。\n激活窗口标题栏高亮显示，接收大部分的键盘消息和窗口内的鼠标点击消息。\n3.为了美观和容易分辨，大多数窗口都要有标题栏和边框。\n为了方便，标题栏上还要有一些按钮，比如：最小化，最大化，关闭（这些按钮是窗口管理器请求的小窗口）\n4.一个窗口可以在另一个窗口旁边显示，而不一定完全被遮挡。为了实现这一点，就要控制窗口显示的位置\n5.为了控制窗口的显示位置，需要将整个屏幕用座标描述，最好的办法是绘制一个填充整个屏幕的窗口，也就是根窗口。\n6.因为根窗口是最大的，所以它可以严严实实的遮挡任何窗口，为了避免这一点，根窗口永远在最底层。\n这很形象的说明了为什么它叫作“根窗口” ……root\n7.根窗口不一定只有一个，大多数的窗口管理器可以使用 “工作区” ，来切换显示多个根窗口\n8.根窗口固定位置上通常放置一些其它Xclient的窗口，例如底部面板，顶部面板，侧面板，程序启动图标\n9.面板上又可以放一些其它的Xclient窗口，如任务条，启动栏，菜单……\n任务条可以以图标显示正在运行的任务，还可以作其它的杂活，像自动挂载USB设备……\n启动流程\n我们知道 init 是linux的根进程，是所有进程的父进程。同样， xinit是所有Xwindow进程的根进程\nStartx\nstartx 命令可以在命令行下启动图形界面。执行startx 命令时，实际执行这一命令：\nxinit /etc/X11/xinit/xinitrc \u0026ndash; /etc/X11/xinit/xserverrc\n根据脚本 /etc/X11/xinit/xserverrc 启动Xserver，同时根据脚本 /etc/X11/xinit/xinitrc 启动指定Xclient进程，例如窗口管理器\n脚本 /etc/X11/xinit/xserverrc 以预设的参数运行程序 /usr/bin/X11/X\n/etc/X11/xinit/xinitrc 脚本则指向 /etc/X11/Xsession ，依次启动 /etc/X11/Xsession.d 目录中的脚本\n* 您可以在用户配置文件 ~/.Xsession 中定义使用的WM，它的优先级高于全局配置文件(对于GDM会话不起作用)\n* startx启动时，并不会再进行身份认证。因为它启动的是 /etc/X11/Xsession.d/gnome-session ，而不是 GDM会话\nGDM会话\nUbuntu系统启动时自动进入图形界面，不需要运行 startx 命令\n在某些启动级别中，包含了gdm的启动脚本，例如 ： /etc/rc2.d/S13gdm\n\\1. 指向 /etc/gdm/gdm-cdd.conf 文件，加载预设视觉主题，启动 /usr/lib/gdm/gdmgreeter（登录屏幕）\n\\2. 用户身份认证完成后，启动 /etc/X11/default-display-manager 这个文件中设定的默认窗口管理器 /usr/sbin/gdm\ngdm在启动时，会要求用户名和密码，也就是我们看到的登录屏幕（gdmgreeter）\n* /usr/share/xsessions 目录下为所有可用登录会话的脚本\n配置文件\nX服务器\nX服务器的主要配置文件为 /etc/X11/xorg.conf\n布局\nSection \u0026ldquo;ServerLayout\u0026rdquo;\nIdentifier \u0026ldquo;Default Layout\u0026rdquo;\nScreen \u0026ldquo;Default Screen\u0026rdquo; 0 0\nInputDevice \u0026ldquo;Generic Keyboard\u0026rdquo;\nInputDevice \u0026ldquo;Configured Mouse\u0026rdquo;\nEndSection\n* 定义了 布局标识 、 屏幕标识 、 键盘标识 、 鼠标标识\n模块\nSection \u0026ldquo;Module\u0026rdquo;\nLoad \u0026ldquo;i2c\u0026rdquo;\nLoad \u0026ldquo;bitmap\u0026rdquo;\nLoad \u0026ldquo;ddc\u0026rdquo;\nLoad \u0026ldquo;dri\u0026rdquo;\nLoad \u0026ldquo;extmod\u0026rdquo;\nLoad \u0026ldquo;freetype\u0026rdquo;\nLoad \u0026ldquo;glx\u0026rdquo;\nLoad \u0026ldquo;int10\u0026rdquo;\nLoad \u0026ldquo;type1\u0026rdquo;\nLoad \u0026ldquo;vbe\u0026rdquo;\nEndSection\nX核心字体路径\nSection \u0026ldquo;Files\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/X11/fonts/75dpi\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/X11/fonts/100dpi\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/X11/fonts/misc\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/X11/fonts/cyrillic\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/X11/fonts/100dpi/:unscaled\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/X11/fonts/75dpi/:unscaled\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/X11/fonts/Type1\u0026rdquo;\nFontPath \u0026ldquo;/usr/share/fonts/Chinese/wqy-bitmapfont\u0026rdquo;\nEndSection\n屏幕\nSection \u0026ldquo;Screen\u0026rdquo;\nIdentifier \u0026ldquo;Default Screen\u0026rdquo;\nDevice \u0026ldquo;ATI Technologies, Inc. RV370 5B62 [Radeon X600 (PCIE)]\u0026rdquo;\nMonitor \u0026ldquo;DELL E176FP\u0026rdquo;\nDefaultDepth 24\nSubSection \u0026ldquo;Display\u0026rdquo;\nDepth 1\nModes \u0026ldquo;1280x1024\u0026rdquo; \u0026ldquo;1152x864\u0026rdquo; \u0026ldquo;1024x768\u0026rdquo; \u0026ldquo;800x600\u0026rdquo; \u0026ldquo;720x400\u0026rdquo; \u0026ldquo;640x480\u0026rdquo;\n………………\nEndSubSection\nEndSection\n* DefaultDepth 24 默认色深\n* SubSection 可用色深及分辨率\n显卡\nSection \u0026ldquo;Device\u0026rdquo;\nIdentifier \u0026ldquo;ATI Technologies, Inc. RV370 5B62 [Radeon X600 (PCIE)]\u0026rdquo;\nDriver \u0026ldquo;fglrx\u0026rdquo;\nOption \u0026ldquo;KernelModuleParm\u0026rdquo; \u0026ldquo;agplock=0\u0026rdquo;\nVideoRam 131072\nEndSection\n* Identifier 显卡标识\n* Driver 显卡驱动（如不同正常启用图形界面，首先尝试\u0026quot;vesa\u0026quot;）\n* Option 显卡参数\n* VideoRam 显存大小\n显示器\nSection \u0026ldquo;Device\u0026rdquo;\nIdentifier \u0026ldquo;ATI Technologies, Inc. RV370 5B62 [Radeon X600 (PCIE)]\u0026rdquo;\nDriver \u0026ldquo;fglrx\u0026rdquo;\nOption \u0026ldquo;KernelModuleParm\u0026rdquo; \u0026ldquo;agplock=0\u0026rdquo;\nVideoRam 131072\nEndSection\n配置文件内部结构\n/ ├/ \u0026#34;ServerLayout\u0026#34; 布局 │├ \u0026#34;InputDevice\u0026#34; keyboard 键盘 │├ \u0026#34;InputDevice\u0026#34; mouse 鼠标 ││ │└/ \u0026#34;Screen\u0026#34; 显示子系统 │ ├ \u0026#34;Monitor\u0026#34; 显示器 │ ├ \u0026#34;Device\u0026#34; videocard 显卡 │ │ ├ \u0026#34;Files\u0026#34; 字体 └ \u0026#34;Module\u0026#34; 模块 X客户端\n在 /etc/X11/Xsession 文件中可以发现下列内容\nOPTIONFILE=/etc/X11/Xsession.options SYSRESOURCES=/etc/X11/Xresources USRRESOURCES=$HOME/.Xresources SYSSESSIONDIR=/etc/X11/Xsession.d USERXSESSION=$HOME/.xsession ALTUSERXSESSION=$HOME/.Xsession ERRFILE=$HOME/.xsession-errors OPTIONFILE=/etc/X11/Xsession.options 设定X进程的启动参数。例如允许用户进程allow-user-xsession\nXresources X资源文件。许多程序保留了X接口，允许X服务器管理一些视觉选项，例如窗口内的字体，配色等\nxsession X进程。可以设置一些启动时自动运行的程序，也可以用来设定自己的窗口管理器（窗口管理器和桌面环境或者登录管理器是无关的）\n字体\nfreetype渲染引擎\n作为Xorg服务器的一个模块，freetype的功能包括读取Truetype字体信息，如大小、分辨率、编码等，并以之为依据渲染字体 -\nfreetype2.x相对于freetype1.x 增加了抗锯齿等功能 - ( /etc/X11/xorg/conf 的 Module\n字段中，可以选择字体渲染模块，建议使用默认的 freetype )\nfreetype只负责渲染字体。而查找字体，则可以由X服务器、X客户端或者字体服务器来完成。找到字体后，使用freetype引擎就地渲染\nX核心字体\nX服务器根据X客户端的请求（字符编码），查找字体并进行渲染，然后显示，我们称之为\nXft字体\nX客户端自行查找字体并进行渲染，X服务器只负责显示\n由于Xft字体的渲染在客户端完成，所以它可以动态的加载，而不需要随同X服务器一同启动\n字体服务器\n另外还有一种字体服务器模式，例如 XFT字体：当客户端请求字体时，X服务器将请求转发到字体服务器，由字体服务器查找字体，并使用freetype引擎渲染，将结果传回X服务器，X服务器进行显示……\nX核心字体\n/etc/X11/xorg.conf 中可以配置X核心字体的搜索路径\nSection \u0026ldquo;Files\u0026rdquo;\nFontPath \u0026ldquo;/usr/X11R6/lib/X11/fonts/misc/\u0026rdquo;\nFontPath \u0026ldquo;/usr/X11R6/lib/X11/fonts/Type1/\u0026rdquo;\nFontPath \u0026ldquo;/usr/X11R6/lib/X11/fonts/Speedo/\u0026rdquo;\nFontPath \u0026ldquo;/usr/X11R6/lib/X11/fonts/100dpi/\u0026rdquo;\nFontPath \u0026ldquo;/usr/X11R6/lib/X11/fonts/75dpi/\u0026rdquo;\nEndSection\n当X客户端向X服务器请求显示文字的时候，X服务器会按上面列表的先后顺序查找字体\n例如显示中文时，如果第一个路径中的字体不包含中文，则查找下面的路径，直到发现中文字体\n请将您偏好的字体放在靠前的位置\n要使安装的字体能够作为X核心字体使用，将字体的安装路径添加到上面的列表中，使用 mkfontscale 、 mkfontdir\n扫瞄文件夹中的字体，并生成索引，就可以了（建议使用 ttmkfdir 生成 fonts.scale ，将其复制为 fonts.dir ）\n字体的选择及显示风格，可以修改GTK1的配置文件，或者在Xresources文件中对程序单独进行定义\n事实上，在我们的日常应用中，X核心字体环境并不常见，使用GTK1图形库的程序、某些类型的终端……\n* Emacs也是这样一个老派的程序……不过Emacs23中刚刚加入了xft字体的支持\nXFT字体\nXft字体相关选项在 /etc/fonts/fonts.conf 文件中配置\n可以使用 fc-cache 命令，递归扫瞄以下目录中的字体（包括子文件夹中的字体），建立字体缓存\n/usr/share/X11/fonts\n/usr/share/fonts\n/usr/local/share/fonts\n~/.fonts\n* /etc/fonts/fonts.conf 文件的 字段\n多数支持GTK2或者Qt图形库的X客户端能够使用Xft字体渲染技术\n* GTK2为Gnome使用的图形库，Qt为KDE使用的图形库。相对来说，GTK2图形库在程序的GUI设计中更加通用\n安装字体，只要将字体拷贝到以上任意目录， fc-cache -fv 刷新字体缓存即可 （参数: -f 强制刷新; -v 显示过程）\n使用命令 fc-list 列出所有可用字体\n字体的选择及显示风格，可以修改GTK2或者Qt的配置文件，建议使用图形界面配置\n* 一般情况下，桌面环境中附带了相关程序，例如 gnome-font-properties\n系统管理 一些细节 Linux是大小写敏感的系统，所有的命令、路径、参数、变量……都区分大小写\n使用 TAB 键补全命令，无论任何时候，多按几次TAB总会有所帮助\nShell的功能键能够协助您更高效的编辑命令，请熟悉其键绑定，尽量使用它\n命令由 命令名 、 分隔符 、 参数 、 操作对象 构成\n命令名 标识命令的功能，例如cp(copy)、mv(move)、rm(remove)……\n有些命令包含一些子命令，您可以认为它的命令名由两个单词构成，例如apt软件包管理系统：\napt-get install # 安装一个软件 apt-get remove # 删除一个软件 分隔符 通常为空格，多个连续的空格视为一个空格，下面两个命令相同：\ncp a b cp a b 有一些特殊符号也属于分隔符，例如 管道 | 、重定向 \u0026gt; 、 \u0026gt;\u0026gt; 、 \u0026lt; 、后台运行 \u0026amp; 、序列执行 \u0026amp;\u0026amp; 、 ; 。使用这些符号时，您不需要再使用空格作为分隔符，例如：\nls -al|less 写为以下形式，是为了让您更容易的阅读它：\nls -al | less 参数 精细调节命令的行为，以 - 引导，通常为参数名的首字母。许多软件都可以使用 -h 参数来阅读使用说明，例如：\napt-get -h 也可以使用参数的全名，一般以 \u0026ndash; 引导，例如：\napt-get --help 多数命令中，使用 - 引导多个字符，将会被视为多个参数，例如：\napt-get -help 系统会解读为以下命令\napt-get -h -e -l -p 少数命令的参数，不需要以 - 引导，或者使用 - 引导参数全名，例如：\nps aux /etc/init.d/gdm start mplayer -loop xxx 需要对多个对象进行操作时，可以使用空格分隔符将它们隔开：\ntouch 1 2 3 4 5 6 使用空格分隔的多个对象，视为一个整体，作为命令的一个操作对象：\nmv 1 2 3 4 5 6 /home/ 这个命令把1 2 3 4 5 6作为一个操作对象，移动到另一个操作对象，/home/目录\n递归 表示在子层次中重复相同操作。例如递归复制某目录，不但复制当前目录及其下的所有文件；而且对当前目录的子目录，也进行递归复制的操作。\n格式约定 使用 [] 表示可选项，实际输入为方括号中的内容，例如\nls [-al] ls是必须的，参数不需要以方括号括起来。\n使用 \u0026lt;\u0026gt; 表示必需项，实际输入为尖括号中的内容\n使用 | 表示 或 ，以 | 分隔的项目不能同时使用，例如\ntar [-z|j c|x vf] \u0026lt;归档文件\u0026gt; [源文件] 参数通常紧跟命令名，除非必要，在命令格式中，我们通常省略它们\n系统信息 uptime 联机信息-时间，显示如下\n11:27pm up 9 days, 7:12, 3 user, load average: 0.07, 0.12, 0.14\n当前系统时间 系统运行时间 当前在线用户数 系统负荷 1分钟前 5分钟前 15分钟前\nw 联机信息-已登录用户，显示如下\n01:04:10 up 1:34, 2 users, load average: 0.25, 0.16, 0.11\nuptime 信息\nUSER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT\nuser tty1 192.168.0.1 23:30 1:33 0.14s 0.12s -bash\n用户名 登录方式 来源地址 登录时间 发呆时间 资源占用 当前任务\nTip：w [用户名称] : 显示某一用户相关信息\nwho 联机信息，常用参数\n-r 运行级别\nwhoami 显示当前用户名\nlast 最近用户登录信息 -\u0026lt;数字\u0026gt; 使用数字作为参数，控制显示条目。例如 last -10 显示10条纪录\nuname 系统信息\n-s 内核名称（默认参数） -a 全部 -p CPU 信息 -n 主机名 -r 内核发行信息（版本号） -v 内核版本信息 date 显示、设定系统时间\n-u 显示格林尼洛时间（UTC） MMDDhhmm[[CC]YY][.ss] 设定时间，需要管理员权限。例如： date 12292359 MM 月份 DD 天数 hh 小时 mm 分钟 CC 年份前两位 YY 年份后两位 ss 秒钟 秒钟、年份为可选，例如： date 122923592006.59 +[%X]设定显示格式，以下为date默认输出格式： date +%Y年%m月%d日%A%H:%M:%S%Z 格式控制 %n 换行 %t 制表符 小时 %H(00~23) %I(01~12) %k(0~23) %l(1~12) %p(AM|PM) 分、秒 %M分钟(00~59) %S秒(00..61) %T(hh:mm:ss) %r(hh:mm:ss [AM|PM]) %s 从1970年1月1日00:00:00 UTC到目前为止的秒数 %X(%H:%M:%S) %Z时区 星期 %a(Sun~Sat) %A(Sunday~Saturday) %w : 一周中的第几天 (0..6) 年份 %Y(0000~9999) %y(00~99) 月份 %m(01~12) %b %h(Jan~Dec) %B(January~December) 日期 %d(01~31) %j(001~366) %x(本地格式mm/dd/yy) %D(mm/dd/yy) %c 一年中的第几周 %U(00~53)以Sunday为一周的第一天 %W(00~53)以Monday为一周的第一天 cal 显示日历\n文件管理 一些细节\n/ 目录为文件系统根目录，所有目录都是它的子目录\n绝对路径以 / 起始，相对路径以当前所在目录起始\n目录是一种特殊类型的文件，如果没有特别指明， 文件 包括文件和目录\n.. 表示上一级目录， . 表示当前目录，它们是两个特殊目录\n链接 为当前文件建立在其它路径中的访问方法。例如将系统中其它位置的可执行文件，链接到 /usr/local/bin 目录下，使用命令调用。\nls [路径]\n显示当前目录文件列表\n\u0026ndash;color 不同属性以不同颜色显示（默认参数）\n-a 全部显示 -i 显示inode值 -l 详细信息\n-F 显示文件类型后缀 目录*/* 链接*@* 可执行文件*** 端口文件*=* 管道文件*| \u0026gt;*\n-A 显示隐藏文件 -R 递归显示子目录文件列表 -S 按文件大小排序\n-t 按修改时间排序 -u 按访问时间排序 -d 只显示目录，不递归显示目录下的文件\ncd [目录路径] | [特殊路径]\n切换目录\n目录路径可以使用绝对路径或者相对路径特殊路径：\n~ $HOME**目录（默认值） - 上一次目录 .. 上一级目录 . 当前目录\n说明：您可以通过修改 /etc/environment 文件，来定义 $CDPATH 变量，设定“cd”命令的搜索路径。\npwd\n显示当前路径\nfile \u0026lt;文件名\u0026gt;\n显示文件类型\n*-i* ***显示mime****类型*\ndu [路径]\n计算文件或目录空间占用\n-h 人性化显示。自动以G、M、K为单位显示占用空间大小 -l 重复计算硬链接文件大小\n-L 计算符号链接文件大小 -a 显示当前目录子目录中的文件 -c 显示文件数\nless \u0026lt;文件名\u0026gt;\n浏览文件，使用VI和Emacs两种风格的键绑定。以下为VI风格键绑定\nCtrl+f(orward) 向下翻一页 Ctrl+d(own) 向下翻半页\nCtrl+b(ackward) 向上翻一页 Ctrl+u(p) 向上翻半页 / 查找 q(uit) 退出\ntouch \u0026lt;目标文件\u0026gt;\n触碰，在不修改文件的前提下，更改其时间属性。通常用来创建一个空文件\nmkdir \u0026lt;文件夹\u0026gt;\n创建文件夹\n-p \u0026lt;多级目录\u0026gt; 按路径创建多级目录 -m \u0026lt;数字权限值\u0026gt; 设定权限\ncp \u0026lt;源文件\u0026gt; \u0026lt;目标目录|文件\u0026gt;\n将源文件复制为目录文件，或者将源文件复制到目标目录。多个源文件使用空格分隔\ncp \u0026lt;源目录\u0026gt; \u0026lt;目标目录\u0026gt;\n将源目录复制到目标目录中，如果复制多个源目录，需要使用 -R 参数\n-a 相当于*-dpr**参数* -d 保留链接 -f 强制复制，覆盖目标文件 -i 覆盖时询问用户\n-p 保留修改时间和访问权限 -r -R 递归复制（目录*=\u0026gt;*目录） -l 创建链接\n-v 显示过程\nrm \u0026lt;目标目录|文件\u0026gt;\n删除\n-r -R 递归删除 -f 强制删除（无需确认，直接删除。慎用！） -i 交互式删除（询问用户）\nrmdir \u0026lt;目标目录\u0026gt;\n删除目录时，建议您使用“rm -r”命令\nmv \u0026lt;源文件\u0026gt; \u0026lt;目标目录|文件\u0026gt;\n相当于cp后删除源文件，也可以作为“重命名”使用。\nmv \u0026lt;源目录\u0026gt; \u0026lt;目标目录\u0026gt;\n-r -R 递归\nln \u0026lt;源文件\u0026gt; \u0026lt;链接\u0026gt;\n链接\n-s 符号链接 -f 强制链接，覆盖目标文件 -i 覆盖前询问用户\n文件操作 nano\n一个简单轻便的文本编辑器，使用Emacs风格的键绑定。\nsplit \u0026lt;源文件\u0026gt; [目标文件名前缀]\n将源文件按一定规则分割成若干个目标文件。默认文件名前缀为 x\n-\u0026lt;行数\u0026gt; 按行数分割文件 -l \u0026lt;行数\u0026gt; 同上\n-b \u0026lt;字节\u0026gt; 按大小分割文件。可以使用b、k、m作单位，不指定单位的情况下，默认单位为**b\n-C \u0026lt;字节\u0026gt; 按大小分割文件，并尽量保持每行的完整\n示例：split -C 100k file.split x\ncat \u0026lt;文件名\u0026gt;\n输出文件内容。用空格分隔多个文件名，可以将多个文件内容连接到一起输出。使用重定向合并为一个文件\n-n 在输出中添加行号 -b 在输出中添加行号，空行不编号\n-s 将两行或以上的空行，合并为一个空行\n示例：cat xaa xab xac \u0026gt; file.split\nsort [-o \u0026lt;输出文件\u0026gt;] [-t \u0026lt;分隔字符\u0026gt;] [+\u0026lt;起始字段\u0026gt; - \u0026lt;结束字段\u0026gt;] [文件]\n对文本内容排序\n-m 合并文件 -c 检查文件是否已按规则排序 -b 忽略行首空格字符\n-u 忽略内容重复行 -f 忽略大小写 -l 忽略非打印字符 -M 作为月份比较\n-d 按字典顺序排序，按照字母、数字、空格、制表符排序 -r 逆序输出\nmore\n查看文件内容，我们建议您使用 less\ndiff \u0026lt;文件名\u0026gt;\n比较文件\ncksum [文件名]\n计算文件的CRC值。不指定文件名则从标准输入设备读入数据，例如：\necho xxx | cksum\nmd5sum [文件名] 计算文件的md5值。同上\n权限管理 一些细节\n一个文件主要包含下列属性， ls -l\n- rwx rwx rwx user group date filename 111 101 101 其中，第一组为归属用户的权限，第二组为归属群组的权限，第三组为其它用户群组的权限。user为文件的归属用户，group为文件的归属群组，date为日期信息，filename为文件名。\n对于文件夹，必须拥有它的可执行权限，才能够使用 cd 命令进入该文件夹；拥有可读权限，才能够使用 ls 命令查看该文件夹的文件列表。\nroot用户拥有最高权限。\n可以使用3位的二进制数字来描述一组权限，某一权限对应的数字为1,则表示具有该种权限，为0,则不具有该种权限。\n使用二进制数字来描述一组权限，虽然非常直观，但是3组权限需要用9位数来表示，使用不够方便。因此我们将三组权限使用3位8进制数字来表示。它们的对应关系为：\nr 100 4\nw 010 2\nx 001 1\n将这三位8进制数字相加的结果，就可以表示该组权限的具体内容，例如：\n7=4+2+1=rwx\n5=4+1=rx\n755=4+2+1 4+1 4+1=rwx r-x r-x\n还可以使用 a 、 u 、 g 、 o 表示归属关系，使用 = 、 + 、 - 表示权限变化，使用 r 、 w 、 x 表示权限内容，\na 所有用户 u 归属用户 g 归属群组 o 其它用户\n= 具有权限 + 增加权限 - 去除权限\nr 可读权限 w 可写权限 x 可执行权限\n例如：\na+x 给所有用户增加可执行权限\ngo-wx 将归属群组和其它用户的可写、可执行权限去掉\nu=rwx 归属用户具有可读、可写、可执行权限\nchmod \u0026lt;权限表达式\u0026gt; \u0026lt;文件|目录\u0026gt;\n更改文件的权限。权限的表达式可以使用三位8进制数字表示，或者使用 augo +-= rxw-s 来表示\n-R 递归\n-v 显示过程\n-c 类似“-v”，仅显示更改部分\n\u0026ndash;reference=\u0026lt;参考文件或目录\u0026gt; 以指定文件为参考更改权限\n示例：\nchmod -R a+x path\nchmod -Rv 755 path\nchown \u0026lt;归属用户\u0026gt;[:归属群组] \u0026lt;文件|目录\u0026gt;\n更改文件的归属用户。可以使用用户名或者UID\n-R 递归 -v 显示过程 -c 类似 -v ，仅显示更改部分\n\u0026ndash;reference=\u0026lt;参考文件或目录\u0026gt; 以指定文件为参考更改权限\n示例：\nchown user:admin path chown -R user.admin path chown user path\nchgrp \u0026lt;归属群组\u0026gt; \u0026lt;文件|目录\u0026gt;\n更改文件的归属群组。可以使用群组名或者GID\n参数同上\nSUID、SGID、Sticky bit\n某些情况下，需要以可执行文件归属用户的身份执行该文件，可以为该文件设置SUID。同样，设置SGID能够以该文件归属群组的身份执行它。\n例如：用户自行设定密码。出于安全方面的考虑， /etc/shadow 只能由root用户直接修改。\n-rw\u0026mdash;\u0026mdash;- root root /etc/shadow\n这个时候，可以为程序 /usr/bin/passwd\n设置SUID，当普通用户执行“passwd”命令时，便能够以该程序归属用户root的身份修改 /etc/shadow\n文件。而“passwd”程序自身带有身份验证机制，不能通过验证时拒绝执行，从而保证了安全。\nls -l /usr/bin/passwd\n-r-s\u0026ndash;x\u0026ndash;x root root /usr/bin/passwd\n我们发现，归属用户的可执行权限位使用 s ，表示SUID。同样，归属群组的可执行权限位使用 s ，表示SGID。任何用户或群组都拥有\n其它用户 的权限，所以不需要以 其它用户 身份执行文件，其它用户的可执行权限位便不会出现 s 。该权限位可能出现的属性为 t\n，也就是粘着位Sticky bit。\nls -ld /tmp\ndrwxrwxrwt root root /tmp\n粘着位表示任何用户都可能具有写权限，但只有该归属用户或root用户才能够删除\nSUID、SGID、Sticky bit也可以像权限一样，使用一个八进制数表示，如下：\n4 SUID\n2 SGID\n1 Sticky bit\n通过在“chmod”命令中使用4个八进制数的表达式，如 4755 ，用第一位表示SUID、SGID、或Sticky bit，便能够为文件设置这些特殊权限。示例：\nchmod -R 4755 path\nlsattr [路径]\n查看文件的特殊属性\n-a 全部显示 -d 只显示目录 -R 递归\n特殊属性包括：\na*：仅供附加用途* b*：不更新最后存取时间* c*：压缩后存放* d*：排除在倾倒操作之外*\ni*：不得任意更动文件或目录* s*：保密性删除文件或目录* S*：即时更新文件或目录*\nu*：预防以外删除*\nchattr +|-|=\u0026lt;属性\u0026gt; \u0026lt;路径\u0026gt;\n更改文件特殊属性\n-R 递归 -V 显示过程\n压缩解压 tar -c|x|u|r|t[z|j][v] -f \u0026lt;归档文件\u0026gt; [未打包文件]\n将多个文件打包为一个归档文件，可以在打包的同时进行压缩。支持的格式为tar（归档）、gz（压缩）、bz2（压缩率更高，比较耗时）\n-c 创建 -x 解包 -u 更新 -r 添加 -t 查看\n-d 比较压缩包内文件和文件 -A 将tar文件添加到归档文件中 -z 使用gz压缩格式\n-j 使用bz2压缩格式 -v 显示过程 -f \u0026lt;文件名\u0026gt; 归档文件的文件名\n-C \u0026lt;解压路径\u0026gt; 将压缩包中的文件解压到指定目录\n[未打包文件] 创建、更新时必须填写\n示例：\ntar -zcvf xxx.tar.gz xxx/ xxx1 xxx2 xxx3 多个待打包文件以空格分隔\ntar -zcvf xxx.tar.gz /home/user/xxx/ 使用绝对路径打包，解包也使用绝对路径\ntar -zxvf xxx.tar.gz 按相对路径解包到当前目录下，或按绝对路径解包\ntar -zcvf xxx.tar.gz xxx | split -b 1m 打包后，使用split分割为1m大小的多个文件\n其它参数\n-P 使用绝对路径压缩时，保留根目录*“/” -W* 校验 -p 还原文件权限\n-w 询问用户 \u0026ndash;totals 统计 -T \u0026lt;表达式\u0026gt; 处理符合条件的文件\n-X \u0026lt;表达式\u0026gt; 排除符合条件的文件\nzip [参数] \u0026lt;压缩包\u0026gt; \u0026lt;源文件\u0026gt;\n使用zip格式打包文件\n-r 递归，将指定目录下的所有文件和子目录一并处理 -S 包含系统和隐藏文件\n-y 直接保存符号连接，而非该连接所指向的文件 -X 不保存额外的文件属性\n-m 将文件压缩并加入压缩文件后，删除源文件\n-\u0026lt;压缩级别\u0026gt; 1~9，数字越大，压缩率越高\n-F 尝试修复已损坏的压缩文件 -T 检查备份文件内的每个文件是否正确无误\n-q 不显示指令执行过程 -g 将文件压缩后附加在既有的压缩文件之后，而非另行建立新的压缩文件\n-u 更新压缩包内文件\n-f 更新压缩包内文件。如果符合条件的文件没有包含在压缩包中，则压缩后添加\n-$ 保存第一个被压缩文件所在磁盘的卷标 -j 只保存文件名称及其内容\n-D 压缩文件内不建立目录名称 -i \u0026lt;表达式\u0026gt; 压缩目录时，只压缩符合条件的文件\n-x \u0026lt;表达式\u0026gt; 排除符合条件的文件 -n \u0026lt;文件名后缀\u0026gt; 排除指定文件名后缀的文件\n-b \u0026lt;缓存路径\u0026gt; 指定临时文件目录 -d \u0026lt;表达式\u0026gt; 从压缩文件内删除指定的文件\n-t \u0026lt;日期时间\u0026gt; 把压缩文件的日期设成指定的日期\n-o 以压缩文件内拥有最新更改时间的文件为准，将压缩文件的更改时间设成和该文件相同\n-A 调整可执行的自动解压缩文件 -c 替每个被压缩的文件加上注释\n-z 替压缩文件加上注释 -k 使用MS-DOS兼容格式的文件名称。\n-l 压缩文件时，把LF字符置换成LF+CR字符。 -ll 压缩文件时，把LF+CR字符置换成LF字符。\nunzip [参数] \u0026lt;压缩文件\u0026gt; [压缩包中将被释放的文件]\n解压zip压缩包文件\n-P \u0026lt;密码\u0026gt; zip**压缩包的密码 -d \u0026lt;路径\u0026gt; 指定解压路径 -n 解压缩时不覆盖原有文件\n-f 覆盖原有文件 -o 不经询问，直接覆盖原有文件\n-u 覆盖原有文件，并将压缩文件中的其他文件解压缩到目录中\n-l 显示压缩文件内所包含的文件 -t 检查压缩文件是否正确 -z 显示压缩包注释\n-Z unzip -Z等于执行zipinfo**指令 -j 不处理压缩文件中原有的目录路径\n-C 压缩文件中的文件名称区分大小写 -L 将压缩文件中的全部文件名改为小写\n-s 将文件名中的空格转换下划线 -X 解压缩时保留文件原来的**UID/GID\n-q 执行时不显示任何信息 -v 执行是时显示详细的信息\n-c 将解压缩的结果显示到屏幕上，并对字符做适当的转换\n-p 与*-c**参数类似，会将解压缩的结果显示到屏幕上，但不会执行任何的转换*\n-a 对文本文件进行必要的字符转换 -b 不要对文本文件进行字符转换\n-x \u0026lt;表达式\u0026gt; 处理里排除压缩包中的指定文件 -M 将输出结果送到more程序处理\n7z|7za \u0026lt;子命令\u0026gt; [参数] \u0026lt;压缩包\u0026gt; [文件]\n子命令\na 添加 d 删除 e 解压 x 带路径解压 l 列表查看 t 测试 u 更新\n参数\n-m\u0026lt;压缩方式\u0026gt; -m0=\u0026lt;压缩算法\u0026gt; 默认使用**lzma -mx=\u0026lt;1~9\u0026gt; 压缩级别\n-mfb=64 number of fast bytes for LZMA = 64 -md=\u0026lt;字典大小\u0026gt; 设置字典大小，例如 -md=32m\n-ms=\u0026lt;on|off\u0026gt; 是否固实压缩 -o\u0026lt;输出目录\u0026gt; 设置输出目录 -p[密码] 使用密码\n-r[数字] 递归，使用数字定义递归子目录的深度 -sfx[\u0026lt;模块名称\u0026gt;] 使用自解压模块\n-si 从标准输入设备读入数据 -so 将数据写入标准输出设备 -y 所有询问均回答**Yes\n-w\u0026lt;工作目录\u0026gt;\nrar \u0026lt;子命令\u0026gt; [参数] \u0026lt;压缩包\u0026gt; [文件|文件列表|路径]\n子命令\nx 带路径解压 e 解压到当前目录 a 将文件添加到压缩包内 d 从压缩包中删除文件\nu 更新压缩包内文件 f 更新压缩包内文件，并添加压缩包内不存在的文件 m 添加并删除源文件\nr 修复 l 列表查看压缩包内文件信息 lt 更详细信息 lb 简短信息 c 添加压缩包注释\ncf \u0026lt;文件名\u0026gt; 将文件内容添加为注释\ncw \u0026lt;文件名\u0026gt; 将注释保存为文件\nt 测试压缩包 rr 添加恢复纪录 rv 恢复到文件\n参数\n-p\u0026lt;密码\u0026gt; 设置密码\n-m\u0026lt;0~5\u0026gt; 设置压缩级别，数字越大，压缩级别越高\n搜索 whereis \u0026lt;程序名称\u0026gt;\n查找软件的安装路径\n-b 只查找二进制文件 -m 只查找帮助文件 -s 只查找源代码 -u 排除指定类型文件\n-f 只显示文件名 -B \u0026lt;目录\u0026gt; 在指定目录下查找二进制文件\n-M \u0026lt;目录\u0026gt; 在指定目录下查找帮助文件 -S \u0026lt;目录\u0026gt; 在指定目录下查找源代码\nlocate \u0026lt;文件名称\u0026gt;\n在文件索引数据库中搜索文件\n-d \u0026lt;数据库路径\u0026gt; 搜索指定数据库\nupdatedb 更新文件索引数据库\nfind [路径] \u0026lt;表达式\u0026gt;\n查找文件\n-name \u0026lt;表达式\u0026gt; 根据文件名查找文件\n-iname \u0026lt;表达式\u0026gt; 根据文件名查找文件，忽略大小写\n-path \u0026lt;表达式\u0026gt; 根据路径查找文件\n-ipath \u0026lt;表达式\u0026gt; 根据路径查找文件，忽略大小写\n-amin \u0026lt;分钟\u0026gt; 过去N分钟内访问过的文件\n-atime \u0026lt;天数\u0026gt; 过去N天内访问过的文件\n-cmin \u0026lt;分钟\u0026gt; 过去N分钟内修改过的文件\n-ctime \u0026lt;天数\u0026gt; 过去N天内修改过的文件\n-anewer \u0026lt;参照文件\u0026gt; 比参照文件更晚被读取过的文件\n-cnewer \u0026lt;参照文件\u0026gt; 比参照文件更晚被修改过的文件\n-size \u0026lt;大小\u0026gt; 根据文件大小查找文件，单位b c w k M G\n-type \u0026lt;文件类型\u0026gt; 根据文件类型查找文件。b 块设备 c 字符设备 d 目录 p 管道文件 f 普通文件 l 链接 s 端口文件\n-user \u0026lt;用户名\u0026gt; 按归属用户查找文件\n-uid 按UID查找文件\n-group \u0026lt;群组名\u0026gt; 按归属群组查找文件\n-gid 按GID查找文件\n-empty 查找空文件\ngrep \u0026lt;字符串\u0026gt;|\u0026quot;\u0026lt;正则表达式\u0026gt;\u0026quot; [文件名]\n其它 echo \u0026lt;字符串\u0026gt;\n回显。较复杂的字符串，可以使用 \u0026quot; 括起来。\n-n 输出内容不换行 -E 不解析脱字符 -e 解析脱字符\n控制字符\n** 反斜线 a 警告 b 退格 n 换行 r 回车 t 水平制表符\nclear\n消除屏幕\nalias \u0026lt;输入内容\u0026gt; \u0026lt;实际内容\u0026gt;\n别名，为命令指定一个别名，以简化输入。例如：\nalias ls=\u0026lsquo;ls \u0026ndash;color=auto\u0026rsquo;\nalias ls=\u0026ldquo;l -CF\u0026rdquo;\n可以将您的定义保存在 ~/.bashrc 文件中。\nexport \u0026lt;变量名称\u0026gt;\n将变量导出为环境变量，常写变量赋值一同使用，例如：\nexport PATH=\u0026quot;$PATH:xxx\u0026quot;\n其中 $PATH 表示变量 PATH 原值\nshutdown\n关闭计算机，向根进程 init 发送信号，更改 runlevel 为 0 (halt)\n-h 关闭电源 -r 重启 -n 强行关机，不向 init**进程 发送信号\n-k 模拟关机，向登录者发送关机警告 -t \u0026lt;秒\u0026gt; N**秒后关机 time \u0026lt;时间\u0026gt; 定时关机\n-c [说明信息] 取消关机 -f 重启时忽略检测文件系统 -F 重启时强制检测文件系统\nhalt\n关闭计算机。 调用 shutdown -h ，结束系统进程，同步文件系统，停止内核。\n-n 不同步文件系统 -w 模拟关机，写 /var/log/wtmp 纪录 -f 不调用 *shutdown ,*强行关机\n-p 默认选项，关机时调用 poweroff -i 关机前断开网络\nreboot\n重新启动计算机。参数与 halt 相似\nchroot \u0026lt;路径\u0026gt;\nChange Root 更改根目录，重新定义会话的运行环境。\n用户管理 一些细节\nroot 用户为根用户，也就是 系统管理员 拥有全部权限\n一个用户只能拥有一个 GID ，但是还可以归属于其它附加群组\n用户管理的重要配置文件：\n/etc/passwd 用户名 密码位 UID 归属GID 姓名 $HOME目录 登录Shell /etc/shadow 用户名 已加密密码 密码改动信息 密码策略 /etc/group 群组名 密码位 GID 组内用户 /etc/gshadow 群组密码相关文件，不重要 /etc/sudoers 用户名 权限定义 权限 可以使用 pwconv 命令创建影子密码，将 /etc/passwd 文件中的密码转换到 /etc/shadow 文件\nsu [用户名]\n切换到其它用户，默认切换到root用户。提示密码为将切换用户密码\n-f 快速切换，忽略配置文件 -l 重新登录 -m ，**-p 不更改环境变量\n-c \u0026lt;命令\u0026gt; 切换后执行命令，并退出切换\nsudo [命令]\n以其它用户的身份执行命令，默认以root的身份执行。提示密码为当前用户密码\n-s 切换为**root shell -i 切换为root shell，并初始化 -u \u0026lt;用户名|UID\u0026gt; 执行命令的身份\n-l 显示自己的权限\npasswd [用户名]\n设定用户密码\n-d 清除密码 -l 锁定用户 -e 使密码过期，在下次登录时更改密码\n-S 显示密码认证信息 -x \u0026lt;天数\u0026gt; 密码过期，最大使用时间\n-n \u0026lt;天数\u0026gt; 冻结密码，最小使用时间 -s 更改登录**Shell -f 更改用户信息\n示例：\n$passwd\nChanging password for user\n(current) UNIX password: 原密码\nEnter new UNIX password: 新密码\nRetype new UNIX password: 确认新密码\nchsh [-s ] [用户名]\n更改登录Shell\nusermod \u0026lt;用户名\u0026gt;\n修改用户账号\n-d \u0026lt;目录\u0026gt; 设定*$HOME目录* -m 设定$HOME*目录时自动建立*\n-s 修改用户登录**Shell -l \u0026lt;新用户名\u0026gt; 修改为新用户名\n-u 修改用户**UID -g \u0026lt;群组名\u0026gt; 修改用户归属群组\n-G \u0026lt;群组名\u0026gt; 修改用户归属附加群组 -L 锁定帐户 -U 解除锁定\n-e \u0026lt;过期时间\u0026gt; 设定用户账号过期时间 -f \u0026lt;缓冲天数\u0026gt; 设定密码过期后多长时间关闭账号\n-c \u0026lt;字符串\u0026gt; 修改用户备注\nuseradd \u0026lt;用户名\u0026gt;\n新建用户\n-d \u0026lt;目录\u0026gt; 设定*$HOME目录* -m 自动建立$HOME目录* -M 不自动建立$HOME**目录*\n-s 修改用户登录**Shell -l \u0026lt;用户名\u0026gt; 修改为新用户名 -u 修改用户**UID\n-g \u0026lt;群组名\u0026gt; 修改用户归属群组 -G \u0026lt;群组名\u0026gt; 修改用户归属附加群组\n-n 不建立以用户名为名称的群组 -e \u0026lt;过期时间\u0026gt; 设定用户账号过期时间\n-f \u0026lt;缓冲天数\u0026gt; 设定密码过期后多长时间关闭账号 -c \u0026lt;字符串\u0026gt; 修改用户备注\n-D [表达式] 更改预设值 （预设值保存于 /etc/default/useradd 文件中）\n新建用户规则保存于 /etc/login.defs 文件中\n新建用户默认文件保存于 /etc/skel/ 目录中。新建用户时，系统自动拷贝此目录下的文件至新建用户的 $HOME 目录\nuserdel \u0026lt;用户名\u0026gt;\n删除用户\n-r 删除用户相关文件和目录\nid [用户名]\n显示用户 UID GID 归属附加群组\nfinger [用户名]\n显示用户信息\n进程管理 一些细节\n进程一般分为交互进程、批处理进程和守护进程三类。\n守护进程总是活跃，在系统启动时通过脚本自动启动，或由root启动，通常在后台运行。\n一个进程可以拥有子进程。当父进程终止时，它的子进程也随之终止；而子进程终止时，父进程通常可以继续运行。\ninit 进程为根进程，所有进程都是它的子进程\nps\n显示进程信息，参数可省略 -\naux 以BSD风格显示进程*(常用) -efH* 以System V风格显示进程\n-e , -A 显示所有进程 a 显示终端上所有用户的进程 x 显示无终端进程\nu 显示详细信息 f 树状显示 w 完整显示信息 l 显示长列表\n示例：\nps alx 另一种常用输出格式\nps aux | less 将输出通过管道，使用 less 查看\nps aux | grep \u0026lt;关键字\u0026gt; 通过关键字查找进程\n输出字段\nUSER 进程所有者 PID 进程ID PPID 父进程 %CPU CPU占用率\n%MEM 内存占用率 NI 进程优先级。数值越大，占用CPU时间越少 VSZ 进程虚拟大小\nRSS 页面文件占用 TTY 终端ID STAT 进程状态\nD 不可中断 Uninterruptible sleep (usually IO) R 正在运行，或在队列中的进程\nS 处于休眠状态 T 停止或被追踪 Z 僵尸进程\nW 进入内存交换（从内核2.6开始无效） X 死掉的进程 \u0026lt; 高优先级 N 低优先级\nL 有些页被锁进内存 s 包含子进程 + 位于后台的进程组；\nl 多线程，克隆线程 multi-threaded (using CLONE_THREAD, like NPTL pthreads do)\npstree\n树状显示进程信息\n-a 显示完整命令及参数 -c 重复进程分别显示 -c 显示进程**ID PID -n 按 PID 排列进程\npgrep \u0026lt;进程名\u0026gt;\n显示进程的PID\n-l 显示进程名和进程**PID -o 进程起始**ID -n 进程终止**ID\nxkill\n在图形界面中点杀进程。执行此命令后，鼠标指针变为骷髅图案（一定看过《加勒比海盗》吧）。在窗口中点击左键杀死进程，右键取消\npkill \u0026lt;进程名\u0026gt;\n结束进程族。如果结束单个进程，请用 kill\nkill [信号代码] \u0026lt;进程PID\u0026gt;\n根据PID向进程发送信号，常用来结束进程，默认信号为 -9\n-l [信号数字] 显示、翻译信号代码\n-9 , -KILL 发送 kill 信号退出\n-6 , -ABRT 发送 abort 信号退出\n-15 , -TERM 发送 Termination 信号\n-1 , -HUP 挂起\n-2 , -INT 从键盘中断，相当于 Ctrl+c\n-3 , -QUIT 从键盘退出，相当于 Ctrl+d\n-4 , -ILL 非法指令\n-11 , -SEGV 内存错误\n-13 , -PIPE 破坏管道\n-14 , -ALRM\n-STOP 停止进程，但不结束\n-CONT 继续运行已停止的进程\n-9 -1 结束当前用户的所有进程\nrenice \u0026lt;优先级表达式\u0026gt; \u0026lt;进程表达式\u0026gt;\n重新设定进程优先级（无此必要）\n优先级表达式：\n+|-|= \u0026lt;nice值\u0026gt;\nnice取值范围： -20~19\n进程表达式：\n-p 通过进程ID进行设定\n-g 通过进程群组ID\n-u 通过进程拥有者UID设定\ntop\n动态、交互式进程管理器\n-c 显示进程启动状态，包括参数、操作对象等；而不只是进程名\n-d \u0026lt;秒\u0026gt; 刷新频率。 -d 5，表示5秒刷新一次\n-n \u0026lt;次\u0026gt; 刷新次数，然后退出。 -n 5，表示刷新5次后退出；\n-b 以批量模式运行，让输出能够使用管道或重定向。但不能进行交互，最好和 -n \u0026lt;次\u0026gt; 参数一同使用\n-i 禁止显示空闲进程或僵尸进程；\n-p PID 仅监视指定进程的ID；PID是一个数值；\n-s 安全模式运行，禁用一些效互指令；\n-S 累积模式，输出每个进程的总的CPU时间，包括已死的子进程；\n交互命令：\n立即刷新\nk 交互式杀死进程，提示输入进程 PID （默认发送信号15）\nr 设定renice，提示输入PID和renice值\ns 改变两次刷新时间间隔，以秒为单位\nn 设定显示进程数， 0 为不作限制\ni 隐藏空闲进程和僵尸进程\nS 切换到累积时间模式\nl 开关，在顶部显示 uptime 信息\nt 开关，在顶部显示 进程和CPU状态\nm 开关，在顶部显示 free 信息\nc 显示方式切换： 进程名/进程启动状态\nA 按进程启动顺序进行排序。由新到旧\nM 按内存占用排序。由大到小\nN 以进程ID排序。由大到小\nP 按CPU占用排序。由大到小\nT 按时间／累积时间排序\nf ，F 设定显示字段。设定完成后空格退出\no,O 设定显示字段的排序。大写向前移动，小写向后移动，空格退出\nh,? 显示有关安全模式和累积模式的帮助信息\nW 把当前的配置写到~/.toprc中；\nnohup \u0026lt;命令\u0026gt;\n将任务提交到后台，输出附加到 ~/nohup.out 文件。即便用户退出登录，提交的命令仍继续执行。\n\u0026lt;命令\u0026gt; \u0026amp;\n背景执行此命令，如果用户退出登录，则命令停止执行\n\u0026lt;命令1\u0026gt; ; \u0026lt;命令2\u0026gt; ; \u0026hellip;\u0026hellip;\n命令队列，从左向右，依次执行以 ; 分隔的命令\n\u0026lt;命令1\u0026gt; \u0026amp;\u0026amp; \u0026lt;命令2\u0026gt; \u0026amp;\u0026amp; \u0026hellip;\u0026hellip;\n命令队列，从左向右，依次执行以 \u0026amp;\u0026amp; 分隔的命令。前一个命令执行成功，后一个命令才能执行\n\u0026lt;命令\u0026gt; \u0026lt;Ctrl+z\u0026gt;\n\u0026lt;Ctrl+z\u0026gt; 挂起当前Shell中的任务\njobs\n显示背景任务\nbg [任务编号]\n将挂起的任务背景执行\nfg [任务编号]\n将背景任务调到前台执行\n计划任务\n磁盘和内存管理 一些细节\nLinux中，设备用/dev/目录下的文件表示。例如\n/dev/hda1 第一块硬盘的第一主分区\n/dev/hdb5 第二块硬盘的第一逻辑分区\n/dev/sda4 第一块SATA硬盘的第四主分区，或者扩展分区\n/dev/null 黑洞设备\n关于磁盘设备，详见 分区概念\nmount \u0026lt;设备文件\u0026gt; [挂载路径]\n挂载文件系统\n-t 指定文件系统的类型。通常不必指定，mount自动检测。下面是常用的格式\nreiserfs ReiserFS 3.6版\njfs IBM技术\nxfs SGI技术(适合高级服务器，桌面用户慎用)\next3 Linux传统文件系统\nvfat fat fat32\next2 不带日志的ext3\nntfs WINNT\niso9660 光盘\nsmbfs Windows文件共享\n-o [选项1] [选项2] \u0026hellip;\u0026hellip;\nloop 环设备。光盘、ISO镜像等\nro | rw 只读readonly；可读写read-write\nsync | async 同步模式|异步模式。决定修改是否立即写入文件系统\natime | noattime 读取时是否修改访问时间。对于写入敏感设备，例如闪存、软盘，建议使用 noatime\nauto | noauto 自动挂载模式\nexec | noexec 是否允许可执行权限\ndefaults 使用预设的选项 rw, suid, dev, exec, auto, nouser, async\niocharset=UTF-8 指定字符集，可简写为 utf8\ncodepage=936 指定代码页，可简写为 cp936 西文系统代码页为 437\numask=\u0026lt;权限掩码\u0026gt; 设定权限掩码\nuid= 设定归属用户\ngid= 设定归属群组\nremount 以不同选项重新挂载\n-L \u0026lt;卷标\u0026gt; 将带有特殊卷标的分区\nTip\n权限掩码\n权限=777-权限掩码（三位） | 7777-权限掩码（四位）\n假如权限掩码为 022 ，则新建对象权限为 755 rwxr-xr-x\n可以使用 umask 命令设置权限掩码\nmount -a\n挂载 /etc/fstab 文件中定义的所有设备\n示例：\nsudo mount -t iso9660 -o loop /dev/cdrom0 /media/cdrom\nsudo mount -t vfat -o remount iocharset=utf8,codepage=cp936 /dev/hda5 /media/hda5\numount \u0026lt;设备文件\u0026gt; | \u0026lt;挂载路径\u0026gt;\n卸载已挂载文件系统\ndf\n查看已挂载文件系统的磁盘空间占用\n-a 显示所有文件系统的磁盘使用情况，包括0块（block）的文件系统，如/proc文件系统\n-T 显示文件系统类型 -k 以k字节为单位显示 -i 显示i节点信息，而不是磁盘块\n-t \u0026lt;文件系统类型\u0026gt; 显示指定类型的文件系统的磁盘空间使用情况\n-x \u0026lt;文件系统类型\u0026gt; 列出不是某一指定类型文件系统的磁盘空间使用情况（与t选项相反）。\n-l 只显示本地文件系统\nfree\n查看内存、缓冲区、交换空间的占用\n-b 以字节为单位显示数值 -k 以千字节为单位显示数值 -m 以兆字节为单位显示数值\n-g 以吉字节为单位显示数值 -l 显示内存占用峰值 -o 不显示缓冲区占用 -t 统计结果\n-s \u0026lt;秒\u0026gt; 刷新频率\nsync\n同步文件系统。将缓冲区中的数据写入文件系统\nfdisk \u0026lt;磁盘设备文件\u0026gt;\n分区表修改工具\n交互命令：\nm 使用帮助 l 查看已知文件系统类型 p 显示分区信息\nn 新建分区 （p:主分区 l:扩展分区 参见 分区概念 ) d 删除分区 t 改变分区类型\nw 将改动写入分区表 q 放弃改动并退出\n* 磁盘设备名称为整块磁盘，而不是磁盘中的分区。例如 /dev/hda ，而不是 /dev/hda1\nfdisk -l\n查看所有磁盘分区信息\ncfdisk\n更加友善的分区表修改工具\nmkfs.\u0026lt;文件系统类型\u0026gt; \u0026lt;分区设备文件\u0026gt;\n将分区格式化为文件系统。 文件系统类型\n示例：\nsudo mkfs.reiserfs /dev/hda1\nmkfs \u0026lt;分区设备文件\u0026gt;\n-t \u0026lt;文件系统类型\u0026gt; 指定文件系统类型 -c 格式化前检查磁盘\nmkisofs -o \u0026lt;镜像文件\u0026gt; [源文件目录]\n用光盘或者文件制作iso镜像\n-b 可启动镜像\nhdparm \u0026lt;磁盘设备文件\u0026gt;\n设置硬盘参数\n-d \u0026lt;0|1\u0026gt; DMA模式开关 -a \u0026lt;0|1\u0026gt; 预计模式开关 -t 性能测试 -T 缓存性能测试\n-c \u0026lt;0|1|3\u0026gt; 32位传输模式开关 -g 显示柱面，扇区等信息 -i -I 显示磁盘信息\n网络和硬件管理 ifconfig\n配置网络接口\n-a 显示所有网络接口\nifconfig \u0026lt;网卡\u0026gt; up|down\n激活|禁用网卡\n示例： ::\nsudo ifconfig eth0 up\nifconfig \u0026lt;网卡\u0026gt; add \u0026lt;IP地址\u0026gt; [ netmask \u0026lt;子网掩码\u0026gt; ]\n给网卡指定IP地址或子网掩码\nroute\n配置路由及网关\nroute add -net \u0026lt;路由地址\u0026gt; gw \u0026lt;网关地址\u0026gt; [ netmask \u0026lt;子网掩码\u0026gt; ] dev \u0026lt;网卡\u0026gt;\n指定路由及网关\nroute del -net \u0026lt;网关地址\u0026gt; gw \u0026lt;网关地址\u0026gt; [ netmask \u0026lt;子网掩码\u0026gt; ]\n删除路由及网关\nip\n配置网络\n子命令：\nlink 网卡配置 address 配置地址。相当于 ifconfig route 配置路由。相当于 route\n参数：\nshow 显示(默认) set 设置 add 添加 del 删除\n示例：\nip link show 显示网卡配置\nip link set eth0 name xxx 重命名网络接口\nping \u0026lt;IP地址\u0026gt;\n向目标地址发送ICMP封包，常用来测试网络\n-b \u0026lt;广播地址\u0026gt; ping整个网段 -c 发送封包次数 -s \u0026lt;封包大小\u0026gt; 默认为64字节\nnetstat\n网络连接状态\n-r 显示路由表，同 route -a 所有连接 -t 只显示TCP协议 -U 只显示UDP协议\n-l 只显示正在监听的端口 -p 显示PID和进程名 -c \u0026lt;秒\u0026gt; 刷新频率\n* http/ftp/ssh…… 为应用层协议 * TCP/UDP为传输层协议 * IP/ICMP为网络层协议\nlspci\n查看PCI总线连接的设备\nlsusb\n查看USB接口连接的设备\nlsmod\n查看已加载模块\n* /lib/modules/uname -r 目录下为所有可用模块\nmodprobe \u0026lt;模块名称\u0026gt;\n简明VIM教程 VIM简介 我们使用的大多数编辑器，都可以直接在编辑区输入字符，并且能够通过一些快捷键来完成一些控制功能，比如使用方向键移动光标，使用\nBackSpack 或者 Delete 键删除文字，使用 PgUp 和 PgDn 翻页，使用 Home 和 End 来定位行首和行末……\n而Vim是一个带模式的编辑器，同样的按键，在不同模式下，具有不同的功能定义。例如 h j k l 在 编辑模式 下输入相应的字符，在 普通模式 下却相当于方向键的作用。\n由于需要切换模式，Vim的使用起来略显繁琐。不过优点也显而易见：您只要把手安安稳稳的放在打字区就可以了，而不需要使用诸如方向键、排版键、小键盘等\n需要挪开双手的键位，从而提高了您的效率和专注程度。事实上，Vim的前身Vi诞生的时候，键盘上还没有方向键、排版键和小键盘：）\n命令 使用Vim编辑文件:\nvi [文件名] vim [文件名] 教学模式:\nvimtutor [语言] vim教程，相当于使用Vim编辑器以只读模式打开教程文件。您无论对这个文件作了什么，都会在退出后恢复原来的样貌。与只读模式的区别在于，它不会没有眼色的提醒您，现在的状态为只读模式。您可以使用它作一些练习\n您可以指定教程文件的语言，如果使用本地语言(ZH_cn)出现乱码，您可以尝试使用英语\nvimtutor en 使用Vim比较文件区别 vimdiff [文件1] [文件2] [其它文件]…… 配置文件 Vim的全局配置文件为 /etc/vim/vimrc ，用户配置文件为 ~/.vimrc ， \u0026quot; 起始的行为注释行。我们提供的配置项，您直接加入配置文件就可以了\n您可以先对Vim进行一些简单的配置：\n\u0026#34;设定文件编码 set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936 \u0026#34;开启语法加亮 syntax on \u0026#34;配色风格 colorscheme pablo \u0026#34;设定行距 GUI界面中生效 set linespace=4 \u0026#34;设定GUI选项 \u0026#34;set guioptions=gmrLtT m:菜单 T:工具栏 set guioptions=gmrLt \u0026#34;设定Tab键缩进的空格数 set tabstop=4 \u0026#34;设定编辑器将多少空格视为一个缩进 set shiftwidth=4 \u0026#34;将缩进转换为空格 \u0026#34;set expandtab \u0026#34;设定折叠方式 \u0026#34;set foldmethod=indent \u0026#34;以下字符将被视为单词的一部分 (ASCII)： \u0026#34;set iskeyword+=33-47,58-64,91-96,123-128 模式介绍 Vim常见的模式有： 普通模式 、 插入模式 、 命令模式 ，另外我们也会经常用到 可视模式 。\nVim启动时进入 普通模式 ；或者在其它模式下，按下 Esc 键，便可以回到普通模式。\n使用 vimtutor en 命令进入教程，现在是普通模式。随便按几下 j 、 k 、 l 、 h 键，您会发现光标的位置发生改变。\n按下 i 键，编辑器底部出现了 \u0026ndash; 插入 \u0026ndash; 或者 \u0026ndash; insert \u0026ndash; ，您进入了插入模式。随便按几下 j 、 k 、 l、 h，您会发现相应的字符出现在编辑区，现在还可以通过方向键来移动光标。可能您觉得使用方向键移动光标不是什么问题，但是习惯了Vim后，您会认为方向键太麻烦了，简直不能容忍！好了，现在按下 Esc 键回到普通模式，我们又可以使用 j 、 k 、 l 、 h 来移动光标了。\n在普通模式下，按下 : 键（也就是 Shift+; ），在编辑器底部出现了一个 : ，您进入了命令模式。在 : 后输入一个命令 new ，回车后，编辑器被分割为上下两栏。为了方便起见，我们在命令前加一个 : 来表示命令模式下输入的命令，像这样\n:vnew 一个命令能够以一些规则简化，上面的命令也可以写为这种形式\n:vne 现在您的编辑区一定弄的四分五裂，您可以使用命令:quit来关闭当前栏，直接用简写就可以了\n:q 这个命令是退出编辑器，如果编辑区被分成多栏，则是退出当前栏。\n执行完一个命令（按下回车后），编辑器会自动回到普通模式。如果您想不执行当前命令，直接回到普通模式，您可以按下Esc键。\n按下 v 键，您进入了可视模式，可以使用 j 、 k 、 l 、 h 移动光标，高亮选取文本 。\n事实上，可视模式相当于高亮选取文本后的普通模式。\n可视模式具有子模式，以行为单位进行选取的可视行模式，使用 V 键进入（也就是 Shift+v ）；和以块为单位进行选取的可视块模式，使用 Ctrl+v 键进入。\n模式切换 好了，现在我们总结一下模式间切换的方法\n其它模式==\u0026gt;普通模式\nEsc\n普通模式==\u0026gt;插入模式\ni 在光标前插入 I 在行首插入 a 在光标后插入 A 在行末插入\no 在当前行之下新建行 O 在当前行之上新建行 r 替换当前字符 R 从当前字符开始替换\n普通模式==\u0026gt;命令模式 普通模式==\u0026gt;可视模式 v 可视模式 V 可视块模式\n\u0026lt;Ctrl+v\u0026gt; 可视块模式\n移动 在普通模式中，您可以使用以下方式移动光标\nj 向下 k 向上 l 向右 h l h 向左 j\n您可以使用其它更有效率的方式移动光标\nw 下一个单词词首 W 将特殊符号视为单词的一部分 b 上一个单词词首 B 同上\ne 单词末尾 E 同上 0 行首 ^ 行首文字（行首空格之后） $ 行末\nH 页面顶部 M 页面中部 L 页面底部\n在其它模式中，您可以使用方向键移动光标，不过我们不推荐您那样作，您可以在配置文件中绑定插入模式下的功能键\nnoremap! noremap! noremap! noremap! ………………\n\u0026lt;作用范围\u0026gt; \u0026lt;键位\u0026gt; \u0026lt;功能\u0026gt;\n其中，map!绑定的键盘映射，作用于所有模式；inoremap!绑定的映射，仅作用于插入模式。\n数字参数 您也可以使用数字参数，来重复执行。例如\n100j 执行100次j键，向下100行\n或者作为跳转的行号、百分比。见下面的浏览部分\n\u0026lt;行号\u0026gt; Ctrl+g 按行号跳转\n标记 您可以在当前光标处作一个标记，以便快速返回\nm\u0026lt;标记名称\u0026gt; 定义标记。标记名称为一个字符\n`\u0026lt;标记名称\u0026gt; 返回标记\nmx 将当前光标处定义为标记 x\n`x 返回标记 x\n浏览 \u0026lt;Ctrl+f\u0026gt; 下翻一页 \u0026lt;Ctrl+d\u0026gt; 下翻半页 \u0026lt;Ctrl+b\u0026gt; 上翻一页 \u0026lt;Ctrl+u\u0026gt; 上翻半页\ngg 文件首行 G 文件末行 \u0026lt;行号\u0026gt;G 按行号转到相应行\n\u0026lt;1~100\u0026gt;% 按百分比转到相应的行数 zz 将光标所在行调整至页面中间\n\u0026lt;Ctrl+e\u0026gt; 下卷一行 \u0026lt;Ctrl+y\u0026gt; 上卷一行\n说明：gg 定位到文件首行， V 进入可视行模式， G 定位到文件末行，实现类似“全选”的功能。依次按下 g g V(Shift+v) G(Shift+g)\n编辑 x 剪切当前字符 dd 剪切当前行 y 复制可视模式选取字符 yy 复制当前行\np 在光标后粘贴 P 在光标前粘贴 u 撤消 \u0026lt;trl+r\u0026gt; 重做\n\u0026lt;Ctrl+y\u0026gt; 逐字克隆上一行内容 \u0026lt;Ctrl+e\u0026gt; 逐字克隆下一行内容\n寄存器操作 Vim可以将不同字段剪切或复制到不同寄存器中，您可以从不同寄存器中取出内容后粘贴\n\u0026ldquo;\u0026lt;寄存器名称\u0026gt; 按下“\u0026quot;”键和另一个字符键，便可以定义一个寄存器。例如：\n\u0026ldquo;a \u0026ldquo;1\n定义寄存器后直接进行操作\n\u0026ldquo;ayy 将当前行复制到寄存器 a 中\n\u0026ldquo;ap 将寄存器 a 中的内容粘贴到光标之后\n* 通常情况下，寄存器 + ( \u0026quot; + Shift+= )对应X下的剪贴板。您在其它程序中复制的内容，可以使用 \u0026ldquo;+p 粘贴到Vim中；您在Vim中，可以使用 \u0026ldquo;+y 将内容复制到剪贴板，再粘贴到其它程序中\n* 没有指定寄存器时，Vim使用“无名寄存器”存储内容\n搜索和替换 按下 / 键，编辑器底部会出现 / 符号，接着输入字符串，便可以进行搜索\n/ 向下搜索 ? 向上搜索\nn 搜索下一个\nN 搜索上一个\n:s/\u0026lt;源字符串\u0026gt;/\u0026lt;目标字符串\u0026gt; 将源字符串替换为目标字符串\n:s/\u0026lt;源字符串\u0026gt;/\u0026lt;目标字符串\u0026gt;/g 替换当前行中所有符合条件的字符串\n:\u0026lt;行号1\u0026gt;,\u0026lt;行号2\u0026gt;s/\u0026lt;源字符串\u0026gt;/\u0026lt;目标字符串\u0026gt;/g 在指定行中进行替换\n:%s/\u0026lt;源字符串\u0026gt;/\u0026lt;目标字符串\u0026gt;/g 全文替换\n正则表达式 在搜索和替换时，可以使用正则表达式进行匹配\n宏 您可以将一系列的操作录制为一个宏，然后执行它\nq\u0026lt;宏名称\u0026gt; 开始录制宏。宏名称为一个字符\nq 录制中按下“q”键，结束录制\n@\u0026lt;宏名称\u0026gt; 执行宏\n插入模式下的快捷键\n\u0026lt;Ctrl+r\u0026gt;\u0026lt;寄存器名称\u0026gt; 输入指定寄存器内容\n\u0026lt;Ctrl+k\u0026gt;\u0026lt;2个字符\u0026gt; 输入二合字符\n\u0026lt;Ctrl+v\u0026gt;\u0026lt;数字\u0026gt; 通过数字编码输入字符\n\u0026lt;Ctrl+v\u0026gt;\u0026lt;键位\u0026gt; 输入键位的名称\n键绑定、缩写 前面我们已经向您介绍了键绑定，\nmap! 尖括号及其中的内容，为Vim配置文件的约定，分别描述了按键和功能，表示将功能编写到按键上。如果绑定的只是普通字符，例如：\nmap! xxx XXXXX\n表示将 fXXXXX 绑定到 xxx 上。当您键入 xxx 时，编辑器会自动替换为 XXXXX 。\n如果您只是想将字符串绑定为缩写，方便输入，我们建议您使用 iabbrev 来绑定。例如：\niabbrev ubt Ubuntu\n在插入模式下键入 ubt ，编辑器会自动替换为 Ubuntu 。您可以将 iabbrev 命令缩写为 iab ，例如：\niab ubt Ubuntu\n以上命令，您可以直接在命令模式下输入，临时启用。也可以写入配置文件，永久启用。\n单词补全 \u0026lt;Ctrl+n\u0026gt; 下一个匹配项\n\u0026lt;Ctrl+p\u0026gt; 上一个匹配项\n您可以在配置文件中定义补全的方式\n\u0026#34;自动补全方式：(使用逗号分隔) set complete=k,. \u0026#34; . 当前文件 \u0026#34; b 已被装缓冲区,但是没有在窗口内的文件 \u0026#34; d 在当前的文件中定义和由#include包含进来的文件 \u0026#34; i 由#include包含进来的文件 \u0026#34; k 由dictionary选项定义的文件 \u0026#34; kfile 名为{file}的文件 \u0026#34; t 标记(tags)文件 \u0026#34; u 没有载入的缓冲区 \u0026#34; w 在其他窗口中的文件 \u0026#34;设定自动补全字典 ： set dictionary=path 命令模式 前面介绍了普通模式和插入模式。我们发现，普通模式主要用来浏览和修改文本内容，而插入模式则用来向文本中添加内容。\n而命令模式则多用于操作文本文件（而不是操作文本文件的内容），例如保存文件；或者用来更改编辑器本身的状态，例如设定多栏窗口、标签或者退出编辑器……\nw(rote) 将更改写入文件\n:w q(uit) 退出编辑器:\n:q 某些情况下，编辑器会阻止命令的执行。例如您修改了文件，而没有保存，那么您使用 :q 命令退出时，编辑器就不会执行这条命令，而是提醒您保存文件。\n这个时候，您可以在命令末尾追加 ! 来强制执行命令\n:\u0026lt;命令\u0026gt;! 例如 :q! ，即便您没有保存已修改的文件，使用此命令，编辑器也会放弃修改而强行退出\n以 ! 引导一个Shell命令，则可以从Vim临时切换到Shell中，执行一个Shell\n:!\u0026lt;命令\u0026gt; 例如 :!ls\n多栏窗口 您可以使用以下命令，将当前窗口水平分为两栏\n:new 新建一栏空白窗口\n:split 将当前文件分两栏显示\n同理，您可以使用下列命令，将当前窗口垂直分为两栏\n:vnew :vsplit 先按下 \u0026lt;ctrl+w\u0026gt; 键，再按下方向键 j 、 k 、 l 、 h ，您可以切换到其它栏；在当前栏中使用 :q 命令，可以退出当前栏，也可以使用其它命令，对当前栏作出修改\n如果您希望当前命令在所有栏中生效，您可以在命令的末尾追加 all\n:\u0026lt;命令\u0026gt;all 例如：\n:qall 如果您希望这条命令强制执行，那么 ! 位于命令的最末\n:\u0026lt;命令\u0026gt;all! 例如：\n:qall! 强行退出所有栏窗口 标签页 Vim在7以后的版本，开始支持标签页的功能\n:tabnew 新建一个标签 :tabnext 转到下一个标签 :tabprevious 转到上一个标签 多数情况下，您可以使用鼠标点击标签进行切换。\n引导管理器Grub 硬件基础 一块硬盘，它起始的一部分扇区为主引导扇区，包括MBR（主引导纪录）和DPT（分区表，您可以阅读分区概念章节中相关内容）\n每个分区起始的一部分扇区，为分区引导扇区。\n在分区引导扇区之后的部分，为文件系统的索引，文件系统通过它定位文件在硬盘上的位置。不同的文件系统采用不同的索引，例如FAT文件系统使用文件分配表和目录区。\n绝大多数操作系统，对硬盘的读写操作，通过文件系统来完成，因此引导扇区中的内容，我们不能够在文件系统中进行操作，而需要专用软件，比如引导管理器。\n我们对文件进行修改后，操作系统会将文件系统索引中的内容同步。\n系统引导流程 1.系统启动时，首先引导至MBR，将控制权移交安装在MBR中的引导管理器\n（Windows使用NTLDR，Linux通常用Grub）\n2.引导管理器读取分区表\n3.引导管理器读取分区中的配置文件，并按配置文件中预设的参数运行\n例如，Grub读取“/boot/grub/menu.lst”文件中内容，将可引导系统通过菜单显示\n4.引导管理器根据您的选择，可能会有如下活动\n加载内核，启动Linux系统检查活动分区，并引导它（单一Windows系统）读取相应分区的引导扇区，将控制权移交该扇区中的引导管理器，Ubuntu系统在安装Grub时，会提问您安装在MBR或者分区引导扇区中。如果将Grub安装在分区引导纪录中，您必须确保MBR中的引导管理器能够正确的引导至分区引导扇区。\n如果您在MBR中使用的是Windows的引导管理器NTLDR，完成这件工作会非常困难，因而我们推荐您使用Grub。\nGrub介绍 Grub主要有以下功能：\n菜单式选择 命令行模式 支持开机画面 支持大硬盘 其它的功能还有很多，就不一一介绍了。\n您可以运行命令 grub 启动它。会显示一些版本信息和使用提示，当然还有命令提示符，如下：\nGNU GRUB version 0.97 (640K lower / 3072K upper memory) [ Minimal BASH-like line editing is supported. For the first word, TAB lists possible command completions. Anywhere else TAB lists the possible completions of a device/filename. ] grub\u0026gt; 您可以使用 TAB 键补全命令和路径，这非常重要，因为Grub中路径表示方式与操作系统是不同的，您可能比较陌生，所以尽量用TAB补全它，既方便，也不容易出错。\n您可以在 grub\u0026gt; 提示符后按 TAB 键，会将所有可用的命令显示出来。\n呵呵，是不是有点晕，命令可真不少啊！！！\n其实我们会用到的命令只有两个，\nroot\nsetup\nGrub术语 在分区概念章节里，我们已经介绍了Linux系统中表示分区的方法 /dev/hda5\n/dev/hdMN M为a起始的小写字母，表示硬盘序号；N为1起始的数字，表示分区序号\nGrub中使用的表示方法为 hd0,1\nhdX,Y X为0起始的数字，表示硬盘序号；Y为0起始的数字，表示分区序号\n您得留意它们之间的区别：\nN从1开始计数，X和Y从0开始计数\nN为1~4，它是一个主分区；N为5或大于5，它是第(N-4)个逻辑分区。Y按分区在硬盘上排列的顺序排列，无论它表示的是主分区还是逻辑分区。\n举例来说：\n主 主 逻 逻 主\n/dev/hdMN hda1 hda2 hda5 hda6 hda3\nhdX,Y hd0,0 hd0,1 hd0,2 hd0,3 hd0,4\n现在我们来看 root 和 setup 命令的使用：\ngrub\u0026gt;root (hd0,1)\n这个命令将Grub的根分区定位为 “(hd0,1)”\ngrub\u0026gt;setup (hd0)\n这个命令表示将Grub安装在“(hd0)”，因为没有指定安装的分区，所以安装位置为MBR\nGrub的根分区 为Grub配置文件 /boot/grub/menu.lst 所在分区。假如您单独为 /boot 目录挂载了一个分区，那么Grub的根分区通常为您系统中 /boot 目录所在的分区。\n搞错了根分区，Grub就不能正确读取配置文件，自然不能正确引导。\n引导分区 ，Windows等系统的引导分区为它的安装分区，Linux系统的引导分区为它的 /boot 目录所在的分区\n系统根目录所在分区 ，Linux根目录 / 的挂载分区。Linux系统的分区挂载信息保存在文件系统分配表 /etc/fstab 文件中\nGrub首先读取根分区中的 /boot/grub/menu.lst\n文件，并转到引导分区，如果是Windows等系统，则将控制权移动分区引导扇区中的启动管理器。如果是Linux系统，则加载内核和设备，并根据\n/etc/fstab 文件的内容挂载文件系统。\n看这个例子：（假设Grub安装在MBR中）\ntitle Ubuntu\nroot (hd0,0)\nkernel (hd0,1)/boot/vmlinuz-2.6.15-25-686 root=/dev/sda3 ro splash vga=0x31b\ninitrd (hd0,1)/boot/initrd.img-2.6.15-25-686\nboot\nGrub的安装位置为 (hd0)\nroot (hd0,0) ，这一行表示Grub的根分区为第一块硬盘的第一个分区 (hd0,0) ，它读取该分区中的配置文件 grub/menu.lst\nkernel 和 initrd 行中的 (hd0,1) ，表示当前系统的 /boot 目录挂载到第一块硬盘的第二个分区 (hd0,1)\nkernel 行的 root=/dev/sda3 ，表示当前系统的 / 目录挂载到第一块硬盘的第三个分区 (hd0,2) ，内核根据该分区中的 /etc/fstab 文件来挂载文件系统\nGrub配置文件 /boot/grub/menu.lst 文件，主要由一些下面这样的块构成的\ntitle Ubuntu root (hd0,2) kernel (hd0,2)/boot/vmlinuz-2.6.15-25-686 root=/dev/sda3 ro splash vga=0x31b initrd (hd0,2)/boot/initrd.img-2.6.15-25-686 boot title Windows xp root (hd0,0) makeactive chainloader +1 每一块代表一个操作系统，包含下面里几个部分\ntitle xxx 标题，title和分隔符后的内容为Grub菜单中显示的条目\nroot (hdX,Y) 引导分区，可以留空，默认为 grub/menu.lst 所在分区（根分区），可以使用 grub\u0026gt;root (hdX,Y) 命令设置，或者在您安装系统时自动设置\n如果您计划引导至分区引导扇区，如Windows或者Unix系统（Unix和Linux系统，您需要选择将引导管理器安装到分区中），那么需要这样配置\nmakeactive 设置活动分区，系统默认设置，可以删除\nchainloader +1 链式引导，不要动它。\n如果以这种方式引导系统，上面 root (hdX,Y) 这一行通常需要配置， (hdX,Y) 为您的系统所在的分区。假如您的Windows在第一块硬盘的第一个分区，则这样写 root (hd0,0)\n如果您引导的是Linux系统（没有在分区中安装引导管理器，而是安装到MBR），则需要这样配置\nkernel (hd0,2)/boot/vmlinuz-2.6.15-25-686 root=/dev/sda2 ro splash vga=0x31b\ninitrd (hd0,2)/boot/initrd.img-2.6.15-25-686 设备镜像文件，与上一行保持一致\nboot 不要动它\nkernel 这一行最关键，它控制系统内核的加载。行末以 ro 起始的部分为参数（ro只读，splash显示启动画面，vga设定启动屏幕分辨率）\n之前的部分可以写为这种形式：\nkernel (hdX,Y)/boot/vmlinuz root=/dev/sdMN\n(hdX,Y) 通常不是必须的，如果您安装了多个Linux系统，或者 /boot目录与根目录 / 不在一个分区，则应把它写为 /boot 目录所在分区。而后面的 root=/dev/sdMN 为系统根目录 / 所在的分区。\ninitrd 这一行的 (hdX,Y) 与上一行保持一致。\nGrub安装 上面已经向您介绍了Grub的安装，不过更多的侧重理论。现在我们来实践一下，假设您的系统不能引导，您可以尝试下面的方法：）\n找一张Ubuntu的LiveCD （Knoppix也是不错的选择） 也可以使用安装光盘，启动后在 boot 提示符后输入 linux rescue ，回车进入救援模式。 如果您拥有root权限，命令行提示符为 # ，如果是普通用户，则为 $ 。 在救援模式下，通常你已经具有了root权限\n如果是LiveCD且没有root权限，请在终端中输入 su命令切换到root，会提问你root的密码。如果不知道root密码，可以使用这个命令 sudo su，只要你知道自己的密码，并且你在ID在sudoer列表中就可以了。\n在终端中输入 grub ，会进入到Grub的提示符界面 a. 输入命令 root (hd 后按 Tab 键，屏幕上就会列出所有可用选项。比如我的是这样的：\nPossible disks are: hd0 hd1 这表示我装了两块硬盘，如果你只有一块硬盘的话，那么一定是hd0。\n在 root(hd 后输入 0 ,按 Tab ，会自动补上一个 , ，现在你输入的内容成为这样：\nroot(hd0,\n再按 Tab 键，会列出所有可用选项，我的是这样的。\nPossible partitions are: Partition num: 0, Filesystem type unknown, partition type 0x7 Partition num: 1, Filesystem type is fat, partition type 0xc Partition num: 2, Filesystem type is reiserfs, partition type 0x83 Partition num: 4, Filesystem type is reiserfs, partition type 0x83 Partition num: 5, Filesystem type unknown, partition type 0x82 Partition num: 6, Filesystem type unknown, partition type 0x7 Partition num: 7, Filesystem type is fat, partition type 0xc 输入你的选择，比如为 1 ， Tab 一次后，结果是这样的：\nroot (hd1,1)\n现在回车\n输入命令\nsetup (hd0)\n将grub安装在mbr中\n最后，quit 命令退出GRUB\nGrub使用 命令行\n在Grub启动菜单中，您可以选择您要的选项，按下 e 键，进入到命令行模式\n修改您的启动参数，完成后回车\n按 b 键，Grub将以您修改后的参数引导系统。\n其它 在Grub启动菜单中，按下 c 进入命令行模式\n按下 d 删除当前选中的项\nFAQ 我的D盘到哪里去了？ 在使用Linux最初的几天里，我感到有些不安。\nWindows下，我可以把系统装在C盘，软件放在D盘，音乐放在E盘……如果系统出现问题，我只要重装系统就可以了，大部分软件都可以直接使用（养成使\n用绿色软件是一种好习惯：），而我辛辛苦苦收集起来的电影和音乐，我总是把它们放在一个安全的地方，以免引发失眠的严重后果。\n其实Linux下硬盘也具有分区的概念，这一点和Windows没有什么不同（分区的概念是由硬盘的物理特性产生的，而不是操作系统）。不同的是，Linux可以将分区挂载到任意的目录下，而不像Windows，您的分区只能够在“我的电脑”里面：）\n那么这么作有什么好处么？\n我们来看看Linux和Windows下路径的表示方法：\nWindows C:\\Documents and Settings\\Users\\Documents\\MyDocument Linux /home/User/MyDocument 您一定注意到了，在Windows下面，路径中含有盘符“C:”，它通常代表您硬盘上的第一个分区。也就是说，在使用这些文件时，您需要知道它们在硬盘上\n存储的相关物理细节。而在Linux下，您不需要知道这些，或者说，只要您设定好了分区挂载的目录，您就不需要再去理会什么分区。\nWindows下的路径包含有分区、目录和文件三部分内容;而Linux下的路径则只有目录和文件，不包含任何分区信息，它的硬件抽象度更高！\nLinux下的目录用“/”表示，这不标准吧？？\n完全相反，这才是标准的体现。您只是习惯了Windows的目录符号，但是那并不意味着它是标准的。\n看看Winodws下，各种位置、路径的表示方法：\nhttp://www.ubuntu.org.cn\nftp://192.168.0.1\nc:\\Windows\\\nfile:///C:/Windows/\n\\127.0.0.1$C\n操作系统是一种非常精密的高科技产品，怎么可能如此混乱！！！他们是怎么作到的？？？ Linux下的病毒少，是因为Linux的使用者少，骇客显然不愿意浪费气力去攻击没有人使用的操作系统。\n您可能已经知道了，互联网上用作重要用途的服务器，其中很大一部分是Linux系统，另外的一部分是Unix系统：）如果骇客能够搞掉Linux系统的话，那么整个互联网就会陷于瘫痪！效果似乎更好一些。\n当然了，您一定会想：骇客也是人，他们也喜欢上网，兔子还不吃窝边草呢……兔子那么笨，连乌龟都跑不过……骇客们可比兔子要聪明的多了！\n是的，我承认这一点……不过他们也不一定非得把互联网干掉。很多骇客作梦都想入侵美国军方的服务器，美军服务器中的绝密数据，只要1kb，应该就可以买一台顶级的个人电脑了：）\n如果可以的话，骇客为什么不去入侵美军的服务器，而要入侵您的电脑呢？\n这是一个很有意思的观点，与之相映成趣，另一种论调也使人侧目：Windows服务器占到了服务器操作系统xx%的份额。\n或许这个现象可以用80：20法则来解释：）\n占服务器总数80%的Windows提供了服务总量的20%！\n请您务必注意，这只是举一个例子，Windows服务器可能永远也不会占到服务器总数的80%！它提供的服务，以我个人的角度，我不认为可以达到20%，而且永远不会有那一天。\n软件安装繁琐 或许您已经看过一些关于Linux软件安装的文章，但是您也不要忽略，此类文章的数量，是不能够和同类Windows文章相比的。\n当然，使用源码包安装软件确实有点麻烦，但却不一定比Windows下的某些软件复杂。特别要提到，Ubuntu的包管理系统，为您提供了一种高效快捷的\n软件管理方式，您只要知道您需要什么软件就可以了，甚至不需要关心它存放在网络上的哪一台服务器中，而且绝大多数的软件都可以使用这种方式来安装。\n详情请参阅 APT\n如果您有如下需求，您也可以尝试以源码的形式安装软件：\n您需要某些软件的技术预览版本\n您想测试您的机器的运算能力\n您找不到一种比安装软件更好的方式来消磨时间 | （试图通过编译源码安装来大幅提高系统性能，其结果很可能会让您失望）\n源码保密性不强，存在安全隐患 既然Linux下软件都开放源代码，那么会不会造成一些安全隐患呢？比如说一名骇客会发现其中的漏洞，并利用它？\n事实刚好相反，一个软件，即便它不开放源码，骇客一样可以找到其中的漏洞，雷蒙德的软件巨头就是最好的佐证。就像一把锁，无论如何坚固，它总是能被撬开！它的作用无外乎“聊备一格，以防君子”：）\n而这把锁，防住的恰恰是能够改进它的工程师！工程师知道了它的漏洞，却不能够去改进它;骇客知道了它的漏洞，却可以利用它……这把锁正是封闭源码！\n这岂不是不妙？\n软件功能不够强 虽然您很愿意使用Linux系统，但是它的软件并不能使您满意，甚至使您多愁善感的心灵又蒙上了一层阴影，“长太息以掩涕……”\n首先您别忘了，《泰坦尼克》的特效就是在Linux系统下完成的，连业界巨头SGI都在向Linux迁移（尽管SGI的IRIX本来就是一种Unix系统）。如果您不知道SoftImage，那么Maya您总听说过吧？它最初就是多平台的。\n对于电影特效处理时需要的高吞吐量的数据（以TB计）和运算能力，Windows系统恐怕连崩溃的机会都没有=_=#(最新统计资料显示，Top500计算机中，使用Linux的占到73.4%，包括最快的前两名。其中Linux系统367部，Unix系统98部，混合操作系统24部，AppleMacOS系统5部,BSD系统4部，Windows系统，2部）类似于大气模拟、基因解码等等真正的科学运算……Windows……前几天我还在verycd.com上看到一套欧洲某天文台的天文学软件，只有Linux版！\n当然了，Linux下功能强大的软件大多是命令行的，图形界面的程序只能视觉上强大，外强中干！建议您多使用man这个命令来查询各类软件的使用方法，它排版美观，格式工整，语法简明，意韵流畅，实在是学习英语难得的教材。\n界面不友好 如果您指的是系统的美观程度。Gnome默认效果我认为与Windows处于同一水平线，而KDE的效果就要略好一点，很多高手用FVWM可以作出让人眼花瞭乱的效果来……而Novell的XGL，更是可以用“惊艳”来形容。\n如果您指的是操作，这属于“易于上手难于精通”与“难于上手易于精通”两种理念的冲撞。\n当然了，我指的精通主要针对效率而言。如果您经常玩Blizzard出品的游戏，您对于“易于上手难于精通”这种理念或许相当了解，甚至非常欣赏。\n不过这一理念只适用于竞技游戏！竞技游戏要球能够吸引大量的玩家，所以要易于上手。但是竞技游戏是为竞技而生的，所以不可能人人是高手 ────事实上高手只是一小部分人！\n而操作系统是给人们来用的，最好人人都成为高手，所以易于精通是很重要的……当然最好也能够易于上手。但是考虑到效率的问题，这很难解决……\nLinux怎么占用这么多内存？ Linux会最大程度的利用物理内存，避免使用交换空间;而不是尽量的回收内存，使用页面文件。\n又因为Linux系统的内存管理非常优秀，程序退出时可以高效的回收内存，所以更加没有必要在程序运行时就回收内存！\n因此，Linux系统表面看来内存开销很大，实际上系统运行是很稳定的──Linux不会时而流畅，时而瘫痪。事实上，在正常情况下，它运行是非常流畅的。\n","permalink":"/post/c5-linux/linux/ubuntu-tour/","summary":"\u003cblockquote\u003e\n\u003cp\u003eref:\u003ca href=\"http://www.cnblogs.com/dutlei/archive/2012/11/20/2778327.html\"\u003eUbuntu完全教程，让你成为Ubuntu高手！\u003c/a\u003e\ntodo整理\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"ubuntu的发音\"\u003eUbuntu的发音\u003c/h2\u003e\n\u003cp\u003eUbuntu，源于非洲祖鲁人和科萨人的语言，发作 oo-boon-too 的音。了解发音是有意义的，您不是第一个为此困惑的人，当然，也不会是最后一个：）\u003c/p\u003e\n\u003cp\u003e大多数的美国人读 ubuntu 时，将 u 作为元音发音，类似单词 who 或者 boo ，重音在第二个音节即 u\u0026rsquo;buntu ，oo-boon-too 。\u003c/p\u003e\n\u003cp\u003e如果您喜欢撒哈拉，喜欢它令人窒息的温柔、梦幻般的寂寥还有张扬恣肆的旷远，您大可在第一个 u，后面带些嗡嗡声： oom-boon-too。\u003c/p\u003e\n\u003cp\u003eUbuntu的中文发音大约为： 乌班图\u003c/p\u003e\n\u003ch3 id=\"ubuntu的涵义\"\u003eUbuntu的涵义\u003c/h3\u003e\n\u003cp\u003eUbuntu这个单词源自非洲，意谓“班图精神”────谁都不是一座孤岛，自成一体。每个人都包孕于人类，因他人存在而存在，因他人幸福而幸福。\u003c/p\u003e\n\u003ch3 id=\"ubuntu当前版本\"\u003eUbuntu当前版本\u003c/h3\u003e\n\u003cp\u003eUbuntu Linux v6.06 LTS (Dapper Drake)\u003c/p\u003e\n\u003cp\u003eLTS：Long Term Support\u003c/p\u003e\n\u003cp\u003eDapper Drake：当前版本的开发代号\u003c/p\u003e\n\u003ch3 id=\"ubuntu的特点\"\u003eUbuntu的特点\u003c/h3\u003e\n\u003cp\u003eUbuntu 完全基于 Linux 操作系统， 可以免费得到社区及专业机构的支持。庞大的社区是它成长的沃土，请向这片动人的热忱敞开心扉。\u003c/p\u003e\n\u003cp\u003eUbuntu 社区恪守 Ubuntu 理念：自由！软件应是自由的，应尊重人类的自由意志，它与人类之间不应有任何隔膜。本地语种，功能限制，自主改进的权利……都不应成为使用的障碍或负担。\u003c/p\u003e\n\u003cp\u003e自由，让 Ubuntu 与传统的私有软件从根本上不同: 免费不能用来遮羞，您有权修正它，直到满意为止。\u003c/p\u003e\n\u003cp\u003eUbuntu 适合桌面和服务器。当前 Ubuntu 发布版支持 PC (Intel x86), 64-bit PC (AMD64) 和 PowerPC (Apple iBook 和 Powerbook, G4 和 G5) 架构。\u003c/p\u003e","tags":["ubuntu","技巧","转载"],"title":"「转」Ubuntu完全教程"},{"categories":["网络"],"content":" 文章来源：\n鲜枣课堂（ID：xzclasscom） 原文\n19 世纪中叶，电报业务在欧洲大陆逐渐开始普及。\n1853 年，北欧小国瑞典动用 “海盗基金”（不是海盗的钱，是政府用来打海盗的钱），架设了自己的第一条电报线路，从首都斯德哥尔摩到乌普萨拉。\n为了确保负责这条线路的正常运营，瑞典政府还成立了自己的第一家电报公司，名字叫 Televerket。\n当时，Televerket 公司急需大量的电报硬件设备。于是，乌普萨拉电报局的局长，安东 · 亨里克 · 奥勒（Anton Henric Öller），决定创办一家公司，为 Televerket 生产、修理和改进电报机。\n不久后，这家电气设备维修公司正式成立，名字叫奥勒公司（Öller \u0026amp; Co）。\n安东 · 亨里克 · 奥勒，瑞典电信业的先驱 奥勒公司名义上是一家公司，但实际上就是一个手工作坊，规模很小，只能靠 Televerket 公司的资助才能维持生存。\n在奥勒公司的员工中，有一个勤奋的小伙子，当时专门负责维修电报设备以及其它机械设备。他的名字，叫做拉什 · 玛格纳斯 · 爱立信（Lars Magnus Ericsson）。\n拉什 · 玛格纳斯 · 爱立信 拉什 · 爱立信 1846 年 5 月 5 日出生于瑞典中部瓦姆兰省的一个小农场里。他的家庭条件贫困，自己在 9 个兄弟姐妹中排行第六。\n11 岁时，由于父亲病逝，他不得不外出工作，养家糊口。这期间，他当过矿工，修过铁路，还在铁匠铺做了很长时间的学徒。\n1867 年，拉什 · 爱立信终于攒够了路费，来到他梦寐以求的瑞典首都——斯德哥尔摩。经过一周的试用后，他成功加入了奥勒公司，成为一名修理工。\n尽管这份工作的工资微薄，拉什 · 爱立信仍然感到十分满足。他后来回忆说：“（这份工作）足以满足我的需求，让我庆幸地看到生活比以往任何时候都更加光明，我心中第一次感受到了生活的快乐。”\n工作之余，拉什 · 爱立信努力学习数学、材料技术、工程制图，以及德语和英语。在公司老板奥勒先生的推荐下，1873 年和 1875 年，拉什 · 爱立信先后两次获得瑞典政府的官方资助，前往德国和瑞士进行游学和实习。\n这期间，拉什 · 爱立信来到了德国柏林的西门子公司（Siemens \u0026amp; Halske），学到了很多电报工程技术知识，也接触到一些先进的机床设备。\n拉什 · 爱立信在西门子公司时绘制的图纸，相当精妙 游学结束之后，拉什 · 爱立信返回瑞典。此时的他，已经具备了非常丰富的专业知识，有能力开创属于自己的事业。\n1876 年 4 月，拉什 · 爱立信拒绝了奥勒公司升职加薪的提议，在斯德哥尔摩皇后街 15 号一个普通建筑的小厨房里，创建了 L.M.Ericsson 公司。\n爱立信公司最初的商标 MEK.WERKSTAD 的意思是 “机械作坊” STOCKHOLM 就是瑞典首都 “斯德哥尔摩” 当时的 L.M.Ericsson 公司，其实就是一个作坊修理铺。启动资金 1000 克朗，是借来的。小厨房不到 13 平方米，是租来的。仅有的一套工作设备，是一架脚踏式机床。\n公司的全部员工，除了拉什 · 爱立信本人之外，只有一名临时雇佣的 12 岁男孩。\n不久后，拉什 · 爱立信在奥勒公司的前同事卡尔 · 乔汗 · 安德森（Carl Johan Andersson）加入了他的新公司，成为合伙人。\n公司创立之后，主要业务是维修各种机械设备、电报机以及电器仪表。他们接到的第一单生意，是维修用于火警的一只机械指示器，收费 2 克朗。\n没过多久，拉什 · 爱立信凭借自己的才华和经验，制造出了一些不错的产品，例如用于铁路系统的拨号电报仪器，以及小型社区的防火电报系统。\n这些产品，逐渐赢得了铁路、消防等部门用户的认可，带来了源源不断的订单。\n█ 涉足电话业务，规模迅速扩张 爱立信公司成立的同一年（1876 年），美国的亚历山大 · 贝尔申请并获得了电话的发明专利，从而将人类带入了电话时代。\n1877 年，电话被引入瑞典。拉什 · 爱立信第一时间去买了一对，并进行了拆解研究。\n后来，很多用户将损坏的电话机送到拉什 · 爱立信这里维修，使得他对电话机内部结构有了更深入的了解。\n凭借敏锐的商业嗅觉，拉什 · 爱立信意识到电话背后的巨大商机。于是，他决定研制自己的电话机型号。\n1878 年底，拉什 · 爱立信在妻子希尔达 · 爱立信（Hilda Ericsson）的帮助下，成功研制出第一台电话机产品。这款产品性能出色，价格远低于对手，受到了用户的欢迎。\n拉什 · 爱立信的妻子（左），对他帮助极大 后来，拉什 · 爱立信又推出了自己的墙式电话机，再次获得畅销。\n爱立信的墙式电话机 1880 年，拉什 · 爱立信和他的公司迎来了一次重大的机遇。\n当时，美国贝尔公司在斯德哥尔摩、哥德堡、马尔默、松兹瓦尔和索德港建造了一个电话网络。如果任由贝尔公司发展下去，他们将垄断整个瑞典的电话市场。\n于是，拉什 · 爱立信决定与贝尔公司进行正面竞争。不久后，L.M.Ericsson 公司成功击败对手，先后中标了耶夫勒市和挪威卑尔根市的本地电话系统合同。\n拉什 · 爱立信的胜利，极大地增强了瑞典人民的信心。事实证明，瑞典的工艺和技术，完全可以与世界最领先的公司相媲美。\n1883 年，拉什 · 爱立信遇到了自己创业早期最重要的合作伙伴兼客户，亨里克 · 托勒 · 塞德格伦（Henrik Thore Cedergren）。\n亨里克 · 托勒 · 塞德格伦 亨里克 · 塞德格伦原本是一个珠宝商人。作为瑞典最早的电话机用户之一，他非常看好电话的发展潜力。但是，他认为贝尔公司的收费太过昂贵，阻碍了电话业务的普及。\n于是，1883 年 2 月，他成立了一家名为 Stockholms Allmänna Telefonaktiebolag（斯德哥尔摩公共电话公司，以下简称 SAT 公司）的独立瑞典电话公司，旨在为公众提供廉价的电话连接服务。\n起初，拉什 · 爱立信并不看好亨里克 · 塞德格伦和他的公司，因为他们完全没有电话网络方面的经验。后来，亨里克 · 塞德格伦凭借自己的热情，打动了拉什 · 爱立信，说服他支持自己的事业。\n1883 年，L.M.Ericsson 公司和 SAT 公司就电话供应签订了一项供货合同，全面负责 SAT 的电话及相关设备。那一年，L.M.Ericsson 公司完成了 SAT 订购的 1000 部电话机和 22 套电话交换设备的交付。\n此后，L.M.Ericsson 公司进入了发展的快车道。\n1884 年，公司建造完成了自己的第一家大规模工厂。1885 年，生产了第一部手持送受话筒。1887 年，签订了当时的最大的合同，为 SAT 在斯德哥尔摩开办的电话局提供设备。这个电话局，是当时欧洲最大的电话局。\n当时的 SAT 公司电话塔 1890 年，L.M.Ericsson 公司的员工人数上升到 153 人。1896 年，L.M.Ericsson 公司改制为有限责任公司，股份资本为 100 万克朗。这一年的 6 月 1 日，爱立信公司累计生产电话超过十万部。\n此后的爱立信，开始全面开拓海外市场。\n1897 年，爱立信在俄罗斯圣彼得堡开办工厂，组装电话机。1902 年，爱立信在纽约开设办事处。1903 年，爱立信与英国国家电话公司联合组建英国爱立信制造有限公司。\n后来，爱立信陆续进入了挪威、丹麦、芬兰、澳大利亚、新西兰、南非、墨西哥、法国、匈牙利、奥地利等国家，成为一家全球性的电信设备公司。\n1900 年，正当爱立信公司高速发展的时候，创始人拉什 · 爱立信决定辞去总经理职务。次年，他又辞任董事长，并逐步出售他持有的爱立信公司的股票（1905 年全部卖完）。\n拉什 · 爱立信 1926 年 12 月 17 日，拉什 · 爱立信逝世，安葬在距离斯德哥尔摩不远的博基尔卡。按照他的遗嘱，墓地没有立石碑。\n1946 年，拉什 · 爱立信百年诞辰之际，他的家乡为他立了一座石碑，上面刻着——“瑞典电话工业见证了他的成就”。\n█ 遭遇股权危机，险些沦落敌手 1914 年，第一次世界大战爆发，爱立信的海外市场受到重创。\n瑞典地处波罗的海，战争导致出海口被封，爱立信的设备根本运不出去。 1917 年，俄国十月革命爆发，新成立的布尔什维克政府将爱立信在俄国的工厂和业务全部国有化，夺取了价值约 2000 万瑞典克朗的资产，使得爱立信公司雪上加霜。\n被夺走的工厂，后来被改名为 “红色黎明” 1918 年，为了度过经营危机，L.M.Ericsson 与 SAT 公司正式合并，成为 Allmänna Telefonaktiebolaget LM Ericsson 公司。\n合并之后的新公司，得到了瑞典政府支付的约 5000 万克朗电话网络运营费用，大大缓解了经营压力。\n不久后，新公司迎来了一个更大的危机，关于控制权的危机。\n当时的情况是这样的：1909 年，SAT 公司创始人亨里克 · 塞德格伦去世时，将公司所有权转移给了一个基金会和他的家人。后来，SAT 公司与 L.M.Ericsson 公司合并，基金会和亨里克 · 塞德格伦的家人继而拥有了新公司的大部分控制权。\n再后来，一战期间的巨额经营亏损，使得他们面临巨大的经济压力，于是，他们将爱立信公司的股权卖给了卡尔 · 弗雷德里克 · 温克兰茨（Karl Henrik Wincrantz）。\n温克兰茨是谁？温克兰茨原本是 SAT 公司旗下斯德哥尔摩电信的总裁，1925 年，他被任命为爱立信公司的总裁。\n为了巩固自己的权力，温克兰茨一直在努力增加自己的持股比例。\n1928 年，在温克兰茨的推动下，爱立信公司开始发行 “A” 和“B”股。其中，“B”股只有 “A” 股千分之一的投票权。\n温克兰茨希望通过持有少数 “A” 股来控制公司。同时，他主导发行了大量的 “B” 股，筹措公司发展所需的资金。这一时期，公司更名为 Telefon AB LM Ericsson。\n温克兰茨增持股票肯定需要资金，但自己并没有这么多资金。于是，他找到了国际金融家伊瓦尔 · 克鲁格（Ivar Kreuger）。\n伊瓦尔 · 克鲁格 伊瓦尔 · 克鲁格帮助温克兰茨控制了爱立信公司。后来，克鲁格与温克兰茨闹翻，干脆赶走了温克兰茨，委任了自己的亲信担任爱立信公司的总裁。\n克鲁格是一个做火柴生意起家的商人，非常精明，也非常不靠谱。为了从资本市场骗取资金，他长期谎报自己的资产规模和旗下企业的盈利能力。\n1931 年，经济大萧条愈演愈烈，克鲁格资金断链。为了偿还债务，他找到了 ITT 的主席，索申尼斯 · 奔尼（Sosthenes Behn），把自己的爱立信股票以 1100 万美元的价格出售给 ITT。\nITT 是什么公司？美国国际电话电报公司，爱立信最大的竞争对手。这一举动，相当于把爱立信的控制权拱手交给了死对头。\n1932 年 3 月，克鲁格自杀身亡。此时，ITT 拥有爱立信三分之一的股份。\n事情被揭露之后，瑞典举国哗然。自己的民族企业，竟然被对手完全控制，这是无法接受的事情。\n不过好在瑞典法律规定，禁止外国利益在瑞典公司中行使多数表决权，导致 ITT 公司没有办法完全控制爱立信公司。\n后来，瑞典三大银行——斯堪的纳维亚银行、斯德哥尔摩恩斯基尔达银行和瑞典商业银行——迅速采取行动，拯救爱立信。他们与 ITT 进行谈判，逐渐增加了对爱立信公司的控股，夺回了控制权。\n当时，负责牵头拯救行动的是瓦伦堡家族的小马库斯 · 瓦伦堡（Marcus Wallenberg Jr），斯德哥尔摩恩斯基尔达银行就属于他的瓦伦堡家族。\n小马库斯 · 瓦伦堡 后来，经过数十年的漫长周旋，一直到 1960 年，小马库斯 · 瓦伦堡才完全收回了 ITT 所持有的爱立信公司股份。爱立信公司也由此彻底摆脱了伊瓦尔 · 克鲁格事件的阴影。\n█ 专注技术研发，成功反超对手 二战时期，爱立信的业务再度因为出海口问题遭受重创。它的很多国外资产都被战争摧毁，销售额也大幅下降。\n这期间，爱立信不得不临时转行，进行军工生产，为军队制造电话、飞机仪表、机枪和弹药等，维持生存。\n二战结束后，全球电话市场需求激增，爱立信公司的业务也逐渐开始复苏。\n1960 年，爱立信开始业务聚焦，砍掉了电信业务之外的无关业务，专注通信设备的研发。\n当时，爱立信启动了一种名为 AKE 的商用电子交换系统的研发。到了 60 年代末，爱立信意识到，AKE 系统已经跟不上时代，它的速度太慢而且价格过于昂贵。\n因为技术和产品的落后，爱立信在市场竞争中屡次输给自己的对手——ITT、GTE 和西门子等。\n1969 年底，爱立信在一个大额合同上再次输给了 ITT。这次失败，迫使爱立信管理层下定决心，与瑞典电报公司 Televerket 联手，共同开发有竞争力的新型产品。\n于是，1970 年 4 月，爱立信与 Televerket 正式签署协议，成立一家名为 Ellemtel Utvecklings AB 的联合研发公司。该公司的主要任务，就是开发一种先进的自动化数字电话交换系统，名为 AX 系统。\n1976 年，经过不懈努力，Ellemtel 公司成功研发出世界上首台全数字交换机——AXE 交换机。\nAXE 是爱立信历史上最重要和最成功的产品 AXE 是一个划时代的产品。它采用模块化的软硬件设计方式，易于制造和测试，也易于维修。\nAXE 设备 因为技术上非常领先，在推出的两年时间里，AXE 几乎赢得了所有主要的国际电信合同。领导 AXE 开发团队的年轻工程师 Björn Svedberg，1977 年直接被任命为公司总裁。\nAXE 成功商用后，Ellemtel 完成了自己的使命，逐步将研究成果移交给了爱立信和 Televerket。后来，Televerket 将自己的 Ellemtel 股份出售给爱立信，Ellemtel 也因此被完全整合到爱立信中。\n█ 移动通信浪潮，百年名企沉浮 20 世纪 80 年代初，爱立信的数字交换技术继续在行业保持领先。\n这一时期，因为沉迷于自己的 AXE 系统，爱立信错过了移动通信技术崛起的第一波浪潮。等到对手纷纷有所成就后，爱立信公司才反应过来，赶紧调整自身的战略方向，转战蜂窝移动通信市场。\n1981 年 9 月，爱立信在沙特阿拉伯建设完成了世界第一个投入商业运营的 NMT 网络（比瑞典自己还早了 1 个月）。\n项目签约现场 1988 年，爱立信决定继续聚焦核心业务。这一年，它以 2.17 亿美元的价格，将自己的计算机和终端业务出售给了芬兰公司诺基亚。\n与此同时，爱立信最主要的竞争对手，美国 AT\u0026amp;T 公司，因为垄断被美国政府强行拆分。爱立信从中受益，很快占据了全球 40% 的移动系统市场。\n后来，到了 2G 时代。欧洲基于 NMT 推出了 GSM，爱立信也及时地推出了自己的产品。\n爱立信的 2G GSM 原型机 这期间，爱立信保持了连续 10 年年均 35% 以上的惊人增长，成为了世界上最大的电话及蜂窝移动通信设备商之一。\n1995 年，爱立信的收入达到 76.1 亿瑞典克朗。1996 年，爱立信全球研发工程师达到 18000 名。1997 年，爱立信在世界移动市场上的份额达到 40%，拥有大约 5400 万用户。\n1998 年，斯温 · 克里斯特 · 尼尔森（Sven-Christer Nilsson）当选为爱立信公司的 CEO。\n斯温 · 克里斯特 · 尼尔森 在他的领导下，爱立信进行了重大的组织架构调整。\n他将公司业务分为三个板块，分别是网络运营商部门、消费品部门（包括手机业务）和企业解决方案部门。（是不是有点眼熟？）\n除了重组之外，尼尔森还宣布了 11000 人的裁员计划。\n1999 年，爱立信与高通公司解决了为期两年的 CDMA 技术专利官司。作为和解的一部分，爱立信收购了高通的无线基础设施业务。\n这一年，爱立信的手机业务在与诺基亚的竞争中落后，导致市场份额从 15.1% 下降到 10.5%。当时，爱立信 70% 的收入来自基础设施销售，而 21% 来自手机销售。\n1999 年 7 月，因为业务重组失败，尼尔森被迫辞职。\n进入 21 世纪，爱立信的霉运没有结束。2000 年，因为产品质量问题以及工厂发生的火灾意外，爱立信亏损 240 亿瑞典克朗。\n2001 年，爱立信宣布将其手机的生产外包给伟创力国际有限公司，自己则集中力量于手机的技术研发、设计以及市场推广。同时，爱立信大幅裁剪了消费品部门的员工人数。\n同年 10 月，爱立信与日本索尼公司分别出资 50%，组建了索尼爱立信移动通信公司，专门生产手机产品。对于这家公司，相信大家都比较熟悉。\n2002 年，在全球金融危机的持续影响下，爱立信再次遭受巨额亏损。\n面对亏损，爱立信一方面推出了降低运营成本、提高效率的 “成本控制计划”；另一方面，调整市场战略，将公司的核心业务做了全面的优化与整合，出售了一些非核心业务。\n2002 年 6 月，爱立信以 4 亿美元的价格，将自己的微电子部门卖给了英飞凌科技股份公司（当时是西门子的子公司）。\n2003 年，随着全球通信产业回暖，加上之前的一系列战略调整显露成效，爱立信宣告结束亏损，恢复盈利。\n复苏后的爱立信，在全球 3G 市场上表现突出，拥有 40% 的 3G WCDMA 市场份额，是当之无愧的全球第一设备商。\n█ 遭遇中国对手，迎来严峻挑战 爱立信与中国的历史渊源已超过百年。早在 1892 年，爱立信就接到了来自中国的订单（2000 个电话机），并为中国供货。1906 年，中国代表团还前往斯德哥尔摩，参观了爱立信总部。\n当时的会面场景 一个多世纪以来，爱立信在中国电信发展史上贡献了多个 “第一”。\n中国第一部人工交换机（1900 年）和第一部自动交换机（1924 年），就是来自爱立信。1987 年中国第一套移动电话系统在广州开通，设备也是来自爱立信。\n中国第一套移动电话系统 改革开放后，国内也引进了 AXE（1985 年照片） 爱立信一直非常重视中国市场，不仅成立了合资公司和独资公司，还在中国设立了爱立信学院和研究院。\n不过，拉什 · 爱立信当年卖电话到这个国家的时候，一定不会想到，一百多年后，这个国家会走出来两个名不见经传的小公司，把他开创的通信霸业给搅得鸡犬不宁。\n这两个小公司，当然就是华为和中兴。\n在这两家公司的挑战和冲击下，爱立信公司在 21 世纪的市场份额不断下滑，CEO 频繁更换。那些年，伴随爱立信的坏消息总是一个接着一个，不是出售业务，就是裁员。\n2013 年，华为全年销售收入正式超过爱立信，爱立信被迫将全球第一的位置拱手相让。\n2016 年，爱立信计划关闭瑞典境内的所有工厂，结束在瑞典制造产品 140 年的历史。\n2017 年，爱立信净亏损 44.76 亿美元，全年裁员达到 1.7 万人。\n█ 外部环境变化，业绩迅速复苏 2018 年之后，爱立信的形势有了明显的好转，原因包括多个方面。\n首先，就是 5G 市场增长带来的商业机会。\n爱立信非常重视 5G，投入了大量的资源进行研发。2014 年，爱立信就发布了全球首台 5G 移动终端原型。\n2016 年，爱立信发布了一款号称 “全球首个 5G NR 无线设备” 的 5G 基站——AIR 6468。\n2017 年 2 月，爱立信推出了自己的 5G 平台。2018 年 1 月，爱立信发布了首个 5G 小基站 “5G Radio Dot”，吸引了行业的广泛关注。\n5G NR DOT 点系统 除了 5G 之外，另一个帮助爱立信业绩复苏的主要原因，是微妙变化的外部环境。\n正如大家所知道的，中美贸易摩擦，美国对中国通信设备商进行强力打压，多个国家宣布 “禁用” 华为和中兴。于是，欧美国家的设备商就有了难得的市场机会。\n综合种种因素，爱立信的业绩迅速转好，扭亏为盈，股价攀升。\n2020 年，爱立信全年净销售额达到 2324 亿瑞典克朗（约合 278 亿美元），同比上涨 2%；净利润 176 亿瑞典克郎（约合 21 亿美元），相比 2019 年，翻了近十倍。\n█ 结语 爱立信，是通信行业历史最悠久的企业之一（准确来说，是 145 年的历史）。\n在很长的一段时间里，它都是世界排名第一的通信设备制造商。爱立信的很多技术创新，改变了通信行业的发展走向。很多经典的通信产品和知名的通信项目，都是出于这家企业。\n在一百年的发展过程中，爱立信有过辉煌，也有过挫折，但是它仍然屹立不倒，在世界通信第一阵营中牢牢占据自己的位置。这充分说明，这家企业有着自己的技术积累和文化底蕴，有属于自己的 “韧性”。\n如今，5G 的竞争还在继续，百年老店爱立信的奋斗之路也在继续。面对变幻莫测的市场环境，爱立信究竟会走向何方呢？它还会续写另一段百年辉煌吗？\n（全文完）\n参考文献：\n1、https://www.ericsson.com/en/about-us/history/company\n2、https://en.wikipedia.org/wiki/Ericsson\n3、《改变世界》，2009 年出版\n4、https://ethw.org/Lars_Magnus_Ericsson\n5、https://www.company-histories.com/Telefonaktiebolaget-LM-Ericsson-Company-History.html\n","permalink":"/post/c6-network/history-ericsson/","summary":"\u003cblockquote\u003e\n\u003cp\u003e文章来源：\u003cbr\u003e\n鲜枣课堂（ID：xzclasscom）\n\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MjM5NTY1MjY0MQ==\u0026amp;mid=2650814278\u0026amp;idx=1\u0026amp;sn=26083fed8d8dd76340e063fd42a59dea\"\u003e原文\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e19 世纪中叶，电报业务在欧洲大陆逐渐开始普及。\u003c/p\u003e\n\u003cp\u003e1853 年，北欧小国瑞典动用 “海盗基金”（不是海盗的钱，是政府用来打海盗的钱），架设了自己的第一条电报线路，从首都斯德哥尔摩到乌普萨拉。\u003c/p\u003e\n\u003cp\u003e为了确保负责这条线路的正常运营，瑞典政府还成立了自己的第一家电报公司，名字叫 Televerket。\u003c/p\u003e\n\u003cp\u003e当时，Televerket 公司急需大量的电报硬件设备。于是，乌普萨拉电报局的局长，\u003cstrong\u003e安东 · 亨里克 · 奥勒\u003c/strong\u003e（Anton Henric Öller），决定创办一家公司，为 Televerket 生产、修理和改进电报机。\u003c/p\u003e\n\u003cp\u003e不久后，这家电气设备维修公司正式成立，名字叫奥勒公司（Öller \u0026amp; Co）。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"640.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ccenter\u003e\u003cdiv\u003e安东 · 亨里克 · 奥勒，瑞典电信业的先驱\u003c/div\u003e\u003c/center\u003e\n\u003cp\u003e奥勒公司名义上是一家公司，但实际上就是一个手工作坊，规模很小，只能靠 Televerket 公司的资助才能维持生存。\u003c/p\u003e\n\u003cp\u003e在奥勒公司的员工中，有一个勤奋的小伙子，当时专门负责维修电报设备以及其它机械设备。他的名字，叫做\u003cstrong\u003e拉什 · 玛格纳斯 · 爱立信\u003c/strong\u003e（Lars Magnus Ericsson）。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"640-16487839499382.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ccenter\u003e\u003cdiv\u003e 拉什 · 玛格纳斯 · 爱立信\u003c/div\u003e\u003c/center\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e拉什 · 爱立信 1846 年 5 月 5 日出生于瑞典中部瓦姆兰省的一个小农场里。他的家庭条件贫困，自己在 9 个兄弟姐妹中排行第六。\u003c/p\u003e\n\u003cp\u003e11 岁时，由于父亲病逝，他不得不外出工作，养家糊口。这期间，他当过矿工，修过铁路，还在铁匠铺做了很长时间的学徒。\u003c/p\u003e\n\u003cp\u003e1867 年，拉什 · 爱立信终于攒够了路费，来到他梦寐以求的瑞典首都——斯德哥尔摩。经过一周的试用后，他成功加入了奥勒公司，成为一名修理工。\u003c/p\u003e\n\u003cp\u003e尽管这份工作的工资微薄，拉什 · 爱立信仍然感到十分满足。他后来回忆说：“（这份工作）足以满足我的需求，让我庆幸地看到生活比以往任何时候都更加光明，我心中第一次感受到了生活的快乐。”\u003c/p\u003e","tags":["通信","历史","转载"],"title":"「转」爱立信的百年沉浮"},{"categories":["工具"],"content":"2020年了，笔者还是使用RSS的原始人。RSS，Really Simple Syndication是一种信息聚合工具。在5G时代信息即将大爆炸之前，我来谈谈rss的杂七杂八吧。我们来打个赌，你不会看完这篇文章。\n软件的交互设计有很多心理学理论的应用。比如微信、QQ的三级页面设计，一般经过3次点击就能到达功能或设置。这符合认知原理，人认知记忆能力一般为3-5个的组合。日常生活中要记电话号码，可以3-4-4这样记。软件交互中还有利用人的习惯奖励机制的提醒红点的设计，吸引你去点击，获取红点消失的奖励。对我来说，较难控制住不受这些设计的影响。在《习惯的力量》一书了解到，直接逃离这些环境可有效解决控制不住的问题。比如工作的时候，把手机关进柜子，工作1个小时，然后再回复信息，当然重要电话还是要立即接的。\n铺天盖地的广告，马路上，电视中，手机里，PC页面充斥着各种广告等等。大多数人可能养成了自动过滤的广告的习惯，然而我的情况是一直在用去广告的插件，并没有养成自动忽略广告的习惯。可怜兮兮，难道只有我是有广告洁癖的嘛？广告有点浪费生命。\n我饱受广告的困扰。web的去广告方法，我可使用某款chrome插件可以将web界面上的小红点，推荐信息模块全部屏蔽掉的。哪里不看点哪里，贼方便。\n移动端的广告去掉太难了，我一生气卸载了知乎 b站等等应用，终于有了一个清爽的手机。\n那我还是想获取一些新的内容，根据二八定律，是有20%的网络资料包含了80%的信息，也就是干货，也可能被我这种操作忽略掉了，那一套RSS应用体系应运而生。\n谈谈推荐算法，知乎推荐的都是啥呀，程序员都懂的，把我一个屌丝的形象勾勒的这么明显。于是我回答问题，人在美国，刚下飞机，年薪百万，老婆在旁？\n很多人会说，RSS一定会获取到有用的信息吗，这取决于信息源的可靠程度。也就是需要你自己去选择，由于它是不含推荐算法的，就不会根据你选择的，再给你推荐一些可能是非常有用的。\n再谈谈知识焦虑，每天觉得有大量知识需要吸收。大家都明白mark了也并不会看的，但还是mark很多，但你并不会有时间或者精力去看。既然不会看，那就不mark了，用到啥学啥，或许是个不错的策略。那RSS的即时性还是不错的，最好能当天把信息清理一下，star一些当前重要的东西，然后一周整理一下，像阮一峰老师。吸收完，把它输出出去，与人交流，给人讲明白，能够记得更深。（费曼学习法，把自己当成老师）。\n让我们再回到RSS，RSS是个淘汰的东西，和微信的公众号的形式有点像。然后倒霉的我又在微信的公众号上难以自拔，常常花很多时间在这上面。推荐算法厉害呀，就是让你看得爽。自我节制太难，那就改变环境。于是，我去掉了很多公众号，保留一些本地生活工作的公众号，微信上专注与朋友们侃大山。\n还有一点难受是，各个平台，相互串在一起，在这个地方看了，在其他地方又换了一个马甲它继续晃悠在眼前。信息源在多平台发布，然后信息重叠。\n看来all in one 势在必行，RSS被谷歌放弃后，很多网站傲娇地不提供RSS服务了，毕竟流量至上，钱要赚的，我一直想做一个这种爬的工具，但我不希望有大量使用爬，也就是我们还是要尊重网站的盈利以及持续发展的，这也是仅仅方便个人的信息处理，优化你的自动信息的处理，再也不用一个个打开网站，然后看信息看广告，还要被推荐不重用的信息。这也算我个人的想法。人在于折腾，于是我开始折腾ttrss rsshub等开源软件。\n自由软件的好处，在于自由定制，参与发展，利益化会尽量变慢或者没有，方便的同时并不忘隐私保护。\n我想说的是，技术应当给人们带来自由和发展，而非接管人们的注意力，浪费宝贵的时间。\n写在5G信息大爆发前，与大家共同反思与成长。\n","permalink":"/post/c0-life/talk-rss-2020/","summary":"\u003cp\u003e2020年了，笔者还是使用RSS的原始人。RSS，Really Simple Syndication是一种信息聚合工具。在5G时代信息即将大爆炸之前，我来谈谈rss的杂七杂八吧。我们来打个赌，你不会看完这篇文章。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e软件的交互设计有很多心理学理论的应用。比如微信、QQ的三级页面设计，一般经过3次点击就能到达功能或设置。这符合认知原理，人认知记忆能力一般为3-5个的组合。日常生活中要记电话号码，可以3-4-4这样记。软件交互中还有利用人的习惯奖励机制的提醒红点的设计，吸引你去点击，获取红点消失的奖励。对我来说，较难控制住不受这些设计的影响。在《习惯的力量》一书了解到，直接逃离这些环境可有效解决控制不住的问题。比如工作的时候，把手机关进柜子，工作1个小时，然后再回复信息，当然重要电话还是要立即接的。\u003c/p\u003e\n\u003cp\u003e铺天盖地的广告，马路上，电视中，手机里，PC页面充斥着各种广告等等。大多数人可能养成了自动过滤的广告的习惯，然而我的情况是一直在用去广告的插件，并没有养成自动忽略广告的习惯。可怜兮兮，难道只有我是有广告洁癖的嘛？广告有点浪费生命。\u003c/p\u003e\n\u003cp\u003e我饱受广告的困扰。web的去广告方法，我可使用某款chrome插件可以将web界面上的小红点，推荐信息模块全部屏蔽掉的。哪里不看点哪里，贼方便。\u003c/p\u003e\n\u003cp\u003e移动端的广告去掉太难了，我一生气卸载了知乎 b站等等应用，终于有了一个清爽的手机。\u003c/p\u003e\n\u003cp\u003e那我还是想获取一些新的内容，根据二八定律，是有20%的网络资料包含了80%的信息，也就是干货，也可能被我这种操作忽略掉了，那一套RSS应用体系应运而生。\u003c/p\u003e\n\u003cp\u003e谈谈推荐算法，知乎推荐的都是啥呀，程序员都懂的，把我一个屌丝的形象勾勒的这么明显。于是我回答问题，人在美国，刚下飞机，年薪百万，老婆在旁？\u003c/p\u003e\n\u003cp\u003e很多人会说，RSS一定会获取到有用的信息吗，这取决于信息源的可靠程度。也就是需要你自己去选择，由于它是不含推荐算法的，就不会根据你选择的，再给你推荐一些可能是非常有用的。\u003c/p\u003e\n\u003cp\u003e再谈谈知识焦虑，每天觉得有大量知识需要吸收。大家都明白mark了也并不会看的，但还是mark很多，但你并不会有时间或者精力去看。既然不会看，那就不mark了，用到啥学啥，或许是个不错的策略。那RSS的即时性还是不错的，最好能当天把信息清理一下，star一些当前重要的东西，然后一周整理一下，像阮一峰老师。吸收完，把它输出出去，与人交流，给人讲明白，能够记得更深。（费曼学习法，把自己当成老师）。\u003c/p\u003e\n\u003cp\u003e让我们再回到RSS，RSS是个淘汰的东西，和微信的公众号的形式有点像。然后倒霉的我又在微信的公众号上难以自拔，常常花很多时间在这上面。推荐算法厉害呀，就是让你看得爽。自我节制太难，那就改变环境。于是，我去掉了很多公众号，保留一些本地生活工作的公众号，微信上专注与朋友们侃大山。\u003c/p\u003e\n\u003cp\u003e还有一点难受是，各个平台，相互串在一起，在这个地方看了，在其他地方又换了一个马甲它继续晃悠在眼前。信息源在多平台发布，然后信息重叠。\u003c/p\u003e\n\u003cp\u003e看来all in one 势在必行，RSS被谷歌放弃后，很多网站傲娇地不提供RSS服务了，毕竟流量至上，钱要赚的，我一直想做一个这种爬的工具，但我不希望有大量使用爬，也就是我们还是要尊重网站的盈利以及持续发展的，这也是仅仅方便个人的信息处理，优化你的自动信息的处理，再也不用一个个打开网站，然后看信息看广告，还要被推荐不重用的信息。这也算我个人的想法。人在于折腾，于是我开始折腾ttrss rsshub等开源软件。\u003c/p\u003e\n\u003cp\u003e自由软件的好处，在于自由定制，参与发展，利益化会尽量变慢或者没有，方便的同时并不忘隐私保护。\u003c/p\u003e\n\u003cp\u003e我想说的是，\u003cstrong\u003e技术应当给人们带来自由和发展，而非接管人们的注意力，浪费宝贵的时间。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e写在5G信息大爆发前，与大家共同反思与成长。\u003c/p\u003e","tags":["rss","思考","想法"],"title":"二零年RSS杂谈"},{"categories":["生活"],"content":"简介 14 Peaks: Nothing Is Impossible (2021)\n无畏的尼泊尔登山运动员尼姆斯·普贾开始了一项看似不可能完成的任务：在7个月内登顶全球14座8000米高峰。（2019年度完成的Possible plan）\n最近，我看完了该记录片，摘录了些语句，鼓励自己不断进取，征服人生的一座座高峰，追寻梦想，不忘初心！\n追寻梦想 不忘初心 最后 山不向我走来，我便向他走去！\n","permalink":"/post/c0-life/trips/14peak/","summary":"\u003ch2 id=\"简介\"\u003e简介\u003c/h2\u003e\n\u003cp\u003e14 Peaks: Nothing Is Impossible (2021)\u003c/p\u003e\n\u003cp\u003e无畏的尼泊尔登山运动员尼姆斯·普贾开始了一项看似不可能完成的任务：在7个月内登顶全球14座8000米高峰。（2019年度完成的Possible plan）\u003c/p\u003e\n\u003cp\u003e最近，我看完了该记录片，摘录了些语句，鼓励自己不断进取，征服人生的一座座高峰，追寻梦想，不忘初心！\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"2022-01-09-16-49-12.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"追寻梦想\"\u003e追寻梦想\u003c/h2\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"2022-01-09-17-20-35.JPG\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch2 id=\"不忘初心\"\u003e不忘初心\u003c/h2\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"20220109_hello.JPG\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch2 id=\"最后\"\u003e最后\u003c/h2\u003e\n\u003cp\u003e山不向我走来，我便向他走去！\u003c/p\u003e","tags":["影视","纪录片"],"title":"征服14座高峰：凡事皆有可能"},{"categories":["linux"],"content":"全文导读\nLinux 内核预备工作 Linux 内核体系结构简析 Linux 体系结构和内核结构区别 Linux 驱动的 platform 机制 Linux 内核体系结构 内核模块 Linux 内核学习经验总结 结尾 Linux 内核预备工作 理解 Linux 内核最好预备的知识点：\n懂 C 语言\n懂一点操作系统的知识\n熟悉少量相关算法\n懂计算机体系结构\nLinux 内核的特点：\n结合了 unix 操作系统的一些基础概念\nLinux 内核的任务：\n从技术层面讲，内核是硬件与软件之间的一个中间层。作用是将应用层序的请求传递给硬件，并充当底层驱动程序，对系统中的各种设备和组件进行寻址。\n从应用程序的层面讲，应用程序与硬件没有联系，只与内核有联系，内核是应用程序知道的层次中的最底层。在实际工作中内核抽象了相关细节。\n内核是一个资源管理程序。负责将可用的共享资源 (CPU 时间、磁盘空间、网络连接等) 分配得到各个系统进程。\n内核就像一个库，提供了一组面向系统的命令。系统调用对于应用程序来说，就像调用普通函数一样。\n内核实现策略：\n微内核。最基本的功能由中央内核（微内核）实现。所有其他的功能都委托给一些独立进程，这些进程通过明确定义的通信接口与中心内核通信。\n宏内核。内核的所有代码，包括子系统（如内存管理、文件管理、设备驱动程序）都打包到一个文件中。内核中的每一个函数都可以访问到内核中所有其他部分。目前支持模块的动态装卸 (裁剪)。Linux 内核就是基于这个策略实现的。\n哪些地方用到了内核机制？\n进程（在 cpu 的虚拟内存中分配地址空间，各个进程的地址空间完全独立; 同时执行的进程数最多不超过 cpu 数目）之间进行通 信，需要使用特定的内核机制。\n进程间切换 (同时执行的进程数最多不超过 cpu 数目)，也需要用到内核机制。\n进程切换也需要像 FreeRTOS 任务切换一样保存状态，并将进程置于闲置状态 / 恢复状态。\n进程的调度。确认哪个进程运行多长的时间。\nLinux 进程\n采用层次结构，每个进程都依赖于一个父进程。内核启动 init 程序作为第一个进程。该进程负责进一步的系统初始化操作。init 进程是进程树的根，所有的进程都直接或者间接起源于该进程。\n通过 pstree 命令查询。实际上得系统第一个进程是 systemd，而不是 init（这也是疑问点）\n系统中每一个进程都有一个唯一标识符 (ID), 用户（或其他进程）可以使用 ID 来访问进程。\nLinux 内核源代码的目录结构\nLinux 内核源代码包括三个主要部分：\n内核核心代码，包括第 3 章所描述的各个子系统和子模块，以及其它的支撑子系统，例如电源管理、Linux 初始化等\n其它非核心代码，例如库文件（因为 Linux 内核是一个自包含的内核，即内核不依赖其它的任何软件，自己就可以编译通过）、固件集合、KVM（虚拟机技术）等\n编译脚本、配置文件、帮助文档、版权说明等辅助性文件\n使用 ls 命令看到的内核源代码的顶层目录结构，具体描述如下。\ninclude/ \u0026mdash;- 内核头文件，需要提供给外部模块（例如用户空间代码）使用。\nkernel/ \u0026mdash;- Linux 内核的核心代码，包含了 3.2 小节所描述的进程调度子系统，以及和进程调度相关的模块。\nmm/ \u0026mdash;- 内存管理子系统（3.3 小节）。\nfs/ \u0026mdash;- VFS 子系统（3.4 小节）。\nnet/ \u0026mdash;- 不包括网络设备驱动的网络子系统（3.5 小节）。\nipc/ \u0026mdash;- IPC（进程间通信）子系统。\narch// \u0026mdash;- 体系结构相关的代码，例如 arm, x86 等等。\narch//mach- \u0026mdash;- 具体的 machine/board 相关的代码。\narch//include/asm \u0026mdash;- 体系结构相关的头文件。\narch//boot/dts \u0026mdash;- 设备树（Device Tree）文件。\ninit/ \u0026mdash;- Linux 系统启动初始化相关的代码。\nblock/ \u0026mdash;- 提供块设备的层次。\nsound/ \u0026mdash;- 音频相关的驱动及子系统，可以看作 “音频子系统”。\ndrivers/ \u0026mdash;- 设备驱动（在 Linux kernel 3.10 中，设备驱动占了 49.4 的代码量）。\nlib/ \u0026mdash;- 实现需要在内核中使用的库函数，例如 CRC、FIFO、list、MD5 等。\ncrypto/ \u0026mdash;\u0026ndash; 加密、解密相关的库函数。\nsecurity/ \u0026mdash;- 提供安全特性（SELinux）。\nvirt/ \u0026mdash;- 提供虚拟机技术（KVM 等）的支持。\nusr/ \u0026mdash;- 用于生成 initramfs 的代码。\nfirmware/ \u0026mdash;- 保存用于驱动第三方设备的固件。\nsamples/ \u0026mdash;- 一些示例代码。\ntools/ \u0026mdash;- 一些常用工具，如性能剖析、自测试等。\nKconfig, Kbuild, Makefile, scripts/ \u0026mdash;- 用于内核编译的配置文件、脚本等。\nCOPYING \u0026mdash;- 版权声明。\nMAINTAINERS \u0026mdash;- 维护者名单。\nCREDITS \u0026mdash;- Linux 主要的贡献者名单。\nREPORTING-BUGS \u0026mdash;- Bug 上报的指南。\nDocumentation, README \u0026mdash;- 帮助、说明文档。\nLinux 内核体系结构简析 图 1 Linux 系统层次结构\n最上面是用户（或应用程序）空间。这是用户应用程序执行的地方。用户空间之下是内核空间，Linux 内核正是位于这里。GNU C Library （glibc）也在这里。它提供了连接内核的系统调用接口，还提供了在用户空间应用程序和内核之间进行转换的机制。这点非常重要，因为内核和用户空间的应用程序使用的是不同的保护地址空间。每个用户空间的进程都使用自己的虚拟地址空间，而内核则占用单独的地址空间。\nLinux 内核可以进一步划分成 3 层。最上面是系统调用接口，它实现了一些基本的功能，例如 read 和 write。系统调用接口之下是内核代码，可以更精确地定义为独立于体系结构的内核代码。这些代码是 Linux 所支持的所有处理器体系结构所通用的。在这些代码之下是依赖于体系结构的代码，构成了通常称为 BSP（Board Support Package）的部分。这些代码用作给定体系结构的处理器和特定于平台的代码。\nLinux 内核实现了很多重要的体系结构属性。在或高或低的层次上，内核被划分为多个子系统。Linux 也可以看作是一个整体，因为它会将所有这些基本服务都集成到内核中。这与微内核的体系结构不同，后者会提供一些基本的服务，例如通信、I/O、内存和进程管理，更具体的服务都是插入到微内核层中的。每种内核都有自己的优点，不过这里并不对此进行讨论。 随着时间的流逝，Linux 内核在内存和 CPU 使用方面具有较高的效率，并且非常稳定。但是对于 Linux 来说，最为有趣的是在这种大小和复杂性的前提下，依然具有良好的可移植性。Linux 编译后可在大量处理器和具有不同体系结构约束和需求的平台上运行。一个例子是 Linux 可以在一个具有内存管理单元（MMU）的处理器上运行，也可以在那些不提供 MMU 的处理器上运行。\nLinux 内核的 uClinux 移植提供了对非 MMU 的支持。\n图 2 是 Linux 内核的体系结构\n图 2 Linux 内核体系结构\nLinux 内核的主要组件有：系统调用接口、进程管理、内存管理、虚拟文件系统、网络堆栈、设备驱动程序、硬件架构的相关代码。\n（1）系统调用接口\nSCI 层提供了某些机制执行从用户空间到内核的函数调用。正如前面讨论的一样，这个接口依赖于体系结构，甚至在相同的处理器家族内也是如此。SCI 实际上是一个非常有用的函数调用多路复用和多路分解服务。在 ./linux/kernel 中您可以找到 SCI 的实现，并在 ./linux/arch 中找到依赖于体系结构的部分。\n（2）进程管理\n进程管理的重点是进程的执行。在内核中，这些进程称为线程，代表了单独的处理器虚拟化（线程代码、数据、堆栈和 CPU 寄存器）。在用户空间，通常使用进程 这个术语，不过 Linux 实现并没有区分这两个概念（进程和线程）。内核通过 SCI 提供了一个应用程序编程接口（API）来创建一个新进程（fork、exec 或 Portable Operating System Interface [POSIX] 函数），停止进程（kill、exit），并在它们之间进行通信和同步（signal 或者 POSIX 机制）。\n进程管理还包括处理活动进程之间共享 CPU 的需求。内核实现了一种新型的调度算法，不管有多少个线程在竞争 CPU，这种算法都可以在固定时间内进行操作。这种算法就称为 O(1) 调度程序，这个名字就表示它调度多个线程所使用的时间和调度一个线程所使用的时间是相同的。O(1) 调度程序也可以支持多处理器（称为对称多处理器或 SMP）。您可以在 ./linux/kernel 中找到进程管理的源代码，在 ./linux/arch 中可以找到依赖于体系结构的源代码。\n（3）内存管理\n内核所管理的另外一个重要资源是内存。为了提高效率，如果由硬件管理虚拟内存，内存是按照所谓的内存页 方式进行管理的（对于大部分体系结构来说都是 4KB）。Linux 包括了管理可用内存的方式，以及物理和虚拟映射所使用的硬件机制。不过内存管理要管理的可不止 4KB 缓冲区。Linux 提供了对 4KB 缓冲区的抽象，例如 slab 分配器。这种内存管理模式使用 4KB 缓冲区为基数，然后从中分配结构，并跟踪内存页使用情况，比如哪些内存页是满的，哪些页面没有完全使用，哪些页面为空。这样就允许该模式根据系统需要来动态调整内存使用。为了支持多个用户使用内存，有时会出现可用内存被消耗光的情况。由于这个原因，页面可以移出内存并放入磁盘中。这个过程称为交换，因为页面会被从内存交换到硬盘上。内存管理的源代码可以在 ./linux/mm 中找到。\n（4）虚拟文件系统\n虚拟文件系统（VFS）是 Linux 内核中非常有用的一个方面，因为它为文件系统提供了一个通用的接口抽象。VFS 在 SCI 和内核所支持的文件系统之间提供了一个交换层（请参看图 4）。\n图 3 Linux 文件系统层次结构\n在 VFS 上面，是对诸如 open、close、read 和 write 之类的函数的一个通用 API 抽象。在 VFS 下面是文件系统抽象，它定义了上层函数的实现方式。它们是给定文件系统（超过 50 个）的插件。文件系统的源代码可以在 ./linux/fs 中找到。文件系统层之下是缓冲区缓存，它为文件系统层提供了一个通用函数集（与具体文件系统无关）。这个缓存层通过将数据保留一段时间（或者随即预先读取数据以便在需要是就可用）优化了对物理设备的访问。缓冲区缓存之下是设备驱动程序，它实现了特定物理设备的接口。\n（5）网络堆栈\n网络堆栈在设计上遵循模拟协议本身的分层体系结构。回想一下，Internet Protocol (IP) 是传输协议（通常称为传输控制协议或 TCP）下面的核心网络层协议。TCP 上面是 socket 层，它是通过 SCI 进行调用的。socket 层是网络子系统的标准 API，它为各种网络协议提供了一个用户接口。从原始帧访问到 IP 协议数据单元（PDU），再到 TCP 和 User Datagram Protocol (UDP)，socket 层提供了一种标准化的方法来管理连接，并在各个终点之间移动数据。内核中网络源代码可以在 ./linux/net 中找到。\n（6）设备驱动程序\nLinux 内核中有大量代码都在设备驱动程序中，它们能够运转特定的硬件设备。Linux 源码树提供了一个驱动程序子目录，这个目录又进一步划分为各种支持设备，例如 Bluetooth、I2C、serial 等。设备驱动程序的代码可以在 ./linux/drivers 中找到。\n（7）依赖体系结构的代码\n尽管 Linux 很大程度上独立于所运行的体系结构，但是有些元素则必须考虑体系结构才能正常操作并实现更高效率。./linux/arch 子目录定义了内核源代码中依赖于体系结构的部分，其中包含了各种特定于体系结构的子目录（共同组成了 BSP）。对于一个典型的桌面系统来说，使用的是 x86 目录。每个体系结构子目录都包含了很多其他子目录，每个子目录都关注内核中的一个特定方面，例如引导、内核、内存管理等。这些依赖体系结构的代码可以在 ./linux/arch 中找到。\n如果 Linux 内核的可移植性和效率还不够好，Linux 还提供了其他一些特性，它们无法划分到上面的分类中。作为一个生产操作系统和开源软件，Linux 是测试新协议及其增强的良好平台。Linux 支持大量网络协议，包括典型的 TCP/IP，以及高速网络的扩展（大于 1 Gigabit Ethernet [GbE] 和 10 GbE）。Linux 也可以支持诸如流控制传输协议（SCTP）之类的协议，它提供了很多比 TCP 更高级的特性（是传输层协议的接替者）。\nLinux 还是一个动态内核，支持动态添加或删除软件组件。被称为动态可加载内核模块，它们可以在引导时根据需要（当前特定设备需要这个模块）或在任何时候由用户插入。\nLinux 最新的一个增强是可以用作其他操作系统的操作系统（称为系统管理程序）。最近，对内核进行了修改，称为基于内核的虚拟机（KVM）。这个修改为用户空间启用了一个新的接口，它可以允许其他操作系统在启用了 KVM 的内核之上运行。除了运行 Linux 的其他实例之外， Microsoft Windows 也可以进行虚拟化。惟一的限制是底层处理器必须支持新的虚拟化指令。\nLinux 体系结构和内核结构区别 1．当被问到 Linux 体系结构（就是 Linux 系统是怎么构成的）时，我们可以参照下图这么回答：\n从大的方面讲，Linux 体系结构可以分为两块：\n（1）用户空间：用户空间中又包含了，用户的应用程序，C 库\n（2）内核空间：内核空间包括，系统调用，内核，以及与平台架构相关的代码\n2．Linux 体系结构要分成用户空间和内核空间的原因：\n1）现代 CPU 通常都实现了不同的工作模式。\n以 ARM 为例：ARM 实现了 7 种工作模式，不同模式下 CPU 可以执行的指令或者访问的寄存器不同： （1）用户模式 usr\n（2）系统模式 sys\n（3）管理模式 svc\n（4）快速中断 fiq\n（5）外部中断 irq\n（6）数据访问终止 abt\n（7）未定义指令异常\n以（2）X86 为例：X86 实现了 4 个不同级别的权限，Ring0—Ring3 ;Ring0 下可以执行特权指令，可以访问 IO 设备；Ring3 则有很多的限制\n2）所以，Linux 从 CPU 的角度出发，为了保护内核的安全，把系统分成了 2 部分；\n3．用户空间和内核空间是程序执行的两种不同状态，我们可以通过 “系统调用” 和“硬件中断“来完成用户空间到内核空间的转移\n4．Linux 的内核结构（注意区分 LInux 体系结构和 Linux 内核结构）\nLinux 驱动的 platform 机制 Linux 的这种 platform driver 机制和传统的 device_driver 机制相比，一个十分明显的优势在于 platform 机制将本身的资源注册进内核，由内核统一管理，在驱动程序中使用这些资源时通过 platform_device 提供的标准接口进行申请并使用。这样提高了驱动和资源管理的独立性，并且拥有较好的可移植性和安全性。下面是 SPI 驱动层次示意图，Linux 中的 SPI 总线可理解为 SPI 控制器引出的总线：\n和传统的驱动一样，platform 机制也分为三个步骤：\n1、总线注册阶段：\n内核启动初始化时的 main.c 文件中的 kernel_init()→do_basic_setup()→driver_init()→platform_bus_init()→bus_register(\u0026amp;platform_bus_type)，注册了一条 platform 总线（虚拟总线，platform_bus）。\n2、添加设备阶段：\n设备注册的时候 Platform_device_register()→platform_device_add()→(pdev→dev.bus = \u0026amp;platform_bus_type)→device_add()，就这样把设备给挂到虚拟的总线上。\n3、驱动注册阶段：\nPlatform_driver_register()→driver_register()→bus_add_driver()→driver_attach()→bus_for_each_dev(), 对在每个挂在虚拟的 platform bus 的设备作__driver_attach()→driver_probe_device(), 判断 drv→bus→match() 是否执行成功，此时通过指针执行 platform_match→strncmp(pdev→name , drv→name , BUS_ID_SIZE), 如果相符就调用 really_probe(实际就是执行相应设备的 platform_driver→probe(platform_device)。) 开始真正的探测，如果 probe 成功，则绑定设备到该驱动。\n从上面可以看出，platform 机制最后还是调用了 bus_register() , device_add() , driver_register() 这三个关键的函数。\n下面看几个结构体：\nstruct platform_device (/include/linux/Platform_device.h) { const char * name; int id; struct device dev; u32 num_resources; struct resource * resource; }; Platform_device 结构体描述了一个 platform 结构的设备，在其中包含了一般设备的结构体 struct device dev; 设备的资源结构体 struct resource * resource; 还有设备的名字 const char * name。（注意，这个名字一定要和后面 platform_driver.driver àname 相同，原因会在后面说明。）\n该结构体中最重要的就是 resource 结构，这也是之所以引入 platform 机制的原因。\nstruct resource ( /include/linux/ioport.h) { resource_size_t start; resource_size_t end; const char *name; unsigned long flags; struct resource *parent, *sibling, *child; }; 其中 flags位表示该资源的类型，start和end分别表示该资源的起始地址和结束地址(/include/linux/Platform_device.h)： struct platform_driver { int (*probe)(struct platform_device *); int (*remove)(struct platform_device *); void (*shutdown)(struct platform_device *); int (*suspend)(struct platform_device *, pm_message_t state); int (*suspend_late)(struct platform_device *, pm_message_t state); int (*resume_early)(struct platform_device *); int (*resume)(struct platform_device *); struct device_driver driver; }; Platform_driver结构体描述了一个platform结构的驱动。其中除了一些函数指针外，还有一个一般驱动的device_driver结构。 名字要一致的原因：\n上面说的驱动在注册的时候会调用函数 bus_for_each_dev(), 对在每个挂在虚拟的 platform bus 的设备作__driver_attach()→driver_probe_device(), 在此函数中会对 dev 和 drv 做初步的匹配，调用的是 drv-\u0026gt;bus-\u0026gt;match 所指向的函数。platform_driver_register 函数中 drv-\u0026gt;driver.bus = \u0026amp;platform_bus_type，所以 drv-\u0026gt;bus-\u0026gt;match 就为 platform_bus_type→match, 为 platform_match 函数，该函数如下：\nstatic int platform_match(struct device * dev, struct device_driver * drv) { struct platform_device *pdev = container_of(dev, struct platform_device, dev); return (strncmp(pdev-\u0026gt;name, drv-\u0026gt;name, BUS_ID_SIZE) == 0); } 是比较 dev 和 drv 的 name，相同则会进入 really_probe（）函数，从而进入自己写的 probe 函数做进一步的匹配。所以 dev→name 和 driver→drv→name 在初始化时一定要填一样的。\n不同类型的驱动，其 match 函数是不一样的，这个 platform 的驱动，比较的是 dev 和 drv 的名字，还记得 usb 类驱动里的 match 吗？它比较的是 Product ID 和 Vendor ID。\n个人总结 Platform 机制的好处：\n1、提供 platform_bus_type 类型的总线，把那些不是总线型的 soc 设备都添加到这条虚拟总线上。使得，总线——设备——驱动的模式可以得到普及。\n2、提供 platform_device 和 platform_driver 类型的数据结构，将传统的 device 和 driver 数据结构嵌入其中，并且加入 resource 成员，以便于和 Open Firmware 这种动态传递设备资源的新型 bootloader 和 kernel 接轨。\nLinux 内核体系结构 因为 Linux 内核是单片的，所以它比其他类型的内核占用空间最大，复杂度也最高。这是一个设计特性，在 Linux 早期引起了相当多的争论，并且仍然带有一些与单内核固有的相同的设计缺陷。\n为了解决这些缺陷，Linux 内核开发人员所做的一件事就是使内核模块可以在运行时加载和卸载，这意味着您可以动态地添加或删除内核的特性。这不仅可以向内核添加硬件功能，还可以包括运行服务器进程的模块，比如低级别虚拟化，但也可以替换整个内核，而不需要在某些情况下重启计算机。\n想象一下，如果您可以升级到 Windows 服务包，而不需要重新启动……\n内核模块 如果 Windows 已经安装了所有可用的驱动程序，而您只需要打开所需的驱动程序怎么办? 这本质上就是内核模块为 Linux 所做的。内核模块，也称为可加载内核模块 (LKM)，对于保持内核在不消耗所有可用内存的情况下与所有硬件一起工作是必不可少的。\n模块通常向基本内核添加设备、文件系统和系统调用等功能。lkm 的文件扩展名是. ko，通常存储在 / lib/modules 目录中。由于模块的特性，您可以通过在启动时使用 menuconfig 命令将模块设置为 load 或 not load，或者通过编辑 / boot/config 文件，或者使用 modprobe 命令动态地加载和卸载模块，轻松定制内核。\n第三方和封闭源码模块在一些发行版中是可用的，比如 Ubuntu，默认情况下可能无法安装，因为这些模块的源代码是不可用的。该软件的开发人员 (即 nVidia、ATI 等) 不提供源代码，而是构建自己的模块并编译所需的. ko 文件以便分发。虽然这些模块像 beer 一样是免费的，但它们不像 speech 那样是免费的，因此不包括在一些发行版中，因为维护人员认为它通过提供非免费软件 “污染” 了内核。\n内核并不神奇，但对于任何正常运行的计算机来说，它都是必不可少的。Linux 内核不同于 OS X 和 Windows，因为它包含内核级别的驱动程序，并使许多东西 “开箱即用”。希望您能对软件和硬件如何协同工作以及启动计算机所需的文件有更多的了解。\nLinux 内核学习经验总结 开篇 学习内核，每个人都有自己的学习方法，仁者见仁智者见智。以下是我在学习过程中总结出来的东西，对自身来说，我认为比较有效率，拿出来跟大家交流一下。\n内核学习，一偏之见；疏漏难免，恳请指正。\n为什么写这篇博客 刚开始学内核的时候，不要执着于一个方面，不要专注于一个子系统就一头扎到实际的代码行中去，因为这样的话，牵涉的面会很广，会碰到很多困难，容易产生挫败感，一个函数体中（假设刚开始的时候正在学习某个方面的某个具体的功能函数）很可能掺杂着其他各个子系统方面设计理念（多是大量相关的数据结构或者全局变量，用于支撑该子系统的管理工作）下相应的代码实现，这个时候看到这些东西，纷繁芜杂，是没有头绪而且很不理解的，会产生很多很多的疑问，（这个时候如果对这些疑问纠缠不清，刨根问底，那么事实上就是在学习当前子系统的过程中频繁的去涉足其他子系统，这时候注意力就分散了），而事实上等了解了各个子系统后再回头看这些东西的话，就简单多了，而且思路也会比较清晰。所以，要避免 “只见树木，不见森林”，不要急于深入到底层代码中去，不要过早研究底层代码。\n我在大二的时候刚开始接触内核，就犯了这个错误，一头扎到内存管理里头，去看非常底层的实现代码，虽然也是建立在内存管理的设计思想的基础上，但是相对来说，比较孤立，因为此时并没有学习其它子系统，应该说无论是视野还是思想，都比较狭隘，所以代码中牵涉到的其它子系统的实现我都直接跳过了，这一点还算聪明，当然也是迫不得已的。\n我的学习方法 刚开始，我认为主要的问题在于你知道不知道，而不是理解不理解，某个子系统的实现采用了某种策略、方法，而你在学习中需要做的就是知道有这么一回事儿，然后才是理解所描述的策略或者方法。\n根据自己的学习经验，刚开始学习内核的时候，我认为要做的是在自己的脑海中建立起内核的大体框架，理解各个子系统的设计理念和构建思想，这些理念和思想会从宏观上呈献给你清晰的脉络，就像一个去除了枝枝叶叶的大树的主干，一目了然；当然，肯定还会涉及到具体的实现方法、函数，但是此时接触到的函数或者方法位于内核实现的较高的层次，是主（要）函数，已经了解到这些函数，针对的是哪些设计思想，实现了什么样的功能，达成了什么样的目的，混个脸熟的说法在这儿也是成立的。至于该主函数所调用的其它的辅助性函数就等同于枝枝叶叶了，不必太早就去深究。此时，也就初步建立起了内核子系统框架和代码实现之间的关联，关联其实很简单，比如一看到某个函数名字，就想起这个函数是针对哪个子系统的，实现了什么功能。\n我认为此时要看的就是 LKD3，这本书算是泛泛而谈，主要就是从概念，设计，大的实现方法上描述各个子系统，而对于具体的相关的函数实现的代码讲解很少涉及 (对比于 ULK3，此书主要就是关于具体函数代码的具体实现的深入分析，当然，你也可以看，但是过早看这本书，会感觉很痛苦，很枯燥无味，基本上都是函数的实现)，很少，但不是没有，这就很好，满足我们当前的需求，还避免我们过早深入到实际的代码中去。而且本书在一些重要的点上还给出了写程序时的注意事项，算是指导性建议。主要的子系统包括：内存管理，进程管理和调度，系统调用，中断和异常，内核同步，时间和定时器管理，虚拟文件系统，块 I/O 层，设备和模块。（这里的先后顺序其实就是 LKD3 的目录的顺序）。\n我学习的时候是三本书交叉着看的，先看 LKD3，专于一个子系统，主要就是了解设计的原理和思想，当然也会碰到对一些主要函数的介绍，但大多就是该函数基于前面介绍的思想和原理完成了什么样的功能，该书并没有就函数本身的实现进行深入剖析。然后再看 ULK3 和 PLKA 上看同样的子系统，但是并不仔细分析底层具体函数的代码，只是粗略地、不求甚解地看，甚至不看。因为，有些时候，在其中一本书的某个点上，卡壳了，不是很理解了，在另外的书上你可能就碰到对同一个问题的不同角度的描述，说不准哪句话就能让你豁然开朗，如醍醐灌顶。我经常碰到这种情况。\n并不是说学习过程中对一些函数体的实现完全就忽略掉，只要自己想彻底了解其代码实现，没有谁会阻止你。我是在反复阅读过程中慢慢深入的。比如 VFS 中文件打开需要对路径进行分析，需要考虑的细节不少 (.././ 之类的)，但是其代码实现是很好理解的。再比如，CFS 调度中根据 shedule latency、队列中进程个数及其 nice 值(使用的是动态优先级) 计算出分配给进程的时间片，没理由不看的，这个太重要了，而且也很有意思。\nULK3 也会有设计原理与思想之类的概括性介绍，基本上都位于某个主题的开篇段落。但是更多的是对支持该原理和思想的主要函数实现的具体分析，同样在首段，一句话综述函数的功能，然后对函数的实现以 1、2、3，或者 a、b、c 步骤的形式进行讲解。我只是有选择性的看，有时候对照着用 source insight 打开的源码，确认一下代码大体上确实是按书中所描述的步骤实现的，就当是增加感性认识。由于步骤中掺杂着各种针对不同实现目的安全性、有效性检查，如果不理解就先跳过。这并不妨碍你对函数体功能实现的整体把握。\nPLKA 介于 LKD3 和 ULK3 之间。我觉得 PLKA 的作者（看照片，真一德国帅小伙，技术如此了得）肯定看过 ULK，无论他的本意还是有意，总之 PLKA 还是跟 ULK 有所不同，对函数的仔细讲解都做补充说明，去掉函数体中边边角角的情况，比如一些特殊情况的处理，有效性检查等，而不妨碍对整个函数体功能的理解，这些他都有所交代，做了声明；而且，就像 LKD3 一样，在某些点上也给出了指导性编程建议。作者们甚至对同一个主要函数的讲解的着重点都不一样。这样的话，对我们学习的人而言，有助于加深理解。另外，我认为很重要的一点就是 PLKA 针对的 2.6.24 的内核版本，而 ULK 是 2.6.11，LKD3 是 2.6.34。在某些方面 PLKA 比较接近现代的实现。其实作者们之所以分别选择 11 或者 24，都是因为在版本发行树中，这两个版本在某些方面都做了不小的变动，或者说是具有标志性的转折点（这些信息大多是在书中的引言部分介绍的，具体的细节我想不起来了）。\nIntel V3，针对 X86 的 CPU，本书自然是系统编程的权威。内核部分实现都可以在本书找到其根源。所以，在读以上三本书某个子系统的时候，不要忘记可以在 V3 中相应章节找到一些基础性支撑信息。\n在读书过程中，会产生相当多的疑问，这一点是确信无疑的。大到搞不明白一个设计思想，小到不理解某行代码的用途。各个方面，各种疑问，你完全可以把不理解的地方都记录下来 (不过，我并没有这么做，没有把疑问全部记下来，只标记了很少一部分我认为很关键的几个问题)，专门写到一张纸上，不对，一个本上，我确信会产生这么多的疑问，不然内核相关的论坛早就可以关闭了。其实，大部分的问题（其中很多问题都是你知道不知道有这么一回事的问题）都可以迎刃而解，只要你肯回头再看，书读百遍，其义自现。多看几遍，前前后后的联系明白个七七八八是没有问题的。我也这么做了，针对某些子系统也看了好几遍，切身体会。\n当你按顺序学习这些子系统的时候，前面的章节很可能会引用后面的章节，就像 PLKA 的作者说的那样，完全没有向后引用是不可能的，他能做的只是尽量减少这种引用而又不损害你对当前问题的理解。不理解，没关系，跳过就行了。后面的章节同样会有向前章节的引用，不过这个问题就简单一些了 ，你可以再回头去看相应的介绍，当时你不太理解的东西，很可能这个时候就知道了它的设计的目的以及具体的应用。不求甚解只是暂时的。比如说，内核各个子系统之间的交互和引用在代码中的体现就是实现函数穿插调用，比如你在内存管理章节学习了的内存分配和释放的函数，而你是了解内存在先的，在学习驱动或者模块的时候就会碰到这些函数的调用，这样也就比较容易接受，不至于太过茫然；再比如，你了解了系统时间和定时器的管理，再回头看中断和异常中 bottom half 的调度实现，你对它的理解就会加深一层。\n子系统进行管理工作需要大量的数据结构。子系统之间交互的一种方式就是各个子系统各自的主要数据结构通过指针成员相互引用。学习过程中，参考书上在讲解某个子系统的时候会对数据结构中主要成员的用途解释一下，但肯定不会覆盖全部（成员比较多的情况，例如 task_struct），对其它子系统基于某个功能实现的引用可能解释了，也可能没做解释，还可能说这个变量在何处会做进一步说明。所以，不要纠结于一个不理解的点上，暂且放过，回头还可以看的。之间的联系可以在对各个子系统都有所了解之后再建立起来。其实，我仍然在强调先理解概念和框架的重要性。\n等我们完成了建立框架这一步，就可以选择一个比较感兴趣的子系统，比如驱动、网络，或者文件系统之类的。这个时候你再去深入了解底层代码实现，相较于一开始就钻研代码，更容易一些，而且碰到了不解之处，或者忘记了某个方面的实现，此时你完全可以找到相应的子系统，因为你知道在哪去找，查漏补缺，不仅完成了对当前函数的钻研，而且可以回顾、温习以前的内容，融会贯通的时机就在这里了。\n《深入理解 linux 虚拟内存》(2.4 内核版本)，LDD3，《深入理解 linux 网络技术内幕》，几乎每一个子系统都需要一本书的容量去讲解，所以说，刚开始学习不宜对某个模块太过深入，等对各个子系统都有所了解了，再有针对性的去学习一个特定的子系统。这时候对其它系统的援引都可以让我们不再感到茫然、复杂，不知所云。\n比如，LDD3 中的以下所列章节：构造和运行模块，并发和竞态，时间、延迟及延缓操作, 分配内存，中断处理等，都属于驱动开发的支撑性子系统，虽说本书对这些子系统都专门开辟一个章节进行讲解，但是详细程度怎么能比得上 PLKA，ULK3，LKD3 这三本书，看完这三本书，你会发现读 LDD3 这些章节的时候简直跟喝白开水一样，太随意了，因为 LDD3 的讲解比之 LKD3 更粗略。打好了基础，PCI、USB、TTY 驱动，块设备驱动，网卡驱动，需要了解和学习的东西就比较有针对性了。这些子系统就属于通用子系统，了解之后，基于这些子系统的子系统的开发—驱动 (需进一步针对硬件特性) 和网络(需进一步理解各种协议)—相对而言，其学习难度大大降低，学习进度大大加快，学习效率大大提升。说着容易做来难。达到这样一种效果的前提就是：必须得静下心来，认真读书，要看得进去，PLKA，ULK3 厚得都跟砖头块儿一样，令人望之生畏，如果没有兴趣，没有热情，没有毅力，无论如何都是不行，因为需要时间，需要很长时间。我并不是说必须打好了基础才可以进行驱动开发，只是说打好了基础的情况下进行开发会更轻松，更有效率，而且自己对内核代码的驾驭能力会更强大。这只是我个人见解，我自己的学习方式，仅供参考。\n语言 PLKA 是个德国人用德语写的，后来翻译成英文，又从英文翻译成中文，我在网上书店里没有找到它的纸质英文版，所以就买了中文版的。ULK3 和 LKD3 都是英文版的。大牛们写的书，遣词造句真的是简洁，易懂，看原版对我们学习计算机编程的程序员来说完全不成问题，最好原汁原味。如果一本书确实翻译地很好，我们当然可以看中文版的，用母语进行学习，理解速度和学习进度当然是很快的，不作他想。看英文的时候不要脑子里想着把他翻译成中文，没必要。\nAPI 感想 “比起知道你所用技术的重要性，成为某一个特别领域的专家是不重要的。知道某一个具体 API 调用一点好处都没有，当你需要他的时候只要查询下就好了。” 这句话源于我看到的一篇翻译过来的博客。我想强调的就是，这句话针应用型编程再合适不过，但是内核 API 就不完全如此。\n内核相当复杂，学习起来很不容易，但是当你学习到一定程度，你会发现，如果自己打算写内核代码，到最后要关注的仍然是 API 接口，只不过这些 API 绝大部分是跨平台的，满足可移植性。内核黑客基本上已经标准化、文档化了这些接口，你所要做的只是调用而已。当然，在使用的时候，最好对可移植性这一话题在内核中的编码约定烂熟于心，这样才会写出可移植性的代码。就像应用程序一样，可以使用开发商提供的动态库 API，或者使用开源 API。同样是调用 API，不同点在于使用内核 API 要比使用应用 API 了解的东西要多出许多。\n当你了解了操作系统的实现—这些实现可都是对应用程序的基础性支撑啊—你再去写应用程序的时候，应用程序中用到的多线程，定时器，同步锁机制等等等等，使用共享库 API 的时候，联系到操作系统，从而把对该 API 的文档描述同自己所了解到的这些方面在内核中的相应支撑性实现结合起来进行考虑，这会指导你选择使用哪一个 API 接口，选出效率最高的实现方式。对系统编程颇有了解的话，对应用编程不无益处，甚至可以说是大有好处。\n设计实现的本质，知道还是理解 操作系统是介于底层硬件和应用软件之间的接口，其各个子系统的实现很大程度上依赖于硬件特性。书上介绍这些子系统的设计和实现的时候，我们读过了，也就知道了，如果再深入考虑一下，为什么整体架构要按照这种方式组织，为什么局部函数要遵循这样的步骤处理，知其然，知其所以然，如果你知道了某个功能的实现是因为芯片就是这么设计的，CPU 就是这么做的，那么你的疑问也就基本上到此为止了。再深究，就是芯片架构方面的设计与实现，对于程序员来讲，无论是系统还是应用程序员，足迹探究到这里，已经解决了很多疑问，因为我们的工作性质偏软，而这些东西实在是够硬。\n比如，ULK3 中讲解的中断和异常的实现，究其根源，那是因为 Intel x86 系列就是这么设计的，去看看 Intel V3 手册中相应章节介绍，都可以为 ULK3 中描述的代码实现方式找到注解。还有时间和定时器管理，同样可以在 Intel V3 对 APIC 的介绍中获取足够的信息，操作系统就是依据这些硬件特性来实现软件方法定义的。\n又是那句话，不是理解不理解的问题，而是知道不知道的问题。有时候，知道了，就理解了。在整个学习过程中，知道，理解，知道，理解，知道……，交叉反复。为什么开始和结尾都是知道，而理解只是中间步骤呢？世界上万事万物自有其规律，人类只是发现而已，实践是第一位的，实践就是知道的过程，实践产生经验，经验的总结就是理论，理论源于实践，理论才需要理解。我们学习内核，深入研究，搞来搞去，又回到了芯片上，芯片是物质的，芯片的功用基于自然界中物质本有的物理和电子特性。追本溯源，此之谓也。\n动手写代码 纸上得来终觉浅，绝知此事要躬行。只看书是绝对不行的，一定要结合课本给出的编程建议自己敲代码。刚开始就以模块形式测试好了，或者自己编译一个开发版本的内核。一台机器的话，使用 UML 方式调试，内核控制路走到哪一步，单步调试看看程序执行过程，比书上的讲解更直观明了。一定要动手实际操作。\n参考书\nLDD3 Linux Device Driver 3rd\nLKD3 Linux Kernel Development 3rd\nULK3 Understanding the Linux Kernel 3rd\nPLKA Professional Linux Kernel Architecture\nUML User Mode Linux\nIntel V3 Intel? 64 and IA-32 Architectures Software Developer’s Manual Volume 3 (3A, 3B \u0026amp; 3C): System Programming Guide\n作者在写书的时候，都是以自己的理解组织内容，从自己的观点看待一个主题，关注点跟作者自身有很大的关系。出书的时间有先后，后来人针对同一个主题想要出书而又不落入窠臼，最好有自己的切入方式，从自己的角度讲解相关问题，这才值得出这本书，千篇一律是个掉价的行为，书就不值钱了。\n尽信书不如无书。 http://lwn.net/Articles/419855/ 此处是一篇关于 LKD3 的书评，指出了其中的错误，当你读完的时候，不妨去找找，看一下自己在其中所描述的地方有什么特别的印象。 http://lwn.net/Articles/161190 / 此处是一篇对 ULK3 的介绍，我认为其中很关键的几句话就可以给本书定位： Many of the key control paths in the kernel are described, step by step;\n一步一步地讲述内核控制路径的实现。\nThe level of detail sometimes makes it hard to get a sense for the big picture, but it does help somebody trying to figure out how a particular function works.\n对代码讲解的详细程度有时候很难让读者把握住它的主旨大意，但是确实有助于读者理解一个特定的函数到底是如何工作的。\nIndeed, that is perhaps the key feature which differentiates this book. It is very much a “how it works” book, designed to help people understand the code.\n事实上，这也正是本书与众不同的地方。更像一个 “如何工作” 的书，帮助读者理解代码实现。\nIt presents kernel functions and data structures, steps the reader through them, but does not, for example, emphasize the rules for using them. UTLK is a study guide, not a programming manual.\n本书描述了内核函数和数据结构，引导读者穿行于其间，但是，并没有着重强调使用它们的法则。UTLK 是一本学习指南，而不是编程手册。\n这几句话对本书的描述非常到位。基于此，作为指导性原则，我们就可以很有效率地使用它了。\n看一本技术书籍，书中的序言部分绝对是首先应该翻阅的，其次就是目录。我发现在阅读过程中我会频繁的查看目录，甚至是喜欢看目录。\n结尾 兴趣的力量是无穷的。兴趣能带来激情，如果工作可以和兴趣结合到一起，工作起来才会有热情，那么工作就不只是工作了，更是一种享受。\nLinux，我的兴趣，我的动力，我的方向，我的未来！\n参考 图片来自：link 部分文章来自：link 已失效\n","permalink":"/post/c5-linux/linux/linux-in-one/","summary":"\u003cp\u003e全文导读\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"\"\u003eLinux 内核预备工作\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"\"\u003eLinux 内核体系结构简析\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"\"\u003eLinux 体系结构和内核结构区别\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"\"\u003eLinux 驱动的 platform 机制\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"\"\u003eLinux 内核体系结构\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"\"\u003e内核模块\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"\"\u003eLinux 内核学习经验总结\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"\"\u003e结尾\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"linux-内核预备工作\"\u003eLinux 内核预备工作\u003c/h2\u003e\n\u003cp\u003e理解 Linux 内核最好预备的知识点：\u003c/p\u003e\n\u003cp\u003e懂 C 语言\u003cbr\u003e\n懂一点操作系统的知识\u003cbr\u003e\n熟悉少量相关算法\u003cbr\u003e\n懂计算机体系结构\u003c/p\u003e\n\u003cp\u003eLinux 内核的特点：\u003c/p\u003e\n\u003cp\u003e结合了 unix 操作系统的一些基础概念\u003c/p\u003e\n\u003cimg src=\"linux_in_one/174749211_2_20191103041018392.jpeg\" alt=\"174749211_2_20191103041018392\" style=\"zoom:50%;\" /\u003e\n\u003cimg src=\"linux_in_one/174749211_3_20191103041018455.jpeg\" alt=\"174749211_3_20191103041018455\" style=\"zoom:60%;\" /\u003e\n\u003cp\u003eLinux 内核的任务：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e从技术层面讲，内核是硬件与软件之间的一个中间层。作用是将应用层序的请求传递给硬件，并充当底层驱动程序，对系统中的各种设备和组件进行寻址。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e从应用程序的层面讲，应用程序与硬件没有联系，只与内核有联系，内核是应用程序知道的层次中的最底层。在实际工作中内核抽象了相关细节。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e内核是一个资源管理程序。负责将可用的共享资源 (CPU 时间、磁盘空间、网络连接等) 分配得到各个系统进程。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e内核就像一个库，提供了一组面向系统的命令。系统调用对于应用程序来说，就像调用普通函数一样。\u003cbr\u003e\n内核实现策略：\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e微内核。最基本的功能由中央内核（微内核）实现。所有其他的功能都委托给一些独立进程，这些进程通过明确定义的通信接口与中心内核通信。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e宏内核。内核的所有代码，包括子系统（如内存管理、文件管理、设备驱动程序）都打包到一个文件中。内核中的每一个函数都可以访问到内核中所有其他部分。目前支持模块的动态装卸 (裁剪)。Linux 内核就是基于这个策略实现的。\u003cbr\u003e\n哪些地方用到了内核机制？\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e进程（在 cpu 的虚拟内存中分配地址空间，各个进程的地址空间完全独立; 同时执行的进程数最多不超过 cpu 数目）之间进行通   信，需要使用特定的内核机制。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e进程间切换 (同时执行的进程数最多不超过 cpu 数目)，也需要用到内核机制。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e进程切换也需要像 FreeRTOS 任务切换一样保存状态，并将进程置于闲置状态 / 恢复状态。\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e\n\u003cp\u003e进程的调度。确认哪个进程运行多长的时间。\u003cbr\u003e\nLinux 进程\u003c/p\u003e","tags":["linux内核","转载"],"title":"「转」一文看懂Linux内核！Linux内核架构和工作原理详解"},{"categories":["生活"],"content":"简介 “中华古籍资源库”是“中华古籍保护计划”的重要成果。2016年9月28日，“中华古籍资源库”正式开通运行，陆续发布国家图书馆藏善本和普通古籍、法国国家图书馆藏敦煌遗书、天津图书馆藏普通古籍、日本永青文库捐赠汉籍、云南省图书馆善本古籍、芷兰斋藏稿抄校本等古籍影像资源，总量超过3.3万部。\n《中华古籍资源库》！！！\n网址：http://www.nlc.cn/pcab/zy/zhgj_zyk/\n查询：http://read.nlc.cn/thematDataSearch/toGujiIndex\n比如：《九章算数》的古籍\n比如：卷第九的勾股\n数字古籍 国家图书馆收藏古籍15万部，其中善本古籍直接继承了南宋缉熙殿、元翰林国史院、明文渊阁、清内阁大库等皇家珍藏，以及明清以来许多私人藏书家的毕生所聚。宋元旧椠、明清精刻琳琅满目。通过全彩影像数字化和缩微胶卷转化影像方式建设，从2016年9月28日起陆续在线发布，目前已发布馆藏古籍2万余部，国家图书馆超过三分之二的善本古籍实现了在线阅览。\n数字方志 地方志文献为我国所特有，也是国家图书馆独具特色的馆藏之一，所存文献数量与品质极高。该数据库以国家图书馆藏地方志文献建设，主要包括为清代（含清代）以前的方志资源6529种。\n赵城金藏 《赵城金藏》被誉为国家图书馆四大镇馆之宝之一。《赵城金藏》是在金代刻的一部大藏，因为它藏在赵城县（今属山西洪洞县）广胜寺，所以后人将它定名为《赵城金藏》。全藏约七千卷左右，六千多万字，现存四千余卷。2017年12月28日，国家图书馆《赵城金藏》1281件正式发布。\n宋人文集 国家图书馆精选所藏宋人文集善本二百七十五部，首选宋元刊本，次及明清精抄精刻，或经名家校勘题跋之本，通过缩微胶卷还原数字影像，并辅以详细书目建成本全文影像数据库，目前已发布275部，免费呈献公众利用。\n碑帖菁华 以国家图书馆藏有的历代甲骨、青铜器、石刻等类拓片二十三万余件为基础建设的数据库，内容涉及历史、地理、政治、经济、军事、民族、民俗、文学、艺术、科技、建筑等方面。2019年11月12日又新增发布2595种馆藏明清碑刻拓片数字资源，现有元数据2.5万余条，影像3.1万余幅。\n甲骨世界 被誉为二十世纪四大文献发现之一的甲骨文，集文献性、文物性、收藏性于一身，是研究我国商朝晚期不可多得的珍贵史料，该库包括甲骨实物元数据2964条，影像5932幅；甲骨拓片元数据2975条，影像3177幅。\n西夏文献 以国家图书馆保存的西夏、元代孤本及各种西夏的珍贵实物资料为基础建设的数据库。包括西夏文献书目数据124条，原件影像近5000拍。\n西夏论著 包括西夏研究论文篇名数据1200余条。\n年画撷英 国家图书馆收藏了杨柳青、朱仙镇等地制作的4000余幅年画作品，从中精选出一部分制作了该库，并为每种年画编写了内容说明，重点介绍了该年画的故事梗概、历史背景、制作特色和相关知识。目前发布元数据及影像302组。\n前尘旧影 该资源库收录了国家图书馆收藏的新旧照片3074组，真实生动地记录了过去的社会事件、历史人物、城乡面貌、名胜古迹和建筑服饰等，人们可从中解读出不同历史时期特定事物的形象特征和真实信息，具有十分重要的历史价值。\n敦煌遗珍 国际敦煌项目（IDP）建设的数据库，发布来自敦煌和丝绸之路上的写本、绘画、纺织品及器物的信息和图片，其中包括国家图书馆藏敦煌写卷影像18万余拍。\n徽州善本家谱 徽州善本家谱印刷资料数据库是中国国家图书馆与法国远东学院的合作项目，收录了中国国家图书馆藏善本古籍中徽州家谱243种286部，配有书影5437幅。\n中华医药典籍资源库（测试版） 图书馆收藏的文献典籍是整理研究的基础资料，为使读者能够通过互联网检索、利用中医文献资源，国家图书馆（国家古籍保护中心）将逐步建设中华医药典藏资源库，目前首批对221种中医古籍影像进行发布测试。\n云南图书馆古籍 云南省图书馆将该馆古籍数字资源共139种727册提供给国家图书馆（国家古籍保护中心），这批资源均是云南省图书馆所藏珍贵的、有代表性的古籍文献，特别是明代云南丽江木氏土司家族著述，更是明代少数民族汉文著述的代表。该批资源于2019年11月12日正式在线发布。\n天津图书馆古籍 为进一步丰富古籍数字资源品种和版本，满足广大读者使用需求，2014年底，天津图书馆向国家图书馆（国家古籍保护中心）提供总量约5,800余种300万拍明清古籍数字资源，该批资源经加工后，于2018年9月28日、2019年1月28日分两批发布。\n上海图书馆家谱 上海图书馆现藏有家谱近3万余种30余万册共计365个姓氏，收藏的家谱覆盖全国27个省、自治区及直辖市，是国内外收藏中国家谱原件最多的公藏机构，有着“全球中国家谱第一藏”之美誉。国家图书馆与上海图书馆合作，征集该馆所藏明清家谱资源2200余种，在国图网站发布使用。\n中华古籍善本联合书目 中华古籍善本国际联合书目系统是由中文善本书国际联合目录项目发展而来的新数据库，著录了三十余家海内外图书馆所藏古籍善本，数据达2万多条，并配有1.4万余幅书影。\n东文研汉籍影像库 东京大学东洋文化研究所收藏有大量中国古籍，其中包括东方文化学院东京研究所的旧藏以及大木幹一、长泽规矩也、仓石武四郎等各具特色的个人收藏。2009年11月，东洋文化研究所将所藏中文古籍4000余种，以数字化方式无偿提供给中国国家图书馆，在国图网站上面向读者提供服务。\n哈佛大学善本特藏 哈佛大学哈佛燕京图书馆藏中文善本古籍特藏，以其质量之高、数量之大著称于世。为了方便海内外学人便捷地利用这些资料进行研究，同时以数字化形式保存这些中华古籍精品，2009年国家图书馆与哈佛大学哈佛燕京图书达成协议，对哈佛燕京图书馆所藏中文善本和齐如山专藏进行数字化。目前在线发布经部和史部善本数字资源741部，另有齐如山戏曲小说专藏204种。\n法藏敦煌遗书 2015年，在法国国家图书馆与中国国家图书馆达成合作意向，由法国国家图书馆向中国国家图书馆赠送馆藏全部敦煌遗书高清数字资源。在双方共同努力下，实现了这批敦煌遗书的数字化回归，并于2018年3月5日正式在线发布，共计5300余号3.1万余拍。\n中华寻根网 中华寻根网是国家图书馆与澳门基金会开展的文化合作项目，是以提供姓氏源流和家谱资源服务为核心、方便海内外华人寻根问祖活动的网络平台。“中华寻根网”目前提供500多个姓氏源流、2000多部家谱和6000种其他文献的阅览，以及自建家谱，交流联谊的互动服务。\n","permalink":"/post/c0-life/readings/zhonghuaguji/","summary":"\u003ch2 id=\"简介\"\u003e简介\u003c/h2\u003e\n\u003cp\u003e“中华古籍资源库”是“中华古籍保护计划”的重要成果。2016年9月28日，“中华古籍资源库”正式开通运行，陆续发布国家图书馆藏善本和普通古籍、法国国家图书馆藏敦煌遗书、天津图书馆藏普通古籍、日本永青文库捐赠汉籍、云南省图书馆善本古籍、芷兰斋藏稿抄校本等古籍影像资源，总量超过3.3万部。\u003c/p\u003e\n\u003cp\u003e《中华古籍资源库》！！！\u003cbr\u003e\n网址：http://www.nlc.cn/pcab/zy/zhgj_zyk/\u003cbr\u003e\n查询：http://read.nlc.cn/thematDataSearch/toGujiIndex\u003c/p\u003e\n\u003cimg src=\"zhonghuaguji/image-20211216225907506.png\" alt=\"image-20211216225907506\" style=\"zoom:30%;\" /\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e比如：《九章算数》的古籍\u003c/p\u003e\n\u003cimg src=\"zhonghuaguji/image-20211216231340351.png\" alt=\"image-20211216231340351\" style=\"zoom:30%;\" /\u003e\n\u003cimg src=\"zhonghuaguji/image-20211216231141739.png\" alt=\"image-20211216231141739\" style=\"zoom:30%;\" /\u003e\n\u003cp\u003e比如：卷第九的勾股\u003c/p\u003e\n\u003cimg src=\"zhonghuaguji/image-20211216232009068.png\" alt=\"image-20211216232009068\" style=\"zoom:50%;\" /\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e数字古籍\n国家图书馆收藏古籍15万部，其中善本古籍直接继承了南宋缉熙殿、元翰林国史院、明文渊阁、清内阁大库等皇家珍藏，以及明清以来许多私人藏书家的毕生所聚。宋元旧椠、明清精刻琳琅满目。通过全彩影像数字化和缩微胶卷转化影像方式建设，从2016年9月28日起陆续在线发布，目前已发布馆藏古籍2万余部，国家图书馆超过三分之二的善本古籍实现了在线阅览。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e数字方志\n地方志文献为我国所特有，也是国家图书馆独具特色的馆藏之一，所存文献数量与品质极高。该数据库以国家图书馆藏地方志文献建设，主要包括为清代（含清代）以前的方志资源6529种。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e赵城金藏\n《赵城金藏》被誉为国家图书馆四大镇馆之宝之一。《赵城金藏》是在金代刻的一部大藏，因为它藏在赵城县（今属山西洪洞县）广胜寺，所以后人将它定名为《赵城金藏》。全藏约七千卷左右，六千多万字，现存四千余卷。2017年12月28日，国家图书馆《赵城金藏》1281件正式发布。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e宋人文集\n国家图书馆精选所藏宋人文集善本二百七十五部，首选宋元刊本，次及明清精抄精刻，或经名家校勘题跋之本，通过缩微胶卷还原数字影像，并辅以详细书目建成本全文影像数据库，目前已发布275部，免费呈献公众利用。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e碑帖菁华\n以国家图书馆藏有的历代甲骨、青铜器、石刻等类拓片二十三万余件为基础建设的数据库，内容涉及历史、地理、政治、经济、军事、民族、民俗、文学、艺术、科技、建筑等方面。2019年11月12日又新增发布2595种馆藏明清碑刻拓片数字资源，现有元数据2.5万余条，影像3.1万余幅。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e甲骨世界\n被誉为二十世纪四大文献发现之一的甲骨文，集文献性、文物性、收藏性于一身，是研究我国商朝晚期不可多得的珍贵史料，该库包括甲骨实物元数据2964条，影像5932幅；甲骨拓片元数据2975条，影像3177幅。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e西夏文献\n以国家图书馆保存的西夏、元代孤本及各种西夏的珍贵实物资料为基础建设的数据库。包括西夏文献书目数据124条，原件影像近5000拍。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e西夏论著\n包括西夏研究论文篇名数据1200余条。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e年画撷英\n国家图书馆收藏了杨柳青、朱仙镇等地制作的4000余幅年画作品，从中精选出一部分制作了该库，并为每种年画编写了内容说明，重点介绍了该年画的故事梗概、历史背景、制作特色和相关知识。目前发布元数据及影像302组。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e前尘旧影\n该资源库收录了国家图书馆收藏的新旧照片3074组，真实生动地记录了过去的社会事件、历史人物、城乡面貌、名胜古迹和建筑服饰等，人们可从中解读出不同历史时期特定事物的形象特征和真实信息，具有十分重要的历史价值。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e敦煌遗珍\n国际敦煌项目（IDP）建设的数据库，发布来自敦煌和丝绸之路上的写本、绘画、纺织品及器物的信息和图片，其中包括国家图书馆藏敦煌写卷影像18万余拍。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e徽州善本家谱\n徽州善本家谱印刷资料数据库是中国国家图书馆与法国远东学院的合作项目，收录了中国国家图书馆藏善本古籍中徽州家谱243种286部，配有书影5437幅。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e中华医药典籍资源库（测试版）\n图书馆收藏的文献典籍是整理研究的基础资料，为使读者能够通过互联网检索、利用中医文献资源，国家图书馆（国家古籍保护中心）将逐步建设中华医药典藏资源库，目前首批对221种中医古籍影像进行发布测试。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e云南图书馆古籍\n云南省图书馆将该馆古籍数字资源共139种727册提供给国家图书馆（国家古籍保护中心），这批资源均是云南省图书馆所藏珍贵的、有代表性的古籍文献，特别是明代云南丽江木氏土司家族著述，更是明代少数民族汉文著述的代表。该批资源于2019年11月12日正式在线发布。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e天津图书馆古籍\n为进一步丰富古籍数字资源品种和版本，满足广大读者使用需求，2014年底，天津图书馆向国家图书馆（国家古籍保护中心）提供总量约5,800余种300万拍明清古籍数字资源，该批资源经加工后，于2018年9月28日、2019年1月28日分两批发布。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e上海图书馆家谱\n上海图书馆现藏有家谱近3万余种30余万册共计365个姓氏，收藏的家谱覆盖全国27个省、自治区及直辖市，是国内外收藏中国家谱原件最多的公藏机构，有着“全球中国家谱第一藏”之美誉。国家图书馆与上海图书馆合作，征集该馆所藏明清家谱资源2200余种，在国图网站发布使用。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e中华古籍善本联合书目\n中华古籍善本国际联合书目系统是由中文善本书国际联合目录项目发展而来的新数据库，著录了三十余家海内外图书馆所藏古籍善本，数据达2万多条，并配有1.4万余幅书影。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e东文研汉籍影像库\n东京大学东洋文化研究所收藏有大量中国古籍，其中包括东方文化学院东京研究所的旧藏以及大木幹一、长泽规矩也、仓石武四郎等各具特色的个人收藏。2009年11月，东洋文化研究所将所藏中文古籍4000余种，以数字化方式无偿提供给中国国家图书馆，在国图网站上面向读者提供服务。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e哈佛大学善本特藏\n哈佛大学哈佛燕京图书馆藏中文善本古籍特藏，以其质量之高、数量之大著称于世。为了方便海内外学人便捷地利用这些资料进行研究，同时以数字化形式保存这些中华古籍精品，2009年国家图书馆与哈佛大学哈佛燕京图书达成协议，对哈佛燕京图书馆所藏中文善本和齐如山专藏进行数字化。目前在线发布经部和史部善本数字资源741部，另有齐如山戏曲小说专藏204种。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e法藏敦煌遗书\n2015年，在法国国家图书馆与中国国家图书馆达成合作意向，由法国国家图书馆向中国国家图书馆赠送馆藏全部敦煌遗书高清数字资源。在双方共同努力下，实现了这批敦煌遗书的数字化回归，并于2018年3月5日正式在线发布，共计5300余号3.1万余拍。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e中华寻根网\n中华寻根网是国家图书馆与澳门基金会开展的文化合作项目，是以提供姓氏源流和家谱资源服务为核心、方便海内外华人寻根问祖活动的网络平台。“中华寻根网”目前提供500多个姓氏源流、2000多部家谱和6000种其他文献的阅览，以及自建家谱，交流联谊的互动服务。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e","tags":["书籍","资源","古籍"],"title":"「转」《中华古籍资源库》中国国家图书馆"},{"categories":["网络"],"content":"前言 注：章节中的源代码，基于 linux 内核 4.7.4\n网桥的背景到处都有，在这里就不浪费的时间说废话了。\n桥接程序的初始化，桥接程序既可以集成在内核中，也可以编译成独立模块。初始化函数br_init和清理函数br_deinit的定义在/net/bridge/br.c中\n在网桥设备初始化的时候，主要是做一些注册和初始化的操作。\n桥初始化 static int __init br_init(void) { int err; /*注册协议生成树收包函数*/ err = stp_proto_register(\u0026amp;br_stp_proto); if (err \u0026lt; 0) { pr_err(\u0026#34;bridge: can\u0026#39;t register sap for STP\\n\u0026#34;); return err; } /*转发数据库初始化*/ err = br_fdb_init(); if (err) goto err_out; /*在/proc目录下生成任何与bridge相关的目录，如果我们想在/proc下生成bridge相关的子目录或子文件*/ err = register_pernet_subsys(\u0026amp;br_net_ops); if (err) goto err_out1; /*目前好像没有什么实际作用，在内核中所注册的函数为空*/ err = br_nf_core_init(); if (err) goto err_out2; /*注册相关网络设备的事件通知连*/ err = register_netdevice_notifier(\u0026amp;br_device_notifier); if (err) goto err_out3; /*注册通知连，主要针对桥转发表事件的相关信息*/ err = register_switchdev_notifier(\u0026amp;br_switchdev_notifier); if (err) goto err_out4; /*进行netlink的初始化*/ err = br_netlink_init(); if (err) goto err_out5; /*用来处理ioctl命令的函数，比如添加和删除网桥*/ brioctl_set(br_ioctl_deviceless_stub); #if IS_ENABLED(CONFIG_ATM_LANE) br_fdb_test_addr_hook = br_fdb_test_addr; #endif return 0; } 具体的 了解了桥初始化大致要做的事情后，我们再来看看这些初始化或者注册的事情到底干了些什么？\n1.注册协议生成树收包函数stp_proto_register 在桥初始化的时候，注册了一个br_stp_proto参数，此参数的具体模样是这样子的 static const struct stp_proto br_stp_proto = { .rcv = br_stp_rcv, }; br_stp_rcv函数在/net/bridge/br_stp_bpdu.c中主要针对网桥进行协议交换的帧（BPDU）进行配置操作。 2.桥转发数据库初始化br_fdb_init 此函数就是在内存中建立一块slab cache，以存放net_bridge_fdb_entry 其中：net_bridge_fdb_entry是一个结构体，用来转发数据库的记录项网桥所学到对的每个MAC地址都有这样一个记录 3.在proc目录下生成相关文件的注册函数register_pernet_subsys，初始化的时候给这个函数传递了一个参数br_net_ops，这个参数的模样是这样的 static struct pernet_operations br_net_ops = { .exit = br_net_exit, }; 但是在桥初始化的时候，仅仅注册了br_net_exit，这个函数会将桥下面的所有文件全部清空。 4.通知链的相关函数注册register_netdevice_notifier这个注册函数主要针对设备信息的变化，注册参数br_device_notifier，具体如下： static struct notifier_block br_device_notifier = { .notifier_call = br_device_event }; br_device_event函数是用来当桥上的设备状态或者设备信息发生改变时做相应的处理，该函数在/net/bridge/br.c中 5.注册通知连，主要针对桥转发表事件的相关信息register_switchdev_notifier，传入的参数br_switchdev_notifier详细信息如下： static struct notifier_block br_switchdev_notifier = { .notifier_call = br_switchdev_event, }; br_switchdev_event，主要针对桥转发表的事件做出相应的处理该函数在/net/bridge/br.c中 6.brioctl_set用来处理ioctl命令的函数，比如添加和删除网桥，br_ioctl_deviceless_stub给回调函数br_ioctl_hook,而br_ioctl_hook在sock_ioctl中 使用，这样通过在应用层调用socket的ioctl函数，就能够进行网桥的添加与删除了，函数用来处理添加和删除网桥的相关操作，会在下一节详细介绍。 以上就是网桥初始化的相关操作 1\n参考 @不留你的名字 桥初始化 2010-12-01\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"/post/c6-network/br_init/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e注：章节中的源代码，基于 linux 内核 4.7.4\u003c/p\u003e\n\u003cp\u003e网桥的背景到处都有，在这里就不浪费的时间说废话了。\u003c/p\u003e\n\u003cp\u003e桥接程序的初始化，桥接程序既可以集成在内核中，也可以编译成独立模块。初始化函数br_init和清理函数br_deinit的定义在/net/bridge/br.c中\u003c/p\u003e\n\u003cp\u003e在网桥设备初始化的时候，主要是做一些注册和初始化的操作。\u003c/p\u003e\n\u003ch2 id=\"桥初始化\"\u003e桥初始化\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003estatic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e __init \u003cspan style=\"color:#a6e22e\"\u003ebr_init\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e err;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e/*注册协议生成树收包函数*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    err \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estp_proto_register\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ebr_stp_proto);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (err \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003epr_err\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bridge: can\u0026#39;t register sap for STP\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e err;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e/*转发数据库初始化*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    err \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebr_fdb_init\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (err)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e err_out;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   \u003cspan style=\"color:#75715e\"\u003e/*在/proc目录下生成任何与bridge相关的目录，如果我们想在/proc下生成bridge相关的子目录或子文件*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    err \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eregister_pernet_subsys\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ebr_net_ops);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (err)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e err_out1;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e/*目前好像没有什么实际作用，在内核中所注册的函数为空*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    err \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebr_nf_core_init\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (err)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e err_out2;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e/*注册相关网络设备的事件通知连*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    err \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eregister_netdevice_notifier\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ebr_device_notifier);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (err)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e err_out3;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e/*注册通知连，主要针对桥转发表事件的相关信息*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    err \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eregister_switchdev_notifier\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ebr_switchdev_notifier);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (err)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e err_out4;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e/*进行netlink的初始化*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    err \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebr_netlink_init\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (err)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003egoto\u003c/span\u003e err_out5;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e/*用来处理ioctl命令的函数，比如添加和删除网桥*/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ebrioctl_set\u003c/span\u003e(br_ioctl_deviceless_stub);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#if IS_ENABLED(CONFIG_ATM_LANE)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    br_fdb_test_addr_hook \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e br_fdb_test_addr;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"具体的\"\u003e具体的\u003c/h2\u003e\n\u003cp\u003e了解了桥初始化大致要做的事情后，我们再来看看这些初始化或者注册的事情到底干了些什么？\u003c/p\u003e","tags":["linux","二层桥"],"title":"「转」桥初始化（一）"},{"categories":["生活"],"content":"前言 帝国时代3，现在帝国4！\n2021 年科隆游戏展奖项提名名单正式公布\n8 月 23 日，2021 年科隆游戏展的奖项提名名单已经全部揭晓，本次直接涉及游戏的奖项有 21 个，其中获得提名的游戏分别为：\n最佳微软 Xbox 游戏：《艾尔登法环》（万代南梦宫娱乐）；《孤岛惊魂 6》（育碧）；《光环无限》（微软）\n最佳任天堂 Switch 游戏：《舞力全开 2022》（育碧）；《马里奥 + 疯狂兔子星耀之愿》 (育碧)\n最佳 PC 游戏：《帝国时代 4》(微软)；《艾尔登法环》（万代南梦宫娱乐）；《塞伯利亚之谜: 世界之前》 (Astragon Entertainment)\n最佳索尼 PlayStation 游戏：《艾尔登法环》（万代南梦宫娱乐）；《破晓传说》（万代南梦宫娱乐）；《黑相集：灰冥界》 (万代南梦宫娱乐)\n最佳动作冒险游戏：《艾尔登法环》（万代南梦宫娱乐）；《马里奥 + 疯狂兔子星耀之愿》 (育碧)；《塞伯利亚之谜: 世界之前》 (Astragon Entertainment)\n最佳动作游戏：《孤岛惊魂 6》（育碧）；《光环：无限》（微软）；《彩虹六号：异种》（育碧）\n最佳家庭游戏：《舞力全开 2022》（育碧）；《Run Prop, Run!》（PlayTogether Studio）；《Super Dungeon Maker》 (Rokaplay)\n最佳独立游戏：《Dorfromantik》（Toukana Interactive）；《Inua》（Arte France）；《Lost in Random》（EA）\n最佳角色扮演游戏：《艾尔登法环》（万代南梦宫娱乐）；《Encased》（科赫传媒）；《破晓传说》（万代南梦宫娱乐）\n最佳模拟游戏：《攀登者：天空是极限》(Art Games Studio)；《模拟农场 22》 (Astragon Entertainment)\n最佳体育游戏：《攀登者：天空是极限》(Art Games Studio)；《FIFA22》（EA）；《Riders Republic》（育碧）\n最佳策略游戏：《帝国时代 4》 (微软)；《英雄连 3》 (世嘉)；《马里奥 + 疯狂兔子星耀之愿》 (育碧)\n最佳多人游戏：《光环无限》（微软）；《Riders Republic》（育碧）；《黑相集：灰冥界》 (万代南梦宫娱乐)\n持续时间最长游戏：《Apex 游戏》（EA）；《黑色沙漠》 (Pearl Abyss Corp.)；《末日地带: 隔离的世界》 (Assemble Entertainment)\n最具原创性的游戏：《骰子遗产》（科赫传媒/Destinybit）；《Riders Republic》（育碧）；《Terrorbane》 (轻语互动)\n2021 年科隆游戏展将会于 8 月 25 日至 8 月 29 日举办，将保留现场展览的形式，同时线上数字展形式也将同步举行。\n参考 ","permalink":"/post/c0-life/games/2021games/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e帝国时代3，现在帝国4！\u003cbr\u003e\n2021 年科隆游戏展奖项提名名单正式公布\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e8 月 23 日，2021 年科隆游戏展的奖项提名名单已经全部揭晓，本次直接涉及游戏的奖项有 21 个，其中获得提名的游戏分别为：\u003c/p\u003e\n\u003cp\u003e最佳微软 Xbox 游戏：《艾尔登法环》（万代南梦宫娱乐）；《孤岛惊魂 6》（育碧）；《光环无限》（微软）\u003c/p\u003e\n\u003cp\u003e最佳任天堂 Switch 游戏：《舞力全开 2022》（育碧）；《马里奥 + 疯狂兔子星耀之愿》 (育碧)\u003c/p\u003e\n\u003cp\u003e最佳 PC 游戏：《帝国时代 4》(微软)；《艾尔登法环》（万代南梦宫娱乐）；《塞伯利亚之谜: 世界之前》 (Astragon Entertainment)\u003c/p\u003e\n\u003cp\u003e最佳索尼 PlayStation 游戏：《艾尔登法环》（万代南梦宫娱乐）；《破晓传说》（万代南梦宫娱乐）；《黑相集：灰冥界》 (万代南梦宫娱乐)\u003c/p\u003e\n\u003cp\u003e最佳动作冒险游戏：《艾尔登法环》（万代南梦宫娱乐）；《马里奥 + 疯狂兔子星耀之愿》 (育碧)；《塞伯利亚之谜: 世界之前》 (Astragon Entertainment)\u003c/p\u003e\n\u003cp\u003e最佳动作游戏：《孤岛惊魂 6》（育碧）；《光环：无限》（微软）；《彩虹六号：异种》（育碧）\u003c/p\u003e\n\u003cp\u003e最佳家庭游戏：《舞力全开 2022》（育碧）；《Run Prop, Run!》（PlayTogether Studio）；《Super Dungeon Maker》 (Rokaplay)\u003c/p\u003e\n\u003cp\u003e最佳独立游戏：《Dorfromantik》（Toukana Interactive）；《Inua》（Arte France）；《Lost in Random》（EA）\u003c/p\u003e\n\u003cp\u003e最佳角色扮演游戏：《艾尔登法环》（万代南梦宫娱乐）；《Encased》（科赫传媒）；《破晓传说》（万代南梦宫娱乐）\u003c/p\u003e\n\u003cp\u003e最佳模拟游戏：《攀登者：天空是极限》(Art Games Studio)；《模拟农场 22》 (Astragon Entertainment)\u003c/p\u003e\n\u003cp\u003e最佳体育游戏：《攀登者：天空是极限》(Art Games Studio)；《FIFA22》（EA）；《Riders Republic》（育碧）\u003c/p\u003e\n\u003cp\u003e最佳策略游戏：《帝国时代 4》 (微软)；《英雄连 3》 (世嘉)；《马里奥 + 疯狂兔子星耀之愿》 (育碧)\u003c/p\u003e","tags":["游戏","转载"],"title":"2021 年科隆游戏展奖项提名名单"},{"categories":["编程"],"content":"背景 2011 年 6 月 11 日 小武哥\n前几天帮同事跟踪的一个程序莫名退出，没有 core dump(当然 ulimit 是打开的) 的问题。我们知道，正常情况下，如果程序因为某种异常条件退出的话，应该会产生 core dump，而如果程序正常退出的话，应该是直接或者间接的调用了 exit() 相关的函数。基于这个事实，我想到了这样一个办法，在程序开始时，通过系统提供的 atexit()，向系统注册一个回调函数，在程序调用 exit() 退出的时候，这个回调函数就会被调用，然后我们在回调函数中打印出当前的函数调用栈，由此便可以知道 exit() 是在哪里调用，从而上述问题便迎刃而解了。上述方法用来解决类似问题是非常行之有效的。在上面，我提到了在 “回调函数中打印出当前的函数调用栈”，相信细心的朋友应该注意到这个了，本文的主要内容就是详细介绍，如何在程序中打印中当前的函数调用栈。\n我之前写过一篇题目为《介绍几个关于 C/C++ 程序调试的函数》的文章，看到这里，请读者朋友先看一下前面这篇，因为本文是以前面这篇文章为基础的。我正是用了 backtrace() 和 backtrace_symbols() 这两个函数实现的，下面是一个简单的例子，通过这个例子我们来介绍具体的方法：\n#include \u0026lt;execinfo .h\u0026gt; #include \u0026lt;stdio .h\u0026gt; #include \u0026lt;stdlib .h\u0026gt; void fun1(); void fun2(); void fun3(); void print_stacktrace(); int main() { fun3(); } void fun1() { printf(\u0026#34;stackstrace begin:\\n\u0026#34;); print_stacktrace(); } void fun2() { fun1(); } void fun3() { fun2(); } void print_stacktrace() { int size = 16; void * array[16]; int stack_num = backtrace(array, size); char ** stacktrace = backtrace_symbols(array, stack_num); for (int i = 0; i \u0026lt; stack_num; ++i) { printf(\u0026#34;%s\\n\u0026#34;, stacktrace[i]); } free(stacktrace); } （说明：下面的介绍采用的环境是 ubuntu 11.04, x86_64, gcc-4.5.2）\n通过下面的方式编译运行： wuzesheng@ubuntu:~/work/test$ gcc test.cc -o test1 wuzesheng@ubuntu:~/work/test$ ./test1 stackstrace begin: ./test1() [0x400645] ./test1() [0x400607] ./test1() [0x400612] ./test1() [0x40061d] ./test1() [0x4005ed] /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xff) [0x7f5c59a91eff] ./test1() [0x400529] 从上面的运行结果中，我们的确看到了函数的调用栈，但是都是 16 进制的地址，会有点小小的不爽。当然我们可以通过反汇编得到每个地址对应的函数，但这个还是有点麻烦了。不急，且听我慢慢道来，看第 2 步。\n通过下面的方式编译运行： wuzesheng@ubuntu:~/work/test$ gcc test.cc -rdynamic -o test2 wuzesheng@ubuntu:~/work/test$ ./test2 stackstrace begin: ./test2(_Z16print_stacktracev+0x26) [0x4008e5] ./test2(_Z4fun1v+0x13) [0x4008a7] ./test2(_Z4fun2v+0x9) [0x4008b2] ./test2(_Z4fun3v+0x9) [0x4008bd] ./test2(main+0x9) [0x40088d] /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xff) [0x7f9370186eff] ./test2() [0x4007c9] 这下终于可以看到函数的名字了，对比一下 2 和 1 的编译过程，2 比 1 多了一个 - rdynamic 的选项，让我们来看看这个选项是干什么的 (来自 gcc mannual 的说明):\n```shell -rdynamic Pass the flag -export-dynamic to the ELF linker, on targets that support it. This instructs the linker to add all symbols, not only used ones, to the dynamic symbol table. This option is needed for some uses of \u0026quot;dlopen\u0026quot; or to allow obtaining backtraces from within a program. ``` 从上面的说明可以看出，它的主要作用是让链接器把所有的符号都加入到动态符号表中，这下明白了吧。不过这里还有一个问题，这里的函数名都是 mangle 过的，需要 demangle 才能看到原始的函数。关于 c++ 的 mangle/demangle 机制，不了解的朋友可以在搜索引擎上搜一下，我这里就不多就介绍了。这里介绍如何用命令来 demangle，通过 c++filt 命令便可以:\n```shell wuzesheng@ubuntu:~/work/test$ c++filt \u0026lt; \u0026lt;\u0026lt; \u0026quot;_Z16print_stacktracev\u0026quot; print_stacktrace() ``` 写到这里，大部分工作就 ok 了。不过不知道大家有没有想过这样一个问题，同一个函数可以在代码中多个地方调用，如果我们只是知道函数，而不知道在哪里调用的，有时候还是不够方便，bingo，这个也是有办法的，可以通过 address2line 命令来完成，我们用第 2 步中编译出来的 test2 来做实验 (address2line 的 - f 选项可以打出函数名, -C 选项也可以 demangle)：\n```shell wuzesheng@ubuntu:~/work/test$ addr2line -a 0x4008a7 -e test2 -f 0x00000000004008a7 _Z4fun1v ??:0 ``` Oh no，怎么打出来的位置信息是乱码呢？不急，且看我们的第 3 步。\n通过下面的方式编译运行：\nwuzesheng@ubuntu:~/work/test$ gcc test.cc -rdynamic -g -o test3 wuzesheng@ubuntu:~/work/test$ ./test3 stackstrace begin: ./test3(_Z16print_stacktracev+0x26) [0x4008e5] ./test3(_Z4fun1v+0x13) [0x4008a7] ./test3(_Z4fun2v+0x9) [0x4008b2] ./test3(_Z4fun3v+0x9) [0x4008bd] ./test3(main+0x9) [0x40088d] /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xff) [0x7fa9558c1eff] ./test3() [0x4007c9] wuzesheng@ubuntu:~/work/test$ addr2line -a 0x4008a7 -e test3 -f -C 0x00000000004008a7 fun1() /home/wuzesheng/work/test/test.cc:20 看上面的结果，我们不仅得到了调用栈，而且可以得到每个函数的名字，以及被调用的位置，大功告成。在这里需要说明一下的是，第 3 步比第 2 步多了一个 - g 选项，-g 选项的主要作用是生成调试信息，位置信息就属于调试信息的范畴，经常用 gdb 的朋友相信不会对这个选项感到陌生。\n在 C/C++ 程序里打印调用栈信息 我们知道，GDB 的 backtrace 命令可以查看堆栈信息。但很多时候，GDB 根本用不上。比如说，在线上环境中可能没有 GDB，即使有，也不太可能让我们直接在上面调试。如果能让程序自己输出调用栈，那是最好不过了。本文介绍和调用椎栈相关的几个函数。\nNAME backtrace, backtrace_symbols, backtrace_symbols_fd - support for application self-debugging SYNOPSIS #include \u0026lt;execinfo.h\u0026gt; int backtrace(void **buffer, int size); char **backtrace_symbols(void *const *buffer, int size); void backtrace_symbols_fd(void *const *buffer, int size, int fd); 以上内容源自这几个函数的 man 手册。\n先简单介绍一下这几个函数的功能： backtrace：获取当前的调用栈信息，结果存储在 buffer 中，返回值为栈的深度，参数 size 限制栈的最大深度，即最大取 size 步的栈信息。 backtrace_symbols：把 backtrace 获取的栈信息转化为字符串，以字符指针数组的形式返回，参数 size 限定转换的深度，一般用 backtrace 调用的返回值。 backtrace_symbols_fd：它的功能和 backtrace_symbols 差不多，只不过它不把转换结果返回给调用方，而是写入 fd 指定的文件描述符。\nMan 手册里，给出了一个简单的实例，我们看一下：\n#include \u0026lt;execinfo.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #define SIZE 100 void myfunc3(void) { int j, nptrs; void *buffer[100]; char **strings; nptrs = backtrace(buffer, SIZE); printf(\u0026#34;backtrace() returned %d addresses\\n\u0026#34;, nptrs); /* The call backtrace_symbols_fd(buffer, nptrs, STDOUT_FILENO) * would produce similar output to the following: */ strings = backtrace_symbols(buffer, nptrs); if (strings == NULL) { perror(\u0026#34;backtrace_symbols\u0026#34;); exit(EXIT_FAILURE); } for (j = 0; j \u0026lt; nptrs; j++) { printf(\u0026#34;%s\\n\u0026#34;, strings[j]); } free(strings); } /* \u0026#34;static\u0026#34; means don\u0026#39;t export the symbol... */ static void myfunc2(void) { myfunc3(); } void myfunc(int ncalls) { if (ncalls \u0026gt; 1) { myfunc(ncalls - 1); } else { myfunc2(); } } int main(int argc, char *argv[]) { if (argc != 2) { fprintf(stderr, \u0026#34;%s num-calls\\n\u0026#34;, argv[0]); exit(EXIT_FAILURE); } myfunc(atoi(argv[1])); exit(EXIT_SUCCESS); } 编译:\n# cc prog.c -o prog 运行：\n# ./prog 0 backtrace() returned 6 addresses ./prog() [0x80485a3] ./prog() [0x8048630] ./prog() [0x8048653] ./prog() [0x80486a7] 这样，是输出了调用栈，不过只是以十六进制输出函数地址而已，可读性很差。仔细看下 man 手册，原来很简单，编译时加上个参数：\n重新编译：\n# cc -rdynamic prog.c -o prog 通过 gcc 手册，我们可以也解下参数的说明:\n-rdynamic Pass the flag -export-dynamic to the ELF linker, on targets that support it. This instructs the linker to add all symbols, not only used ones, to the dynamic symbol table. This option is needed for some uses of \u0026#34;dlopen\u0026#34; or to allow obtaining backtraces from within a program. 再执行：\n# ./prog 0 backtrace() returned 6 addresses ./prog(myfunc3+0x1f) [0x8048763] ./prog() [0x80487f0] ./prog(myfunc+0x21) [0x8048813] ./prog(main+0x52) [0x8048867] /lib/libc.so.6(__libc_start_main+0xe6) [0xaf9cc6] ./prog() [0x80486b1] 这回，可以看到函数名了。是不是很酷呢？把它封装到你的调试代码中吧。\n","permalink":"/post/c8-programming/c-debug/","summary":"\u003ch2 id=\"背景\"\u003e背景\u003c/h2\u003e\n\u003cp\u003e2011 年 6 月 11 日 \u003ca href=\"http://www.wuzesheng.com/?author=2\"\u003e小武哥\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e前几天帮同事跟踪的一个程序莫名退出，没有 core dump(当然 ulimit 是打开的) 的问题。我们知道，正常情况下，如果程序因为某种异常条件退出的话，应该会产生 core dump，而如果程序正常退出的话，应该是直接或者间接的调用了 exit() 相关的函数。基于这个事实，我想到了这样一个办法，在程序开始时，通过系统提供的 atexit()，向系统注册一个回调函数，在程序调用 exit() 退出的时候，这个回调函数就会被调用，然后我们在回调函数中打印出当前的函数调用栈，由此便可以知道 exit() 是在哪里调用，从而上述问题便迎刃而解了。上述方法用来解决类似问题是非常行之有效的。在上面，我提到了在 “回调函数中打印出当前的函数调用栈”，相信细心的朋友应该注意到这个了，本文的主要内容就是详细介绍，如何在程序中打印中当前的函数调用栈。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e我之前写过一篇题目为《\u003ca href=\"http://www.wuzesheng.com/?p=1123\"\u003e介绍几个关于 C/C++ 程序调试的函数\u003c/a\u003e》的文章，看到这里，请读者朋友先看一下前面这篇，因为本文是以前面这篇文章为基础的。我正是用了 backtrace() 和 backtrace_symbols() 这两个函数实现的，下面是一个简单的例子，通过这个例子我们来介绍具体的方法：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;execinfo .h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;stdio .h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;stdlib .h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efun1\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efun2\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efun3\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprint_stacktrace\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efun3\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efun1\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;stackstrace begin:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprint_stacktrace\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efun2\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efun1\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efun3\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efun2\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprint_stacktrace\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e size \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e array[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e stack_num \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebacktrace\u003c/span\u003e(array, size);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003e stacktrace \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebacktrace_symbols\u003c/span\u003e(array, stack_num);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e stack_num; \u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003ei)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%s\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, stacktrace[i]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003efree\u003c/span\u003e(stacktrace);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e（说明：下面的介绍采用的环境是 ubuntu 11.04, x86_64, gcc-4.5.2）\u003c/p\u003e","tags":["c语言","调试"],"title":"「转」在 C/C++ 程序中打印当前函数调用栈"},{"categories":["工具"],"content":"前言\n好久没有更新博客了。RSS这种形式的信息获取方式，似乎又流行起来。\ngithub文件更新 github上面有很多不错的资源。我的流程是：github readme文件更新-\u0026gt;svn下载对应文件-\u0026gt;生成rss文件。\n这里为什么要这么复杂，因为github仓库更新多了好多不需要的rss信息，而且github文件下载比较慢。\n最后效果，获取《经济学人》和《纽约客》的更新～\n下载脚本 解析readme中的地址，自动下载，并生成rss源。\n# -*- coding: utf-8 -*- # /etc/cron.hour from urllib import request import datetime from rfeed import * # 为生成rss.xml的库 import re import os from glob import glob URL=\u0026#34;https://raw.githubusercontent.com/hehonghui/the-economist-ebooks/master/README.md\u0026#34; BASE_URL=\u0026#34;http://your_vps_host/download/\u0026#34; SVN_BASE_URL=\u0026#34;https://github.com/hehonghui/the-economist-ebooks/trunk/\u0026#34; s=\u0026#34;\u0026#34;\u0026#34; * [经济学人 - 周刊, 点击这里下载最新一期](01_economist/te_2021.02.27) , 每周五十一点更新 * [纽约客 - 周刊, 点击这里下载最新一期](02_new_yorker/2021.03.01) , 每周六上午更新 * [卫报 - 每周两期](09_guardian/), 每周三、周日更新 \u0026#34;\u0026#34;\u0026#34; s = request.urlopen(URL).read().decode(\u0026#39;utf8\u0026#39;) res= re.findall(r\u0026#34;\\[.+\\]\\((0.+)\\)\u0026#34;,s)[0:2] # generate xml res_list=[] for item in res: res_list+=sorted(glob(item.split(\u0026#39;/\u0026#39;)[0]+\u0026#34;/*\u0026#34;)) item_list=[] print(item_list) for item in res_list: _one = Item( title = item[3:], link = BASE_URL+item, description = \u0026#39;pdf etc. \u0026lt;a href=\u0026#34;%s\u0026#34;\u0026gt;link\u0026lt;/a\u0026gt; \u0026#39;% (BASE_URL+item), author = \u0026#34;hehonghui\u0026#34;, guid = Guid(BASE_URL+item), pubDate = datetime.datetime(2020, 1, 1, 4, 0)) # year, month, date, hh, mm, ss item_list+=[_one] feed = Feed( title = \u0026#34;经济学人+纽约客更新\u0026#34;, link = \u0026#34;https://www.xxxxx.biz/atom/updated.xml\u0026#34;, description = \u0026#34;更新经济学人，纽约客\u0026#34;, language = \u0026#34;en-US\u0026#34;, lastBuildDate = datetime.datetime.now(), items = item_list) def save_to_file(file_name, contents): fh = open(file_name, \u0026#39;w\u0026#39;) fh.write(contents) fh.close() save_to_file(\u0026#39;test.xml\u0026#39;, feed.rss()) # start downing for item in res: if item not in res_list: print(\u0026#34;downing %s\u0026#34;%item) os.popen(\u0026#34;svn checkout %s %s\u0026#34;%(SVN_BASE_URL+item,item)) _now=sorted(glob(item.split(\u0026#39;/\u0026#39;)[0]+\u0026#34;/*\u0026#34;)) print(_now) if len(_now)\u0026gt;=5: # 最多5个，免得服务器下载过多。 for _d in _now[:-5]: os.popen(\u0026#34;rm -rf %s\u0026#34;%_d) 在linux亦可使用crontab定时启动下载任务。在 /etc/cron.hourly/ 设置即可。\n#!/bin/sh date \u0026gt;\u0026gt; test.log python3 down_ecomic.py \u0026gt;\u0026gt;test.log exit 0 下载某管音频，自动转成mp3格式 某管自带rss的，所以只要用feedparser解析一下，然后调用youtube_dl下载一哈。 各种码包自行安装。\n# -*- coding: utf-8 -*- # # 2020-04-18 # /etc/cron.hour # https://www.runoob.com/w3cnote/linux-crontab-tasks.html from urllib import request import datetime from rfeed import * import re import os from glob import glob import feedparser import pprint URL=\u0026#34;https://www.youtube.com/feeds/videos.xml?channel_id=UCFhp6N5z8W9Ann2eyHAzbbA\u0026#34; rss = feedparser.parse(URL) entries=rss[\u0026#39;entries\u0026#39;][:3] BASE_URL=\u0026#34;http://xxxxx/down_youtube/\u0026#34; item_list=[] for entry in entries: print(entry[\u0026#39;title\u0026#39;]) print(entry[\u0026#39;published\u0026#39;]) print(entry[\u0026#39;link\u0026#39;]) #print(entry[\u0026#39;summary\u0026#39;]) new_link=BASE_URL+\u0026#34;book_audios/%s.mp3\u0026#34;%entry[\u0026#39;yt_videoid\u0026#39;] _one = Item( title = entry[\u0026#39;title\u0026#39;], link = new_link, description = \u0026#39;audio: \u0026lt;a href=\u0026#34;%s\u0026#34;\u0026gt;mp3\u0026lt;/a\u0026gt; %s\u0026#39;% (new_link,entry[\u0026#39;summary\u0026#39;]), author = \u0026#34;Youtube\u0026#34;, guid = Guid(new_link), pubDate = datetime.datetime(2020, 1, 1, 4, 0)) # year, month, date, hh, mm, ss item_list+=[_one] feed = Feed( title = \u0026#34;知乎读书会更新\u0026#34;, link = \u0026#34;https://www.xxxxx.biz/atom/updated.xml\u0026#34;, description = \u0026#34;更新Youtube知乎读书会\u0026#34;, language = \u0026#34;en-US\u0026#34;, lastBuildDate = datetime.datetime.now(), items = item_list) def save_to_file(file_name, contents): fh = open(file_name, \u0026#39;w\u0026#39;) fh.write(contents) fh.close() save_to_file(\u0026#39;audio.xml\u0026#39;, feed.rss()) from os import rename import youtube_dl # start downing if not os.path.exists(\u0026#34;book_audios/\u0026#34;): os.makedirs(\u0026#34;book_audios/\u0026#34;) def audio_download(youtube_url): # 定义某些下载参数 ydl_opts = { \u0026#39;format\u0026#39;: \u0026#39;bestaudio/best\u0026#39;, # \u0026#39;download_archive\u0026#39;: \u0026#39;downloaded_songs.txt\u0026#39;, \u0026#39;outtmpl\u0026#39;: \u0026#39;book_audios/%(id)s.%(ext)s\u0026#39;, \u0026#39;postprocessors\u0026#39;: [{ \u0026#39;key\u0026#39;: \u0026#39;FFmpegExtractAudio\u0026#39;, \u0026#39;preferredcodec\u0026#39;: \u0026#39;mp3\u0026#39;, \u0026#39;preferredquality\u0026#39;: \u0026#39;192\u0026#39;, }], } with youtube_dl.YoutubeDL(ydl_opts) as ydl: ydl.download([youtube_url]) #download(\u0026#39;https://www.youtube.com/watch?v=JElpSrsmbTU\u0026#39;) for entry in entries: if entry[\u0026#39;yt_videoid\u0026#39;]+\u0026#39;.mp3\u0026#39; not in os.listdir(\u0026#39;book_audios\u0026#39;): print(\u0026#34;downing %s, %s\u0026#34;%(entry[\u0026#39;title\u0026#39;], entry[\u0026#39;link\u0026#39;])) audio_download(entry[\u0026#39;link\u0026#39;]) _now=sorted(glob(\u0026#34;book_audios/*\u0026#34;),key=os.path.getctime) print(_now) if len(_now)\u0026gt;=6: # 多余删除 for _d in _now[:-5]: os.popen(\u0026#34;rm -rf %s\u0026#34;%_d) 下载某管视频 # -*- coding: utf-8 -*- # # 2020-04-18 # /etc/cron.hour # https://www.runoob.com/w3cnote/linux-crontab-tasks.html # pip install feedparser youtube_dl from urllib import request import datetime from rfeed import * import re import os from glob import glob import feedparser import pprint from os import rename import youtube_dl def save_to_file(file_name, contents): fh = open(file_name, \u0026#39;w\u0026#39;) fh.write(contents) fh.close() def audio_download(youtube_url, file_root, only_audio=False): # 定义某些下载参数 ydl_opts = { \u0026#39;format\u0026#39;: \u0026#39;best\u0026#39;, \u0026#39;outtmpl\u0026#39;: file_root+\u0026#39;/%(id)s.%(ext)s\u0026#39;, } # 定义某些下载参数 ydl_opts_a = { \u0026#39;format\u0026#39;: \u0026#39;bestaudio/best\u0026#39;, # \u0026#39;download_archive\u0026#39;: \u0026#39;downloaded_songs.txt\u0026#39;, \u0026#39;outtmpl\u0026#39;: file_root+\u0026#39;/%(id)s.%(ext)s\u0026#39;, \u0026#39;postprocessors\u0026#39;: [{ \u0026#39;key\u0026#39;: \u0026#39;FFmpegExtractAudio\u0026#39;, \u0026#39;preferredcodec\u0026#39;: \u0026#39;mp3\u0026#39;, \u0026#39;preferredquality\u0026#39;: \u0026#39;192\u0026#39;, }], } if only_audio: ydl_opts = ydl_opts_a with youtube_dl.YoutubeDL(ydl_opts) as ydl: ydl.download([youtube_url]) class YoutubeDowner: def __init__(self, yurl, burl, file_root, feed_title, only_audio=False): self.yurl = yurl self.burl = burl self.file_root = file_root self.feed_title = feed_title self.feed_des = feed_title self.only_audio = only_audio self.type_name = \u0026#34;mp4\u0026#34; if only_audio: self.type_name = \u0026#34;mp3\u0026#34; rss = feedparser.parse(yurl) self.entries = rss[\u0026#39;entries\u0026#39;][:3] if not os.path.exists(file_root): os.makedirs(file_root) self.generate_xml() self.down() def generate_xml(self): item_list = [] for entry in self.entries: print(entry[\u0026#39;title\u0026#39;],entry[\u0026#39;published\u0026#39;],entry[\u0026#39;link\u0026#39;]) # print(entry[\u0026#39;summary\u0026#39;]) date_s = entry[\u0026#39;published\u0026#39;].split(\u0026#39;T\u0026#39;)[0].split(\u0026#39;-\u0026#39;) dates = [int(x) for x in date_s] # print(dates) new_link = self.burl + \u0026#34;/%s.%s\u0026#34; % (entry[\u0026#39;yt_videoid\u0026#39;],self.type_name) # 下载的实际地址 print(\u0026#39;%s: \u0026lt;a href=\u0026#34;%s\u0026#34;\u0026gt;%s\u0026lt;/a\u0026gt; \u0026lt;pre\u0026gt;%s\u0026lt;/pre\u0026gt;\u0026#39; % (self.type_name,new_link,self.type_name,entry[\u0026#39;summary\u0026#39;])) _one = Item( title = entry[\u0026#39;title\u0026#39;], link = new_link, description = \u0026#39;%s: \u0026lt;a href=\u0026#34;%s\u0026#34;\u0026gt;%s\u0026lt;/a\u0026gt; \u0026lt;pre\u0026gt;%s\u0026lt;/pre\u0026gt;\u0026#39; % (self.type_name,new_link,self.type_name,entry[\u0026#39;summary\u0026#39;]), author = \u0026#34;Youtube\u0026#34;, guid = Guid(new_link), pubDate = datetime.datetime(dates[0], dates[1], dates[2], 6, 0)) # year, month, date, hh, mm, ss item_list+=[_one] feed = Feed( title = self.feed_title, link = \u0026#34;https://www.xxxxx.biz/atom/updated.xml\u0026#34;, description = self.feed_des, language = \u0026#34;en-US\u0026#34;, lastBuildDate = datetime.datetime.now(), items = item_list) save_to_file(\u0026#39;%s.xml\u0026#39; % self.file_root, feed.rss()) def down(self): for entry in self.entries: if entry[\u0026#39;yt_videoid\u0026#39;]+\u0026#39;.\u0026#39;+self.type_name not in os.listdir(self.file_root): print(\u0026#34;downing %s, %s\u0026#34;%(entry[\u0026#39;title\u0026#39;], entry[\u0026#39;link\u0026#39;])) audio_download(entry[\u0026#39;link\u0026#39;], self.file_root, self.only_audio) _now = sorted(glob(self.file_root + \u0026#34;/*\u0026#34;),key=os.path.getctime) print(_now) if len(_now)\u0026gt;=6: # 多余删除 for _d in _now[:-5]: os.popen(\u0026#34;rm -rf %s\u0026#34;%_d) # url_rss = \u0026#34;https://www.youtube.com/feeds/videos.xml?channel_id=UCSs4A6HYKmHA2MG_0z-F0xw\u0026#34; # url_base=\u0026#34;http://xxxxx/\u0026#34; # root=\u0026#34;rss2\u0026#34; # title=\u0026#34;李永乐老师\u0026#34; # YoutubeDowner(url_rss, url_base, root, title) 最后效果如下：\n祝大家使用愉快！\n","permalink":"/post/c7-toolchain/rss-github-file/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e好久没有更新博客了。RSS这种形式的信息获取方式，似乎又流行起来。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"github文件更新\"\u003egithub文件更新\u003c/h2\u003e\n\u003cp\u003egithub上面有很多不错的资源。我的流程是：github readme文件更新-\u0026gt;svn下载对应文件-\u0026gt;生成rss文件。\u003c/p\u003e\n\u003cp\u003e这里为什么要这么复杂，因为github仓库更新多了好多不需要的rss信息，而且github文件下载比较慢。\u003c/p\u003e\n\u003cp\u003e最后效果，获取《经济学人》和《纽约客》的更新～\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"rss_result.png\" \n     alt=\"image-20210724005152399\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch3 id=\"下载脚本\"\u003e下载脚本\u003c/h3\u003e\n\u003cp\u003e解析readme中的地址，自动下载，并生成rss源。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# -*- coding: utf-8 -*-\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# /etc/cron.hour \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e urllib \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e request\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e datetime\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e rfeed \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e# 为生成rss.xml的库\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e re\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e os\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e glob \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e glob\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eURL\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://raw.githubusercontent.com/hehonghui/the-economist-ebooks/master/README.md\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBASE_URL\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://your_vps_host/download/\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSVN_BASE_URL\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://github.com/hehonghui/the-economist-ebooks/trunk/\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003es\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e* [经济学人 - 周刊, 点击这里下载最新一期](01_economist/te_2021.02.27) , 每周五十一点更新\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e* [纽约客 - 周刊, 点击这里下载最新一期](02_new_yorker/2021.03.01) , 每周六上午更新\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e* [卫报 - 每周两期](09_guardian/), 每周三、周日更新\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003es \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e request\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurlopen(URL)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf8\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eres\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e re\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efindall(\u003cspan style=\"color:#e6db74\"\u003er\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\\[.+\\]\\((0.+)\\)\u0026#34;\u003c/span\u003e,s)[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# generate xml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eres_list\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e res:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tres_list\u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003esorted(glob(item\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/*\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eitem_list\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(item_list)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e res_list:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    _one \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Item(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\ttitle \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e item[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        link \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BASE_URL\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eitem,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tdescription \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;pdf etc. \u0026lt;a href=\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026gt;link\u0026lt;/a\u0026gt; \u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e (BASE_URL\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eitem),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        author \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hehonghui\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        guid \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Guid(BASE_URL\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eitem),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        pubDate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e datetime\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edatetime(\u003cspan style=\"color:#ae81ff\"\u003e2020\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)) \u003cspan style=\"color:#75715e\"\u003e# year, month, date, hh, mm, ss\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    item_list\u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e[_one]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efeed \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Feed(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        title \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;经济学人+纽约客更新\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        link \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://www.xxxxx.biz/atom/updated.xml\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        description \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;更新经济学人，纽约客\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        language \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;en-US\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        lastBuildDate \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e datetime\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edatetime\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003enow(),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        items \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e item_list)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esave_to_file\u003c/span\u003e(file_name, contents):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    fh \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e open(file_name, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    fh\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(contents)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    fh\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eclose()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esave_to_file(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;test.xml\u0026#39;\u003c/span\u003e, feed\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erss())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# start downing \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e res:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e res_list:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;downing \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003eitem)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epopen(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;svn checkout \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e(SVN_BASE_URL\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eitem,item))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    _now\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esorted(glob(item\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/*\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(_now)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(_now)\u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e: \u003cspan style=\"color:#75715e\"\u003e# 最多5个，免得服务器下载过多。\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e _d \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e _now[:\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e]:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epopen(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rm -rf \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e_d)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在linux亦可使用\u003ca href=\"https://www.runoob.com/w3cnote/linux-crontab-tasks.html\"\u003ecrontab\u003c/a\u003e定时启动下载任务。在 \u003ccode\u003e/etc/cron.hourly/\u003c/code\u003e 设置即可。\u003c/p\u003e","tags":["rss","知识管理","python"],"title":"RSS跟踪github文件更新+某管子更新"},{"categories":["数学"],"content":"前言 日常生活中，我们面临很多的选择，选择自己最工作offer，选择买哪个牌子的手机，选择哪个地方旅行等等。这些选择难以定量的衡量，有很多不确定性。内心小纠结，我选择了这个，万一那个好呢，怎么办？请看层次分析法。\n层次分析法(Analytic Hierarchy Process，简称 AHP)是对一些较为复杂、较为模糊的问题作出决策的简易方法，它特别适用于那些难于完全定量分析的问题。它是美国运筹学家 T. L. Saaty 教授于上世纪 70 年代初期提出的一种简便、灵活而又实用的多准则决策方法。\n运用层次分析法建模，大体上可按下面四个步骤进行\n建立递阶层次结构模型 构造出各层次中的所有判断矩阵 层次单排序及一致性检验 层次总排序及一致性检验。（一般不用） 让我们从offer大佬的例子开始吧！\n举个栗子，今年有位大学生，有三个offer，C1 C2 C3。\n第一步，建立层次模型。\n目标层A：找工作的目标，自己满意程度。 这个程度怎么计算呢？比如工作1。 准则层B：研究课题、发展前途、待遇、同事情况、地理位置、单位名气等等。 尽量列全一点，不需要排列重要顺序。 小于等于9个，后面要两两拍脑袋给出相对的重要层度，给多了不得把脑袋拍疼了。 也可以有子准则层，比如待遇中的放假、工作环境等等，列出也小于9个。 方案层C：就是我们的offer 构造 A B 之间判断矩阵 准则层B与目标A之间的关系。为了求出准则层中(B1-6) 对目标的重要层度的排序。比如对于该生工作满意度第一重要是待遇，然后是地点，其实该生自己也很模糊。就是固定A，然后求B中准则，对A重要性的排序。\n我们怎么对B中的准则们的重要排序呢？ 直接给每一个准则，0-1的评分，然后排序。经常会想，给完分之后，这个不合理呀要不我再给哪个准则加加分。所以这样的方法常常会因考虑不周全、顾此失彼而使决策者提出与他实际认为的重要性程度不相一致的数据。\n我们可以将这个过程细化，我就比较两个准则对于目标的重要性，然后通过下面的矩阵方法，求出优先顺序。\n还能通过一个一致性检验，来检验在你评分的过程中，有没有自相矛盾的地方，当然这种方法允许一些自相矛盾。反正评分的时候尊从内心拍脑袋就对了。\n所以我们拿出一个B1 与 B2 对于目标的重要，想一想然后给出B2/B1，填入下面的表格中的(2,1)的位置。\n整个矩阵i,j 与j，i 是取倒数的关系，所以只要做一半。\n在找工作的目标下，准则i与j相对的重要性表示，B2/B1 的值。采用9个标度。而相比不重要刻度取倒数就可以了\n准则i比j的比较 1 2 3 4 5 6 7 8 9 相同重要 比较重要 明显重要 强烈重要 极端重要 最后的两两相对重要表格\n对角线对称的两个数互为倒数，即 $$a_{ji}=\\frac{1}{a_{ij}}$$ B1/B2 不就是和 B2/B1互为倒数嘛\n从心理学观点来看，分级太多会超越人们的判断能力，既增加了作判断的难度， 又容易因此而提供虚假数据。Saaty 等人还用实验方法比较了在各种不同标度下人们判断结果的正确性，实验结果也表明，采用 1~9 标度最为合适。\n判断矩阵的一致性指标步骤：\n1）计算一致性指标 CI 。$$CI=\\frac{ \\lambda_{max}-n}{n-1}$$ 2）查表，平均随机一致性指标 RI。 n 1 2 3 4 5 6 7 8 9 RI 0 0 0.58 0.90 1.12 1.24 1.32 1.41 1.45 RI 的值是这样得到的，用随机方法构造500个样本矩阵:随机地从1~9及其倒数中抽取数字构造正互反矩阵，求得最大特征根的平均值 $$\\bar \\lambda_{max}$$ 并定义$$RI=\\frac{\\bar \\lambda_{max}-n}{n-1}$$\n3）计算一致性比例CR。 $$CR=\\frac{CI}{RI}$$，当$$CR\u0026lt;0.10$$ 时，认为判断矩阵的一致性是可以接受的，否则应对判断矩阵作适当修正。 如果一个矩阵满足上面的条件，那么它最大特征值对应的特征向量就可以认为是每个维度的重要性权重。\n构造 B C 之间判断矩阵 相同的方法，在同一B准则下，考虑不同工作的优先顺序。求工作排序的方法，和上面一样。\npython代码1\nimport numpy as np import pandas as pd import warnings class AHP: def __init__(self, criteria, b): self.RI = (0, 0, 0.58, 0.9, 1.12, 1.24, 1.32, 1.41, 1.45, 1.49) self.criteria = criteria self.b = b self.num_criteria = criteria.shape[0] self.num_project = b[0].shape[0] def cal_weights(self, input_matrix): input_matrix = np.array(input_matrix) n, n1 = input_matrix.shape assert n == n1, \u0026#39;不是一个方阵\u0026#39; for i in range(n): for j in range(n): if np.abs(input_matrix[i, j] * input_matrix[j, i] - 1) \u0026gt; 1e-7: raise ValueError(\u0026#39;不是反互对称矩阵\u0026#39;) eigenvalues, eigenvectors = np.linalg.eig(input_matrix) max_idx = np.argmax(eigenvalues) max_eigen = eigenvalues[max_idx].real eigen = eigenvectors[:, max_idx].real eigen = eigen / eigen.sum() if n \u0026gt; 9: CR = None warnings.warn(\u0026#39;无法判断一致性\u0026#39;) else: CI = (max_eigen - n) / (n - 1) CR = CI / self.RI[n] return max_eigen, CR, eigen def run(self): max_eigen, CR, criteria_eigen = self.cal_weights(self.criteria) print(\u0026#39;准则层：最大特征值{:\u0026lt;5f},CR={:\u0026lt;5f},检验{}通过\u0026#39;.format(max_eigen, CR, \u0026#39;\u0026#39; if CR \u0026lt; 0.1 else \u0026#39;不\u0026#39;)) print(\u0026#39;准则层权重={}\\n\u0026#39;.format(criteria_eigen)) max_eigen_list, CR_list, eigen_list = [], [], [] for i in self.b: max_eigen, CR, eigen = self.cal_weights(i) max_eigen_list.append(max_eigen) CR_list.append(CR) eigen_list.append(eigen) pd_print = pd.DataFrame(eigen_list, index=[\u0026#39;准则\u0026#39; + str(i) for i in range(self.num_criteria)], columns=[\u0026#39;方案\u0026#39; + str(i) for i in range(self.num_project)], ) pd_print.loc[:, \u0026#39;最大特征值\u0026#39;] = max_eigen_list pd_print.loc[:, \u0026#39;CR\u0026#39;] = CR_list pd_print.loc[:, \u0026#39;一致性检验\u0026#39;] = pd_print.loc[:, \u0026#39;CR\u0026#39;] \u0026lt; 0.1 print(\u0026#39;方案层\u0026#39;) print(pd_print) # 目标层 obj = np.dot(criteria_eigen.reshape(1, -1), np.array(eigen_list)) print(\u0026#39;\\n目标层\u0026#39;, obj) print(\u0026#39;最优选择是方案{}\u0026#39;.format(np.argmax(obj))) return obj if __name__ == \u0026#39;__main__\u0026#39;: # 准则重要性矩阵 criteria = np.array([[1, 2, 7, 5, 5], [1 / 2, 1, 4, 3, 3], [1 / 7, 1 / 4, 1, 1 / 2, 1 / 3], [1 / 5, 1 / 3, 2, 1, 1], [1 / 5, 1 / 3, 3, 1, 1]]) # 对每个准则，方案优劣排序 b1 = np.array([[1, 1 / 3, 1 / 8], [3, 1, 1 / 3], [8, 3, 1]]) b2 = np.array([[1, 2, 5], [1 / 2, 1, 2], [1 / 5, 1 / 2, 1]]) b3 = np.array([[1, 1, 3], [1, 1, 3], [1 / 3, 1 / 3, 1]]) b4 = np.array([[1, 3, 4], [1 / 3, 1, 1], [1 / 4, 1, 1]]) b5 = np.array([[1, 4, 1 / 2], [1 / 4, 1, 1 / 4], [2, 4, 1]]) b = [b1, b2, b3, b4, b5] a = AHP(criteria, b).run() 层次分析法与控制变量法 我们的任务是选择工作，最后使得我们满意，直接选择我们当然一头雾水。所以我们设立一些准则，然后对这些准则对于目标的重要性排序。\n这又有点像概率图模型，只是赋权的方法，是相互比较的方法。\n选择困难者的福音？ 层次分析法对人们的思维过程进行了加工整理，提出了一套系统分析问题的方法，为科学管理和决策提供了较有说服力的依据。\n在应用层次分析法研究问题时，遇到的主要困难有两个:\n(1) 如何根据实际情况抽象出较为贴切的层次结构;\n(2) 如何将某些定性的量作比较接近实际定量化处理。\n层次分析法的其局限性2：\n(1) 它在很大程度上依赖于人们的经验，主观因素的影响很大，它至多只能排除思维过程中的严重非一致性，却无法排除决策者个人可能存在的严重片面性。\n(2) 比较、 判断过程较为粗糙，不能用于精度要求较高的决策问题。\n所以，AHP 至多只能算是一种半定量(或定性与定量结合)的方法。 本文仅供参考，不负法律责任，哈哈。\n参考 幼鹰me 知乎 层次分析法原理与Python实现\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n司守奎《数学建模算法与程序》第八章 层次分析法 P167\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"/post/c1-math/ahp/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e日常生活中，我们面临很多的选择，选择自己最工作offer，选择买哪个牌子的手机，选择哪个地方旅行等等。这些选择难以定量的衡量，有很多不确定性。内心小纠结，我选择了这个，万一那个好呢，怎么办？请看层次分析法。\u003c/p\u003e\n\u003cp\u003e层次分析法(Analytic Hierarchy Process，简称 AHP)是对一些较为复杂、较为模糊的问题作出决策的简易方法，它特别适用于那些难于完全定量分析的问题。它是美国运筹学家 T. L. Saaty 教授于上世纪 70 年代初期提出的一种简便、灵活而又实用的多准则决策方法。\u003c/p\u003e\n\u003cp\u003e运用层次分析法建模，大体上可按下面四个步骤进行\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e建立递阶层次结构模型\u003c/li\u003e\n\u003cli\u003e构造出各层次中的所有判断矩阵\u003c/li\u003e\n\u003cli\u003e层次单排序及一致性检验\u003c/li\u003e\n\u003cli\u003e层次总排序及一致性检验。（一般不用）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e让我们从offer大佬的例子开始吧！\u003c/p\u003e\n\u003cp\u003e举个栗子，今年有位大学生，有三个offer，C1 C2 C3。\u003c/p\u003e\n\u003cp\u003e第一步，建立层次模型。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e目标层A：找工作的目标，自己满意程度。\n\u003cul\u003e\n\u003cli\u003e这个程度怎么计算呢？比如工作1。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e准则层B：研究课题、发展前途、待遇、同事情况、地理位置、单位名气等等。\n\u003cul\u003e\n\u003cli\u003e尽量列全一点，不需要排列重要顺序。\u003c/li\u003e\n\u003cli\u003e小于等于9个，后面要两两拍脑袋给出相对的重要层度，给多了不得把脑袋拍疼了。\u003c/li\u003e\n\u003cli\u003e也可以有子准则层，比如待遇中的放假、工作环境等等，列出也小于9个。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e方案层C：就是我们的offer\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"image-20200406145535585.png\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch2 id=\"构造-a-b-之间判断矩阵\"\u003e构造 A B 之间判断矩阵\u003c/h2\u003e\n\u003cp\u003e准则层B与目标A之间的关系。为了求出准则层中(B1-6) 对目标的重要层度的排序。比如对于该生工作满意度第一重要是待遇，然后是地点，其实该生自己也很模糊。就是固定A，然后求B中准则，对A重要性的排序。\u003c/p\u003e\n\u003ch3 id=\"我们怎么对b中的准则们的重要排序呢\"\u003e我们怎么对B中的准则们的重要排序呢？\u003c/h3\u003e\n\u003cp\u003e直接给每一个准则，0-1的评分，然后排序。经常会想，给完分之后，这个不合理呀要不我再给哪个准则加加分。所以这样的方法常常会因考虑不周全、顾此失彼而使决策者提出与他实际认为的重要性程度不相一致的数据。\u003c/p\u003e\n\u003cp\u003e我们可以将这个过程细化，我就比较两个准则对于目标的重要性，然后通过下面的矩阵方法，求出优先顺序。\u003c/p\u003e\n\u003cp\u003e还能通过一个一致性检验，来检验在你评分的过程中，有没有自相矛盾的地方，当然这种方法允许一些自相矛盾。反正评分的时候尊从内心拍脑袋就对了。\u003c/p\u003e\n\u003cp\u003e所以我们拿出一个B1 与 B2 对于目标的重要，想一想然后给出B2/B1，填入下面的表格中的(2,1)的位置。\u003c/p\u003e\n\u003cp\u003e整个矩阵i,j 与j，i 是取倒数的关系，所以只要做一半。\u003c/p\u003e\n\u003cp\u003e在找工作的目标下，准则i与j相对的重要性表示，B2/B1 的值。采用9个标度。而相比不重要刻度取倒数就可以了\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e准则i比j的比较\u003c/th\u003e\n          \u003cth\u003e1\u003c/th\u003e\n          \u003cth\u003e2\u003c/th\u003e\n          \u003cth\u003e3\u003c/th\u003e\n          \u003cth\u003e4\u003c/th\u003e\n          \u003cth\u003e5\u003c/th\u003e\n          \u003cth\u003e6\u003c/th\u003e\n          \u003cth\u003e7\u003c/th\u003e\n          \u003cth\u003e8\u003c/th\u003e\n          \u003cth\u003e9\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e相同重要\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e比较重要\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e明显重要\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e强烈重要\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e极端重要\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e最后的两两相对重要表格\u003c/p\u003e","tags":["层次分析法","python"],"title":"选择困难者的福音？层次分析法"},{"categories":["编程"],"content":"原标题：除了 Linus，地表最强大的还有这 14 位程序员，速来膜拜！\n导语：IT world 曾经做过一次调查，这个世界上最强大的 15 位程序员，到底是？\n文 / IT world\n译 / 优达菌\n转自 / 优达学城 2018\n原文地址 https://www.sohu.com/a/223302790_700886\n当和技术基友谈论起 “谁是世界上最顶级的程序员” 的话题时，总是分分钟能引发骂战，优秀的程序员太多了，要评出最优秀的，貌似真的不容易。\nIT world 曾经就做过一次调查，当说到谁是世界上健在且最顶级的程序员时，这 15 个人的名字总是能浮现出来，是公认的还是有争议的，是真 · 大神还是伪 · 大神？一起来看看吧~\nMargaret Hamilton 作为 15 位上榜者中唯一女性，玛格丽特被誉为是 “阿波罗飞行控制软件背后的大脑”。\n作为查尔斯 · 斯塔克 · 德雷珀实验室（Charles Stark Draper Laboratory）软件工程部的老大，她组建了一个团队，负责设计和制造阿波罗舰载飞行控制器软件和空间实验室。\n基于这段经历，她开发了通用系统语言（Universal Systems Language）和开发先于事实（ Development Before the Fact）的范例，首先提出异步软件、优先调度和高可信度的软件设计理念。“软件工程（ software engineering）” 这个名字，公认是由她首先发明的。\n1986 年，玛格丽特获得了奥古斯塔 · 埃达 · 洛夫莱斯奖，2003 年获得 NASA 卓越太空行动奖。\n世人评价：\n“她发明了测试，很大程度上规范了美国的计算机工程” —— ford_beeblebrox\n“在她之前，计算机编程只是个数学分支。然而这个宇宙空间的飞行控制系统，清晰地将编程引入到一个截然不同的领域。” —— Dan Allen\n“\u0026hellip; 她发明了‘软件工程’这个词，并作出了最好的示范。” —— David Hamilton\nDonald Knuth 唐纳德 · 克努斯的中文名叫 “高德纳”，几乎是中国程序员永远的偶像之一。他最主要的成就，就是《计算机编程艺术》的作者。\n高德纳写出了计算机编程领域的红宝书，发明了 Tex 数字排版系统，获得了无数的荣耀。1971 年，他获得了第一届葛丽丝 · 穆雷 · 霍普奖（Grace Murray Hopper Award） 奖。1974 年获得了图灵奖，当时他才 36 岁\u0026hellip;.1979 年又获得了美国国家科学奖章，95 年解锁 IEEE 约翰 · 冯 · 诺依曼奖章，98 年，他入选为计算机历史博物馆名人堂的成员之一。\n世人评价：\n“\u0026hellip; 《计算机编程艺术》这本书，估计是有史以来关于计算机编程最牛逼的贡献。”—— 匿名\n“他发明的 TeX ，是我所用过的唯一一个几乎没有 bug 的计算机软件，真让人心悦诚服”—— Jaap Weel\n“如果你要问我的话，他简直是前无古人后无来者！” —— Mitch Rees-Jones\nKen Thompson 作为 “Unix 之父”，肯 · 汤普森足够在这个榜单占据一席之地。\n他与丹尼斯 · 里奇（Dennis Ritchie）共同创造了 Unix 操作系统。此外，他还发明了 B 语言、UTF-8 字符编码规范、ed 文本编辑器，同时也是 Go 语言的共同开发者之一。\n肯 · 汤普森获奖无数，1983 年他获得图灵奖，1994 年获得 IEEE 计算机先锋奖，1998 年获颁美国国家科技奖章。在 1997 年入选成为计算机历史博物馆名人堂的一员。\n世人评论：\n“\u0026hellip; 他可能是有史以来最具成就的程序员了。Unix 内核，Unix 工具，国际象棋程序世界冠军 Belle，Plan 9，Go 语言，无人可比” —— Pete Prokopowicz\n“他所做出的贡献影响深刻，而且经得住时间的考验，时至今日，我们还在享受着他的智慧成果。” —— Jan Jannink\nRichard Stallman 作为 Emacs 和 GCC 的缔造者，是他最大的成就之一。\n理查德是 GNU 项目的创立者，为其开发了很多核心工具，如 Emacs、GCC、GDB 和 GNU Make 等等。他还创办了自由软件基金会。1990 年荣获葛丽丝 · 穆雷 · 霍普奖，1998 年获得 EFF 先锋奖.\n世人评论：\n“他在编程上的造诣和思想，形成了一整套计算机编程的亚文化。” —— Dan Dunay\n“我并不百分百认同他，但不可否认，他的确是足够载入史册的伟大的程序员。” —— Marko Poutiainen\n“假设 Linux 写出来的时候，如果没有 GNU 工程的前期工作会怎么样。多亏了他！” —— John Burnette\nAnders Hejlsberg 身为 Turbo Pascal 的缔造者兼 C# 之父，安德斯也是非常牛逼的！Turbo Pascl 可谓是历史上最受欢迎的编译器之一，也是首个集成开发环境（IDE）。他还主导开发了 Turbo Pascal 的继任者 Delphi ，他还是 C# 的首席架构师。\n2001 年，他荣获了 Dr. Dobb 的杰出编程奖\n生平： Turbo Pascal 的原作者，是最流行的 Pascal 编译器和第一个集成开发环境。而后，领导了 Turbo Pascal 的继任者 Delphi 的构建。C# 的主要设计师和架构师。2001 年荣获 Dr. Dobb’s 杂志颁发的 “杰出编程奖”。\n世人评论：\n“他用汇编语言写了 Pascal 编译器，支持当时 PC 端的两种主流操作系统（DOS 和 CP/M）。用它来编译链接程序并运行的时间，从几分钟减少到了几秒钟。” —— Steve Wood\nDoug Cutting 康婷开发了 Lucene 搜索引擎、 网络爬虫 Nutch 和分布式大型数据处理工具 Hadoop。此外，他还是一位坚定而热情的开源支持者（Lucene、Nutch 以及 Hadoop 都是开源的）。他还担任过前 Apache 软件基金的理事。\n世人评论：\n“\u0026hellip; 他写出了杰出的搜索引擎框架（Lucene/solr），为世界开启大数据之门（Hadoop）。” —— Rajesh Rao\nSanjay Ghemawat 这位谷歌核心架构师，参与设计和实现了一些谷歌大型分布式系统的功能，包括 MapReduce、BigTable、Spanner 和谷歌文件系统。还编写了 Unix 的 ical 日历系统。\n他于 2009 年入选美国国家工程院。2012 年荣获 ACM 计算机科学奖。\n世人评论：\n“Jeff Dean 的左膀右臂。” —— Ahmet Alp Balkan\nJeff Dean 身为谷歌搜索索引的大脑，他参与设计和实现了许多谷歌大型分布式系统的功能，包括网页爬虫，索引搜索，AdSense，MapReduce，BigTable 和 Spanner。\n2009 年，杰夫获得美国国家工程院奖。2012 年荣获 ACM SIGOPS 马克 · 维瑟奖和 ACM 计算机科学奖。\n世人评论：\n“\u0026hellip; 他在数据挖掘领域（GFS、MapReduce、BigTable）上取得了重大突破。” —— Natu Lauchande\nLinus Torvalds 他是 Linux 的缔造者，创建了 Linux 内核与开源的版本控制系统 Git。\n1998 年，他获得了 EFF 先锋奖，2000 年荣获英国电脑学会授予的洛夫莱斯勋章，2012 年的千禧技术奖，2014 年 IEEE 计算机学会授予的计算机先锋奖。他同样入选了 2008 年的计算机历史博物馆名人堂。\n世人评论：\n“他只花了几年，就写出了 Linux 内核，而 GNU Hurd（一个 GNU 开发的内核项目）历经 25 年，却还是一个 demo。” —— Erich Ficker\n“他是程序员的程序员。” —— Dan Allen\nJohn Carmack 他是 《毁灭战士》Doom 之父， ID Software 的联合创始人，开发了一系列极具影响力的 FPS 游戏，比如《德军总部 3D》（Wolfenstein 3D）、《毁灭战士》（Doom）和《雷神之锤》（Quake）等。\n他还是计算机图形技术领域的先锋，在图形学上多次取得重要突破：包括自适应性图块刷新（adaptive tile refresh），二叉空间分割（BSP），以及表面缓存技术等等。\n他在 2001 年入选交互式艺术与科学学院名人堂，并在 2007 年和 2008 年两次获得艾美奖工程和技术类奖项，并于 2010 年获得游戏开发者选择终身成就奖。\n世人评价：\n“他写第一个渲染引擎的时候不到 20 岁。真是个天才。” —— Alex Dolinsky\n“\u0026hellip; 德军总部 3D、毁灭战士还有雷神之锤，这些革命性的游戏，影响了一代游戏设计师。” —— dniblock\n“给他一个周末，他可以写出任何东西\u0026hellip;.” —— Greg Naughton\n“他是编程界的莫扎特\u0026hellip;” —— Chris Morris\nFabrice Bellard 他是 QEMU 之父，是众多著名开源软件的作者，包括硬件模拟和虚拟化的平台 QEMU，处理多媒体数据的 FFmpeg，还有 Tiny C 编译器和 LZEXE，这是一个执行文件压缩的软件。\n他是 2000 年和 2001 年 C 语言混乱代码大赛的冠军，2011 年 荣获 Google-O\u0026rsquo;Reilly 开源奖。此外，他还解锁了计算圆周率小数点后位数最多的世界纪录成就。\n世人评价：\n“我觉得他的工作实在是太伟大了。” —— raphinou\n“他简直是世界上最高产的程序员\u0026hellip;” —— Pavan Yara\nJon Skeet “他根本不需要调试器，他盯下代码，bug 便会羞愧地原形毕露。” 这是世人对他的评价，他作为 Stack Overflow 传说级贡献者，保持着有史以来在 Stack Overflow 上最高的声誉，要知道，他平均每月解答高达 390 个问题！！！\n此外，他还是 Google 工程师，《C# in Depth》的作者。\n“如果他的代码没有通过编译，那么编译器应该道歉。” —— Dan Dyer\n“他根本不需要什么编程规范，他的代码本身就是编程规范。” —— 匿名\nAdam D\u0026rsquo;Angelo 他是” 海外知乎 “—— Quora 的创始人之一，他最早是 Facebook 工程师时，为其搭建了 News Feeds 的基础功能，成为了 Facebook 的 CTO 和 工程 VP。后面离职创办了现在的 Quora 。\n他的经历很传奇，2001 年以还是一名高中生的他，在美国计算机奥林匹克竞赛排名上第八位。在 2004 年 ACM 国际大学生编程大赛获得银牌。2005 年闯入了 Topcoder 大学生算法编程挑战赛的决赛。\n他是马克 · 扎克伯格的所谓的 6 个人之一（不懂请 Google）\n世人评论：\n“这是一位万能的程序员。” —— 匿名\nPetr Mitrechev 他被誉为 “有史以来最具竞赛能力的程序员”，的确，看看他的履历就知道了：2000 年和 2002 年，他在国际信息学奥林匹克竞赛中两次获得金牌。2006 年，赢得 Google 代码挑战赛和 TopCoder 公开算法大赛冠军。他还是两次 Facebook 黑客杯的冠军。\n世人评价：\n“他简直是竞技程序员的偶像，即使是在我们印度” —— Kavish Dwivedi\nGennady Korotkevich 榜单最后一位，是位竞技编程小神童，他是国际信息学奥林匹克竞赛的历史中，年纪最小参赛者（11 岁），并且 6 次获得金牌 (2007~2012)。2013 年，他在 ACM 国际大学生编程大赛获胜，同时还是 2014 Facebook 黑客杯的获胜者。\n写这篇文章的时候，他在 Codeforces 榜排名第一 （ID：Tourist）、TopCoder 榜也是第一。\n世人评价：\n“当之无愧的编程神童！” —— Prateek Joshi\n大神级别的程序员太多了！并不是一篇文章就能说明白道清楚，如果你还有推荐的大神，欢迎在本文评论中和大家分享下。\n— 完 —\n","permalink":"/post/c8-programming/cs-fonters/","summary":"\u003cp\u003e原标题：除了 Linus，地表最强大的还有这 14 位程序员，速来膜拜！\u003c/p\u003e\n\u003cp\u003e导语：IT world 曾经做过一次调查，这个世界上最强大的 15 位程序员，到底是？\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e文 / IT world\u003c/p\u003e\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e译 / 优达菌\u003c/p\u003e\n\u003cp\u003e转自 / 优达学城 2018\u003c/p\u003e\n\u003cp\u003e原文地址 \u003ca href=\"https://www.sohu.com/a/223302790_700886\"\u003ehttps://www.sohu.com/a/223302790_700886\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e当和技术基友谈论起 “谁是世界上最顶级的程序员” 的话题时，总是分分钟能引发骂战，优秀的程序员太多了，要评出最优秀的，貌似真的不容易。\u003c/p\u003e\n\u003cp\u003eIT world 曾经就做过一次调查，当说到谁是世界上健在且最顶级的程序员时，这 15 个人的名字总是能浮现出来，是公认的还是有争议的，是真 · 大神还是伪 · 大神？一起来看看吧~\u003c/p\u003e\n\u003cimg src=\"cs-fonters/3e28c4606b644378b652dc9c3716da02.jpeg\" style=\"zoom:33%;\" /\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"margaret-hamilton\"\u003eMargaret Hamilton\u003c/h2\u003e\n\u003cimg src=\"cs-fonters/264f0ac3e2254ea8b1f91eac42632e1c.jpeg\" style=\"zoom:33%;\" /\u003e\n\u003cp\u003e作为 15 位上榜者中唯一女性，玛格丽特被誉为是 “\u003cstrong\u003e阿波罗飞行控制软件背后的大脑\u003c/strong\u003e”。\u003c/p\u003e\n\u003cp\u003e作为查尔斯 · 斯塔克 · 德雷珀实验室（Charles Stark Draper Laboratory）软件工程部的老大，她组建了一个团队，负责设计和制造阿波罗舰载飞行控制器软件和空间实验室。\u003c/p\u003e\n\u003cp\u003e基于这段经历，她开发了通用系统语言（Universal Systems Language）和开发先于事实（ Development Before the Fact）的范例，首先提出异步软件、优先调度和高可信度的软件设计理念。“软件工程（ software engineering）” 这个名字，公认是由她首先发明的。\u003c/p\u003e\n\u003cp\u003e1986 年，玛格丽特获得了奥古斯塔 · 埃达 · 洛夫莱斯奖，2003 年获得 NASA 卓越太空行动奖。\u003c/p\u003e","tags":["人物","历史","计算机","转载"],"title":"「转」地表最强大的还有这 14 位程序员"},{"categories":["人工智能"],"content":"前言\n路漫漫其修远兮，吾将上下而求索。2013年，大二接触人工智能课，讲逻辑推理，专家系统等等，神经网络只是一部分，打开当时老师的ppt，还能看到BP等算法。接着在2015年，上了模式识别课程，有一些启发式算法，KNN K-means等算法，同时神经网络也已经有了 GoogLeNet 等深层网络，热门的GAN网络也在2014年被提出。后面，机遇巧合，本科毕业时选了人工智能的坑，直到3年后的现在算是明白了一点。接下来的三年的目标还是 成为一名优秀的算法工程师。\n回望入坑 机器学习，没有系统地整理过相关知识。于是想着手整理一份自己笔记系列。本文为序。\n雄关漫道真如铁，而今迈步从头越。\n图1 机器学习知识框架 如图1 所示，整个系列将由五个部分组成。 一、机器学习基础 二、监督学习 图 监督学习 三、无监督学习 图 无监督学习 四、学习理论 图 学习理论 4.1 正则化 五、强化学习 六、参考与规划 目标 通过阅读以上基本书，打牢自己的理论基础。\n书籍\nPRML Bishop 机器学习 周志华 统计学习 李航 深度学习 Goodfellow 模式识别 张学工 课程\nhttps://www.bilibili.com/video/av70839977\n博客编写\n前言介绍，包括作者，背景，原始paper，和以上基本书的对应章节。 原理阐述，算法步骤写出。 案例分析 利用python写出代码，先用scilearn写。 总结，预告。 ","permalink":"/post/c3-ai/machine-leanring-summary/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e路漫漫其修远兮，吾将上下而求索。2013年，大二接触人工智能课，讲逻辑推理，专家系统等等，神经网络只是一部分，打开当时老师的ppt，还能看到BP等算法。接着在2015年，上了模式识别课程，有一些启发式算法，KNN K-means等算法，同时神经网络也已经有了 GoogLeNet 等深层网络，热门的GAN网络也在2014年被提出。后面，机遇巧合，本科毕业时选了人工智能的坑，直到3年后的现在算是明白了一点。接下来的三年的目标还是 \u003ca href=\"https://talengu.github.io/public/2018/10/01/AI/how_algorithm_engineer/\"\u003e成为一名优秀的算法工程师\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e回望入坑 \u003cstrong\u003e机器学习\u003c/strong\u003e，没有系统地整理过相关知识。于是想着手整理一份自己笔记系列。本文为序。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e雄关漫道真如铁，而今迈步从头越。\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"1564034058070.png\" \n     alt=\"1564034058070\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e 图1 机器学习知识框架\u003c/div\u003e\n如图1 所示，整个系列将由五个部分组成。\n\u003c!-- more --\u003e\n\u003ch2 id=\"一机器学习基础\"\u003e一、机器学习基础\u003c/h2\u003e\n\u003ch2 id=\"二监督学习\"\u003e二、监督学习\u003c/h2\u003e\n\u003cimg src=\"ML_summary/1564034419203.png\" alt=\"1564034419203\" style=\"zoom:67%;\" /\u003e\n\u003cdiv align='center'\u003e 图 监督学习\u003c/div\u003e\n\u003ch2 id=\"三无监督学习\"\u003e三、无监督学习\u003c/h2\u003e\n\u003cimg src=\"ML_summary/1564034460034.png\" alt=\"1564034460034\" style=\"zoom:67%;\" /\u003e\n\u003cdiv align='center'\u003e 图 无监督学习\u003c/div\u003e\n\u003ch2 id=\"四学习理论\"\u003e四、学习理论\u003c/h2\u003e\n\u003cimg src=\"ML_summary/xuexililun.png\" alt=\"xuexililun\" style=\"zoom:67%;\" /\u003e\n\u003cdiv align='center'\u003e 图 学习理论\u003c/div\u003e\n\u003ch3 id=\"41-正则化\"\u003e4.1 \u003ca href=\"regulation_baysian.md\"\u003e正则化\u003c/a\u003e\u003c/h3\u003e\n\u003ch2 id=\"五强化学习\"\u003e五、强化学习\u003c/h2\u003e\n\u003ch2 id=\"六参考与规划\"\u003e六、参考与规划\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e目标\u003c/strong\u003e\n通过阅读以上基本书，打牢自己的理论基础。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e书籍\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePRML Bishop\u003c/li\u003e\n\u003cli\u003e机器学习 周志华\u003c/li\u003e\n\u003cli\u003e统计学习 李航\u003c/li\u003e\n\u003cli\u003e深度学习 Goodfellow\u003c/li\u003e\n\u003cli\u003e模式识别 张学工\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e课程\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.bilibili.com/video/av70839977\"\u003ehttps://www.bilibili.com/video/av70839977\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e博客编写\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e前言介绍，包括作者，背景，原始paper，和以上基本书的对应章节。\u003c/li\u003e\n\u003cli\u003e原理阐述，算法步骤写出。\u003c/li\u003e\n\u003cli\u003e案例分析\u003c/li\u003e\n\u003cli\u003e利用python写出代码，先用scilearn写。\u003c/li\u003e\n\u003cli\u003e总结，预告。\u003c/li\u003e\n\u003c/ul\u003e","tags":["机器学习"],"title":"机器学习系列"},{"categories":["生活"],"content":"前言\n《形象美学》这本书是我偶然间看到的，本人很少买衣服，自认为衣品极差，被老妈诟病。以前的观点是多买，买一些品牌好的。每当要去买衣服的时候（计划一年两次），总是有很多困扰。图书馆看到此书，恰合我意，翻阅全书，或许有望提高衣品，提升人生品味了，哈哈哈。\n此书的作者是一位研究人物形象设计的大学教师，并有着多年服装顾问的实战经验。书前四章有很多服装的基础理论，搭配等技巧，书后两章给出驭装的细节方法和一个必备的衣服仓库的采购整理建议。本博文中将整理书中的重点，供各位同好们参考。\n此书历经10 年完成（书中官方介绍），分为塑型、悦色、妆饰、驭装、理橱、博雅六个章节。书本主要分析了衣服的材质、款式、色彩、场合，以期帮助读者从尊重、认识、爱上自己的长相与身材开始，到认识与识别商品进行实践，最终达到人衣匹配，内外合一的境界。\n本博文将此书内容分为两个部分阐述。博文第一部分为塑型、悦色、妆饰、驭装，代表着从材质、款式、色彩和场合四个角度分析衣服，为衣服的基本原理；博文第二部分理橱、博雅，为实践部分，即整理衣服鞋帽，合理配置。\n一、基本理论 衣服的基本理论分为材质、款式、色彩和场合四个方面。\n1. 材质 按面料材质分：天然纤维面料、化学纤维、混纺面料。\n天然纤维面料 棉织物 易掉色 日常休闲、随和温柔、平实、易于亲近 麻织物 易折皱 随性率真、污垢易除 丝织物 比较难打理 毛织物 毛衣 丝毛洗涤剂 丝织物 少见 化学纤维 再生纤维 易掉色 天丝纤维 随性率真、污垢易除 莫代尔纤维 木材、内衣 醋酯纤维 光泽感、[天鹅绒织锦] 合成纤维 混纺面料 比如 毛衣 涤纶（30%-40%）、氨纶（3%-7%） 按纺织工艺分：梭织、针织。\n纺织工艺 梭织 斜纹、平纹、缎纹 针织 手感好，不保形，挺括 面料档次\n档 低 普通化学 普通 棉、麻 中档 天丝、氨纶 高档 羊毛织物、桑蚕丝织物、小牛皮、小羊皮 顶级 羊绒织物、羊驼毛织物 材料小结：相近材料越轻越好（羊毛\u0026lt;羊绒），材料对齐格子和条纹。\nTip: 与其花便宜价钱买回一堆无用的东西，不如花一些心思在辨别服装的档次和价值上。购回衣服一定要试穿（材质和版型）。\n2. 款式 款式，即衣服的型。包括轮廓、量感、比例。\n2.1 轮廓 轮廓 直线 粗：力量，霸气 细：秀气，敏锐灵动 直线+曲线 曲线 大曲线：浪漫、妩媚、经典、奢华、或熟惑。小曲线：可爱、秀美、温柔、年轻化。 配饰、衣物上图案中也有直 中 曲。\n直线：格子、条纹、几何形。 中：动物纹、字母、波普艺术图案。 曲：波点（圆点）、花卉、波纹线，佩花纹理线 2.2 量感 描述 面料 配饰 重型 多变 牛仔布/皮革 夸张 适中 线形柔和 棉麻、针织、磨砂皮 适中 轻 平实 常见 变化少 真丝、纱、薄针织 小巧可爱 2.3 比例 服装轮廓对应身材，服装图案和装饰对应人脸。\n“型”形式美法则\n统一与变化 节奏与韵律。宽窄：上宽下窄。长短：内外。上长下短，不要一样。 经典款式上融入当季流行的元素。\n3. 色彩 3.1 色彩分类 色彩分类 无彩色 黑白灰 有彩色 红橙黄绿蓝紫 明快艳丽 +白 轻快爽朗 +灰 优雅含蓄 +黑 沉稳庄重 独立色 金银 不建议日常 色彩三要素：色相、明度（亮度）、纯色（彩度）\n色相：基础色，色系。冷暖。 伊登色相环 色立体\n明度：加白色，亮暗，浅深。\n纯度：色彩饱和和纯净程度。常用鲜艳，浑浊或艳。鲜与灰。\n平常说的亮，指的是明度而非纯度。 色相，冷与暖；明度，亮与暗（浅与深）；纯度，鲜艳与浑浊（鲜与灰）。\n3.2 肤色 肤色 肤色色相 冷暖 冷：泛青，或黄至青灰的肤色，如小麦色，古铜色，橄榄色。暖：偏黄或偏红的肤色，如象牙色，黄橙色，咖啡色 肤色色明 黑白 高明度：偏白偏亮。低明度：偏黑偏暗。 肤色纯度 轻薄透明，密实紧致 低纯度：；皮肤较薄，晶莹剔透，面部较易泛红印。高纯度：密实紧致，给人厚重感，光泽度较强。 肤色选颜色 肤色的四季理论。此部分来自百度。\nSpring 春季型\n肤色特征：浅象牙色，暖米色，细腻而有透明感。 眼睛特征：眼珠为亮茶色，黄玉色，眼白感觉有湖兰色。 发色特征：明亮如绢的茶色，柔和的棕黄色、栗色。发质柔软。\n春季型人的色彩搭配原则——最适合自己颜色的要点是：不能太旧，太暗。春季型人的服饰基调属于暖色系中的明亮色调，在色彩搭配上应遵循鲜明、对比的突出自己的俏丽。使用范围最广的颜色是黄色，选择红色时，以橙红、桔红为主。 特别提示：对春季型人来说，黑色是最不适合的颜色，过深过重的颜色会与春季型人白色的肌肤、飘逸的黄发出现不和谐音，会使春季型人看上去显得暗淡。春季型人的特点是明亮、鲜艳。属于春季型的人用明亮、鲜艳的颜色打扮自己，会比实际年龄显得年轻。\nSummer 夏季型\n肤色特征：粉白，乳白色皮肤，带蓝色调的褐色皮肤，小麦色皮肤。 眼睛特征：目光柔和，眼珠呈焦茶色，深棕色。 发色特征：轻柔的黑色、灰黑色，柔和的棕色或深棕色。\n夏季型人的色彩搭配原则——拥有健康的肤色，水粉色的红晕，浅玫瑰色的嘴唇，柔软的黑发，给人以非常柔和优雅的整体印象。夏季型人适合以蓝色为底调的柔和淡雅的颜色，这样才能衬托出她们温柔、恬静的个性。夏季型人适合穿深浅不同的各种粉色、蓝色和紫色，以及有朦胧感的色调，在色彩搭配上，最好避免反差大的色调，适合在同一色相里进行浓淡搭配。\n特别提示：选择适合自己的颜色的要点是：颜色一定要柔和、淡雅。夏季型人不适合穿黑色，过深的颜色会破坏夏季型人的柔美，可用一些浅淡的灰蓝色、蓝灰色、紫色来代替黑色。夏季型人穿灰色会非常高雅，但注意选择浅至中度的灰，但注意夏季型人不太适合藏蓝色。\nAutumn 秋季型\n肤色特征：瓷器般的象牙色皮肤，深桔色、暗驼色或黄橙色。肤色匀整，色泽偏橘，无透明感，肤质密实，肤质的纯度较高。不易出现红晕，肤色偏深，也有少部分人肤色呈现瓷器般浅象牙白色 眼睛特征：深棕色、焦茶色、眼白呈暖白色。 发色特征：有光泽的褐色、棕色或者铜色、巧克力色。\n秋季型人的色彩搭配原则—— 是四季色中最成熟而华贵的代表，最适合的颜色是金色，苔绿色，橙色等深而华丽的颜色。选择红色时，一定要选择砖红色和与暗桔红相近的颜色。秋季型人的服饰基调是暖色系中的沉稳色调。浓郁而华丽的颜色可衬托出秋季型人成熟高贵的气质，越浑厚的颜色也越能衬托秋季型人陶瓷般的皮肤。\n特别提示：选择适合自己的颜色的要点是：颜色要温暖，浓郁。秋季型人穿黑色会显得皮肤发黄，可用深棕色来代替。\n最佳用色：金色，姜黄，橄榄绿，土红，土黄，咖啡色，深褐色，等浓郁而温暖的色彩。\nWinter 冬季型\n肤色特征：青白或略带橄榄色，带青色的黄褐色。冷调的看不到红晕的肤色。 眼睛特征：眼睛黑白分明，目光锐利，眼珠为深黑色，焦茶色。 发色特征：乌黑发亮，黑褐色，银灰、深酒红。\n冬季型人的色彩搭配原则—— 最适合纯色，选择红色时，可选正红、酒红和纯正的玫瑰红。在四季颜色中，只有冬季型人最适合使用黑、纯白、灰这三种颜色，藏蓝色也是冬季型人的专利色。但在选择深重颜色的时候一定要有对比色出现。\n特别提示：选择适合自己的颜色的要点是：颜色要鲜明，光泽度高。冬季型人着装一定要注意色彩的对比，只有对比搭配才能显得惊艳、脱俗\n如何确定自己的肤色为冷暖色？ 找一个审美较好的朋友陪着去逛街，试穿五件以上不同暖色调的衣服，再试穿五件以上不同冷色调的衣服。\n3.3 色彩的错觉 色彩的膨胀与收缩。冷，暗，低纯度收缩。暖，亮，高纯度膨胀。 色彩的硬和软。灰黑，深蓝，是硬朗，坚强的色彩，用于职场谈判，强调严谨，强势，理性的态度。粉红，粉黄，为相对温和柔软的色彩，与朋友约会，家庭亲子活动，强调关心，关怀。同时与面料的质感有很大关系。当然也要善用流行色。 3.4 衣服配色原理 色相和谐法。色相类似，明纯改变。冷暖一样，上明下暗。 明度和谐法。明度类似，色相纯度改变。上冷下暖。 纯度和谐法。纯度相近。色相明度不同。 有色彩，无彩搭配。黑白灰 色彩面积大小和谐法。主次，点缀。 色彩的呼应。A、图案与服装色彩的呼应，外花内单，外单内花，单是花中的一个颜色。花色：花卉，格子，条纹，圆点，动物纹，火腿纹，电脑抽像图。B、配饰，帽子与上衣颜色一致，领带、围巾也相呼应。 面料质地与色彩。同色不同质。同质不同色。 面料与肤质。面料粗细，与脸部很相关。 4. 场合 TPO法则：Time Place Object。Time主要为季节。Place为地点，室内还是室外，办公场所还是在家里。Object 穿着的目的，为了什么事情而穿。接下来两个常用场景来说一说。\n职场 与个人职业气质相契合，与个人年龄相契合，与工作环境、工作特点、行业要求相契合。\n领带分为小中大结，身材瘦小适合小结，身材适中适合中结，身材高大适合大结。领结搭配礼服多一点。衬衫要过腕，斜纹代表勇敢，波纹线代表活泼跳跃，圆点代表关怀。带鞋带的皮鞋很正式。\n休闲 旅游：舒适。颜色红黄绿，游山玩水；颜色黑白，城市。 逛街，访友，约会。不穿太正式，体现自我风格。遇见春节等喜庆节日穿红色。 日常运动健身 家居：休闲家居服，睡衣。圆点卡通，有利于休息，全家尽量一致，和谐。 二、理橱博雅 衣服类别： 职业装 上班或适合上班，商务，公务活动穿着的服装，多为正装，套装。\n便装 逛街，聚会，旅行，郊游时穿着的服装，比正装、套装稍显随意，休闲些的服装。\n家居休闲服 买菜，散步，接送孩子时穿着轻松自在的外出服。\n运动服 打球、跑步、游泳、健身时穿着的服装，因运动的不同而具有不同功能和特性的服装。\n礼仪服 参加典礼、庆功宴、年会、酒会，音乐会，高规格的戏剧演出等社交活动时穿着的服装。\n睡衣 睡眠时穿着的有利于人身心放松的服装。\n内衣\n周一至周五的上班族，衣橱中一半为职业服，平时注意将各类服装备齐。\n整理技巧 清理衣橱中现存的服饰，旧的打包。 检查衣橱中留下的服饰，检查是否污渍，掉色，掉线。 系统、规律地吊挂，摆放衣服饰品。比如：按 春夏 秋冬，按上下装，按功能分。 大而厚的衣服要用大衣架。裤子用夹。丝质用有海绵垫肩的衣架。针织服装不用吊挂，容易变形。\n为衣橱中现有的服饰做搭配。发现新搭配。 列出衣橱中缺少的单品清单。在搭配时发现缺少的清单。列出购物时的清单。（在商场中可以带上自己想要搭配的衣物，或者存在手机上） 将衣橱中的服装拍照留存，求助一些专业的朋友，或者设计师。 洗涤时，检查口袋！！！分开洗涤！！！ 棉麻反面晒，拉平一下。 羽绒服晒到一半干，要拍打一下。 买一些合适的晾衣架。\n理智购买 购买服装需定位。衣橱中缺少的是哪一种类型，哪一个季节，哪一种场合穿着的衣服鞋帽。 买衣之前试穿。 不买贵的或便宜的，只买合适的。 贵精不贵多，重质不重量。 购衣时，检查衣服。是否需要“干洗”，比如正装。颜色，条纹是否对齐，勾线齐整等等 怎样才能避免使白衬衫的领口，腋下因汗渍而发黄？穿衬衫前将蜡质止汗膏涂抹在衬衫领口及腋下部位，可以隔绝汗液侵蚀，延长白衬衫的寿命。油渍，用纸巾吸一下，然后用牙膏处理一哈。\n博雅 明礼修身提升综合素养 “若要有优美的嘴唇，请讲亲切的话；若要有优雅的姿态，请记住走路时行人不止你一个。“ \u0026mdash;奥黛丽·赫本\n走路可选择带节奏感的旋律，如414拍的音乐，踏着音乐不停地练习，增强走路的节奏感和律动。\n心中盛满美好之人，脚步时轻盈的；心理盛满爱心的人，脚步是温柔的；心理盛满阳光的人，脚步是快乐的；心里盛满信念之人，步伐也会因此而变得坚定。\n适宜香水：闻香识人，听语知人。\n读万卷书，行万里路，与万人谈。\n美不自美，因人而彰。\n世物自美，需要生活的艺术家运用慧眼发现美。通过丰富多彩的载体创造美，在人和人之间传递美。\n三、总结 买衣服考虑四个方面，材质（棉麻为主要）、款式（轮廓、量感、比例）、颜色（色相、明度、纯度）、场合（工作、休闲）。整理衣橱，理智购买。\n最后，真诚地感谢《形象美学》的作者，黄焱冰老师！！！也希望自己有更好的衣品\n","permalink":"/post/c0-life/readings/xingxiangmeixue/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"book_cover.png\" \n     alt=\"book_cover\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://book.douban.com/subject/30434860/\"\u003e《形象美学》\u003c/a\u003e这本书是我偶然间看到的，本人很少买衣服，自认为衣品极差，被老妈诟病。以前的观点是多买，买一些品牌好的。每当要去买衣服的时候（计划一年两次），总是有很多困扰。图书馆看到此书，恰合我意，翻阅全书，或许有望提高衣品，提升人生品味了，哈哈哈。\u003c/p\u003e\n\u003cp\u003e此书的作者是一位研究人物形象设计的大学教师，并有着多年服装顾问的实战经验。书前四章有很多服装的基础理论，搭配等技巧，书后两章给出驭装的细节方法和一个必备的衣服仓库的采购整理建议。本博文中将整理书中的重点，供各位同好们参考。\u003c/p\u003e\n\u003cp\u003e此书历经10 年完成（书中官方介绍），分为\u003cstrong\u003e塑型、悦色、妆饰、驭装、理橱、博雅\u003c/strong\u003e六个章节。书本主要分析了衣服的材质、款式、色彩、场合，以期帮助读者从尊重、认识、爱上自己的长相与身材开始，到认识与识别商品进行实践，最终达到人衣匹配，内外合一的境界。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e本博文将此书内容分为两个部分阐述。博文第一部分为塑型、悦色、妆饰、驭装，代表着从材质、款式、色彩和场合四个角度分析衣服，为衣服的基本原理；博文第二部分理橱、博雅，为实践部分，即整理衣服鞋帽，合理配置。\u003c/p\u003e\n\u003ch2 id=\"一基本理论\"\u003e一、基本理论\u003c/h2\u003e\n\u003cp\u003e衣服的基本理论分为材质、款式、色彩和场合四个方面。\u003c/p\u003e\n\u003ch3 id=\"1-材质\"\u003e1. 材质\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e按面料材质分\u003c/strong\u003e：天然纤维面料、化学纤维、混纺面料。\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e天然纤维面料\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e棉织物\u003c/td\u003e\n          \u003ctd\u003e易掉色\u003c/td\u003e\n          \u003ctd\u003e日常休闲、随和温柔、平实、易于亲近\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e麻织物\u003c/td\u003e\n          \u003ctd\u003e易折皱\u003c/td\u003e\n          \u003ctd\u003e随性率真、污垢易除\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e丝织物\u003c/td\u003e\n          \u003ctd\u003e比较难打理\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e毛织物\u003c/td\u003e\n          \u003ctd\u003e毛衣\u003c/td\u003e\n          \u003ctd\u003e丝毛洗涤剂\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e丝织物\u003c/td\u003e\n          \u003ctd\u003e少见\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e化学纤维\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e再生纤维\u003c/td\u003e\n          \u003ctd\u003e易掉色\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e天丝纤维\u003c/td\u003e\n          \u003ctd\u003e随性率真、污垢易除\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e莫代尔纤维\u003c/td\u003e\n          \u003ctd\u003e木材、内衣\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e醋酯纤维\u003c/td\u003e\n          \u003ctd\u003e光泽感、[天鹅绒织锦]\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e合成纤维\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e混纺面料\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e比如\u003c/td\u003e\n          \u003ctd\u003e毛衣\u003c/td\u003e\n          \u003ctd\u003e涤纶（30%-40%）、氨纶（3%-7%）\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003e按纺织工艺分\u003c/strong\u003e：梭织、针织。\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e纺织工艺\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e梭织\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e斜纹、平纹、缎纹\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e针织\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n          \u003ctd\u003e手感好，不保形，挺括\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003e面料档次\u003c/strong\u003e\u003c/p\u003e","tags":["社会科学/个人管理","《形象美学》","读书笔记"],"title":"《形象美学》摘录笔记"},{"categories":["人工智能"],"content":"前言 本正则化系列文章我们将讨论正则化技术在机器学习和深度学习的应用。本文为该系列的第一篇，主要介绍机器学习正则化的概念，原理和应用实例。\n正则化 技术广泛应用在机器学习和深度学习算法中，本质作用是防止过拟合、提高模型泛化能力。其中过拟合的简单理解就是训练的算法模型太过复杂，模型过分考虑了当前样本的结构。\n在早期的机器学习领域一般只是将范数惩罚叫做正则化技术，而在深度学习领域认为，能够显著减少方差，而不过度增加偏差的策略都可以认为是正则化技术。故推广的正则化技术还有：扩增样本集、早停止、Dropout、集成学习、多任务学习、对抗训练、参数共享等。(具体见“花书 第七章 Regularization for Deep Learning”），关于深度学习正则化会在下一篇正则化文章中重点分析。\n转载自：https://blog.csdn.net/BigData_Mining/article/details/81631249\n1. 多角度看机器学习正则化 机器学习领域正则化可以从以下三个角度进行理解：\n(1) 正则化等价于结构风险最小化，其是通过在经验风险项后加上表示模型复杂度的正则化项或惩罚项，达到选择经验风险和模型复杂度都较小的模型目的。\n​\t经验风险：机器学习中的风险是指模型与真实解之间的误差的积累，经验风险是指使用训练出来的模型进行预测或者分类，存在多大的误差，可以简单理解为训练误差，经验风险最小化即为训练误差最小。\n​\t结构风险：结构风险定义为经验风险与置信风险(置信是指可信程度)的和，置信风险越大，模型推广能力越差。可以简单认为结构风险是经验风险后面多加了一项表示模型复杂度的函数项，从而可以同时控制模型训练误差和测试误差，结构风险最小化即为在保证模型分类精度(经验风险)的同时，降低模型复杂度，提高泛化能力。\n​\t公式表达 $$ R(f)=\\frac{1}{n}\\sum_{i=1}^{n}L(y_i,f(x_i)) + \\lambda \\Omega (f) \\tag{1} $$ ​\t其中，$R(f)$表示结构风险，$L(y_i,f(x_i))$表示第 $i$ 个样本的经验风险，$\\Omega(f)$是表征模型复杂度的正则项，$\\lambda$ 是正则化参数。根据奥姆剃刀定律，“如无必要，勿增实体”，即认为相对简单的模型泛化能力更好。而模型泛化能力强、泛化误差小，即表示模型推广能力强，通俗理解就是在训练集中训练得到的优秀模型能够很好的适用于实际测试数据，而不仅仅是减少训练误差或者测试误差。泛化误差定义如下： $$ E={Bias}^2(X) + {Var}(X) +{Noise} \\tag{2} $$ ​\t其中，$E$ 表示泛化误差，${Bias}$ 代表偏差，${Var}$ 代表方差， ${Noise}$ 代表噪声。\n​\t关系图\nFig 1. 泛化误差与偏差和方差的关系 ​\t从 Fig 1 可以看出，随着训练程度加深，模型复杂度会增加，偏差减少，方差增大，而泛化误差呈现U型变化。对于一个“好的系统”通常要求误差小，正则化的作用即为适当的控制模型复杂度，从而使得**泛化误差曲线**取最小值。 (2) 正则化等价于带约束的目标函数中的约束项\n以平方误差损失和L2范数为例，优化问题的数学模型如下： $$ J(\\theta)=\\sum_{i=1}^{n}(y_i-\\theta^Tx_i)^2 \\tag{3} $$ $$ {s.t.}{|| \\theta ||}_2^2 \\leq C\\\\ \\tag{4} $$\n针对上述约束条件的优化问题，采用拉格朗日乘积算子法可以转化为无约束化问题，即 $$ J(\\theta)=\\sum_{i=1}^{n}(y_i-w^Tx_i)^2 + \\lambda({|| \\theta ||}_2^2-C) \\tag{5} $$\n由于参数 $C$ 为常数，可以忽略，故上述公式和标准的正则化 公式完全一致。\n(3) 从贝叶斯角度考虑\n正则项等价于引入参数的模型先验概率，可以简单理解为对最大似然估计引入先验概率，从而转化为最大后验估计，其中的先验概率即对于正则项（这部分内容后面详细讲解）。\n2 基本概念 正则化也可以成为规则化、权重衰减技术，不同的领域叫法不一样，数学上常用范数实现，例如L1和L2范数，统计学领域叫做惩罚项、罚因子。\n下面给出范数的数学公式，方便以后分析：\n​\t(1) $p$ 范数： $$ Lp=(\\sum_{i=1}^{n}{|| x_i ||}^p)^{\\frac{1}{p}} \\tag{6} $$ ​\t(2) $L0$ 范数：0 范数表示向量中非零元素的个数（即为其稀疏度）\n​\t(3) $L1$ 范数：即向量元素绝对值之和，$p$ 范数取1，即为1范数 $$ {||x||}_1=\\sum^n_1 {|| x_i || } \\tag{7} $$\n​\t(4) $L2$ 范数：即向量元素绝对值的平方和再开发，也称欧几里得距离，$p$ 范数取2，即为2范数 $$ {||x||}_{2}=\\sqrt{\\sum^{n}_1|| x_i ||^2} \\tag{8} $$\n​\t(5) $\\infty $ 范数：即所有向量元素的绝对值中的最大值，$p$ 范数取 $\\infty $，即为 $\\infty $ 范数 $$ {||x ||}_{\\infty }=\\underset{i}{\\max}{\\left | x_i \\right |} \\tag{9} $$\n​\t(6) $-\\infty $ 范数：即所有向量元素绝对值中的最小值，$p$ 范数取$-\\infty $，即为 $-\\infty $ 范数 $$ {||x ||}_{-\\infty }=\\underset{i}{\\min}{\\left | x_i \\right |} \\tag{10} $$ 图形描述\n​\t从 Fig 2、Fig 3 图可以看出：q(p)越小，曲线越贴近坐标轴，q(p)越大，曲线越远离坐标轴，并且棱角越明显，当q(p)取0时候，是完全和坐标轴贴合，当q(p)取无穷的时候，呈现正方体形状。同时也可以看出，采用不同的范数作为正则项，会得到完全不同的算法模型结果，故而对于不同要求的模型，应该采用不同的范数作为正则项。\nFig 2. 向量长度为2维的范数约束 ![1563354456894](regulation_baysian/1563354456894.png) Fig 3. 向量长度为3维的范数约束 ## 3 深度理解 ​\t为了更好的理解正则化技术原理，下面从4个方面进行深度分析，希望对大家理解有帮助。\n3.1 简单数值假设分析法 ​\t此处以L2范数讲解，下面的各图形来自吴恩达的机器学习课程。\nFig 4. 不同参数下的曲线拟合结果 ​\t左边的曲线拟合是欠拟合，中间的曲线拟合是刚好合适，右边的曲线拟合是过拟合。对于右边的拟合曲线，有 $$ h_{\\theta}(x)={\\theta}_0+{\\theta}_0 x_1 +{\\theta}_2 x_2^2 +{\\theta}_3 x_3^3 +{\\theta}_4 x_4^4 \\tag{11} $$ ​\t从上式可以看出，由于$\\theta_3$和$\\theta_4$对应了高阶，导致拟合曲线是4阶曲线，出现了过拟合。正则化的目的为适当缩减$\\theta_3$和$\\theta_4$的值，例如都为0.0001，则上述曲线本质上等价与 $$ h_{\\theta}(x)={\\theta}_0 + {\\theta}_1 x_1 +{\\theta}_2 x_2^2 \\tag{12} $$ ​\t也就是变成了中间的刚好合适的拟合曲线。对于$\\theta_3$ 和$\\theta_4$增加 L2 正则项后的代价函数表达式为： $$ J(\\theta)= \\underset{\\theta}{\\min}\\frac{1}{n}\\sum_{i=1}^{n}((h_{\\theta}(x_i)-y_i)+1000{\\theta}_3^2 + 1000 {\\theta}_4^2) \\tag{13} $$ ​\t从上式可以看出，$\\theta_3^2$ 和 $\\theta_4^2$ 均大于 0，其乘上了1000，要 $J(\\theta)$ 是最小，则会迫使模型学习到的$\\theta_3$ 和 $\\theta_4$ 会非常小，因为只有在$\\theta_3$ 和 $\\theta_4$ 会非常小的情况下整个代价函数值才会取的较小值。在实际开发中，是对所有参数进行正则化，为了使代价函数尽可能的小，所有的参数 $\\theta$ 的值（不包括 $\\theta_0$）都会在一定程度上减小，但是减小程度会不一样，从而实现了权重衰减、简化模型复杂度的作用。 3.2 图形分析法 ​\t此处采用L1和L2范数讲解： (1) L2 范数正则 $$ J(\\beta)=\\sum_{i=1}^{n}(y_i-{\\beta}^T x_i)^2 + \\lambda {|| {\\beta} ||}_2^2 \\tag{14} $$ Fig 5. L2 范数与代价函数的寻优图示 ​\t在 Fig 5 中，蓝色的圆形空间表示 L2 范数空间，设为 $\\beta_1^2 + \\beta_2^2 = r^2$，可以看出，当 $r$ 从 0 逐渐增大时候，该圆形也逐渐增大，红色的线表示原始代价函数解空间即 $\\sum_{i=1}^{n}(y_i-\\beta^T x_i)^2$，此处为了方便绘图，设参数只有2维。红色圆环上的任何一点都表示一个可行解即代表一组$\\beta_1$、$\\beta_2$，其中任何一个红色圆环上面的$\\beta_1$，$\\beta_2$对应的代价函数值一样（可以简单理解为等值线），$\\hat{\\beta}$ 代表最佳解空间。 4. 贝叶斯角度分析 ​\t以L1和L2范数为例，所得结论可以推广到P范数中，首先需要知道：整个最优化问题从贝叶斯观点来看是一种贝叶斯最大后验估计，其中正则化项对应后验估计中的先验信息，损失函数对应后验估计中的似然函数，两者的乘积即对应贝叶斯最大后验估计的形式。针对L1和L2范数还有结论：L2 范数相当于给模型参数设置一个协方差为1/alpha的零均值高斯先验分布，L1 范数相当于给模型参数 设置一个参数为1/alpha 拉普拉斯先验分布。\n​\t为了讲清楚上述结论，需要具备几点前置知识点：(1) 高斯分布和拉普拉斯分布的定义和形状；(2) 贝叶斯定理；(3) 最大似然估计；(4) 最大后验估计。下面我对这4个知识点进行解释。\n(1) 高斯分布和拉普拉斯分布\n(2) 最大似然估计\n​\t如果上述公式不能理解，请各位读者去复习一下大学课程《概率论与数理统计》中的参数估计章节，为了更方便理解，下面举一个例子：假设我要统计出整个大学内所有同学的身高分布情况，设全校一共20000人，数量庞大，所有人都去问一遍不太靠谱，所以我打算采用抽样方法来估计，假设我已经知道身高分布服从高斯分布，但是我不知道高斯分布中的均值和方差参数，现在我打算采用最大似然估计方法来确定这两个参数。首先需要明确，全校20000即为总体X，我随机从各个班抽取10名同学，假设一共抽了2000个同学，那么2000同学就构成了样本空间，由于每个样本的概率密度函数已知，则很容易写出似然函数，对数求导即可求解参数。\n(3) 最大后验估计\n5. 例子 5.1 逻辑回归 ​\t二分类逻辑回归使用Sigmoid作为决策函数进行分类，该函数可以将任意的输入映射到[0,1]区间，当预测结果小于0.5，则表示负类，当预测结果大于0.5.则表示正类，其模型本质是求最大似然估计，具体求解似然函数通常使用梯度下降法，而前面说过：最大似然估计法没有考虑训练集以外的因素，很容易造成过拟合，故而逻辑回归一般采用L2范数进行正则化操作，Sigmoid函数定义和图形如下：\n5.2 岭回归(Ridge Regression) ​\t岭回归本质上是针对线性回归问题引入了L2范数正则，通过缩减回归系数避免过拟合问题，最先用来处理特征数多于样本数的情况(高维小样本问题)，现在也用于在估计中加人偏差，从而得到更好的估计，加了正则化后的代价函数如下：\n5.3 Lasso 回归 ​\t拉索回归(lasso回归)本质上是针对线性回归问题引入了L1范数正则，通过缩减回归系数避免过拟合问题，其不同于L2范数，其可以将某些系数缩减为0即所谓的具备稀疏性(稀疏性的好处是简化计算、容易理解模型、减少存储空间、不容易出现过拟合等等)，加了正则化后的代价函数如下：\n​\t其中，参数函数和岭回归中相同。L1范数罚有一个问题：由于|X|函数在0处不可导，故而直接使用最小二乘法、梯度下降法等方法均失效，但是由于其为第一类间断点中的可去间断点，可以通过补充该点的定义解决，通常，对于线性回归中的lasso回归可以采用近似的前向逐步回归替代。\n5.4 SVM ​\t支持向量机SVM优化目的为寻找一个超平面，使得正负样本能够以最大间隔分离开，从而得到更好的泛化性能，其通过引入核函数来将低维线性不可分的样本映射到高维空间从而线性可分，通过引入惩罚参数C(类似于正则化参数)来对错分样本进行惩罚，从而减少模型复杂度，提高泛化能力，其优化目标如下：\n​\t大家如果不知道上面公式的推导，不用紧张，对于本次内容不是重点，只需要关注后面正则项部分，惩罚参数C作用和正则化参数作用一致，只是反相关而已。需要明白以下结论：\n​\t(1) C越大，正则化参数越小，表示对分错样本的惩罚程度越大，正则化作用越小，偏差越小，方差越大，越容易出现过拟合(通俗理解，原本将低维空间映射到5维空间正好线性可分，但是由于惩罚过于严重，任何一个样本分错了都不可原谅，结果系统只能不断提高维数来拟合样本，假设为10维，最终导致映射维数过高，出现过拟合样本现象，数学上称为VC维较大)；\n​\t(2) C越小，正则化参数越大，表示对分错样本的惩罚程度越小，正则化作用越大，偏差越大，方差越小，越容易出现欠拟合(通俗理解，原本将低维空间映射到5维空间正好线性可分，但是由于惩罚过小，分错了好多样本都可以理解，比较随意，结果系统也采用简化版来拟合样本，假设为3维，最终导致映射维数过低，出现欠拟合样本现象，数学上称为VC维较小)。\n6. 总结 根本目的本质：防止过拟合，提高模型泛化能力。\n正则化技术分类： 狭义上（不同地方叫法不同）\n在早期的机器学习领域一般只是将范数惩罚叫做正则化技术 规则化、权重衰减 从贝叶斯角度考虑，正则项等价于引入参数的模型先验概率 广义上： 能够显著减少方差，而不过度增加偏差的策略都可以认为是正则化技术，推广的正则化技术还有：扩增样本集、早停止、Dropout、集成学习、多任务学习、对抗训练、参数共享等。\nReference 正则化总结的比较好比较全面的文章\n","permalink":"/post/c3-ai/regulation-baysian/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\n本\u003cstrong\u003e正则化系列\u003c/strong\u003e文章我们将讨论\u003cstrong\u003e正则化技术在机器学习和深度学习的应用\u003c/strong\u003e。本文为该系列的第一篇，主要介绍\u003cstrong\u003e机器学习正则化的概念，原理和应用实例\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Regularization_%28mathematics%29\"\u003e正则化\u003c/a\u003e 技术广泛应用在机器学习和深度学习算法中，本质作用是\u003cstrong\u003e防止过拟合、提高模型泛化能力\u003c/strong\u003e。其中过拟合的简单理解就是训练的算法模型太过复杂，模型过分考虑了当前样本的结构。\u003c/p\u003e\n\u003cp\u003e在早期的机器学习领域一般只是将范数惩罚叫做正则化技术，而在深度学习领域认为，能够显著减少方差，而不过度增加偏差的策略都可以认为是正则化技术。故\u003cstrong\u003e推广的正则化技术\u003c/strong\u003e还有：扩增样本集、早停止、Dropout、集成学习、多任务学习、对抗训练、参数共享等。(具体见“花书 第七章 \u003ca href=\"http://www.deeplearningbook.org/contents/regularization.html\"\u003eRegularization for Deep Learning\u003c/a\u003e”），关于\u003cstrong\u003e深度学习正则化\u003c/strong\u003e会在下一篇正则化文章中重点分析。\u003c/p\u003e\n\u003cp\u003e转载自：https://blog.csdn.net/BigData_Mining/article/details/81631249\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"1-多角度看机器学习正则化\"\u003e1. 多角度看机器学习正则化\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e机器学习领域正则化\u003c/strong\u003e可以从以下三个角度进行理解：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e(1)\u003c/strong\u003e \u003cstrong\u003e正则化等价于结构风险最小化，其是通过在经验风险项后加上表示模型复杂度的正则化项或惩罚项，达到选择经验风险和模型复杂度都较小的模型目的\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e​\t\u003cstrong\u003e经验风险\u003c/strong\u003e：机器学习中的风险是指模型与真实解之间的误差的积累，经验风险是指使用训练出来的模型进行预测或者分类，存在多大的误差，可以简单理解为训练误差，经验风险最小化即为训练误差最小。\u003c/p\u003e\n\u003cp\u003e​\t\u003cstrong\u003e结构风险\u003c/strong\u003e：结构风险定义为经验风险与置信风险(置信是指可信程度)的和，置信风险越大，模型推广能力越差。可以简单认为结构风险是经验风险后面多加了一项表示模型复杂度的函数项，从而可以同时控制模型训练误差和测试误差，结构风险最小化即为在保证模型分类精度(经验风险)的同时，降低模型复杂度，提高泛化能力。\u003c/p\u003e\n\u003cp\u003e​\t\u003cstrong\u003e公式表达\u003c/strong\u003e\n$$\nR(f)=\\frac{1}{n}\\sum_{i=1}^{n}L(y_i,f(x_i)) + \\lambda \\Omega (f)\n\\tag{1}\n$$\n​\t\t其中，$R(f)$表示结构风险，$L(y_i,f(x_i))$表示第 $i$ 个样本的经验风险，$\\Omega(f)$是表征模型复杂度的正则项，$\\lambda$ 是正则化参数。根据奥姆剃刀定律，“如无必要，勿增实体”，即认为相对简单的模型泛化能力更好。而模型泛化能力强、泛化误差小，即表示模型推广能力强，通俗理解就是在训练集中训练得到的优秀模型能够很好的适用于实际测试数据，而不仅仅是减少训练误差或者测试误差。泛化误差定义如下：\n$$\nE={Bias}^2(X) + {Var}(X) +{Noise}\n\\tag{2}\n$$\n​\t\t其中，$E$ 表示泛化误差，${Bias}$ 代表偏差，${Var}$ 代表方差， ${Noise}$ 代表噪声。\u003c/p\u003e\n\u003cp\u003e​\t\u003cstrong\u003e关系图\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"1563350068097.png\" \n     alt=\"1563350068097\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e Fig 1. 泛化误差与偏差和方差的关系\u003c/div\u003e\n​\t\t从 Fig 1 可以看出，随着训练程度加深，模型复杂度会增加，偏差减少，方差增大，而泛化误差呈现U型变化。对于一个“好的系统”通常要求误差小，正则化的作用即为适当的控制模型复杂度，从而使得**泛化误差曲线**取最小值。\n\u003cp\u003e\u003cstrong\u003e(2)\u003c/strong\u003e \u003cstrong\u003e正则化等价于带约束的目标函数中的约束项\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e以平方误差损失和L2范数为例，优化问题的数学模型如下：\n$$\nJ(\\theta)=\\sum_{i=1}^{n}(y_i-\\theta^Tx_i)^2\n\\tag{3}\n$$\n$$\n{s.t.}{|| \\theta ||}_2^2 \\leq C\\\\\n\\tag{4}\n$$\u003c/p\u003e","tags":["机器学习","正则化","算法"],"title":"正则化「一」机器学习中的正则化"},{"categories":["生活"],"content":"重庆，旅游纪实。20190422 - 20190424\n四月二十二 天空之城旅店的临江阳台 今天刚来到重庆。前天查天气说是多云，但是来这之后，天气极好。早上9点从成都出发，12点左右到达重庆北站，然后做地铁10号线倒到6号线的小什坊。在解放广场附近，中午吃了个碗杂面很不错，对于我来说有点辣，说是重庆排行第五的小面。\n下午就准备午休一哈，今早上很早起来要赶到成都的市中心乘火车。在江边，也是在洪崖洞旁边，找了一家叫做天空之城的青年旅舍。晚上走在千厮大桥上，脚感受着下面的地铁穿过抖动。从青年旅馆房间里面刚好可以看到江边的夜景，管理人是个可爱的老人家。里面的床单是没有铺上的，得自己铺，老人家解释免得被认为不好，你也可以自己带睡袋。老人家在铁路上工作，与他聊了很久，谈到他在铁路站工作的经历，当然还有很多打理旅舍时的故事。\n四月二十三 排队2小时，乘过江索道 过江索道，晃晃悠悠在路上 早上起来，去楼下买了个早餐，有八宝粥和一个米团（块），那个团米上面加了两个半枣。吃完早饭，阳光正照进那个青年公寓。四月底，节气谷雨过后，算还不是很热，在那个临江的阳台晒了会儿阳光。然后很困，大概是吃饱的缘故，我又回去睡了一个回笼觉。下午出发去白公馆，搭的是轻轨2号线，到大坪换到去烈士墓的地铁上，轻轨是一路沿江跑的，欣赏着嘉陵江的美景，羡慕着重庆人的立体公交系统。嘉陵江水比较清澈，也见到有人在游泳。过会儿就经过网红景点李子坝，轻轨穿房而过。白公馆旁边是四川外国语大学，没有去逛，直接去了白公馆，香山别墅，然后去了渣滓洞，白公馆的地势比较陡，台阶比较多，旁边是歌乐山。\n鹅岭公园有个塔，从塔上望去 接着到了鹅岭公园，可直接做地铁鹅岭站，进门处分左右路线，我选了左转，然后绕了一大圈到了那个塔，其实可以右转沿着汽车的道往上到那个塔。到了塔顶，可以看到面向朝天门方向，左边是嘉陵江，右边是长江，然后各种大桥，轻轨地铁尽收眼底。吹着微风，站在那个塔上，可见重庆各种摩天大楼，然后就是更远处的山。离开鹅岭公园后，继续搭地铁去了上新街站，下车后往南岸区走，南岸发展比较慢，可以看到明显和渝中区的不同，路边找了一家店，选了几个小菜，吃了个晚饭。晚饭后，去了南山一棵树，人很多，夜景倒是很漂亮，有水有山，两水相交，滋润了这个大都市，今天的行程不错。\n南山一棵松 四月二十四 朝天门码头，水清黄分明 今天也是懒懒起床，吃了个早饭，豆浆是放在那种果冻的包装袋里。今天差不多，就准备看看朝天门，然后回成都。去朝天门还是比较奇怪，随着百度地图导航走，到了一个商城里面，从地面进去是商城的8楼，下了电梯，走了一个商品批发的地方，然后向朝天门赶，今天太阳超级满足，比较热。岸边停了好多游船。到了朝天门，水分了两个颜色，黄的长江，清的嘉陵江。休息一刻，搭了公交车，沿着长江岸跑，居然到了李子坝，然后地铁转到重庆北火车站，这一趟重庆算是画上了一个句号。\n『转载』，请联系博主。\n","permalink":"/post/c0-life/trips/chongqing/","summary":"\u003cp\u003e重庆，旅游纪实。20190422 - 20190424\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"四月二十二\"\u003e四月二十二\u003c/h2\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"tiankongzhicheng.jpg\" \n     alt=\"tiankongzhicheng\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e \u003cb\u003e天空之城旅店的临江阳台\u003c/b\u003e\u003c/div\u003e\n\u003cp\u003e今天刚来到重庆。前天查天气说是多云，但是来这之后，天气极好。早上9点从成都出发，12点左右到达重庆北站，然后做地铁10号线倒到6号线的小什坊。在解放广场附近，中午吃了个碗杂面很不错，对于我来说有点辣，说是重庆排行第五的小面。\u003c/p\u003e\n\u003cp\u003e下午就准备午休一哈，今早上很早起来要赶到成都的市中心乘火车。在江边，也是在洪崖洞旁边，找了一家叫做天空之城的青年旅舍。晚上走在千厮大桥上，脚感受着下面的地铁穿过抖动。从青年旅馆房间里面刚好可以看到江边的夜景，管理人是个可爱的老人家。里面的床单是没有铺上的，得自己铺，老人家解释免得被认为不好，你也可以自己带睡袋。老人家在铁路上工作，与他聊了很久，谈到他在铁路站工作的经历，当然还有很多打理旅舍时的故事。\u003c/p\u003e\n\u003ch2 id=\"四月二十三\"\u003e四月二十三\u003c/h2\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"guojiang1.jpeg\" \n     alt=\"guojiang1\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e \u003cb\u003e排队2小时，乘过江索道\u003c/b\u003e\u003c/div\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"goujiang2.jpeg\" \n     alt=\"goujiang2\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e \u003cb\u003e过江索道，晃晃悠悠在路上\u003c/b\u003e\u003c/div\u003e\n\u003cp\u003e早上起来，去楼下买了个早餐，有八宝粥和一个米团（块），那个团米上面加了两个半枣。吃完早饭，阳光正照进那个青年公寓。四月底，节气谷雨过后，算还不是很热，在那个临江的阳台晒了会儿阳光。然后很困，大概是吃饱的缘故，我又回去睡了一个回笼觉。下午出发去白公馆，搭的是轻轨2号线，到大坪换到去烈士墓的地铁上，轻轨是一路沿江跑的，欣赏着嘉陵江的美景，羡慕着重庆人的立体公交系统。嘉陵江水比较清澈，也见到有人在游泳。过会儿就经过网红景点李子坝，轻轨穿房而过。白公馆旁边是四川外国语大学，没有去逛，直接去了白公馆，香山别墅，然后去了渣滓洞，白公馆的地势比较陡，台阶比较多，旁边是歌乐山。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"eling.jpg\" \n     alt=\"eling\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e \u003cb\u003e鹅岭公园有个塔，从塔上望去\u003c/b\u003e\u003c/div\u003e\n\u003cp\u003e接着到了鹅岭公园，可直接做地铁鹅岭站，进门处分左右路线，我选了左转，然后绕了一大圈到了那个塔，其实可以右转沿着汽车的道往上到那个塔。到了塔顶，可以看到面向朝天门方向，左边是嘉陵江，右边是长江，然后各种大桥，轻轨地铁尽收眼底。吹着微风，站在那个塔上，可见重庆各种摩天大楼，然后就是更远处的山。离开鹅岭公园后，继续搭地铁去了上新街站，下车后往南岸区走，南岸发展比较慢，可以看到明显和渝中区的不同，路边找了一家店，选了几个小菜，吃了个晚饭。晚饭后，去了南山一棵树，人很多，夜景倒是很漂亮，有水有山，两水相交，滋润了这个大都市，今天的行程不错。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"yejing.jpg\" \n     alt=\"yejing\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e \u003cb\u003e南山一棵松\u003c/b\u003e\u003c/div\u003e\n\u003ch2 id=\"四月二十四\"\u003e四月二十四\u003c/h2\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"caotianmen.jpg\" \n     alt=\"caotianmen\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e \u003cb\u003e朝天门码头，水清黄分明\u003c/b\u003e\u003c/div\u003e\n\u003cp\u003e今天也是懒懒起床，吃了个早饭，豆浆是放在那种果冻的包装袋里。今天差不多，就准备看看朝天门，然后回成都。去朝天门还是比较奇怪，随着百度地图导航走，到了一个商城里面，从地面进去是商城的8楼，下了电梯，走了一个商品批发的地方，然后向朝天门赶，今天太阳超级满足，比较热。岸边停了好多游船。到了朝天门，水分了两个颜色，黄的长江，清的嘉陵江。休息一刻，搭了公交车，沿着长江岸跑，居然到了李子坝，然后地铁转到重庆北火车站，这一趟重庆算是画上了一个句号。\u003c/p\u003e\n\u003cp\u003e『转载』，请联系博主。\u003c/p\u003e","tags":["旅游","重庆"],"title":"这哈儿是重庆"},{"categories":["生活"],"content":"前言 世界和民族的优秀作品。 漫漫长路，读书成长。\n茅盾文学奖 第十届茅盾文学奖获奖篇目 (2015—2018)\n作品 作者 出版单位 《人世间》 梁晓声 中国青年出版社 《牵风记》 徐怀中 人民文学出版社 《北上》 徐则臣 北京十月文艺出版社 《主角》 陈 彦 北京十月文艺出版社 《应物兄》 李 洱 人民文学出版社 中国作家网 第十届茅盾文学奖揭晓（附5位获奖作家介绍）\n第九届茅盾文学奖获奖篇目 (2011—2014)\n作品 作者 出版单位 《江南三部曲》 格　非 上海文艺出版社 《这边风景》 王　蒙 花城出版社 《生命册》 李佩甫 作家出版社 《繁花》 金宇澄 上海文艺出版社 《黄雀记》 苏　童 作家出版社 第八届茅盾文学奖获奖篇目 (2007—2010)\n作品 作者 出版单位 《你在高原》 张　炜 作家出版社 《天行者》 刘醒龙 人民文学出版社 《蛙》 莫　言 上海文艺出版社 《推拿》 毕飞宇 人民文学出版社 《一句顶一万句》 刘震云 长江文艺出版社 第七届茅盾文学奖获奖篇目 (2003—2006)\n作品 作者 出版单位 《秦腔》 贾平凹 作家出版社 《额尔古纳河右岸》 迟子建 北京十月文艺出版社 《湖光山色》 周大新 作家出版社 《暗算》 麦　家 世界知识出版社、人民文学出版社 第六届茅盾文学奖获奖篇目 (1999—2002)\n作品 作者 出版单位 《张居正》 熊召政 长江文艺出版社 《无字》 张　洁 北京十月文艺出版社 《历史的天空》 徐贵祥 人民文学出版社 《英雄时代》 柳建伟 人民文学出版社 《东藏记》 宗　璞 人民文学出版社 第五届茅盾文学奖获奖篇目 (1995—1998)\n作品 作者 出版单位 《抉择》 张　平 人民文学出版社 《尘埃落定》 阿　来 人民文学出版社 《长恨歌》 王安忆 作家出版社 《茶人三部曲》(一、二) 王旭烽 浙江文艺出版社 第四届茅盾文学奖获奖篇目 (1989—1994)\n作品 作者 出版单位 《战争和人》(一、二、三) 王　火 人民文学出版社 《白鹿原》（修订本） 陈忠实 人民文学出版社 《白门柳》(一、二) 刘斯奋 中国青年出版社 《骚动之秋》 刘玉民 人民文学出版社 第三届茅盾文学奖获奖篇目 (1985—1988)\n作品 作者 出版单位 《平凡的世界》 路　遥 中国文联出版公司 《少年天子》 凌　力 北京十月文艺出版社 《都市风流》 孙力、余小惠 浙江文艺出版社 《第二个太阳》 刘白羽 人民文学出版社 《穆斯林的葬礼》 霍　达 北京十月文艺出版社 荣　誉　奖 《浴血罗霄》 萧　克 解放军文艺出版社 《金瓯缺》 徐兴业 海峡文艺出版社 第二届茅盾文学奖获奖篇目 (1982—1984)\n作品 作者 出版单位 《黄河东流去》 李　准 北京出版社 《沉重的翅膀》（修订本） 张　洁 人民文学出版社 《钟鼓楼》 刘心武 人民文学出版社 第一届茅盾文学奖获奖篇目 (1977—1981)\n作品 作者 出版单位 《许茂和他的女儿们》 周克芹 百花文艺出版社 《东方》 魏　巍 人民文学出版社 《将军吟》 莫应丰 人民文学出版社 《李自成》 （第二卷） 姚雪垠 中国青年出版社 《芙蓉镇》 古　华 人民文学出版社 《冬天里的春天》 李国文 人民文学出版社 诺贝尔文学奖 link\n2017年得主：黑石一雄\n日裔英国作家\n代表作：《长日留痕》《无可慰藉》《上海孤儿》《被掩埋的巨人》\n获奖理由：他的小说带有强大的情感力量，解开了我们与世界连接的虚幻深渊。\n2016年得主：鲍勃·迪伦\n美国作家\n代表作：《答案在风中飘》、《像一块滚石》、《时光慢慢流逝》\n获奖理由：在伟大的美国民谣传统中创造出新的诗歌意境\n2015年\n得主：斯韦特兰娜·阿列克谢耶维奇（女）\n白俄罗斯作家\n代表作：《切尔诺贝利的回忆：核灾难口述史》\n获奖理由：世界文坛最高水准的感人作品，讲述了这个时代的苦难和勇气。\n2014年得主：帕特里克·莫迪亚诺\n法国作家\n代表作：《暗店街》《星形广场》《青春咖啡馆》\n获奖理由：唤醒了对最难以捕捉的人类命运的记忆和揭露了对人类生活的占领。\n2013年得主：艾丽斯·芒罗(女)\n代表作：《快乐影子舞》《逃离》\n获奖理由：当代短篇小说大师。\n2012年得主：莫言\n中国作家\n代表作：《红高粱》《丰乳肥臀》《蛙》\n获奖理由：用魔幻现实主义的写作手法，将民间故事、历史事件与当代背景融为一体。\n2011年得主：托马斯·特兰斯特勒默\n瑞典诗人\n代表作：《十七首诗》《途中的秘密》\n获奖理由：他以凝炼、简洁的形象，以全新视角带我们接触现实。\n2010年得主：马里奥·巴尔加斯·略萨\n秘鲁与西班牙双重国籍的作家及诗人\n代表作：《绿房子》《世界末日之战》《城市与狗》\n获奖理由：他“对权力结构的制图般的描绘和对个人反抗的精致描写”。\n2009年得主：赫塔·米勒\n罗马尼亚裔的德国女性小说家、诗人、散文家。\n代表作：《呼吸钟摆》《河水奔流》《行走界线》《狐狸那时已是猎人》\n获奖理由：专注于诗歌以及散文的率真，描写了失业人群的生活图景。\n2008年得主：勒·克莱齐奥\n代表作：《战争》\n获奖理由：展现了新的起点、诗意的冒险和感官狂喜；作为探险者，发掘了隐藏于主流文明底部和外部的人性。\n2007年得主：多丽丝·莱辛（女）\n英国作家\n代表作：《金色笔记》\n获奖理由：她用怀疑、热情、构想的力量来审视一个分裂的文明，其作品如同一部女性经验的史诗。\n2006年得主：奥尔罕·帕慕克\n土耳其作家\n代表作：《我的名字叫红》\n获奖理由：在寻找故乡的忧郁灵魂时，发现了文化碰撞和融合中的新象征。\n2005年得主：哈罗德·品特\n英国剧作家。\n代表作：《看房者》《生日晚会》《归家》\n获奖理由：他的戏剧以诗和画的创造性，深入表现了人类长期置身其中的处境。\n2004年得主：埃尔弗里德·耶利内克（女）\n奥地利女作家。\n代表作：《钢琴教师》《死者的孩子》\n获奖理由：因为她的小说和戏剧具有音乐般的韵律，她的作品以非凡的充满激情的语言揭示了社会上的陈腐现象及其禁锢力的荒诞不经。\n2003年得主：约翰·马克斯韦尔·库切\n南非作家。\n代表作：《耻》《幽暗之乡》\n获奖理由：精准地刻画了众多假面具下的人性本质。\n2002年得主：凯尔泰斯·伊姆雷\n匈牙利作家。\n代表作：《无形的命运》\n获奖理由：表彰他对脆弱的个人在对抗强大的野蛮强权时痛苦经历的深刻刻画以及他独特的自传体文学风格。\n2001年得主：维·苏·奈保尔\n印度裔英国作家\n代表作：《神秘的按摩师》《米格尔街》\n获奖理由：其著作将极具洞察力的叙述与不为世俗左右的探索融为一体，是驱策我们从扭曲的历史中探寻真实的动力。\n2000年得主：高行健\n法籍华人，剧作家、小说家。\n代表作：《灵山》\n获奖理由：其作品的普遍价值，刻骨铭心的洞察力和语言的丰富机智，为中文小说和艺术戏剧开辟了新的道路。\n1999年得主：君特·格拉斯\n德国作家。\n代表作：《铁皮鼓》\n获奖理由：其嬉戏之中蕴含悲剧色彩的寓言描摹出了人类淡忘的历史面目。\n1998年得主：若泽·萨拉马戈\n葡萄牙记者、作家\n代表作：《失明症漫记》\n获奖理由：由于他那极富想象力、同情心和颇具反讽意味的作品,我们得以反复重温那一段难以捉摸的历史。\n1997年得主：达里奥·福\n意大利讽刺剧作家\n代表作：《喜剧的神秘》《一个无政府主义者的死亡》\n获奖理由：其在鞭笞权威，褒扬被蹂躏者可贵的人格品质方面所取得的成就堪与中世纪《弄臣》一书相媲美。\n1996年得主：维斯瓦娃·辛波丝卡（女）\n波兰诗人\n代表作：《向自己提出问题》《呼唤雪人》\n获奖理由：由于其在诗歌艺术中警辟精妙的反讽，挖掘出了人类一点一滴的现实生活背后历史更迭与生物演化的深意。\n1995年得主：谢默斯·希尼\n爱尔兰诗人\n代表作：《通向黑暗之门》《在外过冬》\n获奖理由：由于其作品洋溢着抒情之美,包容着深邃的伦理,揭示出日常生活和现实历史的奇迹。\n1994年得主：大江健三郎\n日本小说家\n代表作：《个人的体验》《万延元年的足球队》\n获奖理由：通过诗意的想象力,创造出一个把现实与神话紧密凝缩在一起的想象世界，描绘现代的芸芸众生相，给人们带来了冲击。\n1993年得主：托妮·莫里森（女）\n美国作家\n代表作：《最蓝的眼睛》《所罗门之歌》\n获奖理由：其作品想象力丰富,富有诗意，显示了美国现实生活的重要方面。\n1992年得主：德里克·沃尔科特\n圣卢西亚诗人\n代表作：《西印度群岛》\n获奖理由：他的作品具有巨大的启发性和广阔的历史视野，是其献身多种文化的结果。\n1991年得主：纳丁·戈迪默（女）\n南非作家\n代表作：《七月的人民》\n获奖理由：以强烈而直接的笔触，描写周围复杂的人际与社会关系，其史诗般壮丽的作品，对人类大有裨益。\n1990年得主：奥克塔维奥·帕斯\n墨西哥诗人\n代表作：《太阳石》\n获奖理由：他的作品充满激情，视野开阔，渗透着感悟的智慧并体现了完美的人道主义。\n1989年得主：卡米洛·何塞·塞拉\n代表作：《为亡灵弹奏》\n获奖理由：带有浓郁情感的丰富而精简的描写，对人类弱点达到的令人难以企及的想象力。\n1988年得主：纳吉布·马哈富兹\n埃及作家。\n代表作：《街魂》\n获奖理由：他通过大量刻画入微的作品—洞察一切的现实主义，唤起人们树立雄心—形成了全人类所欣赏的阿拉伯语言艺术。\n1987年得主：约瑟夫·布罗茨基\n苏裔美籍诗人\n代表作：《从彼得堡到斯德哥尔摩》\n获奖理由：他的作品超越时空限制，无论在文学上或是敏感问题方面都充分显示出他广阔的思想及浓郁的诗意。\n1986年得主：沃莱·索因卡\n尼日利亚剧作家、诗人、小说家、评论家\n代表作：《雄狮与宝石》\n获奖理由：他以广博的文化视野创作了富有诗意的关于人生的戏剧。\n1985年得主：克洛德·西蒙\n法国小说家\n代表作：《弗兰德公路·农事诗》\n获奖理由：由于他善于把诗人和画家的丰富想象与深刻的时间意识融为一 体，对人类的生存状况进行了深入的描写。\n1984年得主：雅罗斯拉夫·塞弗尔特\n捷克诗人\n代表作：《紫罗兰》\n获奖理由：他的诗富于独创性、新颖、栩栩如生，表现了人的不屈不挠精神和多才多艺的渴求解放的形象。\n1983年得主：威廉·戈尔丁\n英国作家\n代表作：《蝇王·金字塔》\n获奖理由：具有清晰的现实主义叙述技巧以及虚构故事的多样性与普遍性，阐述了今日世界人类的状况。\n1982年得主：加夫列尔·加西亚·马尔克斯\n哥伦比亚记者、作家\n代表作：《百年孤独》《霍乱时期的爱情》\n获奖理由：由于其长篇小说以结构丰富的想象世界，其中糅混着魔幻与现实，反映出一整个大陆的生命矛盾。\n1981年得主：埃利亚斯·卡内蒂\n英国德语作家\n代表作：《迷茫》\n获奖理由：作品具有宽广的视野、丰富的思想和艺术力量。\n1980年得主：切斯拉夫·米沃什\n波兰诗人\n代表作：《拆散的笔记簿》\n获奖理由：不妥协的敏锐洞察力，描述了人在激烈冲突的世界中的暴露状态。\n1979年得主：奥德修斯·埃里蒂斯\n希腊诗人\n代表作：《英雄挽歌》\n获奖理由：他的诗，以希腊传统为背景，用感觉的力量和理智的敏锐，描写现代人为自由和创新而奋斗。\n1978年得主：艾萨克·巴什维斯·辛格\n美国作家\n代表作：《魔术师·原野王》\n获奖理由：他的充满激情的叙事艺术，这种既扎根于波兰人的文化传统，又反映了人类的普遍处境。\n1977年得主：阿莱克桑德雷·梅洛\n西班牙诗人\n代表作：《天堂的影子》\n获奖理由：他的作品继承了西班牙抒情诗的传统和吸取了今天流派的风格，描述了人在宇宙和当今社会中的状况。\n1976年得主：索尔·贝娄\n美国作家\n代表作：《赫索格》\n获奖理由：由于他的作品对人性的了解，以及对当代文化的敏锐透视。\n1975年得主：埃乌杰尼奥·蒙塔莱\n意大利诗人\n代表作：《生活之恶》\n获奖理由：由于他杰出的诗歌拥有伟大的艺术性，在不适合幻想的人生里，诠释了人类的价值。\n1974年得主1：哈里·埃德蒙·马丁逊\n瑞典诗人\n代表作：《露珠里的世界》\n获奖理由：他的作品透过一滴露珠反映出整个世界。\n得主2：埃温特·约翰逊\n瑞典作家\n代表作：《乌洛夫的故事》\n获奖理由：以自由为目的，而致力于历史的、现代的广阔观点之叙述艺术。\n1973年得主：帕特里克·怀特\n澳大利亚小说家、剧作家\n代表作：《风暴眼》\n获奖理由：由于他史诗与心理叙述艺术，并将一个崭新的大陆带进文学中。\n1972年得主： 亨利希·伯尔\n德国作家\n代表作：《女士及众生相》\n获奖理由：为了表扬他的作品，这些作品兼具有对时代广阔的透视和塑造人物的细腻技巧，并有助于德国文学的振兴。\n1971年得主： 巴勃鲁·聂鲁达\n智利诗人\n代表作：《情诗·哀诗·赞诗》\n获奖理由：诗歌具有自然力般的作用，复苏了一个大陆的命运与梦想。\n1970年得主：亚历山大·索尔仁尼琴\n苏联作家\n代表作：《癌症楼》《古拉格群岛》\n获奖理由：由于他作品中的道德力量，籍著它，他继承了俄国文学不可或缺的传统。\n1969年得主：萨缪尔·贝克特\n法国作家\n代表作：《等待戈多》\n获奖理由：他那具有奇特形式的小说和戏剧作品，使现代人从精神困乏中得到振奋。\n1968年得主：川端康成\n日本小说家\n代表作：《雪国·千只鹤·古都》\n获奖理由：由于他高超的叙事性作品以非凡的敏锐表现了日本人精神特质。\n1967年得主：安赫尔·阿斯图里亚斯\n危地马拉诗人、小说家\n代表作：《玉米人》\n获奖理由：因为他的作品落实于自己的民族色彩和印第安传统，而显得鲜明生动。\n1966年得主1：奈莉·萨克斯（女）\n瑞典诗人\n代表作：《逃亡》\n获奖理由：因为她杰出的抒情与戏剧作品，以感人的力量阐述了以色列的命运。\n得主2：萨缪尔·约瑟夫·阿格农以色列作家\n代表作：《行为之书》\n获奖理由：他的叙述技巧深刻而独特，并从犹太民族的生命汲取主题。\n1965年得主：米哈伊尔·亚历山大罗维奇·肖洛霍夫\n苏联作家\n代表作：《静静的顿河》\n获奖理由：由于这位作家在那部关于顿河流域农村之史诗作品中所流露的活力与艺术热忱——他籍这两者在那部小说里描绘了俄罗斯民族生活之某一历史层面。\n1964年得主：让·保罗·萨特\n法国哲学家、作家\n代表作：《词语》\n获奖理由：因为他那思想丰富、充满自由气息和探求真理精神的作品对我们时代发生了深远影响。\n1963年得主：乔治·塞菲里斯\n希腊诗人\n代表作：《“画眉鸟”号》\n获奖理由：他的卓越的抒情诗作，是对希腊文化的深刻感受的产物。\n1962年得主：约翰·斯坦贝克\n美国作家\n代表作：《人鼠之间》\n获奖理由：通过现实主义的、寓于想象的创作，表现出富于同情的幽默和对社会的敏感观察。\n1961年得主：伊沃·安德里奇\n南斯拉夫小说家\n代表作：《桥·小姐》\n获奖理由：由于他作品中史诗般的力量——他籍著它在祖国的历史中追寻主题，并描绘人的命运。\n1960年得主：圣琼·佩斯\n法国诗人和剧作家\n代表作：《蓝色恋歌》\n获奖理由：由于他高超的飞越与丰盈的想象，表达了一种关于如今这个时代之富于意象的沉思。\n1959年得主：萨瓦多尔·夸西莫多\n意大利诗人\n代表作：《水与土》\n获奖理由：由于他的抒情诗，以古典的火焰表达了我们这个时代中，生命的悲剧性体验。\n1958年得主：鲍里斯·列昂尼多维奇·帕斯捷尔纳克\n苏联俄罗斯诗人、小说家\n代表作：《日瓦戈医生》\n获奖理由：在当代抒情诗和俄国的史诗传统上，他都获得了极为重大的成就。\n1957年得主：阿尔贝·加缪\n法国作家\n代表作：《局外人》\n获奖理由：由于他重要的著作，在这著作中他以明察而热切的眼光照亮了我们这时代人类良心的种种问题。\n1956年得主：胡安·拉蒙·希梅内斯\n西班牙诗人\n代表作：《悲哀的咏叹调》\n获奖理由：由于他的西班牙抒情诗，成了高度精神和纯粹艺术的最佳典范。\n1955年得主：赫尔多尔·奇里扬·拉斯克内斯\n冰岛作家\n代表作：《渔家女》\n获奖理由：为了他在作品中所流露的生动、史诗般的力量，使冰岛原已十分优秀的叙述文学技巧更加瑰丽多姿。\n1954年得主：欧内斯特·海明威\n美国作家\n代表作：《老人与海》\n获奖理由：因为他精通于叙事艺术，突出地表现于其近著《老人与海》之中；同时也因为他对当代文体风格之影响。\n1953年得主：温斯顿·丘吉尔\n英国政治家、历史学家、传记作家\n代表作：《不需要的战争》\n获奖理由：由于他在描述历史与传记方面的造诣，同时由于他那捍卫崇高的人的价值的光辉演说。\n1952年得主：弗朗索瓦·莫里亚克\n法国小说家\n代表作：《爱的荒漠》\n获奖理由：因为他在他的小说中剖析了人生的戏剧，对心灵的深刻观察和紧凑的艺术。\n1951年得主：帕尔·费比安·拉格奎斯特\n瑞典诗人、戏剧家、小说家\n代表作：《大盗巴拉巴》\n获奖理由：由于他在作品中为人类面临的永恒的疑难寻求解答所表现出的艺术活力和真正独立的见解。\n1950年得主：帕特兰·亚瑟·威廉·罗素\n英国数学家、哲学家\n代表作：《哲学—数学—文学》\n获奖理由：表彰他所写的捍卫人道主义理想和思想自由的多种多样意义重大的作品。\n1949年得主：威廉·福克纳\n美国作家\n代表作：《我弥留之际》《喧哗与骚动》\n获奖理由：因为他对当代美国小说做出了强有力的和艺术上无与伦比的贡献。\n1948年得主：托马斯·斯特恩斯·艾略特\n英美诗人、剧作家、批评家\n代表作：《四个四重奏》\n获奖理由：对于现代诗之先锋性的卓越贡献。\n1947年得主：安德烈·纪德\n法国作家、评论家\n代表作：《田园交响曲》《背德者》\n获奖理由：为了他广泛的与有艺术质地的著作，在这些著作中，他以无所畏惧的对真理的热爱，并以敏锐的心理学洞察力，呈现了人性的种种问题与处境。\n1946年得主：赫尔曼·黑塞\n德国作家\n代表作：《荒原狼》\n获奖理由：他那些灵思盎然的作品——它们一方面具有高度的创意和深刻的洞见，一方面象征古典的人道理想与高尚的风格。\n1945年得主：加夫列拉·米斯特拉尔（女）\n智利诗人\n代表作：《柔情》\n获奖理由：她那由强烈感情孕育而成的抒情诗，已经使得她的名字成为整个拉丁美洲世界渴求理想的象征。\n1944年得主：约翰内斯·威廉·扬森\n丹麦小说家、诗人\n代表作：《漫长的旅行》\n获奖理由：由于籍著丰富有力的诗意想象，将胸襟广博的求知心和大胆的、清新的创造性风格结合起来。\n1940年-1943年 未颁奖\n1939年得主：弗兰斯·埃米尔·西兰帕\n芬兰作家\n代表作：《少女西丽亚》\n获奖理由：由于他在描绘两样互相影响的东西——他祖国的本质，以及该国农民的生活时——所表现的深刻了解与细腻艺术。\n1938年得主：赛珍珠（女）\n美国作家\n代表作：《大地》三部曲\n获奖理由：她对于中国农民生活的丰富和真正史诗气概的描述，以及她自传性的杰作。\n1937年得主：罗杰·马丁·杜·加尔\n法国小说家\n代表作：《蒂伯—家》\n获奖理由：由于在他的长篇小说《蒂伯一家》中表现出来的艺术魅力和真实性。这是对人类生活面貌的基本反映。\n1936年得主：尤金·奥尼尔\n美国剧作家\n代表作：《天边外》\n获奖理由：由于他剧作中所表现的力量、热忱与深挚的感情——它们完全符合悲剧的原始概念。\n1935年 未颁奖\n1934年得主：路伊吉·皮兰德娄\n意大利说家、戏剧家\n代表作：《寻找自我》《六个寻找剧作家的角色》\n获奖理由：他果敢而灵巧地复兴了戏剧艺术和舞台艺术。\n1933年得主：伊凡·亚历克塞维奇·蒲宁\n俄国作家\n代表作：《米佳的爱》\n获奖理由：由于他严谨的艺术才能，使俄罗斯古典传统在散文中得到继承。\n1932年得主：约翰·高尔斯华绥\n英国小说家、剧作家\n代表作：《有产者》\n获奖理由：为其描述的卓越艺术——这种艺术在《福尔赛世家》中达到高峰。\n1931年得主：埃利克·阿克塞尔·卡尔费尔德\n瑞典诗人\n代表作：《荒原和爱情》\n获奖理由：由于他在诗作的艺术价值上，从没有人怀疑过。\n1930年得主：辛克莱·刘易斯\n美国作家\n代表作：《巴比特》\n获奖理由：由于他充沛有力、切身和动人的叙述艺术，和他以机智幽默去开创新风格的才华。\n1929年得主：保尔·托马斯·曼\n德国作家\n代表作：《布登勃洛克一家》《魔山》\n获奖理由：由于他那在当代文学中具有日益巩固的经典地位的伟大小说《布登勃洛克一家》。\n1928年得主：西格里德·温塞特（女）\n挪威作家\n代表作：《新娘—主人—十字架》\n获奖理由：主要是由于她对中世纪北国生活之有力描绘。\n1927年得主：亨利·柏格森\n法国哲学家\n代表作：《创造进化论》\n获奖理由：因为他那丰富的且充满生命力的思想，以及所表现出来的光辉灿烂的技巧。\n1926年得主：格拉齐亚·黛莱达（女）\n意大利作家\n代表作：《邪恶之路》\n获奖理由：为了表扬她由理想主义所激发的作品，以浑柔的透彻描绘了她所生长的岛屿上的生活；在洞察人类一般问题上，表现的深度与怜悯。\n1925年得主：乔治·萧伯纳\n爱尔兰戏剧家\n代表作：《圣女贞德》\n获奖理由：由于他那些充满理想主义及人情味的作品——它们那种激动性讽刺，常涵蕴着一种高度的诗意美。\n1924年得主：弗拉迪斯拉夫·莱蒙特\n波兰作家\n代表作：《福地》《农夫们》\n获奖理由：我们颁奖给他，是因为他的民族史诗《农夫们》写得很出色。\n1923年得主：威廉·勃特勒·叶芝\n爱尔兰诗人、剧作家\n代表作：《丽达与天鹅》\n获奖理由：由于他那永远充满着灵感的诗，它们透过高度的艺术形式展现了整个民族的精神。\n1922年得主：哈辛特·贝纳文特·伊·马丁内斯\n西班牙作家\n代表作：《不吉利的姑娘》\n获奖理由：由于他以适当方式，延续了戏剧之灿烂传统。\n1921年得主：阿纳托尔·法郎士\n法国作家、文学评论家、社会活动家\n代表作：《苔依丝》\n获奖理由：他辉煌的文学成就，乃在于他高尚的文体、怜悯的人道同情、迷人的魅力，以及一个真正法国性情所形成的特质。\n1920年得主：克努特·汉姆生\n挪威小说家、戏剧家、诗人\n代表作：《大地硕果—畜牧曲》\n获奖理由：为了他划时代的巨著《土地的成长》。\n1919年得主：卡尔·施皮特勒\n瑞士诗人、小说家\n代表作：《奥林帕斯之春》\n获奖理由：特别推崇他在史诗《奥林帕斯之春》的优异表现。\n1918年 未颁奖\n1917年得主1：亨利克·彭托皮丹\n丹麦小说家\n代表作：《天国》\n获奖理由：由于他对当前丹麦生活的忠实描绘。\n得主2：卡尔·耶勒鲁普\n丹麦作家\n代表作：《磨坊血案》\n获奖理由：因为他多样而丰富的诗作——它们蕴含了高超的理想。\n1916年得主：魏尔纳·海顿斯坦姆\n瑞典诗人、小说家\n代表作：《朝圣年代》\n获奖理由：褒奖他在瑞典文学新纪元中所占之重要代表地位。\n1915年得主：罗曼·罗兰\n法国作家、音乐评论家\n代表作：《约翰·克利斯朵夫》\n获奖理由：文学作品中的高尚理想和他在描绘各种不同类型人物时所具有的同情和对真理的热爱。\n1914年 未颁奖\n1913年得主：罗宾德拉纳特·泰戈尔\n印度诗人、社会活动家主\n代表作：《吉檀枷利—饥饿石头》\n获奖理由：由于他那至为敏锐、清新与优美的诗；这诗出之于高超的技巧，并由于他自己用英文表达出来，使他那充满诗意的思想业已成为西方文学的一部分。\n1912年得主：盖哈特·霍普特曼\n德国剧作家、诗人\n代表作：《群鼠》\n获奖理由：欲以表扬他在戏剧艺术领域中丰硕、多样的出色成就。\n1911年得主：莫里斯·梅特林克\n比利时剧作家、诗人、散文家\n代表作：《花的智慧》\n获奖理由：由于他在文学上多方面的表现，尤其是戏剧作品，不但想象丰富，充满诗意的奇想，有时虽以神话的面貌出现，还是处处充满了深刻的启示。这种启示奇妙地打动了读者的心弦，并且激发了他们的想象。\n1910年得主：保尔·约翰·路德维希·冯·海塞\n德国作家\n代表作：《特雷庇姑娘》\n获奖理由：表扬这位抒情诗人、戏剧家、小说家以及举世闻名的短篇小说家，在他漫长而多产的创作生涯中，所达到的充满理想主义精神之艺术至境。\n1909年得主：西尔玛·拉格洛夫(女)\n瑞典作家\n代表作：《尼尔斯骑鹅旅行记》\n获奖理由：由于她作品中特有的高贵的理想主义、丰富的想象力、平易而优美的风格。\n1908年得主：鲁道尔夫·欧肯\n德国哲学家\n代表作：《精神生活漫笔》\n获奖理由：他对真理的热切追求、他对思想的贯通能力、他广阔的观察，以及他在无数作品中，辩解并阐释一种理想主义的人生哲学时，所流露的热诚与力量。\n1907年得主：约瑟夫·鲁德亚德·吉卜林\n英国小说家、诗人\n代表作：《老虎！老虎！》\n获奖理由：这位世界名作家的作品以观察入微、想象独特、气概雄浑、叙述卓越见长。\n1906年得主：乔祖埃·卡尔杜齐\n意大利诗人、文艺批评家\n代表作：《青春诗》\n获奖理由：不仅是由于他精深的学识和批判性的研究，更重要是为了颂扬他诗歌杰作中所具有的特色、创作气势，清新的风格和抒情的魅力。\n1905年得主：亨利克·显克维支\n波兰小说家\n代表作：《第三个女人》《你往何处去》\n获奖理由：由于他在历史小说写作上的卓越成就。\n1904年得主1：何塞·埃切加赖\n西班牙戏剧家、诗人\n代表作：《伟大的牵线人》\n获奖理由：由于它那独特和原始风格的丰富又杰出，作品恢复了西班牙喜剧的伟大传统。\n得主2：弗雷德里克·米斯塔尔\n法国诗人\n代表作：《金岛》\n获奖理由：他的诗作蕴涵之清新创造性与真正的感召力，它忠实地反映了他民族的质朴精神。\n1903年得主：比昂斯滕·比昂松\n挪威戏剧家、诗人、小说家\n代表作：《挑战的手套》\n获奖理由：他以诗人鲜活的灵感和难得的赤子之心，把作品写得雍容、华丽而又缤纷。\n1902年得主：特奥多尔·蒙森\n德国历史学家\n代表作：《罗马史》\n获奖理由：今世最伟大的纂史巨匠，此点于其巨著《罗马史》中表露无疑。\n1901年得主：苏利·普吕多姆\n法国诗人\n代表作：《孤独与深思》\n获奖理由：是高尚的理想、完美的艺术和罕有的心灵与智慧的实证。\n","permalink":"/post/c0-life/readings/nobel-maodun-literature/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\n世界和民族的优秀作品。\n漫漫长路，读书成长。\u003c/p\u003e\n\u003ch2 id=\"茅盾文学奖\"\u003e茅盾文学奖\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e第十届茅盾文学奖获奖篇目 (2015—2018)\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e作品\u003c/th\u003e\n          \u003cth\u003e作者\u003c/th\u003e\n          \u003cth\u003e出版单位\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《人世间》\u003c/td\u003e\n          \u003ctd\u003e梁晓声\u003c/td\u003e\n          \u003ctd\u003e中国青年出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《牵风记》\u003c/td\u003e\n          \u003ctd\u003e徐怀中\u003c/td\u003e\n          \u003ctd\u003e人民文学出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《北上》\u003c/td\u003e\n          \u003ctd\u003e徐则臣\u003c/td\u003e\n          \u003ctd\u003e北京十月文艺出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《主角》\u003c/td\u003e\n          \u003ctd\u003e陈 彦\u003c/td\u003e\n          \u003ctd\u003e北京十月文艺出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《应物兄》\u003c/td\u003e\n          \u003ctd\u003e李 洱\u003c/td\u003e\n          \u003ctd\u003e人民文学出版社\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003ca href=\"https://mp.weixin.qq.com/s/j-siAAyFx2wa2sc4k0qZyQ\"\u003e 中国作家网 第十届茅盾文学奖揭晓（附5位获奖作家介绍）\u003c/a\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e\u003cstrong\u003e第九届茅盾文学奖获奖篇目 (2011—2014)\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e作品\u003c/th\u003e\n          \u003cth\u003e作者\u003c/th\u003e\n          \u003cth\u003e出版单位\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《江南三部曲》\u003c/td\u003e\n          \u003ctd\u003e格　非\u003c/td\u003e\n          \u003ctd\u003e上海文艺出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《这边风景》\u003c/td\u003e\n          \u003ctd\u003e王　蒙\u003c/td\u003e\n          \u003ctd\u003e花城出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《生命册》\u003c/td\u003e\n          \u003ctd\u003e李佩甫\u003c/td\u003e\n          \u003ctd\u003e作家出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《繁花》\u003c/td\u003e\n          \u003ctd\u003e金宇澄\u003c/td\u003e\n          \u003ctd\u003e上海文艺出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《黄雀记》\u003c/td\u003e\n          \u003ctd\u003e苏　童\u003c/td\u003e\n          \u003ctd\u003e作家出版社\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003e第八届茅盾文学奖获奖篇目 (2007—2010)\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e作品\u003c/th\u003e\n          \u003cth\u003e作者\u003c/th\u003e\n          \u003cth\u003e出版单位\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《你在高原》\u003c/td\u003e\n          \u003ctd\u003e张　炜\u003c/td\u003e\n          \u003ctd\u003e作家出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《天行者》\u003c/td\u003e\n          \u003ctd\u003e刘醒龙\u003c/td\u003e\n          \u003ctd\u003e人民文学出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《蛙》\u003c/td\u003e\n          \u003ctd\u003e莫　言\u003c/td\u003e\n          \u003ctd\u003e上海文艺出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《推拿》\u003c/td\u003e\n          \u003ctd\u003e毕飞宇\u003c/td\u003e\n          \u003ctd\u003e人民文学出版社\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e《一句顶一万句》\u003c/td\u003e\n          \u003ctd\u003e刘震云\u003c/td\u003e\n          \u003ctd\u003e长江文艺出版社\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cstrong\u003e第七届茅盾文学奖获奖篇目 (2003—2006)\u003c/strong\u003e\u003c/p\u003e","tags":["读书","文学","信息类","转载"],"title":"「转」茅盾文学奖、诺贝尔文学奖"},{"categories":["机器人"],"content":"前言 本文为翻译文章。原文地址 https://www.learnopencv.com/face-detection-opencv-dlib-and-deep-learning-c-python/\n在这篇文章中，作者讨论使用了OpenCV或Dlib的多种人脸检测的代码，并给出性能分析。作者使用的 Face Detector 包括以下四个，后面分别给出 c++ 和 python 实现。\nOpenCV 的 Haar Cascade Face Detector OpenCV 的 Deep Learning based Face Detector Dlib 的 HoG Face Detector Dlib 的 Deep Learning based Face Detector 作者限于篇幅没有对对理论进行深入解读，只讨论框架的使用，同时分享一些应用上的选择权衡的经验。\n结论：在多数场景中，我们提前不知道图片大小，因此 选用 OpenCV – DNN 相当快也很精确，甚至对于小人脸也不错，各种人脸角度也可以。选用这个在大多情况下是最优的。\ncode FaceDetectionComparison 说明：为了使文章显得简洁一些，在文中只提供关键的代码片段。在github项目中详细代码，包括每个方法独立的代码和整合在一起的cpp和py文件（run-all.py 和 run-all.cpp），同时里面也有运行代码所使用的人脸检测模型。\n\u003e 实验的图片尺寸是 image size 300×300 1. OpenCV-Haar 在2001年，Viola 和 Jones提出Haar Cascade 特征为基础的 Face Detector，在以后的多年内都是最优的人脸检测算法。以他们的算法为基础人们做了很多改进。OpenCV提供了很多Haar特征的模型算法，更多的Haar特征模型 here\n代码 Python faceCascade = cv2.CascadeClassifier(\u0026#39;./haarcascade_frontalface_default.xml\u0026#39;) faces = faceCascade.detectMultiScale(frameGray) for face in faces: x1, y1, w, h = face x2 = x1 + w y2 = y1 + h C++ faceCascadePath = \u0026#34;./haarcascade_frontalface_default.xml\u0026#34;; faceCascade.load( faceCascadePath ) std::vector\u0026lt;Rect\u0026gt; faces; faceCascade.detectMultiScale(frameGray, faces); for ( size_t i = 0; i \u0026lt; faces.size(); i++ ) { int x1 = faces[i].x; int y1 = faces[i].y; int x2 = faces[i].x + faces[i].width; int y2 = faces[i].y + faces[i].height; } 对图片灰度变化（grayscale）后，再应用 haar cascade 特征，输出是脸的list。list中每个item有四个element 分别为 top-left corner的(x, y) 、检测出来脸的大小(width, height) 。\n优点 在CPU上几乎是实时的（real-time） 简单的框架 （Simple Architecture） 能检测不同大小的脸 （different scales） 缺点 主要缺点是有很多错误的预测（False predictions），会多预测出人脸。 人脸非正面效果不好 （non-frontal） 人脸遮挡效果不好 （under occlusion） 2. OpenCV-DNN 在 OpenCV 3.3 中引入这个方法。DNN模型使用SSD **Single-Shot-Multibox detector**框架和 ResNet-10 特征提取网络（backbone）。这个模型喂的数据是从网上采集的，但是训练的源代码没有公开。OpenCV提供了2个模型文件。\nFloat 16 位版本模型，使用原始的 caffe 训练 (5.4 MB) 8 bit quantized 版本模型，使用 Tensorflow 训练 (2.7 MB) 代码 FaceDetectionComparison 里面放了这两个模型文件。\n代码 Python DNN = \u0026#34;TF\u0026#34; if DNN == \u0026#34;CAFFE\u0026#34;: modelFile = \u0026#34;res10_300x300_ssd_iter_140000_fp16.caffemodel\u0026#34; configFile = \u0026#34;deploy.prototxt\u0026#34; net = cv2.dnn.readNetFromCaffe(configFile, modelFile) else: modelFile = \u0026#34;opencv_face_detector_uint8.pb\u0026#34; configFile = \u0026#34;opencv_face_detector.pbtxt\u0026#34; net = cv2.dnn.readNetFromTensorflow(modelFile, configFile) C++ const std::string caffeConfigFile = \u0026#34;./deploy.prototxt\u0026#34;; const std::string caffeWeightFile = \u0026#34;./res10_300x300_ssd_iter_140000_fp16.caffemodel\u0026#34;; const std::string tensorflowConfigFile = \u0026#34;./opencv_face_detector.pbtxt\u0026#34;; const std::string tensorflowWeightFile = \u0026#34;./opencv_face_detector_uint8.pb\u0026#34;; # ifdef CAFFE Net net = cv::dnn::readNetFromCaffe(caffeConfigFile, caffeWeightFile); # else Net net = cv::dnn::readNetFromTensorflow(tensorflowWeightFile, tensorflowConfigFile); # endif caffe 和 Tensorflow 框架加载模型的代码。使用 Float 16 的 Caffe 模型，需要 caffemodel 和 prototxt 文件。使用 8 bit quantized 的 Tensorflow 模型，需要 Tensorflow 配置文件和模型。\nPython blob = cv2.dnn.blobFromImage(frameOpencvDnn, 1.0, (300, 300), [104, 117, 123], False, False) net.setInput(blob) detections = net.forward() bboxes = [] for i in range(detections.shape[2]): confidence = detections[0, 0, i, 2] if confidence \u0026gt; conf_threshold: x1 = int(detections[0, 0, i, 3] * frameWidth) y1 = int(detections[0, 0, i, 4] * frameHeight) x2 = int(detections[0, 0, i, 5] * frameWidth) y2 = int(detections[0, 0, i, 6] * frameHeight) C++ #ifdef CAFFE cv::Mat inputBlob = cv::dnn::blobFromImage(frameOpenCVDNN, inScaleFactor, cv::Size(inWidth, inHeight), meanVal, false, false); #else cv::Mat inputBlob = cv::dnn::blobFromImage(frameOpenCVDNN, inScaleFactor, cv::Size(inWidth, inHeight), meanVal, true, false); #endif net.setInput(inputBlob, \u0026#34;data\u0026#34;); cv::Mat detection = net.forward(\u0026#34;detection_out\u0026#34;); cv::Mat detectionMat(detection.size[2], detection.size[3], CV_32F, detection.ptr\u0026lt;float\u0026gt;()); for (int i = 0; i \u0026lt; detectionMat.rows; i++) { float confidence = detectionMat.at\u0026lt;float\u0026gt;(i, 2); if (confidence \u0026gt; confidenceThreshold) { int x1 = static_cast\u0026lt;int\u0026gt;(detectionMat.at\u0026lt;float\u0026gt;(i, 3) * frameWidth); int y1 = static_cast\u0026lt;int\u0026gt;(detectionMat.at\u0026lt;float\u0026gt;(i, 4) * frameHeight); int x2 = static_cast\u0026lt;int\u0026gt;(detectionMat.at\u0026lt;float\u0026gt;(i, 5) * frameWidth); int y2 = static_cast\u0026lt;int\u0026gt;(detectionMat.at\u0026lt;float\u0026gt;(i, 6) * frameHeight); cv::rectangle(frameOpenCVDNN, cv::Point(x1, y1), cv::Point(x2, y2), cv::Scalar(0, 255, 0), 2, 4); } } 在上面的代码里面，图像转为blob输入进network里，利用前向传播函数forward()，得到一个4-D matrix。 这里不是很理解，代码跑起来看一下？？？\nThe 3rd dimension iterates over the detected faces. (i is the iterator over the number of faces) The fourth dimension contains information about the bounding box and score for each face. For example, detections[0,0,0,2] gives the confidence score for the first face, and detections[0,0,0,3:6] give the bounding box. The output coordinates of the bounding box are normalized between [0,1]. Thus the coordinates should be multiplied by the height and width of the original image to get the correct bounding box on the image.\n优点（merits） 在本文四个方法中最精确（Most accurate） 可以在CPU上实时运行（real-time） 人脸不同方向效果不错（上下左右，侧脸等）up, down, left, right, side-face etc 人脸不同大小效果不错哦（various scales, big and tiny OK） OpenCV的这个DNN方法克服了 Haar cascade 方法的不足，同时精度也不比它差。暂时没有发现这个方法其他有不足地方，除了比后面的 Dlib HoG 方法速度慢一点以外。\n作者建议，在使用OpenCV时，比Haar方法，可以优先考虑DNN方法。\n3. Dlib-HoG HoG 人脸检测方法被广泛的使用，基于 HoG 特征和 SVM 分类。作者还写了一篇 HoG 的博客 post。模型有5个 HOG filters 滤波器（ front looking, left looking, right looking, front looking but rotated left, and a front looking but rotated right），模型直接放在了头文件里面 header file。\n训练模型的数据库，来自LFW dataset，由 Davis King (Dlib的作者) 手工标记 （manually annotated）共2825张。需要的话，数据库从这里可以下载 dlib_face_detector_training_data.tar.gz.\n代码 Python hogFaceDetector = dlib.get_frontal_face_detector() faceRects = hogFaceDetector(frameDlibHogSmall, 0) for faceRect in faceRects: x1 = faceRect.left() y1 = faceRect.top() x2 = faceRect.right() y2 = faceRect.bottom() C++ frontal_face_detector hogFaceDetector = get_frontal_face_detector(); // Convert OpenCV image format to Dlib\u0026#39;s image format cv_image\u0026lt;bgr_pixel\u0026gt; dlibIm(frameDlibHogSmall); // Detect faces in the image std::vector\u0026lt;dlib::rectangle\u0026gt; faceRects = hogFaceDetector(dlibIm); for ( size_t i = 0; i \u0026lt; faceRects.size(); i++ ) { int x1 = faceRects[i].left(); int y1 = faceRects[i].top(); int x2 = faceRects[i].right(); int y2 = faceRects[i].bottom(); cv::rectangle(frameDlibHog, Point(x1, y1), Point(x2, y2), Scalar(0,255,0), (int)(frameHeight/150.0), 4); } 在上面的代码中，首先加载 face detector，然后将图像输入给 detector 。其中第二个参数代表，想要上采样图片的倍数（times of upscale）。你给的数字越大，小脸检测出的概率越大。但是upscaling 会在计算上花费可观的时间（ substantial impact on the computation speed）。输出是脸的list， 框框对角的坐标（diagonal corners）。\n优点 在cpu上最快的方法（在四个方法中） 对正面和轻微非正面的方法效果很不错 模型比较少对于其他三个的文件来说 轻微遮挡下可以检测 大概以上，这个方法多数情况可以工作，除了下面的情况。\n缺点 主要缺点对小人脸不识别。由于训练在最小 80×80 的数据集上，要确保你的使用环境，不然的话你要自己再训练一下小人脸。 人脸框经常去掉了人额头一部分，有时脸颊一部分。 （part of forehead and even part of chin sometimes） 在明显的遮挡情况下效果不好 在测量和极端不正面的脸情况不工作，像向上看，和向下看的情况。 4. Dlib-CNN 这个模型使用了**Maximum-Margin Object Detector (MMOD)** 加CNN的特征的方法。训练过程相当简单，也不需要大量的数据去训练一个新的 object detector。更多的训练套路，在这个网站上 website.\n使用的模型可以从 dlib-models repository 下载。\n训练使用的数据库是dlib的作者 Davis King 手工标的，7220张从 ImageNet, PASCAL VOC, VGG, WIDER, Face Scrub等数据库里面挑的。这个数据库可以下载到。dlib_face_detection_dataset-2016-09-30.tar.gz\n代码 Python dnnFaceDetector = dlib.cnn_face_detection_model_v1(\u0026#34;./mmod_human_face_detector.dat\u0026#34;) faceRects = dnnFaceDetector(frameDlibHogSmall, 0) for faceRect in faceRects: x1 = faceRect.rect.left() y1 = faceRect.rect.top() x2 = faceRect.rect.right() y2 = faceRect.rect.bottom() C++ String mmodModelPath = \u0026#34;./mmod_human_face_detector.dat\u0026#34;; net_type mmodFaceDetector; deserialize(mmodModelPath) \u0026gt;\u0026gt; mmodFaceDetector; // Convert OpenCV image format to Dlib\u0026#39;s image format cv_image\u0026lt;bgr_pixel\u0026gt; dlibIm(frameDlibMmodSmall); matrix\u0026lt;rgb_pixel\u0026gt; dlibMatrix; assign_image(dlibMatrix, dlibIm); // Detect faces in the image std::vector\u0026lt;dlib::mmod_rect\u0026gt; faceRects = mmodFaceDetector(dlibMatrix); for ( size_t i = 0; i \u0026lt; faceRects.size(); i++ ) { int x1 = faceRects[i].rect.left(); int y1 = faceRects[i].rect.top(); int x2 = faceRects[i].rect.right(); int y2 = faceRects[i].rect.bottom(); cv::rectangle(frameDlibMmod, Point(x1, y1), Point(x2, y2), Scalar(0,255,0), (int)(frameHeight/150.0), 4); } 代码和 HoG detector 差不多，除了下载的 CNN face detection 的模型文件。\n优点 不同的脸朝向效果不错 （face orientations） 遮挡比较稳定 （occlusion） 在GPU上很快 训练模型过程很简单 缺点 CPU上很慢 脸大小于 80×80 检测不出，因为模型在小脸训练的。所以要考虑你应用的具体场景脸的大小，当然也可以对小脸数据库再训练一下。 人脸框 bounding box 甚至比 HoG detector 还小。 5. 精度比较 （Accuracy Comparison）\n作者评估这四个模型使用的是 FDDB 数据库，其中评估OpenCV-DNN 脚本为 OpenCV face_detector_accuracy.py.\n作者发现奇怪的结果。Dlib 的结果比 Haar OpenCV还要低，然而实际从图片上效果比较好。下图是这四个方法的精度得分（ Precision scores）。\n指标说明（Metric）： AP_50 = Precision when overlap between Ground Truth and predicted bounding box is at least 50% (IoU = 50%) AP_75 = Precision when overlap between Ground Truth and predicted bounding box is at least 75% (IoU = 75%) AP_Small = Average Precision for small size faces (Average of IoU = 50% to 95%) AP_medium = Average Precision for medium size faces (Average of IoU = 50% to 95%) AP_Large = Average Precision for large size faces (Average of IoU = 50% to 95%) mAP = Average precision across different IoU (Average of IoU = 50% to 95%)\n作者最近的发现评估过程对 Dlib 不够公平，科学。\n5.1. 评估过程出错了，分析的二个原因！ 根据我们的分析，Dlib拿到低的精度的原因如下： 第一个主要原因是训练dlib的是标准数据库没有加标签（annotations）。数据库图片是由dlib作者自己切的，因此可以发现同样是人脸检测的框，同OpenCV 中的两个方法 OpenCV-Haar 或者 OpenCV-DNN 相比，dlib的方法会裁掉额头一部分或者脸颊一部分（forehead chin）。下面的图中可以看到。\n这个问题可以导致 在上个柱状图中 dlib 分数会低。AP_X 代表着 X% 预测框和真实框交叠的面积占合起来面积的比率。dlib 的 AP_75 的得分为0，尽管有在 AP_75 比 Haar 还高。这个就意味着：Dlib 模型可以预测更多的人脸比 Haar 特征，但是dlib的框的 AP_75 得分比较低。\n第二个原因是 dlib 不能检测小的人脸，进一步拉低了得分。\n因此，比较 OpenCV 和 Dlib 精确性的一个相对合理的指标是 AP_50 （或者可以使用小于50%的指标，我们只是设阈值用来计算人头的个数） 以上分析大家使用 Dlib 的时候注意一下。\n6. 速度比较 Speed Comparison\n我们使用 300x300 图像做的对比实验。Dlib 的 MMOD 模型可以利用上GPU，但是OpenCV方法对 NVIDIA GPUs 支持还没有。所以我们评估对比这些方法在CPU上，但我们也给出 GPU 版本 MMOD 结果。\n(这段话以后写论文的时候可以用到，保留:cat:) We used a 300×300 image for the comparison of the methods. The MMOD detector can be run on a GPU, but the support for NVIDIA GPUs in OpenCV is still not there. So, we evaluate the methods on CPU only and also report result for MMOD on GPU as well as CPU.\n硬件的配置 Processor : Intel Core i7 6850K – 6 Core RAM : 32 GB GPU : NVIDIA GTX 1080 Ti with 11 GB RAM OS : Linux 16.04 LTS Programming Language : Python\n我们跑了10次，每次对图片进行10000趟测试得总时间，然后对这10次取平均。下面的柱状图是结果。We run each method 10000 times on the given image and take 10 such iterations and average the time taken. Given below are the results.\n从图中可以看到，对于 300x300 的图片，除了 MMOD。MMOD 在GPU上还是很快的，CPU上就是渣渣了。As you can see that for the image of this size, all the methods perform in real-time, except MMOD. MMOD detector is very fast on a GPU but is very slow on a CPU.\n以上的结果在不同电脑硬软件环境下可能不一样。\n7. 多种情况讨论 除了速度和精度外，我们在选择哪个模型来使用还有一些因素可以考虑。在这节中，将考虑这些情况下的选择。主要为人脸大小变化、非正脸、遮挡。\n7.1. 人脸大小变化 Detection across scale\n下面有一个例子视频，这位帅哥在做一个前后的健身动作，使得脸部区域变大变小。可以看到OpenCV DNN 检测出了所有的脸，而 Dlib 的方法只有在大于某个 size 的时候才被检测出来。\n我们测试后，脸大于 70×70 才能被 dlib检测出。正如在前面说到的，对小人脸检测是dlib方法的一个大的缺点。我们也可以将图片上采样，但这样的话速度的话相对于 OpenCV-DNN 就太慢了。\nIt can be seen that dlib based methods are able to detect faces of size upto ~(70×70) after which they fail to detect. As we discussed earlier, I think this is the major drawback of Dlib based methods. Since it is not possible to know the size of the face before-hand in most cases. We can get rid of this problem by upscaling the image, but then the speed advantage of dlib as compared to OpenCV-DNN goes away.\n7.2. 非正脸 Non-frontal Face\n对于非正脸的测试，我们选用了 looking towards right, left, up, down。为了对 dlib 公平，我们选择了face 大于 80×80 的图片。下面是一些例子。\nNon-frontal can be looking towards right, left, up, down. Again, to be fair with dlib, we make sure the face size is more than 80×80. Given below are some examples.\n和预期的一样，OpenCV Haar 方法完全败了。Dlib HoG能检测出 left 或 right looking faces，但是精度不如那些DNN方法。\nAs expected, Haar based detector fails totally. HoG based detector does detect faces for left or right looking faces (since it was trained on them) but not as accurately as the DNN based detectors of OpenCV and Dlib.\n7.3. 遮挡 Occlusion\n接下来看一下遮挡的情况。Let us see how well the methods perform under occlusion.\n再一次看到，DNN方法比其他方法更优，OpenCV-DNN 比 Dlib-MMOD 还好一点。这是因为CNN 特征 比 HoG or Haar 更加鲁棒，稳定。\nAgain, the DNN methods outperform the other two, with OpenCV-DNN slightly better than Dlib-MMOD. This is mainly because the CNN features are much more robust than HoG or Haar features.\n8. 总结 我们讨论了每个方法的优缺点。个人建议使用 OpenCV-DNN 和 Dlib-HoG 在应用和设备成本权衡中。以下我们的建议：\nWe had discussed the pros and cons of each method in the respective sections. I recommend to try both OpenCV-DNN and HoG methods for your application and decide accordingly. We share some tips to get started.\n8.1 大多数的情况 General Case\n在多数场景中，我们提前不知道图片大小，因此 选用 OpenCV – DNN 相当快也很精确，甚至对于小人脸也不错，各种人脸角度也可以。选用这个在大多情况下是最优的。\nIn most applications, we won’t know the size of the face in the image before-hand. Thus, it is better to use OpenCV – DNN method as it is pretty fast and very accurate, even for small sized faces. It also detects faces at various angles. We recommend to use OpenCV-DNN in most\n8.2 大小中等或大一点图片 For medium to large image sizes\nDlib HoG 在 cpu上是最快的一个方法。但是它不能检测出 face size (\u0026lt; 70x70) 的图片。所以你得清楚使用的场景，比如自拍的话就可以。如果能使用GPU的话 dlib-MMOD 是一个最好的选择，因为它支持GPU，跑得也比较快，也能适应人脸的角度变化。\nDlib HoG is the fastest method on CPU. But it does not detect small sized faces (\u0026lt; 70x70). So, if you know that your application will not be dealing with very small sized faces ( for example a selfie app ), then HoG based Face detector is a better option. Also, If you can use a GPU, then MMOD face detector is the best option as it is very fast on GPU and also provides detection at various angles.\n8.3 高分辨率图像 High resolution images\n对于这些方法来说，高分辨图像都有点难度，计算时间比较长。可能采用的方法是resize图像 （ scale down the image），HoG / MMOD方法可能就识别不出了，但是可以使用 OpenCV-DNN 尝试一下。我认为也可以将图片分割开再识别呀，嘻嘻。\nSince feeding high resolution images is not possible to these algorithms (for computation speed), HoG / MMOD detectors might fail when you scale down the image. On the other hand, OpenCV-DNN method can be used for these since it detects small faces.\n有任何建议，欢迎在下面评论。 Have any other suggestions? Please mention in the comments and we’ll update the post with them!\n参考 FDDB Comparison code Dlib Blog dlib mmod python example dlib mmod cpp example OpenCV DNN Face detector Haar Based Face Detector\nTODOS 文章作者是 VIKAS GUPTA\n来，看看这个是站长大佬的图片，是不是很熟悉？膜拜一哈。\n我订阅后文章后，作者发的邮件内容，并没有给文章页的代码。\n给的Computer-Vision-Resources.pdf 作者的Dlib fork 重要资源\n作者博客 link\n作者的所有代码拿走不谢 link\n翻译\n代码运行\n根据该作者的博客继续翻译，学习，向大佬致敬。\n","permalink":"/post/c2-robotics/cv/face-detection-comparison/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\n本文为翻译文章。原文地址 \u003ca href=\"https://www.learnopencv.com/face-detection-opencv-dlib-and-deep-learning-c-python/\"\u003ehttps://www.learnopencv.com/face-detection-opencv-dlib-and-deep-learning-c-python/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e在这篇文章中，作者讨论使用了OpenCV或Dlib的多种人脸检测的代码，并给出性能分析。作者使用的 Face Detector 包括以下四个，后面分别给出 c++ 和 python 实现。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eOpenCV 的 Haar Cascade Face Detector\u003c/li\u003e\n\u003cli\u003eOpenCV 的 Deep Learning based Face Detector\u003c/li\u003e\n\u003cli\u003eDlib 的 HoG Face Detector\u003c/li\u003e\n\u003cli\u003eDlib 的 Deep Learning based Face Detector\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e作者限于篇幅没有对对理论进行深入解读，只讨论框架的使用，同时分享一些应用上的选择权衡的经验。\u003c/p\u003e\n\u003cp\u003e结论：在多数场景中，我们提前不知道图片大小，因此 选用 OpenCV – DNN 相当快也很精确，甚至对于小人脸也不错，各种人脸角度也可以。选用这个在大多情况下是最优的。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/spmallick/learnopencv/tree/master/FaceDetectionComparison\"\u003ecode FaceDetectionComparison\u003c/a\u003e 说明：为了使文章显得简洁一些，在文中只提供关键的代码片段。在github项目中详细代码，包括每个方法独立的代码和整合在一起的cpp和py文件（run-all.py 和 run-all.cpp），同时里面也有运行代码所使用的人脸检测模型。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ccenter\u003e\u003ciframe  width=\"100%\" height=\"360\"  frameborder=0 src=\"http://v.qq.com/iframe/player.html?vid=k07615vrzj8\u0026tiny=0\u0026auto=0\" allowfullscreen=\"\"\u003e\u003c/iframe\u003e\u003c/center\u003e\n\u003e 实验的图片尺寸是  image size 300×300\n\u003ch2 id=\"1-opencv-haar\"\u003e1. OpenCV-Haar\u003c/h2\u003e\n\u003cp\u003e在2001年，Viola 和 Jones提出Haar Cascade 特征为基础的 Face Detector，在以后的多年内都是最优的人脸检测算法。以他们的算法为基础人们做了很多改进。OpenCV提供了很多Haar特征的模型算法，更多的Haar特征模型 \u003cstrong\u003e\u003ca href=\"https://github.com/opencv/opencv/tree/master/data/haarcascades\"\u003ehere\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"代码\"\u003e代码\u003c/h3\u003e\n\u003ch4 id=\"python\"\u003ePython\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efaceCascade \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e cv2\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eCascadeClassifier(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;./haarcascade_frontalface_default.xml\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efaces \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e faceCascade\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edetectMultiScale(frameGray)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e face \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e faces:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    x1, y1, w, h \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e face\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    x2 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e x1 \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e w\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    y2 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y1 \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e h\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"c\"\u003eC++\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efaceCascadePath \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./haarcascade_frontalface_default.xml\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efaceCascade.load( faceCascadePath )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003estd\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003evector\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003eRect\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e faces;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efaceCascade.detectMultiScale(frameGray, faces);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e ( size_t i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e faces.size(); i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e x1 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e faces[i].x;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e y1 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e faces[i].y;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e x2 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e faces[i].x \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e faces[i].width;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e y2 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e faces[i].y \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e faces[i].height;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e对图片灰度变化（grayscale）后，再应用 haar cascade 特征，输出是脸的list。list中每个item有四个element 分别为 top-left corner的(x, y) 、检测出来脸的大小(width, height) 。\u003c/p\u003e","tags":["人脸检测","OpenCV","Dlib","计算机视觉","转载"],"title":"「转」「译」Face Detection – OpenCV, Dlib and Deep Learning ( C++ / Python )"},{"categories":["生活"],"content":"前言\n在我电的图书馆的还书柜子里面偶然所得，一本叫《希腊罗马神话对英语语言文化的影响》吕海平 著 江苏大学初版社，然后莫名的想研究一下，发现挺不错的。\n古希腊罗马的神的关系还是比较乱的，尤其是jupiter 或者zeus的奥林匹斯神系。从上古的神系，总共有三代。\n网上有个人（Korwin Briggs）做的关系图很不错。\nTODO:后面我也会对其进行整理，以后给大家分享。\n","permalink":"/post/c0-life/readings/gods_stories/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e在我电的图书馆的还书柜子里面偶然所得，一本叫《希腊罗马神话对英语语言文化的影响》吕海平 著 江苏大学初版社，然后莫名的想研究一下，发现挺不错的。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e古希腊罗马的神的关系还是比较乱的，尤其是jupiter 或者zeus的奥林匹斯神系。从上古的神系，总共有三代。\u003c/p\u003e\n\u003cp\u003e网上有个人（\u003ca href=\"http://www.veritablehokum.com/\"\u003eKorwin Briggs\u003c/a\u003e）做的关系图很不错。\u003c/p\u003e\n\u003cp\u003eTODO:后面我也会对其进行整理，以后给大家分享。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"http://www.veritablehokum.com/wp-content/uploads/2018/08/Roman-God-Family-Tree.jpg\" \n     alt=\"\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e","tags":["希腊罗马神话","语言文化"],"title":"希腊罗马神话"},{"categories":["人工智能"],"content":" 转载 原创： AI学习与实践平台 TODO: 看完里面的文章，对每篇文章做个总结，实验+文章。\n1. 导言 怎样成为一名优秀的算法工程师？这是很多从事人工智能学术研究和产品研发的同学都关心的一个问题。面对市场对人才的大量需求与供给的严重不足，以及高薪水的诱惑，越来越多的人开始学习这个方向的技术，或者打算向人工智能转型。市面上各种鱼龙混杂的培训班以及误导人的文章会把很多初学者带入歧途，浮躁的跟风将会让你最后收获甚微，根本达不到企业的用人要求。为了更好的帮助大家学习和成长，少走弯路，在今天的文章里，SIGAI 的作者以自己的亲身经历和思考，为大家写下对这一问题的理解与答案。\n首先来看一个高度相关的问题：一个优秀的算法工程师必须具备哪些素质？我们给出的答案是这样的：\n数学知识 编程能力 机器学习与深度学习的知识 应用方向的知识 对自己所做的问题的思考和经验 除去教育背景，逻辑思维，学习能力，沟通能力等其他方面的因素，大多数公司在考察算法工程师的技术水平时都会考虑上面这几个因素。接下来我们将按照这几个方面进行展开，详细的说明如何学习这些方面的知识以及积累经验。\n2. 数学知识 与其他工作方向如app、服务器开发相比，以及与计算机科学的其他方向如网络，数据库，分布式计算等相比，人工智能尤其是机器学习属于数学知识密集的方向。在各种书籍，论文，算法中都充斥着大量的数学公式，这让很多打算入门的人或者开始学习的人感到明显的压力。首先我们考虑一个最核心的问题：机器学习和深度学习究竟需要哪些数学知识？在SIGAI之前的公众号文章“学好机器学习需要哪些数学知识”里，我们已经给出了答案。先看下面这张表：\n更多算法工程师的必读文章，请关注SIGAICN公众号\n上面的表给出了各种典型的机器学习算法所用到的数学知识点。我们之前已经总结过，理解绝大多数算法和理论，有微积分/高等数学，线性代数，概率论，最优化方法的知识就够了。除流形学习需要简单的微分几何概念之外，深层次的数学知识如实变函数，泛函分析等主要用在一些基础理论结果的证明上，即使不能看懂证明过程，也不影响我们使用具体的机器学习算法。概率图模型、流形学习中基于图的模型会用到图论的一些基本知识，如果学习过离散数学或者数据结构，这些概念很容易理解。除此之外，某些算法会用到离散数学中的树的概念，但很容易理解。\n2.1 高等数学 如果你已经学过这些大学数学课，只要把所需的知识点复习一遍就够了。对于微积分，通俗易懂而又被广为采用的是同济版的高等数学：\n在机器学习中主要用到了微分部分，积分用的非常少。具体的，用到了下面的概念：\n导数和偏导数的定义与计算方法，与函数性质的关系 梯度向量的定义 极值定理，可导函数在极值点处导数或梯度必须为0 雅克比矩阵，这是向量到向量映射函数的偏导数构成的矩阵，在求导推导中会用到 Hessian矩阵，这是2阶导数对多元函数的推广，与函数的极值有密切的联系 凸函数的定义与判断方法 泰勒展开公式 拉格朗日乘数法，用于求解带等式约束的极值问题 其中最核心的是多元函数的泰勒展开公式，根据它我们可以推导出梯度下降法，牛顿法，拟牛顿法等一系列最优化方法。\n如果你想要深入的学习微积分，可以阅读数学系的教程，称为数学分析：\n与工科的高等数学偏重计算不同，它里面有大量的理论证明，对于锻炼数学思维非常有帮助。北大张筑生先生所著的数学分析可谓是国内这方面教材的精品。\n2.2 线性代数 下面来看线性代数，同样是同济版的教材：\n如果想更全面系统的学习线性代数，可以看这本书：\n相比之下，线性代数用的更多。具体用到的知识点有：\n向量和它的各种运算，包括加法，减法，数乘，转置，内积 向量和矩阵的范数，L1范数和L2范数 矩阵和它的各种运算，包括加法，减法，乘法，数乘 逆矩阵的定义与性质 行列式的定义与计算方法 二次型的定义 矩阵的正定性 特征值与特征向量 奇异值分解 线性方程组的数值解 机器学习算法处理的数据一般都是向量、矩阵或者张量。经典的机器学习算法输入的数据都是特征向量，深度学习算法在处理图像时输入的2维的矩阵或者3维的张量。掌握这些概念是你理解机器学习和深度学习算法的基础。\n2.3 概率论 概率论国内理工科专业使用最多的是浙大版的教材：\n如果把机器学习所处理的样本数据看作随机变量/向量，就可以用概率论的方法对问题进行建模，这代表了机器学习中很大一类方法。在机器学习里用到的概率论知识点有:\n随机事件的概念，概率的定义与计算方法 随机变量与概率分布，尤其是连续型随机变量的概率密度函数和分布函数 条件概率与贝叶斯公式 常用的概率分布，包括正态分布，伯努利二项分布，均匀分布 随机变量的均值与方差，协方差 随机变量的独立性 最大似然估计 这些知识不超出普通理工科概率论教材的范围。\n最优化 最后来说最优化，几乎所有机器学习算法归根到底都是在求解最优化问题。求解最优化问题的指导思想是在极值点出函数的导数/梯度必须为0。因此你必须理解梯度下降法，牛顿法这两种常用的算法，它们的迭代公式都可以从泰勒展开公式而得到。\n凸优化是机器学习中经常会提及的一个概念，这是一类特殊的优化问题，它的优化变量的可行域是凸集，目标函数是凸函数。凸优化最好的性质是它的所有局部最优解就是全局最优解，因此求解时不会陷入局部最优解。如果一个问题被证明为是凸优化问题，基本上已经宣告此问题得到了解决。在机器学习中，线性回归、岭回归、支持向量机、logistic回归等很多算法求解的都是凸优化问题。\n拉格朗日对偶为带等式和不等式约束条件的优化问题构造拉格朗日函数，将其变为原问题，这两个问题是等价的。通过这一步变换，将带约束条件的问题转换成不带约束条件的问题。通过变换原始优化变量和拉格朗日乘子的优化次序，进一步将原问题转换为对偶问题，如果满足某种条件，原问题和对偶问题是等价的。这种方法的意义在于可以将一个不易于求解的问题转换成更容易求解的问题。在支持向量机中有拉格朗日对偶的应用。\nKKT条件是拉格朗日乘数法对带不等式约束问题的推广，它给出了带等式和不等式约束的优化问题在极值点处所必须满足的条件。在支持向量机中也有它的应用。\n如果你没有学过最优化方法这门课也不用担心，这些方法根据微积分和线性代数的基础知识可以很容易推导出来。如果需要系统的学习这方面的知识，可以阅读《凸优化》，《非线性规划》两本经典教材。\n3. 编程能力 编程能力是学好机器学习和深度学习的又一大基础。对于计算机类专业的学生，由于本科已经学了c语言，c++，数据结构与算法，因此这方面一般不存在问题。对于非计算机专业的人来说，要真正学好机器学习和深度学习，这些知识是绕不开的。\n3.1 C++ 虽然现在大家热衷于学习python，但要作为一名真正的算法工程师，还是应该好好学习一下c++，至少，机器学习和深度学习的很多底层开源库都是用它写的；很多公司线上的产品，无论是运行在服务器端，还是嵌入式端，都是用c++写的。此外，如果你是应届生，在校园招聘时不少公司都会面试你c++的知识。\nC++最经典的教材无疑是c++ primer：\n对做算法的人来说，这本书其实不用全部看，把常用的点学完就够了。对于进阶，Effective c++是很好的选择，不少公司的面试题就直接出自这本书的知识点：\n接下来说python，相比c++来说，学习的门槛要低很多，找一本通俗易懂的入门教程学习一遍即可。\n3.2 数据结构和算法 数据结构和算法是编写很多程序的基础，对于机器学习和深度学习程序也不例外。很多算法的实现都依赖于数组，链表，数，排序，查找之类的数据结构和基础算法。如果有时间和精力，把算法导论啃一遍，你会有不一样的感受：\n对于应届生来说，学完它对于你通过大互联网和人工智能公司校园招聘的技术面试也非常有用。\n上面说的只是编程语言的程序设计的理论知识，我们还要考虑实际动手能力。对于开发环境如gcc/g++，visual studio之类的工具，以及gdb之类的调试工具需要做到熟练使用。如果是在linux上开发，对linux的常用命令也要熟记于心。这方面的知识看各种具体的知识点和教程即可。另外，对于编程的一些常识，如进程，线程，虚拟内存，文件系统等，你最好也要进行了解。\n4. 机器学习与深度学习的知识 在说完了数学和编程基础之后，下面我来看核心的内容，机器学习和深度学习知识。机器学习是现阶段解决很多人工智能问题的核心方法，尤其是深度学习，因此它们是算法工程师的核心知识。在这里有一个问题：是否需要先学机器学习，还是直接学深度学习？如果是一个专业的算法工程师，我的建议是先学机器学习。至少，你要知道机器学习中的基本概念， 过拟合，生成模型，ROC曲线等，上来就看深度学习，如没有背景知识你将不知所云。另外，神经网络只是机器学习中的一类方法，对于很多问题，其他机器学习算法如logistic回归，随机森林，GBDT，决策树等还在被大规模使用，因此你不要把自己局限在神经网络的小圈子里。\n4.1 ML和DP的教材 首先来看机器学习，这方面的教材很多，周志华老师的机器学习，李航老师的统计学习方法是国内的经典。这里我们介绍国外的经典教材，首先是PRML：\nPRML 下载地址 link\n此书深厚，内容全面，涵盖了有监督学习，无监督学习的主要方法，理论推导和证明详细深入，是机器学习的经典。此外还有模式分类这本书，在这里不详细介绍。\n本书主要内容包括： 第一章：简介 概率论、模型选择、决策理论、信息理论\n第二章：概率分布 二元变量、多项变量、高斯分布、指数分布族、非参数方法\n第三章：线性模型回归问题 线性基函数模型、偏置方差分解、贝叶斯线性回归、贝叶斯模型比较、The Evidence Approximation、固定基函数的局限性\n第四章：线性模型分类问题 判别函数、概率生成模型、概率判别模型、拉普拉斯逼近、贝叶斯逻辑回归\n第五章：神经网络 前馈神经网络、网络训练、误差反向传播、Hessian矩阵、神经网络的正则化、混合密度网络、贝叶斯神经网络\n第六章：Kernel方法 对偶表示、构造核、径向基函数网络、高斯过程\n第七章：Sparse Kernel Machines 最大边缘分类器、相关向量机\n第八章：图模型 贝叶斯网络、条件独立性、马尔科夫随机场、图模型的推理\n第九章：混合模型和EM K-means聚类、高斯混合、EM算法\n第十章：近似推断 变分推断、高斯的变分混合、变分线性回归、指数族分布、局部变分方法、变分logistic回归、Expectation Propagation\n第十一章：采样方法 基本采样算法、马尔科夫链蒙特卡洛、吉布斯采样、切片采样、混合蒙特卡洛算法、估计划分函数\n第十二章：连续潜在变数 主成分分析，Probabilistic PCA，Kernel PCA，非线性潜变量模型\n第十三章：序列数据 马尔可夫模型，隐马尔可夫模型，Linear Dynamical Systems\n第十四章：混合模型 贝叶斯模型平均法，Committees，Boosting，基于树的模型，条件混合模型\n深度学习目前最权威的教程是下面这本书：\n它涵盖了深度学习的方方面面，从理论到工程，但美中不足的是对应于介绍的相对较少。\n强化学习是机器学习很独特的一个分支，大多数人对它不太了解，这方面的教程非常少，我们推荐下面这本书：\n美中不足的是这本书对深度强化学习没有介绍，因为出版的较早。不知最新的版本有没有加上这方面的内容。\n在这里需要强调的是，你的知识要系统化，有整体感。很多同学都感觉到自己学的机器学习太零散，缺乏整体感。这需要你多思考算法之间的关系，演化历史之类的问题，这样你就做到胸中有图-机器学习算法地图。其实，SIGAI在之前的公众号文章“机器学习算法地图”里已经给你总结出来了。\n4.2 开源库 上面介绍了机器学习和深度学习的理论教材，下面来说实践问题。我们无需重复造车轮子，熟练的使用主流的开源库是需要掌握的一项技能。对于经典的机器学习，常用的库的有:\nlibsvm liblinear XGBoost OpenCV HTK Weka 在这里我们不一一列举。借助于这些库，我们可以方便的完成自己的实验，或是研发自己的产品。对于深度学习，目前常用的有：\nCaffe TensorFlow MXNet 除此之外，还有其他的。对于你要用到的开源库，一定要理解它的原理，以及使用中的一些细节问题。例如很多算法要求输入的数据先做归一化，否则效果会非常差，而且面临浮点数溢出的问题，这些实际经验需要你在使用中摸索。如果有精力把这些库的核心代码分析一遍，你对实现机器学习算法将会更有底气。以深度学习为例，最核心的代码无非是实现：\n各种层，包括它们的正向传播和反向传播 激活函数的实现 损失函数的实现 输入数据的处理 求解器，实现各种梯度下降法 这些代码的量并不大，沉下心来，我相信一周之内肯定能分析完。看完之后你会有一种豁然开朗的感觉。\n5. 应用方向的知识 接下来是各个方向的知识，与机器学习有关的应用方向当前主要有：\n机器视觉 语音识别 自然语言处理 数据挖掘 知识图谱 推荐系统 除此之外，还有其他一些特定小方向，在这里不一一列举。这些具体的应用方向一般都有自己的教材，如果你以后要从事此方向的研究，系统的学习一遍是必须的。\n6. 实践经验与思考 在说完理论与实践知识之后，最后我们来说经验与思考。在你确定要做某一个方向之后，对这个方向的方法要有一个全面系统的认识，很多方法是一脉相承的，如果只追求时髦看最新的算法，你很难做出学术上的创新，以及工程上的优化。对于本问题所有的经典论文，都应该化时间细度，清楚的理解它们解决了什么问题，是怎么解决的，还有哪些问题没有解决。例如：\n机器视觉目标检测中的遮挡问题 推荐系统中的冷启动问题 自然语言处理中文分词中的歧义切分问题 只有经过大量的编程和实验训练，以及持续的思考，你才能算得上对这个方向深刻理解，以至于有自己的理解。很多同学对自己实现轮上的算法没有底气，解决这个问题最快的途径就是看论文算法的开源代码，在github上有丰富的资源，选择一些合适的，研究一下别人是怎么实现的，你就能明白怎么实现自己的网络结构和损失函数，照葫芦画瓢即可。\n计算机以及人工智能是一个偏实践的学科，它的方法和理论既需要我们有扎实的理论功底，又需要有丰富的实践能力与经验。这两个方面构成了算法工程师最主要的素质。科学的学习路径能够让你取得好的学习效果，同时也缩短学习时间。错误和浮躁的做法则会让你最后事倍功半。这是 SIGAI 对想进入这个领域，或者刚进入这个领域的每个人要说的！\n7. 其他材料 7.1 科普类 【‍获取码】SIGAI0413 ​ 机器学习——波澜壮阔四十年 【获取码】SIGAI0620 ​ 理解计算：从√2到AlphaGo ——第1季 从√2谈起\n【获取码】SIGAI0704 理解计算：从√2到AlphaGo ——第2季 神经计算的历史背景\n7.2 数学类 【获取码】SIGAI0417 学好机器学习需要哪些数学知识\n【获取码】SIGAI0511 理解梯度下降法\n【获取码】SIGAI0518 理解凸优化\n【获取码】SIGAI0531 理解牛顿法 7.3 机器学习类 【获取码】SIGAI0428 ​ 用一张图理解SVM的脉络\n【获取码】SIGAI0505 ​ 理解神经网络的激活函数\n【获取码】SIGAI0522 【实验】理解SVM核函数和参数的作用\n【获取码】SIGAI0601 【群话题精华】五月集锦—机器学习和深度学习中一些值得思考的问题 【获取码】SIGAI0602 ​ 大话AdaBoost算法 【获取码】SIGAI0606 ​ 理解主成分分析（PCA） 【获取码】SIGAI0611 ​ 理解决策树 【获取码】SIGAI0613 ​ 用一句话总结常用的机器学习算法\n【获取码】SIGAI0618 ​ 理解过拟合\n【获取码】SIGAI0627 ​ k近邻算法\n【获取码】SIGAI0704 ​ 机器学习算法地图\n【获取码】SIGAI0706 ​ 反向传播算法推导—全连接神经网络\n7.4 深度学习类 【获取码】SIGAI0426 卷积神经网络为什么能够称霸计算机视觉领域？\n【获取码】SIGAI0508 深度卷积神经网络演化历史及结构改进脉络-40页长文全面解读 【获取码】SIGAI0515 循环神经网络综述—语音识别与自然语言处理的利器\n【获取码】SIGAI0625 卷积神经网络的压缩与加速\n【获取码】SIGAI0709 生成式对抗网络模型综述\n7.5 机器视觉类 【获取码】SIGAI0420 ​ 人脸识别算法演化史\n【获取码】SIGAI0424 ​ 基于深度学习的目标检测算法综述\n【获取码】SIGAI0503 ​ 人脸检测算法综述\n【获取码】SIGAI0525 【SIGAI综述】行人检测算法 【获取码】SIGAI0604 ​ FlowNet到FlowNet2.0：基于卷积神经网络的光流预测算法 【获取码】SIGAI0608 ​ 人体骨骼关键点检测综述 【获取码】SIGAI0615 ​ 目标检测算法之YOLO\n【获取码】SIGAI0622 ​ 场景文本检测——CTPN算法介绍\n【获取码】SIGAI0629 ​ 自然场景文本检测识别技术综述\n","permalink":"/post/c3-ai/how-algorithm-engineer/","summary":"\u003cblockquote\u003e\n\u003cp\u003e转载 原创： AI学习与实践平台\nTODO: 看完里面的文章，对每篇文章做个总结，实验+文章。\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"1-导言\"\u003e1. 导言\u003c/h2\u003e\n\u003cp\u003e怎样成为一名优秀的算法工程师？这是很多从事人工智能学术研究和产品研发的同学都关心的一个问题。面对市场对人才的大量需求与供给的严重不足，以及高薪水的诱惑，越来越多的人开始学习这个方向的技术，或者打算向人工智能转型。市面上各种鱼龙混杂的培训班以及误导人的文章会把很多初学者带入歧途，浮躁的跟风将会让你最后收获甚微，根本达不到企业的用人要求。为了更好的帮助大家学习和成长，少走弯路，在今天的文章里，\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzU4MjQ3MDkwNA==\u0026amp;mid=2247485551\u0026amp;idx=2\u0026amp;sn=a6689528f10aedab3fce91857eec877b\u0026amp;chksm=fdb695f8cac11cee025ad6d8d77ed90f7169142d6b20b2f5a6945b58edd97c27225f4a2eba91\u0026amp;scene=21#wechat_redirect\"\u003eSIGAI\u003c/a\u003e 的作者以自己的亲身经历和思考，为大家写下对这一问题的理解与答案。\u003c/p\u003e\n\u003cp\u003e首先来看一个高度相关的问题：一个优秀的算法工程师必须具备哪些素质？我们给出的答案是这样的：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e数学知识\u003c/li\u003e\n\u003cli\u003e编程能力\u003c/li\u003e\n\u003cli\u003e机器学习与深度学习的知识\u003c/li\u003e\n\u003cli\u003e应用方向的知识\u003c/li\u003e\n\u003cli\u003e对自己所做的问题的思考和经验\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e除去教育背景，逻辑思维，学习能力，沟通能力等其他方面的因素，大多数公司在考察算法工程师的技术水平时都会考虑上面这几个因素。接下来我们将按照这几个方面进行展开，详细的说明如何学习这些方面的知识以及积累经验。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"2-数学知识\"\u003e2. 数学知识\u003c/h2\u003e\n\u003cp\u003e与其他工作方向如app、服务器开发相比，以及与计算机科学的其他方向如网络，数据库，分布式计算等相比，人工智能尤其是机器学习属于数学知识密集的方向。在各种书籍，论文，算法中都充斥着大量的数学公式，这让很多打算入门的人或者开始学习的人感到明显的压力。首先我们考虑一个最核心的问题：机器学习和深度学习究竟需要哪些数学知识？在\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzU4MjQ3MDkwNA==\u0026amp;mid=2247485551\u0026amp;idx=2\u0026amp;sn=a6689528f10aedab3fce91857eec877b\u0026amp;chksm=fdb695f8cac11cee025ad6d8d77ed90f7169142d6b20b2f5a6945b58edd97c27225f4a2eba91\u0026amp;scene=21#wechat_redirect\"\u003eSIGAI\u003c/a\u003e之前的公众号文章“\u003ca href=\"http://mp.weixin.qq.com/s?__biz=MzU4MjQ3MDkwNA==\u0026amp;mid=2247483713\u0026amp;idx=1\u0026amp;sn=1e7c81381d16806ac73e15691fe17aec\u0026amp;chksm=fdb69cd6cac115c05f1f90b0407e3f8ae9be8719e454f908074ac0d079885b5c134e2d60fd64\u0026amp;scene=21#wechat_redirect\"\u003e学好机器学习需要哪些数学知识\u003c/a\u003e”里，我们已经给出了答案。先看下面这张表：\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"clip_image003.gif\" \n     alt=\"EB5E93E91C3643F991C93D61F363373E.jpeg\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e更多算法工程师的必读文章，请关注SIGAICN公众号\u003c/p\u003e\n\u003cp\u003e上面的表给出了各种典型的机器学习算法所用到的数学知识点。我们之前已经总结过，理解绝大多数算法和理论，有微积分/高等数学，线性代数，概率论，最优化方法的知识就够了。除流形学习需要简单的微分几何概念之外，深层次的数学知识如实变函数，泛函分析等主要用在一些基础理论结果的证明上，即使不能看懂证明过程，也不影响我们使用具体的机器学习算法。概率图模型、流形学习中基于图的模型会用到图论的一些基本知识，如果学习过离散数学或者数据结构，这些概念很容易理解。除此之外，某些算法会用到离散数学中的树的概念，但很容易理解。\u003c/p\u003e\n\u003ch3 id=\"21-高等数学\"\u003e2.1 高等数学\u003c/h3\u003e\n\u003cp\u003e如果你已经学过这些大学数学课，只要把所需的知识点复习一遍就够了。对于微积分，通俗易懂而又被广为采用的是同济版的高等数学：\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"clip_image005.gif\" \n     alt=\"88F2EB8BDFE1448EBD2DF61848E355FD.jpeg\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e在机器学习中主要用到了微分部分，积分用的非常少。具体的，用到了下面的概念：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e导数和偏导数的定义与计算方法，与函数性质的关系\u003c/li\u003e\n\u003cli\u003e梯度向量的定义\u003c/li\u003e\n\u003cli\u003e极值定理，可导函数在极值点处导数或梯度必须为0\u003c/li\u003e\n\u003cli\u003e雅克比矩阵，这是向量到向量映射函数的偏导数构成的矩阵，在求导推导中会用到\u003c/li\u003e\n\u003cli\u003eHessian矩阵，这是2阶导数对多元函数的推广，与函数的极值有密切的联系\u003c/li\u003e\n\u003cli\u003e凸函数的定义与判断方法\u003c/li\u003e\n\u003cli\u003e泰勒展开公式\u003c/li\u003e\n\u003cli\u003e拉格朗日乘数法，用于求解带等式约束的极值问题\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e其中最核心的是多元函数的泰勒展开公式，根据它我们可以推导出梯度下降法，牛顿法，拟牛顿法等一系列最优化方法。\u003c/p\u003e\n\u003cp\u003e如果你想要深入的学习微积分，可以阅读数学系的教程，称为数学分析：\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"clip_image007.gif\" \n     alt=\"DEB5F0D2FC584E0B96B263FE1D559AFF.jpeg\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e与工科的高等数学偏重计算不同，它里面有大量的理论证明，对于锻炼数学思维非常有帮助。北大张筑生先生所著的数学分析可谓是国内这方面教材的精品。\u003c/p\u003e\n\u003ch3 id=\"22-线性代数\"\u003e2.2 线性代数\u003c/h3\u003e\n\u003cp\u003e下面来看线性代数，同样是同济版的教材：\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"clip_image009.gif\" \n     alt=\"48D5E515A7144CE6A9CB78162F6ECAAF.jpeg\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e如果想更全面系统的学习线性代数，可以看这本书：\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"clip_image011.gif\" \n     alt=\"BF71AB68DB2B4D71AC8D2B3263C197E5.jpeg\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003e相比之下，线性代数用的更多。具体用到的知识点有：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e向量和它的各种运算，包括加法，减法，数乘，转置，内积\u003c/li\u003e\n\u003cli\u003e向量和矩阵的范数，L1范数和L2范数\u003c/li\u003e\n\u003cli\u003e矩阵和它的各种运算，包括加法，减法，乘法，数乘\u003c/li\u003e\n\u003cli\u003e逆矩阵的定义与性质\u003c/li\u003e\n\u003cli\u003e行列式的定义与计算方法\u003c/li\u003e\n\u003cli\u003e二次型的定义\u003c/li\u003e\n\u003cli\u003e矩阵的正定性\u003c/li\u003e\n\u003cli\u003e特征值与特征向量\u003c/li\u003e\n\u003cli\u003e奇异值分解\u003c/li\u003e\n\u003cli\u003e线性方程组的数值解\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e机器学习算法处理的数据一般都是向量、矩阵或者张量。经典的机器学习算法输入的数据都是特征向量，深度学习算法在处理图像时输入的2维的矩阵或者3维的张量。掌握这些概念是你理解机器学习和深度学习算法的基础。\u003c/p\u003e\n\u003ch3 id=\"23-概率论\"\u003e2.3 概率论\u003c/h3\u003e\n\u003cp\u003e概率论国内理工科专业使用最多的是浙大版的教材：\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"clip_image013.gif\" \n     alt=\"91E918CF7ED84C7488BDDFFC7594E0D4.jpeg\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e","tags":["算法","转载","学习路径"],"title":"「转」怎样成为一名优秀的算法工程师"},{"categories":["linux"],"content":"前言 最近要下载一个在youtube上的数据库，用来训练神经网络。走国内通道下载比较慢。于是，我使用了vps代理方式下载，速度取决于你的机器连接vps的网速。本文的主要内容有，实现shadowsocks 代理 ，tsocks 代理工具使用，可组合使用的一些下载工具如wget 和axel等。\n# 举个栗子 $ tsocks wget -c https://www.dropbox.com/s/minpyv59crdifk9/datasets.zip 嗯嗯，这个速度还不错！\n声明：本文以科学研究为目的，请勿滥用。\n1 Shadowsocks Shadowsocks是一个轻量级socks5代理工具。在linux平台，我们可使用 python 提供的包管理工具 pip 安装 Shadowsocks ，如下。\n# pip 安装 Shadowsocks $ pip install shadowsocks # 或者 $ pip install git+https://github.com/shadowsocks/shadowsocks.git@master pip安装完之后，可能要重启终端，我们就有ssserver和sslocal小工具了。下面配置server或者client。一般，server配置在国外的vps上，client配置在本地国内机器上。\nPS：其他平台安装 参考 shadowsocks官方 install\n1.1 配置 Shadowsocks server 按下面的三步走，即可。\n通过ssh连接到（Virtual Private Server）vps上，或者本地打开终端。\n新建一个server_shadowsocks.json文件，内容如下：\n{ \u0026#34;server\u0026#34;:\u0026#34;0.0.0.0\u0026#34;, \u0026#34;server_port\u0026#34;:443, \u0026#34;local_address\u0026#34;: \u0026#34;127.0.0.1\u0026#34;, \u0026#34;local_port\u0026#34;:1080, \u0026#34;password\u0026#34;:\u0026#34;密码\u0026#34;, \u0026#34;timeout\u0026#34;:300, \u0026#34;method\u0026#34;:\u0026#34;aes-256-cfb\u0026#34;, \u0026#34;fast_open\u0026#34;: false } 执行ssserver -c server_shadowsocks.json 说一点: 由于我们的下载任务是临时的，开个screen（终端复用工具）放在后台。当然你也可以设置为开机自启动，这里不再赘述。\n1.2 配置 Shadowsocks client 通过ssh连接到机器上，或者本地打开终端。\n新建文件 client_shadowsocks.json\n{ \u0026#34;server\u0026#34;:\u0026#34;服务器ip或域名\u0026#34;, \u0026#34;server_port\u0026#34;:443, \u0026#34;local_address\u0026#34;:\u0026#34;127.0.0.1\u0026#34;, \u0026#34;local_port\u0026#34;:1280, \u0026#34;password\u0026#34;:\u0026#34;密码\u0026#34;, \u0026#34;timeout\u0026#34;:300, \u0026#34;method\u0026#34;:\u0026#34;aes-256-cfb\u0026#34;, \u0026#34;fast_open\u0026#34;:false, \u0026#34;workers\u0026#34;:1 } 执行sslocal -c client_shadowsocks.json。 说一点：推荐使用screen方式放在后台。当然也可以使用-d 参数放在后台运行。 sslocal -c client_shadowsocks.json -d start\n2 tsocks 有些linux工具可能没有proxy的代理功能，或者不支持sock5代理，而用tsocks可以很好的解决这些问题。tsocks 是个终端代理工具，可以直接连接shadowsocks提供socks 5代理端口，有点类似于proxychains。\n下面简单介绍下安装与使用：\n安装tsocks linux安装tsocks 命令：apt install tsocks mac 安装参考 homebrew-tsocks 开启上面Shadowsocks的client放在后台。 修改tsocks 配置文件，在 /etc/tsocks.conf 文件的最后添加： local = 192.168.1.0/255.255.255.0 server = 127.0.0.1 server_type = 5 server_port = 1080 3 Demo：代理使用 3.1 使用 tsocks 在所需代理的命令前加个tsocks就行，如： tsocks wget -c xxxx,tsocks axel -n 10 -av xxxx,tsocks curl xxx\n3.2 使用 youtube-dl youtube-dl是批量下载youtube视频的好工具。youtube-dl 可以指定 proxy，可以不使用tsocks。\n安装youtube-dl pip install --upgrade youtube-dl 使用举个例子\n下载youtube视频 URL=https://www.youtube.com/playlist?list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax ./youtube-dl --proxy socks5://127.0.0.1:1280 ${URL} # 在 client_shadowsocks.json 的 local_port 设置为1280，这儿也为1280 下载里面的mp3 youtube-dl -x --audio-format mp3 https://www.youtube.com/watch?v=xpVfcZ0ZcFM youtube-dl 中待解决的问题？ 想只下载一个视频中的一部分，不用下载整个视频，太费vps流量了。暂未找到解决办法，我找到的一个跟问题很相似的issue，有朋友会整的，望告诉一下。is it possible to download only desired time interval?\n3.3 使用 axel axel多线程下载。\ntsocks axel -n 3 -a https://www.dropbox.com/s/minpyv59crdifk9/datasets.zip -n 3 : 3个线程下载 -a : 有个进度条 其他方式：下载脚本 axel-bash.sh\n#!/bin/sh -e # usage: ./axel-batch.sh the-download-url.list cat $1 | while read LINE do if [ -n \u0026#34;$LINE\u0026#34; ]; then axel -n 3 -a `echo $LINE` fi done ","permalink":"/post/c5-linux/linux/linux-proxy/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e最近要下载一个在youtube上的数据库，用来训练神经网络。走国内通道下载比较慢。于是，我使用了vps代理方式下载，速度取决于你的机器连接vps的网速。本文的主要内容有，实现shadowsocks 代理 ，tsocks 代理工具使用，可组合使用的一些下载工具如wget 和axel等。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 举个栗子\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ tsocks wget -c https://www.dropbox.com/s/minpyv59crdifk9/datasets.zip\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e嗯嗯，这个速度还不错！\u003c/p\u003e\n\u003ccenter\u003e\u003cimg src=\"linux_proxy/1565246896718.png\" width=\"60%\"\u003e\n\u003c/center\u003e\n\u003cp\u003e\u003cstrong\u003e声明\u003c/strong\u003e：本文以科学研究为目的，请勿滥用。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"1-shadowsocks\"\u003e1 Shadowsocks\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eShadowsocks\u003c/strong\u003e是一个轻量级socks5代理工具。在linux平台，我们可使用 python 提供的包管理工具 pip \u003cstrong\u003e安装 Shadowsocks\u003c/strong\u003e ，如下。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# pip 安装 Shadowsocks\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ pip install shadowsocks\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 或者\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ pip install git+https://github.com/shadowsocks/shadowsocks.git@master\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003epip安装完之后，可能要重启终端，我们就有ssserver和sslocal小工具了。下面配置server或者client。一般，server配置在国外的vps上，client配置在本地国内机器上。\u003c/p\u003e\n\u003cp\u003ePS：其他平台安装 参考 shadowsocks官方 \u003ca href=\"https://github.com/shadowsocks/shadowsocks/tree/master#install\"\u003einstall\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"11-配置-shadowsocks-server\"\u003e1.1 配置 Shadowsocks server\u003c/h3\u003e\n\u003cp\u003e按下面的三步走，即可。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e通过ssh连接到（Virtual Private Server）vps上，或者本地打开终端。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e新建一个\u003cstrong\u003eserver_shadowsocks.json\u003c/strong\u003e文件，内容如下：\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;server\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0.0.0.0\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;server_port\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e443\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;local_address\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;127.0.0.1\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;local_port\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e1080\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;password\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;密码\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;timeout\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e300\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;method\u0026#34;\u003c/span\u003e:\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;aes-256-cfb\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;fast_open\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e执行\u003ccode\u003essserver -c server_shadowsocks.json\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e说一点: 由于我们的下载任务是临时的，开个screen（终端复用工具）放在后台。当然你也可以设置为开机自启动，这里不再赘述。\u003c/p\u003e","tags":["proxy代理","工具"],"title":"linux代理的使用"},{"categories":["linux"],"content":"前言 使用终端有一段时间了，现在主力的平台是Ubuntu16.04，本文对bash、vim、tmux配置的一些记录。\n在cd ~下建立talen_bashrc文件\nHOME_BASHRC=xxxx/talen_bashrc alias vimbashrc=\u0026#39;vim $HOME_BASHRC \u0026amp;\u0026amp; source $HOME_BASHRC\u0026#39; # files alias countfiles=\u0026#39;echo \u0026#34;total num: \u0026#34; \u0026amp;\u0026amp; ls | wc -l \u0026amp;\u0026amp; du -sh\u0026#39; alias ll=\u0026#39;ls -htrlF --time-style=\u0026#34;+%H:%M %Y/%m/%d\u0026#34;\u0026#39; alias dum=\u0026#39;du -a -d 1 -m |sort -nr\u0026#39; alias dug=\u0026#39;df -h /dev/sdbxxx \u0026amp;\u0026amp; du -BG -d 1 --time |sort -nr\u0026#39; alias pi=\u0026#39;pip install -i https://pypi.tuna.tsinghua.edu.cn/simple\u0026#39; alias gpuwatch=\u0026#39;watch -n 1 nvidia-smi\u0026#39; alias gitm=\u0026#39;git commit -m\u0026#39; alias gits=\u0026#39;git status -s\u0026#39; export PYTHONPATH=$PYTHONPATH:xxxxxxx # vimrc export MYVIMRC=xxxx/.vim/.vimrc export VIMINIT=\u0026#34;let \u0026amp;rtp=\u0026#39;xxxx/.vim,\u0026#39; . \u0026amp;rtp so $MYVIMRC\u0026#34; python环境使用的是anaconda（或者minicoonda）添加激活环境。 在~/.bashrc中加入\nalias talen=\u0026#39;source xxx/talen_bashrc \u0026amp;\u0026amp; source activate xxx/envs\u0026#39; alias utalen=\u0026#39;source deactivate\u0026#39; github bashrc\n其他的vimrc配置见我的github项目vimrc\nvimrc\n跳转命令 z z.sh 终端效率提升：自动路径切换 https://zhuanlan.zhihu.com/p/50548459\n","permalink":"/post/c5-linux/linux/bash-bashrc/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e使用终端有一段时间了，现在主力的平台是Ubuntu16.04，本文对bash、vim、tmux配置的一些记录。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e在\u003ccode\u003ecd ~\u003c/code\u003e下建立talen_bashrc文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e HOME_BASHRC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003exxxx/talen_bashrc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias vimbashrc\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;vim $HOME_BASHRC \u0026amp;\u0026amp; source $HOME_BASHRC\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# files\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias countfiles\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;echo \u0026#34;total num: \u0026#34; \u0026amp;\u0026amp; ls | wc -l \u0026amp;\u0026amp; du -sh\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias ll\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ls -htrlF --time-style=\u0026#34;+%H:%M %Y/%m/%d\u0026#34;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias dum\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;du -a -d 1 -m |sort -nr\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias dug\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;df -h /dev/sdbxxx \u0026amp;\u0026amp; du -BG -d 1 --time |sort -nr\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias pi\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;pip install -i https://pypi.tuna.tsinghua.edu.cn/simple\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias gpuwatch\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;watch -n 1 nvidia-smi\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias gitm\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;git commit -m\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e alias gits\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;git status -s\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e export PYTHONPATH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e$PYTHONPATH:xxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# vimrc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e export MYVIMRC\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003exxxx/.vim/.vimrc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e export VIMINIT\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;let \u0026amp;rtp=\u0026#39;xxxx/.vim,\u0026#39; . \u0026amp;rtp\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e so \u003c/span\u003e$MYVIMRC\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003epython环境使用的是anaconda（或者minicoonda）添加激活环境。\n在\u003ccode\u003e~/.bashrc\u003c/code\u003e中加入\u003c/p\u003e","tags":["bash","vim","tmux"],"title":"终端中bash、vim、tmux等的配置"},{"categories":["linux"],"content":"Why Software Should Not Have Owners 为什么软件不应有主人 作者︰Richard Stallman\n数字资讯科技令大众更容易复制和变更资料。然而不是所有人都希望这样。版权制度容许软件有「主人」。他们主要目的在于从公众夺取软件的潜在利益。他们希望独占这些软件的复制、更改权利。\n版权制度随著印刷技术而发展——印刷是一种大量制作副本的技术。版权很适合这项技术，因为它只限制了大规模的复制。它并没有剥夺图书读者的自由。一般读者没有印刷机，他们只能用笔墨抄写作品，所以很少有读者因此而被控告。\n数字科技比印刷机更灵活：当信息呈数字形式时，你能很容易把它跟别人分享。这种情况不太配合故有的版权制度，所以现在有越来越多日益严厉的措施用来加强软件版权。看看这些软件出版商协会（Software Publishers Association, SPA）的四种惯常说法：\n大肆宣传违反版权法去帮助朋友是错误的。 诱使大家告发违返规定的同事和同僚。 如果警察协助突击搜查公司和学校，那里的人们必须证明自己没有非法复制。 因软件出版商协会提出要求，美国政府起诉一些如麻省理工学院的 David LaMacchia的人，不是因为他非法软复制件，而只是因为破解复制工具，从而不能对用户非法复制进行检查。 这些惯常说法和前苏联曾用过的做法相似，在每一台影印机前都有一个守卫，以防止那些未经许可复印，同时个人只有秘密地复制信息，并像「秘密出版物」一样在手头传播。不同的是，苏联管制信息是政治原因，而美国则是为了经济利益。无论动机如何，我们都受到影响。不管什么原因，任何人企图阻止信息共享，都导致了相同的后果和同样的不便。\n软件所有者用各种理由来控制我们如何使用资讯的权利︰\n中伤 软件所有者使用「盗窃」、「剽窃」这类带有污蔑的词语，或者「知识产权」、「损害」之类专业的术语，向公众暗示他们是合理的——其实，他们是将软件和真实物件混为一谈。 我们对「拿取别人的物件」的概念 ，并不能直接套用在复制这件事，然而软件所有者却迫使我们必须接受他们的想法。\n凭空夸大 软件所有者声称当用户复制他们的程序时，他们受到「伤害」或「经济损失」。但复制并不会对软件所有者造成直接的影响，也没有伤害到任何人。只有在使用复制者不愿意给软件所有者付费时，软件所有者才会受损失。 很明显大多数这样的人不愿意购买这些程序，但是软件所有者会假定所有人都会购买，并以此来计算他们的「损失」。客气点说这就是夸大了专有软件的价值。\n法律 软件所有者经常引用当今的法律和苛刻的刑罚来威胁我们。这暗示现今的法律反映了一个不容置疑的道德观念，同时怂恿我们视这些刑罚为正常及不能推卸。 这些说词面对严谨的思维是站不住脚的，这做法只是打算利用了人的惯性思维。 显然法律是不能决定错对的。美国人都应该知道，五十年代的黑人在许多州份坐在巴士前座是违法的；但只有种族主义者才会说他们是错误的。\n自然权利 软件作者常常声称与自己编写的程序有一种特殊联系，因此他们宣称对这个程序的渴望和兴趣是高于世上任何人。（通常是公司持有软件版权，而不是作者，但是我们预期忽略这个差异。) 对那些打算把「作者高于一切」推崇为一种道德的人，本人作为一个著名的软件开发者，只能说这是废话。 但一般人有两个原因对自然权利的说法产生共鸣。 第一个原因是将软件与现实事物过分地类比。当我做意大利面时，如果其他人也要吃，我一定会反感，因为那样的话，我就吃不上了。他的行为对我造成的损失，正如他得到的利益一样。我们中仅有一人可以吃意大利面，问题是谁来吃？我们两者之间最小的分歧也足以打破道德上的平衡。 问题是︰你会否因为运行或修改一个我写的程序而直接影响到你，而对我只会产生一点间接影响？你是否复制我的软件给你的朋友，而对你们的影响远比对我的还要大？我不应有这样的权利去叫你不要这么做。任何人都不该有。 这第二个原因就是，人们被告知作者的自然权利是社会约定俗成的准则。 历史证明，相反的一方才是正确的。当年起草美国宪法时坚决驳回了关于作者自然权利的提议。这就是为什么宪法只是允许版权体系，而并不强制要求；所以说版权体制一定是临时的。宪法也说明版权体制的目的是促进发展，而不是奖励作者。版权确实给作者和出版社带来了更多收益，但这本来只是一种激励他们的手段而已。 事实是我们的社会建立了削弱公众自然权利的版权制度。然而版权只有用于公益事业才是正当的。\n经济 软件应该有主人的最终辩解理由是，这会提高软件产量。 这个论据至少比以上的更切合主题。它立足于一个合理目标——满足软件用户的需求。以经验看来，人们因为满意的回报而生产更多，是很容易理解的。 但是这个关于经济的论据有瑕疵：它基于这样一个假设，区别仅仅是我们要付多少钱的问题。它假设无论软件是否有其所有者，「软件产品」都是我们想要的。 由于这个假设合乎我们处理真实物件的经验，所以人们很乐意接受。假设你付费与否都能得到一份一样的三明治，这样你付的费用就是唯一的分别。不管你是否购买，三明治有相同的味道和相同的营养，但你只能吃一次。不管你是否从所有者手中得到三明治，它都不能直接影响到你的金钱以外的任何事情。 对任何真实物件，这都是正确的︰不管它是否有主人都不会直接影响它的本质和用途。 如果程序有了主人，这将大大影响它的本质，和你对它的用途。不同之处不仅仅是钱的问题。软件该有主人的体制鼓励软件主人生产，但不一定是社会真正需要的。它导致的道德低落影响我们所有人。 社会需要什么？社会需要对公民真实可用的信息──例如，人们可以解读、修补、使用和改进的程序，而不只是操作。但是软件主人往往会给我们一个不能研究和修改的黑盒子。\n社会也需要自由。当程序有了主人，用户就失去了控制他们部分生活的自由。\n总之社会需要鼓励公民们自主合作的精神。当软件主人告诉我们用这种自然的方式帮助旁人是剽窃行为时，那他们就是玷污我们的人格。\n这正是我们提倡自由软件 事关自由，而并非价格的原因。\n支持所有者的经济论据是错误的，但是经济问题确实存在。一些人出于荣誉、认同和博爱，而编写了有用的软件，但是如果我们希望有更多的软件，就需要筹集资金。\n自由软件开发者自从八十年代尝试过许多寻求财源的方法，稍有小成。我们不需要让任何人致富，典型的收入，足以吸引人做很多比编程少满足感的工作。\n多年以来，我一直靠改进自己编写的自由软件为生，直到获得研究经费。每次改进我都会添加到标準发佈版本，使得大众受益。客户为我付费，这样我就会优先完成他们需求，自己的变成次要。\n一些自由软件开发者通过支援服务赚钱。1994年，Cygnus 有近50个员工，估计有大约百分之十五的员工从事自由软件开发︰对一间软件公司而言，这是个了不起的比例。\n九十年代，Intel、Motorola、Texas Instruments 和 Analog Devices 等公司联合赞助持续发展的GNU C语言编译器。现在大部份开发GCC的人工作还是受薪的开发者完成的。GNU的Ada语言编译器受美国空军赞助，之后成立专属公司延续过个项目。\n自由软件运动的规模还是很小，但是靠听众支持的美国电台的例子说明，不用强迫每个用户付费也可以支撑一个巨大的活动。\n今天如果你发现用了专有软件。如果你的朋友问你复制一份，拒绝是不对的。合作比版权更重要。私下传播也不能建立健康的社会。人应当自豪的向往开放而正直的生活，这就意味著应该对专有软件说「不」。\n你应该能与其他软件使用者开放、自由地合作，能够学习软件如何运作，并教导学生，能够在软件出问题时请中意的程序员修复它。\n欢迎来到自由软件的世界。\n参考 http://www.gnu.org/philosophy/why-free.html\n","permalink":"/post/c5-linux/why-gnu/","summary":"\u003cp\u003e\u003ca href=\"http://www.gnu.org/philosophy/why-free.html\"\u003eWhy Software Should Not Have Owners\u003c/a\u003e\n为什么软件不应有主人\n作者︰\u003ca href=\"https://www.stallman.org/\"\u003eRichard Stallman\u003c/a\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e数字资讯科技令大众更容易复制和变更资料。然而不是所有人都希望这样。版权制度容许软件有「主人」。他们主要目的在于从公众夺取软件的潜在利益。他们希望独占这些软件的复制、更改权利。\u003c/p\u003e\n\u003cp\u003e版权制度随著印刷技术而发展——印刷是一种大量制作副本的技术。版权很适合这项技术，因为它只限制了大规模的复制。它并没有剥夺图书读者的自由。一般读者没有印刷机，他们只能用笔墨抄写作品，所以很少有读者因此而被控告。\u003c/p\u003e\n\u003cp\u003e数字科技比印刷机更灵活：当信息呈数字形式时，你能很容易把它跟别人分享。这种情况不太配合故有的版权制度，所以现在有越来越多日益严厉的措施用来加强软件版权。看看这些软件出版商协会（Software Publishers Association, SPA）的四种惯常说法：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e大肆宣传违反版权法去帮助朋友是错误的。\u003c/li\u003e\n\u003cli\u003e诱使大家告发违返规定的同事和同僚。\u003c/li\u003e\n\u003cli\u003e如果警察协助突击搜查公司和学校，那里的人们必须证明自己没有非法复制。\u003c/li\u003e\n\u003cli\u003e因软件出版商协会提出要求，美国政府起诉一些如麻省理工学院的 David LaMacchia的人，不是因为他非法软复制件，而只是因为破解复制工具，从而不能对用户非法复制进行检查。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这些惯常说法和前苏联曾用过的做法相似，在每一台影印机前都有一个守卫，以防止那些未经许可复印，同时个人只有秘密地复制信息，并像「秘密出版物」一样在手头传播。不同的是，苏联管制信息是政治原因，而美国则是为了经济利益。无论动机如何，我们都受到影响。不管什么原因，任何人企图阻止信息共享，都导致了相同的后果和同样的不便。\u003c/p\u003e\n\u003cp\u003e软件所有者用各种理由来控制我们如何使用资讯的权利︰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e中伤\n软件所有者使用「盗窃」、「剽窃」这类带有污蔑的词语，或者「知识产权」、「损害」之类专业的术语，向公众暗示他们是合理的——其实，他们是将软件和真实物件混为一谈。\n我们对「拿取别人的物件」的概念 ，并不能直接套用在复制这件事，然而软件所有者却迫使我们必须接受他们的想法。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e凭空夸大\n软件所有者声称当用户复制他们的程序时，他们受到「伤害」或「经济损失」。但复制并不会对软件所有者造成直接的影响，也没有伤害到任何人。只有在使用复制者不愿意给软件所有者付费时，软件所有者才会受损失。\n很明显大多数这样的人不愿意购买这些程序，但是软件所有者会假定所有人都会购买，并以此来计算他们的「损失」。客气点说这就是夸大了专有软件的价值。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e法律\n软件所有者经常引用当今的法律和苛刻的刑罚来威胁我们。这暗示现今的法律反映了一个不容置疑的道德观念，同时怂恿我们视这些刑罚为正常及不能推卸。\n这些说词面对严谨的思维是站不住脚的，这做法只是打算利用了人的惯性思维。\n显然法律是不能决定错对的。美国人都应该知道，五十年代的黑人在许多州份坐在巴士前座是违法的；但只有种族主义者才会说他们是错误的。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e自然权利\n软件作者常常声称与自己编写的程序有一种特殊联系，因此他们宣称对这个程序的渴望和兴趣是高于世上任何人。（通常是公司持有软件版权，而不是作者，但是我们预期忽略这个差异。)\n对那些打算把「作者高于一切」推崇为一种道德的人，本人作为一个著名的软件开发者，只能说这是废话。\n但一般人有两个原因对自然权利的说法产生共鸣。\n第一个原因是将软件与现实事物过分地类比。当我做意大利面时，如果其他人也要吃，我一定会反感，因为那样的话，我就吃不上了。他的行为对我造成的损失，正如他得到的利益一样。我们中仅有一人可以吃意大利面，问题是谁来吃？我们两者之间最小的分歧也足以打破道德上的平衡。\n问题是︰你会否因为运行或修改一个我写的程序而直接影响到你，而对我只会产生一点间接影响？你是否复制我的软件给你的朋友，而对你们的影响远比对我的还要大？我不应有这样的权利去叫你不要这么做。任何人都不该有。\n这第二个原因就是，人们被告知作者的自然权利是社会约定俗成的准则。\n历史证明，相反的一方才是正确的。当年起草美国宪法时坚决驳回了关于作者自然权利的提议。这就是为什么宪法只是允许版权体系，而并不强制要求；所以说版权体制一定是临时的。宪法也说明版权体制的目的是促进发展，而不是奖励作者。版权确实给作者和出版社带来了更多收益，但这本来只是一种激励他们的手段而已。\n事实是我们的社会建立了削弱公众自然权利的版权制度。然而版权只有用于公益事业才是正当的。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e经济\n软件应该有主人的最终辩解理由是，这会提高软件产量。\n这个论据至少比以上的更切合主题。它立足于一个合理目标——满足软件用户的需求。以经验看来，人们因为满意的回报而生产更多，是很容易理解的。\n但是这个关于经济的论据有瑕疵：它基于这样一个假设，区别仅仅是我们要付多少钱的问题。它假设无论软件是否有其所有者，「软件产品」都是我们想要的。\n由于这个假设合乎我们处理真实物件的经验，所以人们很乐意接受。假设你付费与否都能得到一份一样的三明治，这样你付的费用就是唯一的分别。不管你是否购买，三明治有相同的味道和相同的营养，但你只能吃一次。不管你是否从所有者手中得到三明治，它都不能直接影响到你的金钱以外的任何事情。\n对任何真实物件，这都是正确的︰不管它是否有主人都不会直接影响它的本质和用途。\n如果程序有了主人，这将大大影响它的本质，和你对它的用途。不同之处不仅仅是钱的问题。软件该有主人的体制鼓励软件主人生产，但不一定是社会真正需要的。它导致的道德低落影响我们所有人。\n社会需要什么？社会需要对公民真实可用的信息──例如，人们可以解读、修补、使用和改进的程序，而不只是操作。但是软件主人往往会给我们一个不能研究和修改的黑盒子。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e社会也需要自由。当程序有了主人，用户就失去了控制他们部分生活的自由。\u003c/p\u003e\n\u003cp\u003e总之社会需要鼓励公民们自主合作的精神。当软件主人告诉我们用这种自然的方式帮助旁人是剽窃行为时，那他们就是玷污我们的人格。\u003c/p\u003e\n\u003cp\u003e这正是我们提倡自由软件 事关自由，而并非价格的原因。\u003c/p\u003e\n\u003cp\u003e支持所有者的经济论据是错误的，但是经济问题确实存在。一些人出于荣誉、认同和博爱，而编写了有用的软件，但是如果我们希望有更多的软件，就需要筹集资金。\u003c/p\u003e\n\u003cp\u003e自由软件开发者自从八十年代尝试过许多寻求财源的方法，稍有小成。我们不需要让任何人致富，典型的收入，足以吸引人做很多比编程少满足感的工作。\u003c/p\u003e\n\u003cp\u003e多年以来，我一直靠改进自己编写的自由软件为生，直到获得研究经费。每次改进我都会添加到标準发佈版本，使得大众受益。客户为我付费，这样我就会优先完成他们需求，自己的变成次要。\u003c/p\u003e\n\u003cp\u003e一些自由软件开发者通过支援服务赚钱。1994年，Cygnus 有近50个员工，估计有大约百分之十五的员工从事自由软件开发︰对一间软件公司而言，这是个了不起的比例。\u003c/p\u003e\n\u003cp\u003e九十年代，Intel、Motorola、Texas Instruments 和 Analog Devices 等公司联合赞助持续发展的GNU C语言编译器。现在大部份开发GCC的人工作还是受薪的开发者完成的。GNU的Ada语言编译器受美国空军赞助，之后成立专属公司延续过个项目。\u003c/p\u003e","tags":["gnu","system"],"title":"Why Software Should Not Have Owners"},{"categories":["工具"],"content":"前言 本文介绍jupyter notebook的安装配置过程和实用技巧。 jupyter.readthedocs教程\n1 安装与配置 1.1 安装 jupyter conda install jupyter # pip install -i https://pypi.tuna.tsinghua.edu.cn/simple jupyter # pip install jupyter -y 1.2 修改配置文件 生成配置文件 jupyter notebook --generate-config vim ~/.jupyter/jupyter_notebook_config.py 修改配置文件内容 c.NotebookApp.ip = \u0026#39;0.0.0.0\u0026#39; c.NotebookApp.port = 8018 # 设置密码 c.NotebookApp.password = u\u0026#39;sha1:bcd259ccf...your hashed password here\u0026#39; Tip: 利用ipython 生成密码\nIn [1]: from IPython.lib import passwd In [2]: passwd() Enter password: Verify password: Out[2]: \u0026#39;sha1:67xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\u0026#39; 我选用的是password密码登陆jupyter的方案，其他的密码登陆方案见 link\n新的方法 from notebook.auth import passwd; passwd()\n安装 jupyter-lab jupyter-lab --generate-config vim ~/.jupyter/jupyter_lab_config.py # 允许局域网访问 c.ServerApp.ip = \u0026#39;*\u0026#39; # 使用 生成密码from jupyter_server.auth import passwd; passwd() c.ServerApp.password = \u0026#39;\u0026#39; 安装低版本jupyter python3 -m venv xxx IPython==8.12.0 notebook==6.4.12 jupyter-server==1.13.4 traitlets==5.9.0 # 安装依赖插件 pip install jupyter_contrib_nbextensions jupyter_nbextensions_configurator # 激活扩展管理器 jupyter contrib nbextension install --user jupyter nbextensions_configurator enable --user 1.3 安装插件管理 jupyter_contrib_nbextensions 为 jupyter notebook 扩展插件管理器，下面简称nbextensions。\nnbextensions的github repo nbextensions的教程nbextensions_manual_readthedocs\n# 用conda安装 conda install jupyter conda install -c conda-forge jupyter_contrib_nbextensions # pip安装 pip install jupyter_contrib_nbextensions # 使能 jupyter contrib nbextension install 我启用的一些插件\nplugins Table of Contents (2) Freeze 比较好的一个插件，可以用来冻住cell nbTranslate 这个插件利用Google翻译cell很好用 support languages ExecuteTime 显示执行时间 Ruler 代码标尺 Autopep8 代码美化 Scratchpad 代码测试 其他花样的配置\nhttps://zhuanlan.zhihu.com/p/74950682\n1.4 conda环境的设置 jupyter使用Anaconda miniconda环境需要安装的组件。 conda repo\n# 创建虚拟环境 conda create -n env_name python=3.6 # conda虚拟核组件 切换kernel conda install nb_conda_kernels 1.5 解决界面中英文混杂 如图，jupyter 界面中中英文混杂，解决方法为将界面文字中文切换成英文。\n原理：让jupyter就找不到他的中文配置文件夹。\n找到notebook的汉化文件夹的路径，比如~/miniconda3/lib/python3.6/site-packages/notebook/i18n/zh_CN。将其重命名如加个下划线作为后缀zh_CN_old，重启jupyter就行了。\n为了方便，我作了个脚本自动找notebook/i18n/zh_CN位置并改名此文件夹，如下。\nimport shutil from distutils.sysconfig import get_python_lib # 获取site-package包的位置 path_zh=get_python_lib()+\u0026#39;/notebook/i18n/zh_CN\u0026#39; path_zh_old=get_python_lib()+\u0026#39;/notebook/i18n/zh_CN_old\u0026#39; # 将 notebook/i18n/zh_CN 改为 notebook/i18n/zh_CN_old shutil.move(path_zh,path_zh_old) # 返回中文 # shutil.move(path_zh_old,path_zh) 重启jupyter就行了, 这样jupyter就找不到这个中文配置，返回中文改回去就行了1。\n2 使用的技巧 2.1 快捷键 在非激活状态即是蓝颜色的边框 内容 A insert cell above B insert cell below H 查看帮助 ⌃↩(ctrl + enter) run selected cells 2.2 显示图片 视频 音频 主要是画图、显示视频和音频的方法。\n# 图片 %%HTML \u0026lt;img src=\u0026#34;xxx.jpg\u0026#34; alt=\u0026#34;title\u0026#34; /\u0026gt; # 视频 %%HTML \u0026lt;video width=\u0026#34;330\u0026#34; height=\u0026#34;150\u0026#34; controls\u0026gt; \u0026lt;source src=\u0026#34;out_all.mp4\u0026#34; type=\u0026#34;video/mp4\u0026#34;\u0026gt; \u0026lt;/video\u0026gt; # 语音 %%HTML \u0026lt;audio src=\u0026#34;out.wav\u0026#34; controls=\u0026#34;controls\u0026#34;\u0026gt; Your browser does not support the audio element. \u0026lt;/audio\u0026gt; # html t是html的字符串 from IPython.core.display import HTML HTML(str(t)) 2.3 其他技巧 修复视频文件 def fix_use_ffmpeg(in_name, out_name,message=\u0026#34;\u0026#34;): import os if os.path.isfile(out_name): os.remove(out_name) cmd = \u0026#39;ffmpeg -i %s %s\u0026#39; % (in_name, out_name) log_lines = os.popen(cmd).readlines() print(message,\u0026#34;ok\u0026#34;) 加载自己的模块文件 出于性能考虑，每个模块在每个解释器会话中只导入一遍。因此，如果你修改了你的模块，需要重启解释器；或者，如果你就是想交互式的测试这么一个模块，可以用 imp.reload() 重新加载，例如 import imp; imp.reload(modulename)\n导出pdf支持中文 Jupyter Notebook 输出PDF中文支持 link\ncd /usr/local/lib/python3.6/site-packages/nbconvert/templates/latex # 在里面的模版中添加，前提是安装好了texlive % add \\usepackage{ctex} ipynb2pdf #!/usr/bin/env python3 \u0026#34;\u0026#34;\u0026#34; Current version of Jupyter doesn\u0026#39;t support pdf exporting when it comes to russian language in the document. To fix this, current script has born. It requires nbconvert as long as jupyter to be installed. Author: Sergey Ivanychev Email: sergeyivanychev@gmail.com Revision: 1 \u0026#34;\u0026#34;\u0026#34; import sys import os import subprocess FORMAT = \u0026#34;.ipynb\u0026#34; \u0026#34;\u0026#34;\u0026#34; TODO: What if user has ___o.tex in current folder? \u0026#34;\u0026#34;\u0026#34; TEMP_TEX = \u0026#34;___o.tex\u0026#34; TEMP_FOLDER = \u0026#34;/tmp\u0026#34; TRASH_EXTENSIONS = [\u0026#34;.aux\u0026#34;, \u0026#34;.out\u0026#34;, \u0026#34;.log\u0026#34;] OLD1 = r\u0026#34;\\usepackage[utf8x]{inputenc}\u0026#34; NEW1 = r\u0026#34;\u0026#34;\u0026#34; \\usepackage[utf8x]{inputenc} \\usepackage{ctex} \u0026#34;\u0026#34;\u0026#34; REPLACE = [(OLD1, NEW1)] HELP = \u0026#34;\u0026#34;\u0026#34; This script is aimed at correctly converting .ipynb to .pdf files. You may use it via # ipynb2pdf Solution.ipynb To get .pdf in the same directory \u0026#34;\u0026#34;\u0026#34; def check_args(argv): if (len(argv) \u0026gt; 2): print(\u0026#34;Please, type .ipynb filename as argument\u0026#34;) return -1 if (len(argv) == 1): print(HELP) return -1 script, filename = argv if not is_ipynb(filename): print(\u0026#34;Please, type .ipynb filename as argument\u0026#34;) return -1 def remove_extention(string, extention): \u0026#34;\u0026#34;\u0026#34; Removes argumented extention from the end of the string \u0026#34;\u0026#34;\u0026#34; if extention[0] != \u0026#39;.\u0026#39;: extention = \u0026#34;.\u0026#34; + extention if string.endswith(extention): string = string[0:-len(extention)] return string def is_ipynb(filename): if not filename.endswith(\u0026#34;.ipynb\u0026#34;): return False return True def tex2pdf(filename, desired_name): \u0026#34;\u0026#34;\u0026#34; Converts filename (which is tex document) to desired_name (which is pdf) leaving no trash in current folder \u0026#34;\u0026#34;\u0026#34; base = remove_extention(filename, \u0026#34;tex\u0026#34;) output = base + \u0026#34;.pdf\u0026#34; ret = subprocess.call(\u0026#34;xelatex %s\u0026#34; % filename , shell=True, stdout=subprocess.PIPE) for ext in TRASH_EXTENSIONS: os.unlink(base + ext) os.rename(output, desired_name) return ret def main(argv): if check_args(argv) == -1: return -1 script, filename = argv ret = subprocess.call(\u0026#34;jupyter nbconvert %s --to latex --output %s\u0026#34; % (filename, TEMP_TEX), shell=True, stdout=subprocess.PIPE) if (ret != 0): print(\u0026#34;ret = %d\u0026#34; % ret) os.unlink(TEMP_TEX) print(\u0026#34;Converting to LaTeX failed. Return code: %d\u0026#34; % ret) return -1 tex_file = open(TEMP_TEX, \u0026#34;r\u0026#34;) tex = tex_file.read() for old, new in REPLACE: tex = tex.replace(old, new) tex_file.close() os.unlink(TEMP_TEX) tex_file = open(TEMP_TEX, \u0026#34;w+\u0026#34;) tex_file.write(tex) tex_file.close() ret = tex2pdf(TEMP_TEX, remove_extention(filename, \u0026#34;.ipynb\u0026#34;) + \u0026#34;.pdf\u0026#34;) tex_file.close() os.unlink(TEMP_TEX) print(remove_extention(filename, \u0026#34;.ipynb\u0026#34;) + \u0026#34;.pdf - DONE\u0026#34;) return 0 if __name__ == \u0026#34;__main__\u0026#34;: exit(main(sys.argv)) https://www.zhihu.com/question/302814218/answer/1029684239\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"/post/c7-toolchain/jupyter-notebook/","summary":"\u003cp\u003e\u003cstrong\u003e前言\u003c/strong\u003e\n本文介绍jupyter notebook的安装配置过程和实用技巧。\n\u003ca href=\"https://jupyter.readthedocs.io/en/latest/index.html\"\u003ejupyter.readthedocs教程\u003c/a\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"1-安装与配置\"\u003e1 安装与配置\u003c/h2\u003e\n\u003ch3 id=\"11-安装-jupyter\"\u003e1.1 安装 jupyter\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003econda install jupyter\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# pip install -i https://pypi.tuna.tsinghua.edu.cn/simple jupyter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# pip install jupyter -y\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"12-修改配置文件\"\u003e1.2 修改配置文件\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e生成配置文件\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejupyter notebook --generate-config\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evim ~/.jupyter/jupyter_notebook_config.py\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e修改配置文件内容\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eNotebookApp\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eip \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0.0.0.0\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eNotebookApp\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eport \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8018\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 设置密码\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ec\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eNotebookApp\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epassword \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eu\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;sha1:bcd259ccf...your hashed password here\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eTip: 利用ipython 生成密码\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eIn [1]: from IPython.lib import passwd\nIn [2]: passwd()\n  Enter password:\n  Verify password:\n  Out[2]: \u0026#39;sha1:67xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\u0026#39;\n\u003c/code\u003e\u003c/pre\u003e\u003c/blockquote\u003e\n\u003cp\u003e我选用的是password密码登陆jupyter的方案，其他的密码登陆方案见 \u003ca href=\"https://zhuanlan.zhihu.com/p/23110830\"\u003elink\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e新的方法\nfrom notebook.auth import passwd; passwd()\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"安装-jupyter-lab\"\u003e安装 jupyter-lab\u003c/h3\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ejupyter-lab --generate-config\n\nvim ~/.jupyter/jupyter_lab_config.py\n\n# 允许局域网访问\nc.ServerApp.ip = \u0026#39;*\u0026#39;\n\n# 使用 生成密码from jupyter_server.auth import passwd; passwd()\nc.ServerApp.password = \u0026#39;\u0026#39;\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"安装低版本jupyter\"\u003e安装低版本jupyter\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epython3 -m venv xxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eIPython\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e8.12.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enotebook\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e6.4.12\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejupyter-server\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e1.13.4\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etraitlets\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e5.9.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 安装依赖插件\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epip install jupyter_contrib_nbextensions jupyter_nbextensions_configurator\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 激活扩展管理器\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejupyter contrib nbextension install --user\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejupyter nbextensions_configurator enable --user\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"13-安装插件管理\"\u003e1.3 安装插件管理\u003c/h3\u003e\n\u003cp\u003ejupyter_contrib_nbextensions 为 jupyter notebook 扩展插件管理器，下面简称nbextensions。\u003c/p\u003e","tags":["笔记应用","jupyter","python"],"title":"Jupyter notebook的配置"},{"categories":["linux"],"content":"前言 本文记录修复ubuntu引导，并修改ubuntu盘的大小过程。 参考：http://www.cnblogs.com/jloveu/p/Ubuntu-partition-expansion-record.html 工具：Ubuntu 的live U盘，带有gparted分区工具，和grub修复工具\n修复启动 对于使用gpt的格式的硬盘，ubuntu不要用uefi来安装。gpt还要生成一个bootgios的分区，很重要。\n执行以下命令（以root身份）：\nmkdir /tmp/mydir mount /dev/sda8 /tmp/mydir (注：其中的`/dev/sda8`为我的`/`分区标识，根据自己情况修改为自己的`/`分区标识) mount /dev/sda11 /tmp/mydir/boot (注：同上，`/dev/sda11`为`/boot`分区标识) mount --bind /dev /tmp/mydir/dev mount --bind /proc /tmp/mydir/proc mount --bind /sys /tmp/mydir/sys chroot /tmp/mydir (此步可能输出一些信息，可以无视) grub-install /dev/sda (注：其中的`/dev/sda`为`/`分区所在硬盘的标识) exit 修改Ubuntu多系统的默认启动顺序 link 打开该配置文件\u0026quot;/etc/default/grub\u0026quot;\nsudo vim /etc/default/grub sudo update-grub 其中的“GRUB_DEFAULT=0”为设置默认启动项。系统启动菜单Windows10的启动项在第5项，修改为4（GRUB启动项是从0开始的）。\n去除多余GRUB启动项（直接） link\n注释掉“/boot/grub/grub.cfg”中对应\nsudo gedit /boot/grub/grub.cfg Ubuntu下如何修复Grub引导 link\n本文以 Ubuntu Live CD 修复 Grub 引导为例，已在 /dev/sda3 安装 Fedora。\n首先制作 Ubuntu 启动 USB\n复制代码代码如下：\nsudo dd if=ubuntu-13.10-desktop-amd64.iso of=/dev/sdb #/dev/sdb 为 USB 盘符 1.使用启动 USB 进入 Ubuntu 试用环境\n2.查看硬盘分区状况，获取 Linux 系统安装分区编号 代码如下：\nsudo fdisk -l 查看输出结果，然后根据文件类型和分区大小来判定 Linux 系统安装在哪块硬盘和安装的分区。我的电脑是在 /dev/sda3 安装了 Fedora。\n或者，打开 Gparted 图形化工具来查看分区信息也可以。\n挂载 Fedora 安装分区\n3.已知 Fedora 安装在了 /dev/sda3 上，所以我们可以用下面命令来挂载 Fedora 安装分区。你需要将 /dev/sda3 换成自己的 Linux 安装分区。\nsudo mount /dev/sda3 /mnt 4.挂载其他所需的目录（使用 \u0026ndash;bind）\nsudo mount --bind /dev /mnt/dev sudo mount --bind /proc /mnt/proc sudo mount --bind /sys /mnt/sys 5.Chroot 到硬盘上的 Linux 系统\nsudo chroot /mnt 6.安装\u0026amp;更新 Grub\ngrub2-install /dev/sda grub2-mkconfig -o /boot/grub2/grub.cfg 7.Grub 已经修复成功，我们还需要退出 chroot 环境、卸载已经挂载的设备与目录：\nexit 退出 chroot 环境\nsudo umount /mnt/dev sudo umount /mnt/proc sudo umount /mnt/sys sudo umount /mnt 8.重启！\n上面就是使用Ubuntu LiveCD修复grub的方法介绍了，如果你在使用双系统安装windows中出现Grub引导错误，不妨使用该方法进行修复吧。\n","permalink":"/post/c5-linux/linux/boot-recovery/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e本文记录修复ubuntu引导，并修改ubuntu盘的大小过程。\n参考：\u003ca href=\"http://www.cnblogs.com/jloveu/p/Ubuntu-partition-expansion-record.html\"\u003ehttp://www.cnblogs.com/jloveu/p/Ubuntu-partition-expansion-record.html\u003c/a\u003e\n工具：Ubuntu 的live U盘，带有gparted分区工具，和grub修复工具\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"修复启动\"\u003e修复启动\u003c/h2\u003e\n\u003cp\u003e对于使用gpt的格式的硬盘，ubuntu不要用uefi来安装。gpt还要生成一个bootgios的分区，很重要。\u003c/p\u003e\n\u003cp\u003e执行以下命令（以root身份）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir /tmp/mydir\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emount /dev/sda8 /tmp/mydir  \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e注：其中的\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e/dev/sda8\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e为我的\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e/\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e分区标识，根据自己情况修改为自己的\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e/\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e分区标识\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emount /dev/sda11 /tmp/mydir/boot  \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e注：同上，\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e/dev/sda11\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e为\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e/boot\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e分区标识\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emount --bind /dev /tmp/mydir/dev\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emount --bind /proc /tmp/mydir/proc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emount --bind /sys /tmp/mydir/sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echroot /tmp/mydir  \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e此步可能输出一些信息，可以无视\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egrub-install /dev/sda  \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e注：其中的\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e/dev/sda\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e为\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e/\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e分区所在硬盘的标识\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexit\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"修改ubuntu多系统的默认启动顺序\"\u003e修改Ubuntu多系统的默认启动顺序\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://jingyan.baidu.com/article/f71d60379e16021ab641d1ab.html\"\u003elink\u003c/a\u003e\n打开该配置文件\u0026quot;/etc/default/grub\u0026quot;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo vim /etc/default/grub\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo update-grub\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e其中的“GRUB_DEFAULT=0”为设置默认启动项。系统启动菜单Windows10的启动项在第5项，修改为4（GRUB启动项是从0开始的）。\u003cbr\u003e\n\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"boot_file.png\" \n     alt=\"GRUB修改\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003ch2 id=\"去除多余grub启动项直接\"\u003e去除多余GRUB启动项（直接）\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://zhidao.baidu.com/question/472571337.html\"\u003elink\u003c/a\u003e\u003cbr\u003e\n注释掉“/boot/grub/grub.cfg”中对应\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo gedit /boot/grub/grub.cfg\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ubuntu下如何修复grub引导\"\u003eUbuntu下如何修复Grub引导\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://mp.weixin.qq.com/s/NDZPPA-0FhqSzRndQOhNEw\"\u003elink\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e本文以 Ubuntu Live CD 修复 Grub 引导为例，已在 /dev/sda3 安装 Fedora。\u003c/p\u003e\n\u003cp\u003e首先制作 Ubuntu 启动 USB\u003c/p\u003e","tags":["ubuntu","引导修复"],"title":"Ubuntu引导修复"},{"categories":["数学"],"content":" 百度云链接: https://pan.baidu.com/s/1AwNZNoMLgJcJ5X0G0fpC5w 提取码: pb1n\n","permalink":"/post/c1-math/math-handbook/","summary":"\u003cimg src=\"math-handbook/Screen Shot 2020-03-06 at 13.24.51.png\" alt=\"Screen Shot 2020-03-06 at 13.24.51\" style=\"zoom:33%;\" /\u003e\n\u003cimg src=\"math-handbook/Screen Shot 2020-03-06 at 13.24.27.png\" alt=\"Screen Shot 2020-03-06 at 13.24.27\" style=\"zoom: 33%;\" /\u003e\n\u003cimg src=\"math-handbook/Screen Shot 2020-03-06 at 13.22.44.png\" alt=\"Screen Shot 2020-03-06 at 13.22.44\" style=\"zoom:33%;\" /\u003e\n\u003cimg src=\"math-handbook/Screen Shot 2020-03-06 at 13.23.48.png\" alt=\"Screen Shot 2020-03-06 at 13.23.48\" style=\"zoom:33%;\" /\u003e\n\u003cimg src=\"math-handbook/Screen Shot 2020-03-06 at 13.23.57.png\" alt=\"Screen Shot 2020-03-06 at 13.23.57\" style=\"zoom:33%;\" /\u003e\n\u003cp\u003e百度云链接: \u003ca href=\"https://pan.baidu.com/s/1AwNZNoMLgJcJ5X0G0fpC5w\"\u003ehttps://pan.baidu.com/s/1AwNZNoMLgJcJ5X0G0fpC5w\u003c/a\u003e 提取码: pb1n\u003c/p\u003e","tags":["工具书"],"title":"现代数学手册"},{"categories":["linux"],"content":"前言 窗口颜色设置浅绿色 cd /usr/share/themes/Ambiance/gtk-3.0 sudo gedit gtk-main.css 2 常用环境 安装jdk # add java path export JAVA_HOME=/usr/local/java/jdk1.7 export JRE_HOME=${JAVA_HOME}/jre export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib export PATH=${JAVA_HOME}/bin:$PATH 3 安装软件 在线软件安装 # 备份源列表地址 sudo cp /etc/apt/sources.list /etc/apt/sources.list_backup # 修改 sudo vim /etc/apt/sources.list # 更新源 apt-get update apt-get install xxx # 包search apt-cache search xxx deb本地软件安装 # 安装deb包命令 dpkg -i *.deb # 如果缺少依赖执行 apt-get -f install 4 常用软件 mpv播放器 有道字典 atom atom-pane { font-size: 16px; } .command-palette { font-size: 16px; } 图标设置 cd /usr/share/applications vim eclipse.desktop #!/usr/bin/env xdg-open [Desktop Entry] Version=22.0 Name=eclipse Exec=/home/gtc/Android/adt-bundle-linux/eclipse/eclipse Terminal=false Icon=/home/gtc/Android/adt-bundle-linux/eclipse/icon.xpm Type=Application Categories=Development 设备使用率指示 https://github.com/fossfreedom/indicator-sysmonitor\nimport gi try: gi.require_version(\u0026#39;AyatanaAppIndicator3\u0026#39;, \u0026#39;0.1\u0026#39;) from gi.repository import AyatanaAppIndicator3 as appindicator except ValueError: gi.require_version(\u0026#39;AppIndicator3\u0026#39;, \u0026#39;0.1\u0026#39;) from gi.repository import AppIndicator3 as appindicator apt install gir1.2-ayatanaappindicator3-0.1\n5 其他优化 关闭错误报告 # 关闭烦人的错误报告 sudo gedit /etc/default/apport CPU 100%占用 cd /usr/lib/gvfs # 将gvfsd-smb-brows权限改成744，取消普通用户的执行权限， # 也挺有意思，暂时没引发别的问题 smb apt-get install samba vim /etc/samba/smb.conf service smbd restart smbpasswd -a xxx\nvfs objects = catia fruit streams_xattr fruit:nfs_aces = no [share] path = /home/talen/share valid users = talen available = yes browseable = yes writable = yes public = no ","permalink":"/post/c5-linux/linux/ubuntu-init/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ch2 id=\"窗口颜色设置浅绿色\"\u003e窗口颜色设置浅绿色\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd /usr/share/themes/Ambiance/gtk-3.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo gedit gtk-main.css\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2--常用环境\"\u003e2  常用环境\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ch2 id=\"安装jdk\"\u003e安装jdk\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# add java path\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport JAVA_HOME\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/usr/local/java/jdk1.7\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport JRE_HOME\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eJAVA_HOME\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e/jre\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport CLASSPATH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e.:\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eJAVA_HOME\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e/lib:\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eJRE_HOME\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e/lib\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport PATH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eJAVA_HOME\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e/bin:$PATH\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"3-安装软件\"\u003e3 安装软件\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ch2 id=\"在线软件安装\"\u003e在线软件安装\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 备份源列表地址\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo cp /etc/apt/sources.list /etc/apt/sources.list_backup\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 修改\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo vim /etc/apt/sources.list\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 更新源\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapt-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapt-get install xxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 包search\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapt-cache search xxx\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ch2 id=\"deb本地软件安装\"\u003edeb本地软件安装\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 安装deb包命令\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edpkg -i *.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# 如果缺少依赖执行\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapt-get -f install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"4-常用软件\"\u003e4 常用软件\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003empv播放器\u003c/li\u003e\n\u003cli\u003e有道字典\u003c/li\u003e\n\u003cli\u003e\n\u003ch2 id=\"atom\"\u003eatom\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-css\" data-lang=\"css\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eatom-pane\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efont-size\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003epx\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecommand-palette\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efont-size\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003epx\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ch2 id=\"图标设置\"\u003e图标设置\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd /usr/share/applications\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evim eclipse.desktop\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/env xdg-open\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eDesktop Entry\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVersion\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e22.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eName\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eeclipse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExec\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/home/gtc/Android/adt-bundle-linux/eclipse/eclipse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eTerminal\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eIcon\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/home/gtc/Android/adt-bundle-linux/eclipse/icon.xpm\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eType\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eApplication\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCategories\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eDevelopment\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"设备使用率指示\"\u003e设备使用率指示\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/fossfreedom/indicator-sysmonitor\"\u003ehttps://github.com/fossfreedom/indicator-sysmonitor\u003c/a\u003e\u003c/p\u003e","tags":["技巧","ubuntu"],"title":"Ubuntu的优化与设置"},{"categories":["生活"],"content":"红楼梦是我国四大名著之一，主要内容是贾府的兴衰和宝黛的悲剧爱情。电视剧红楼梦2010版，我是从八月开始看的，看完到现在，也有小一个月了。在网上大家对这版电视剧褒贬不一。与我来说，我是喜欢这部剧的，不能说拍得很好，但这部剧却勾起了我读书与写字的兴趣。于是乎，做了一篇随笔，以记录我的一些感触。\n我记得最早是小学，我们还是顾着打玻璃珠和丢沙包的年纪，学校旁边的小书店里，也都是七龙珠，哆啦A梦，柯南的小人书，老师们讲到四大名著，顺带提了下红楼梦，其他没印象了。我们学习最多的是中文的拼音和书写，作文都是打油，日记也闹了不少笑话。后来上初中，有一次寒假附加作业是阅读红楼梦，我虽毫无兴趣，但还是硬着头皮，去新华书店，试看红楼梦。120章的红楼，厚得连看下去的勇气也没有。略看了几下，最后，做了一个红楼梦不好看的论断，也就放在那边了。那时有老版的红楼梦电视剧播映，打开电视偶尔会遇见，但是立马换台，央视的西游记与情深深雨蒙蒙，湖南电视台的还珠格格，也是欣赏了好几遍。再者，有动画片谁有兴趣去看这些什么破剧，关于书本，最多也就是看看汤姆索亚历险记。\n再后来，去启中读书，学习上比较紧张，再加上理科班的非文学氛围，对这些文学的东西更不感冒。尽管偶尔也会入耳一些其中的人物，比如林妹妹，刘姥姥，也是不用大脑耳朵直接过滤。当时，大伙是杂志，读者，青年文摘读得比较多，班上一本，全班查阅，杂志文章篇幅较小，读起很顺很舒服。期间，与红楼的唯一一次接触是，高中教科书上有刘姥姥进大观园的章节，翻了一遍，当时，感叹人物好多，理不出人物关系，完全放弃看完红楼的欲望。以为姥姥是贾府的姥姥，猩猩然想着以后可以说看过一段红楼，红楼也比较贵不如多买几本读者，积累作文素材。不知什么时候，班上网络小说之风随着mp4和智能手机的普及而吹起，我也用MP4刷完了一两部网络小说，感觉都是一个套路，主角都是绝处逢生，越来越无敌，也就不敢兴趣了。\n再然后，我上大学，藏书400百万册的成电图书馆，也并没有引起我读文学类的欲望，大学四年借的专业工具类书比较多，想来也是浪费资源。在一个工科高校，文学方面的课程几乎没有，虽说有个大学语文的选修课，俨然不感兴趣。大学里，再一次看到有人在看红楼梦电视剧，也是大二的时候的人工智能课上，也是闲得无聊。再后来，大四时，手机上自带一个蜻蜓网络电台应用，无聊点开蒋勋老师评述的红楼梦音频，红学大师讲到他与红楼梦的相遇，同时，他介绍的红楼基本背景和人物，通俗易懂，一下子引起我的兴趣。他说红楼梦写的都是15、6岁人的故事，15、16岁就可以读了。回想我15、16岁，基本没看什么名著。要说四大名著，我也就看了三国和水浒的少年版。上次回家，看美剧，老妈突然蹦出句，不能光看英文也应当看看我们老祖宗的文化。\n现在得空，就这样抱着惭愧和一丝尝试我看起了2010版红楼梦。在这我得承认，我是个演员控。不得不说，三大主演都很不错。\n50集过后，原来红楼讲得是这个，并表示有兴趣去读读名著了。原来有这么多原来。\n人物家族命运令人感慨。作者写出超越那个时代的朦胧的爱情与不得不提的丧心病狂的全部悲剧，果然是个失意文人的作品。 可叹停机德，堪怜咏絮才。宝钗落落大方德才兼备，黛玉因情而伤而痛去世，宝玉虽与宝钗结婚，最后离家成道去。精于人情世故,，胸有城府的王熙凤，平日的爽朗笑声终究悲剧，贾府里多么好的领导，最后也人情冷暖，不免为其伤心。刘姥姥，其实是个成功的投机分子，但也是朴实善良的“穷亲戚”，最后救了巧儿。十二金钗各有个的悲剧，正如宝玉在虚幻仙境里警幻仙姑给的设定。原来故事一开始就把结局告诉了读者。\n体验古代贵族文化。里面还有个诗社的组织，古人的结社，好有雅致，也会给人起“绰号”。除此以外还有击鼓传花，有时主题是讲笑话有时对诗。猜灯谜，中秋赏月，生日宴会等等。\n语言魅力。打秋风，这是形容刘姥姥找找贾府接济用的。恼，生气，或者使生气。不同人的称谓，宝兄弟，宝二爷，宝姐姐或者好姐姐，林妹妹或者好妹妹。\n情节回味无穷。刘姥姥进大观园，是贾母和姥姥差不多年纪想和她聊聊，邀请她的。乡村来打秋风的刘姥姥像是在参观皇宫。在后面时期 ，家族里一次比一次捉襟见肘的聚会，可以看见这些家族的衰落。中国的各种人情世故体现在这里面。四个大家族，一个小社会。\n以上是我的一点点感悟。\n只是，我与红楼梦，还差80章书页，希望还能有计划地读完。\n2016年于成电\n","permalink":"/post/c0-life/readings/hongloumeng/","summary":"\u003cp\u003e红楼梦是我国四大名著之一，主要内容是贾府的兴衰和宝黛的悲剧爱情。电视剧红楼梦2010版，我是从八月开始看的，看完到现在，也有小一个月了。在网上大家对这版电视剧褒贬不一。与我来说，我是喜欢这部剧的，不能说拍得很好，但这部剧却勾起了我读书与写字的兴趣。于是乎，做了一篇随笔，以记录我的一些感触。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e我记得最早是小学，我们还是顾着打玻璃珠和丢沙包的年纪，学校旁边的小书店里，也都是七龙珠，哆啦A梦，柯南的小人书，老师们讲到四大名著，顺带提了下红楼梦，其他没印象了。我们学习最多的是中文的拼音和书写，作文都是打油，日记也闹了不少笑话。后来上初中，有一次寒假附加作业是阅读红楼梦，我虽毫无兴趣，但还是硬着头皮，去新华书店，试看红楼梦。120章的红楼，厚得连看下去的勇气也没有。略看了几下，最后，做了一个红楼梦不好看的论断，也就放在那边了。那时有老版的红楼梦电视剧播映，打开电视偶尔会遇见，但是立马换台，央视的西游记与情深深雨蒙蒙，湖南电视台的还珠格格，也是欣赏了好几遍。再者，有动画片谁有兴趣去看这些什么破剧，关于书本，最多也就是看看汤姆索亚历险记。\u003c/p\u003e\n\u003cp\u003e再后来，去启中读书，学习上比较紧张，再加上理科班的非文学氛围，对这些文学的东西更不感冒。尽管偶尔也会入耳一些其中的人物，比如林妹妹，刘姥姥，也是不用大脑耳朵直接过滤。当时，大伙是杂志，读者，青年文摘读得比较多，班上一本，全班查阅，杂志文章篇幅较小，读起很顺很舒服。期间，与红楼的唯一一次接触是，高中教科书上有刘姥姥进大观园的章节，翻了一遍，当时，感叹人物好多，理不出人物关系，完全放弃看完红楼的欲望。以为姥姥是贾府的姥姥，猩猩然想着以后可以说看过一段红楼，红楼也比较贵不如多买几本读者，积累作文素材。不知什么时候，班上网络小说之风随着mp4和智能手机的普及而吹起，我也用MP4刷完了一两部网络小说，感觉都是一个套路，主角都是绝处逢生，越来越无敌，也就不敢兴趣了。\u003c/p\u003e\n\u003cp\u003e再然后，我上大学，藏书400百万册的成电图书馆，也并没有引起我读文学类的欲望，大学四年借的专业工具类书比较多，想来也是浪费资源。在一个工科高校，文学方面的课程几乎没有，虽说有个大学语文的选修课，俨然不感兴趣。大学里，再一次看到有人在看红楼梦电视剧，也是大二的时候的人工智能课上，也是闲得无聊。再后来，大四时，手机上自带一个蜻蜓网络电台应用，无聊点开蒋勋老师评述的红楼梦音频，红学大师讲到他与红楼梦的相遇，同时，他介绍的红楼基本背景和人物，通俗易懂，一下子引起我的兴趣。他说红楼梦写的都是15、6岁人的故事，15、16岁就可以读了。回想我15、16岁，基本没看什么名著。要说四大名著，我也就看了三国和水浒的少年版。上次回家，看美剧，老妈突然蹦出句，不能光看英文也应当看看我们老祖宗的文化。\u003c/p\u003e\n\u003cp\u003e现在得空，就这样抱着惭愧和一丝尝试我看起了2010版红楼梦。在这我得承认，我是个演员控。不得不说，三大主演都很不错。\u003c/p\u003e\n\u003cp\u003e50集过后，原来红楼讲得是这个，并表示有兴趣去读读名著了。原来有这么多原来。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e人物家族命运令人感慨。作者写出超越那个时代的朦胧的爱情与不得不提的丧心病狂的全部悲剧，果然是个失意文人的作品。 可叹停机德，堪怜咏絮才。宝钗落落大方德才兼备，黛玉因情而伤而痛去世，宝玉虽与宝钗结婚，最后离家成道去。精于人情世故,，胸有城府的王熙凤，平日的爽朗笑声终究悲剧，贾府里多么好的领导，最后也人情冷暖，不免为其伤心。刘姥姥，其实是个成功的投机分子，但也是朴实善良的“穷亲戚”，最后救了巧儿。十二金钗各有个的悲剧，正如宝玉在虚幻仙境里警幻仙姑给的设定。原来故事一开始就把结局告诉了读者。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e体验古代贵族文化。里面还有个诗社的组织，古人的结社，好有雅致，也会给人起“绰号”。除此以外还有击鼓传花，有时主题是讲笑话有时对诗。猜灯谜，中秋赏月，生日宴会等等。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e语言魅力。打秋风，这是形容刘姥姥找找贾府接济用的。恼，生气，或者使生气。不同人的称谓，宝兄弟，宝二爷，宝姐姐或者好姐姐，林妹妹或者好妹妹。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e情节回味无穷。刘姥姥进大观园，是贾母和姥姥差不多年纪想和她聊聊，邀请她的。乡村来打秋风的刘姥姥像是在参观皇宫。在后面时期  ，家族里一次比一次捉襟见肘的聚会，可以看见这些家族的衰落。中国的各种人情世故体现在这里面。四个大家族，一个小社会。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e以上是我的一点点感悟。\u003c/p\u003e\n\u003cp\u003e只是，我与红楼梦，还差80章书页，希望还能有计划地读完。\u003c/p\u003e\n\u003cp\u003e2016年于成电\u003c/p\u003e","tags":["读书","读书笔记","故事","《红楼梦》"],"title":"红楼梦与我"},{"categories":["数学"],"content":"前言 偶然看到的一个问题，如图1，为什么正好经过这个空隙？我们用空间解析几何来解一下吧。\n图1 为什么会经过这个空隙？ 解答 如图2，建立空间直角坐标系$xyz$，原点记为 $O$ ， $P$ 点为水平杆与斜杆的交点， $Q$ 点为垂直杆与水平杆的交点， 将斜杆标记为 $L$ 。\n图2 建立空间直角坐标系 设 $OQ=q$ ， $QP=r$ 。$Q$ 点坐标为 $(0, 0, q)$ 。\n设水平杆 $QP$ 绕 $z$ 轴以 $\\omega, rad/s$ 的角速度旋转，并设从开始旋转到现在的时长为 $t$ 秒， 则 $P$ 点坐标为 $(r\\cos{\\omega t}, r\\sin{\\omega t}, q)$ 。\n由 $Q$、$P$ 两点坐标得：\n$$ \\overrightarrow{OQ}=(0, 0, q) \\qquad \\overrightarrow{QP}=(r\\cos{\\omega t}, r\\sin{\\omega t}, 0) \\tag{1} $$\n设 $L$ 的方向向量 $\\overrightarrow{S}=(a, b, c) $，由 $L$ 的方向向量 $\\overrightarrow{S}$ 和 $P$ 点得，得斜杆 $L$ 代表的直线方程： $$ \\frac{x-r\\cos{\\omega t}}{a}=\\frac{y-r\\sin{\\omega t}}{b}=\\frac{z-q}{c} \\tag{2} $$\n我们知道 $\\overrightarrow{QP}$ 与斜杆 $L$ 垂直，假设 $\\overrightarrow{OQ}$ 与斜杆 $L$ 成固定角 $ \\theta$ ，得： $$ \\begin{cases} 0=\\overrightarrow{QP} \\cdot \\overrightarrow{S} \\ \\cos{\\theta}=\\frac{\\overrightarrow{OQ} \\cdot \\overrightarrow{S}}{\\left|\\overrightarrow{OQ}\\right| \\left| \\overrightarrow{S}\\right|} \\end{cases} \\tag{3} $$\n把 $\\overrightarrow{QP}$， $\\overrightarrow{S}$， $\\overrightarrow{OQ}$ 代入 式(3)，得 $$ \\begin{cases} \\frac{a}{b}=\\frac{-\\sin{\\omega t}}{\\cos{\\omega t}} \\ c^{2}(\\tan{\\theta})^{2}=a^{2}+b^{2} \\end{cases} \\tag{4} $$\n式（4）中第2条等式两边除以 $b^2$ ，再化简得： $$ \\frac{c^{2}}{b^{2}}=\\frac{1}{(\\tan{\\theta})^{2}(\\cos{\\omega t})^{2}} \\tag{5} $$\n求直线组 $L$ 与 $xoz$ 平面相交的图形，即回答这个缝隙的形状为什么是图1 中这样的曲线。我们令 $y=0$ ，代入直线公式(2) 得： $$ \\frac{x-r\\cos{\\omega t}}{a}=\\frac{-r\\sin{\\omega t}}{b} =\\frac{z-q}{c} \\tag{6} $$ 由式（4）（5）（6）得到方程组（7）。 $$ \\begin{cases} \\frac{a}{b}=\\frac{-\\sin{\\omega t}}{\\cos{\\omega t}}\\ \\frac{x-r\\cos{\\omega t}}{a}=\\frac{-r\\sin{\\omega t}}{b} \\ \\frac{c^2}{b^2}=\\frac{1}{(\\tan{\\theta})^{2}(\\cos{\\omega t})^{2}}\\ \\frac{-r\\sin{\\omega t}}{b} =\\frac{z-q}{c} \\end{cases} \\tag{7} $$\n由式（7）中上面两个等式，消去a，b得： $$ \\frac{-\\sin{\\omega t}}{\\cos{\\omega t}}=\\frac{x-r\\cos{\\omega t}}{-r\\sin{\\omega t}}=\\frac{a}{b} \\tag{8} $$ $$ x \\cos{\\omega t}=r \\tag{9} $$\n由式（7）中下面两个等式，消去b，c得： $$ \\frac{1}{(\\tan{\\theta})^2(\\cos{\\omega t})^2} = \\frac{(z-q)^2}{(-r\\sin{\\omega t})^2} =\\frac{c^2}{b^2} \\tag{10} $$\n$$ \\frac{(-r\\sin{\\omega t})^2}{(\\tan{\\theta})^2(\\cos{\\omega t})^2} = {(z-q)}^2 \\tag{11} $$\n由利用式（9），可消去式（11）中的 $(\\sin{\\omega t})^{2}$ 和 $(\\cos{\\omega t})^{2}$ 得： $$ x^{2}-(\\tan{\\theta})^{2}(z-q)^{2}=r^{2} \\tag{12} $$ 易知，为双曲线方程，所以在 xoz 平面相交得图形为双曲线。 ■\n欢迎观众老爷们评论回复，一键三连。 更多有趣问题，欢迎关注投稿 知乎小成 - 数学漫游专栏， 我们聚焦生活中的数与形的小小问题们。 转载请注明出处，谢谢！\n","permalink":"/post/c1-math/why-the-gap-forms-a-hyperbola/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e偶然看到的一个问题，如图1，为什么正好经过这个空隙？我们用空间解析几何来解一下吧。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"math_q1_show.gif\" \n     alt=\"动图\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e 图1 为什么会经过这个空隙？\u003c/div\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"解答\"\u003e解答\u003c/h2\u003e\n\u003cp\u003e如图2，建立空间直角坐标系$xyz$，原点记为 $O$ ， $P$  点为水平杆与斜杆的交点， $Q$ 点为垂直杆与水平杆的交点， 将斜杆标记为 $L$ 。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"v2-80ac80b8031d5782412f4f4ef4e22a1a_b.jpeg\" \n     alt=\"img\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003cdiv align='center'\u003e 图2 建立空间直角坐标系\u003c/div\u003e\n\u003cp\u003e设 $OQ=q$  ， $QP=r$  。$Q$ 点坐标为 $(0, 0, q)$  。\u003c/p\u003e\n\u003cp\u003e设水平杆  $QP$  绕  $z$   轴以  $\\omega, rad/s$  的角速度旋转，并设从开始旋转到现在的时长为 $t$  秒， 则  $P$  点坐标为 $(r\\cos{\\omega t}, r\\sin{\\omega t}, q)$  。\u003c/p\u003e\n\u003cp\u003e由 $Q$、$P$ 两点坐标得：\u003c/p\u003e\n\u003cp\u003e$$\n\\overrightarrow{OQ}=(0, 0, q) \\qquad \\overrightarrow{QP}=(r\\cos{\\omega t}, r\\sin{\\omega t}, 0) \\tag{1}\n$$\u003c/p\u003e\n\u003cp\u003e设 $L$ 的方向向量 $\\overrightarrow{S}=(a, b, c) $，由 $L$ 的方向向量 $\\overrightarrow{S}$ 和 $P$ 点得，得斜杆  $L$  代表的直线方程：\n$$\n\\frac{x-r\\cos{\\omega t}}{a}=\\frac{y-r\\sin{\\omega t}}{b}=\\frac{z-q}{c} \\tag{2}\n$$\u003c/p\u003e","tags":["空间解析几何"],"title":"为什么正好经过这个空隙？"},{"categories":["生活"],"content":" 《西厢记》的书评:『琉璃易碎，人言易坠——关于《莺莺传》的叙事』转载 …全文:(豆瓣link)\n“半欲天明半未明，醉闻花气睡闻莺。 狌儿撼起钟声动，二十年来晓寺情。 ”男人四十的元微之写着酸酸的诗，回忆年少风流。假如我是元微之，我一定会这般写道：天空尚未亮透，微微透着点光，远处传来钟声，让我的思绪一下子回忆到二十年前，也是这样的一个早晨，在那所古寺的西厢，那个散发着鲜花一样香气的女子，用鸟儿般宛转的声音在我耳边低语：“钟声响了，想来我也该回去了。”那声音一直萦绕在耳边，十年、二十年、也许一辈子在我在记忆深处响起……。\n夜宿古刹，偶遇佳人，相伴遥夜，缠绵缱绻，天明而别。这样的际遇，是最最典型的古代书生的爱情幻想。在一个陌生的地方，遇到一个陌生人，发生一段有始无终的感情。书生注定要做个过客，一生漂泊在对那个女子的思念中，却没有勇气长相守。\n当我还是一个初中生的时候，我买来人民文学出版社的《西厢记》，上面盖本教科书，堂而皇之的上课看。但是很快，除了王实甫那华丽的辞藻，整个大团圆的故事构架让我兴趣索然，而前言里现代人给它冠上的什么“礼教叛逆者反抗封建卫道士”的宏大内涵更让我倒尽胃口。\n在书后还附着元稹的《莺莺传》。《莺莺传》所描写的其实只是两个人的故事，两个恋爱的人后来分开的故事，没有太宏大的叙事，没有那些官腔的说教和露骨的批判。这样的故事是我所喜的；这样的故事，也是中国文人所津津乐道的。关于类似内容的作品也就汗牛充栋，数不胜数。或许从《诗经》的“氓之蚩蚩，抱布贸丝”开始，就没有谁打算给自己的爱情故事赋予太宏大的命题，只是后来的人突然犯失心疯，发现了字里行间的微言大义。所以我很景仰孔夫子他老人家，他的《论语》里每一个字都可以养活一大批的圣贤大师。\n元稹的这篇传奇被人考据出是以自己为原型的故事，是一篇忏悔录。忏悔的味道我闻不出来，但是众前辈大师言之凿凿说张生便是元大才子，那我也就相信了罢。\n《莺莺传》的开头，交代道“在贞元年间，有位张生，他性格温和而富有感情，风度潇洒，容貌漂亮，意志坚强，脾气孤僻”。古人向来有画脸谱的习惯，只要不是丑的太离谱，一般的名士贤臣都被描写成“性温茂，美风容”之类。但是据说元稹的家族是著名的鲜卑拓跋，鲜卑人的美貌是相当出名的，就好象现在说日本人长的猥亵一样出名，所以我有理由相信，元稹在这点上也许没有吹牛。\n文章写道“以是年二十三，未尝近女色”，后面他自己解释道“登徒子非好色者，是有凶行；余真好色者，而适不我值。何以言之？大凡物之尤者，未尝不留连于心，是知其非忘情者也”，就仿佛现在的大学男生在卧谈会上被迫承认自己二十三岁高龄还是个处男，被人取笑之下只好解释“其实我哪里是没能力啊，我只是没遇到真正让我心动的；一般的庸脂俗粉我看不上眼，要是真有出类拔萃的，我也会追的。我是谈感情的，和你们玩肉体的垃圾是不一样的”诸如此类。但是考察元稹的家庭情况，他八岁丧父，在家族里又被同父异母的兄弟欺凌，从小随着母亲投奔舅氏，生活贫困，母亲教她念书。我们可以想象，一个幼年便寄人篱下，遭受贫困欺凌的味道，他只比林黛玉多了一个母亲而已，但是林黛玉在物质生活上绝对比他适意。我们的脑海里可以浮现这样一个人物性格：幼年丧父的人，对于男人所称道的齐家治国平天下之类的宏伟功名有着不同于常人的热情和执著，范仲淹就是很好的例子，所以元稹在事业上一直很上进努力，为达目的不惜代价不择手段，由于尝尽人情冷暖世态炎凉，他很敏感，这样的人物让我想到了《红与黑》里的主人公于连；他自幼由一个母亲抚养成人，一般这样的人具有恋母情结，对于女性有异于常人的喜好，所以他的性格里又有滥情懦弱的一面。多情和薄幸，坚毅和懦弱，正义和无耻都矛盾地体现在他身上，这也就能让我们更好的理解他后来为了追求功名而抛弃莺莺的举动了。由于家境贫寒，极端律己，自卑和敏感的元微之“内秉坚孤，非礼不可入”，就算偶尔参加朋友一起的游宴——古人的游宴和现在去歌舞厅唱歌跳舞一样，一般都安排了色情服务——“扰杂其间，他人皆汹汹拳拳，若将不及”，而他“容顺而已，终不能乱”。我不清楚他是不是冬天还要帮别人洗衣服赚钱，但是可以肯定他不会参与打牌这样不合礼仪的活动，所以也就不会有谁去污蔑他打牌作弊，不会有“樗蒲不胜，槌杀四生”的惨剧了。\n在这里他第一次提到“物之尤者”，后面他还有段很著名的话也提到“尤物”，为自己抛弃莺莺的行为做解释“大凡天之所命尤物也，不妖其身，必妖于人”。如此看来，仿佛我们的元大才子是个叶公好龙式的人物，这边在说假如能遇到尤物一定会动真情，那边厢却在说尤物不害她自身，必定祸害他人。没有得到的时候千方百计的追求，到手以后又不迭地甩掉去追求新的目标。人总是这样矛盾的动物，永远不明白自己所追求的到底是什么。我们知道最后元稹娶了豪门韦家的女儿为妻，使得他在仕途平步青云。于此，我们不妨看成是理智和情欲的对立，一边是代表事业投机的豪门韦家联姻的机会，而一边只是爱过的漂亮的女子，理智告诉他应该离开那个女子，但是情欲却欲罢不能，但是最后我们知道理智战胜了情欲，感情只好盘踞在文字里去凭吊，所以元微之为我们贡献了很多首脍炙人口的情诗。\n后来，张生，也就是元稹路过蒲州，搭救了寄住在普救寺的崔家寡妇一家。“是岁，浑瑊薨于蒲，有中人丁文雅，不善于军，军人因丧而扰，大掠蒲人。……先是张与蒲将之党有善，请吏护之，遂不及于难。十余日，廉使杜确将天子命以总戎节，令于军，军由是戢。”据《旧唐书·德宗纪》，贞元十五年十二月，河中绛州节度使浑瑊卒，以同州刺史杜确为河中尹、河中绛州观察使。元稹在贞元九年举明经科，并于贞元十五年在河中府任卑职，所以他和蒲将之党有交情，打个招呼关照一下也在情理之中；但据唐代举士制度，士之及第者还需要经过吏部考试才能正式任命官职，所以我们可以推测出在贞元十五年年底的时候，元稹便上路去长安应考，于是在蒲州遇上了莺莺一家。\n我们知道这篇传奇是有虚构的成分，就如元稹在里边成了张君瑞，但是有一点细节仍然需要注意的，就是莺莺家族的姓氏。在唐朝时候，年轻人普遍的梦想有两个，金榜题名，娶七姓女；就如同现在的大学生的梦想，考上公务员，讨个有钱人做老婆。娶个有钱人做老婆可以少奋斗十年，这是基于现实利益的考量，而娶七姓女等于瞬间提升了自身家族的社会层次，也是基于现实利益的考量。在中国人的现实生活里，找不到“爱情”这两个字\u0026ndash;有时候看历史真的会看到掩卷叹息，中国人过了几千年，还是一点长进都没有啊。唐代的士族世家已经逐渐没落，但是依然地位显赫，其中以陇西李氏、太原王氏、荥阳郑氏、范阳卢氏、清河崔氏、博陵崔氏、赵郡李氏等七姓十族最为著名，一般这些世家大族互为婚姻，自惜羽毛。唐高宗时宰相李义府为子向山东士族求婚不遂，而向朝廷建议禁止七姓十族自为婚姻。可见娶个望族女子为妻，是多么的艰难啊。莺莺是姓崔的，而且“财产甚厚，多奴仆”，很自然的就联想到了清河崔氏、博陵崔氏这些世家大族；但是很奇怪的是元稹描写的张生居然抛弃了莺莺，一个出身寒族的士子抛弃了一个那么美貌温柔的世家女子，仅仅只为了他自己所谓的“予之德不足以胜妖孽，是用忍情”么？考察元某人在政治上趋炎附势的态度，我是不相信他冠冕堂皇的话的。姑且让我用自己邪恶的想法去揣测他：那个被唤作莺莺的女子必定不是什么世家望族，所以元稹为了前途而抛弃了她，之所以故意写成崔氏，只是制造了一种假象，让读者有个印象那个莺莺是世家女子，我元微之离开她只是因为好男儿不该沉溺于爱情，你看为了理想我连世家女都放弃了啊。这便是文人的下作！\n为了答谢这位刚认的远亲的救命之恩，于是请吃饭，贞元十五年十二月很快就在危机中渡过，这顿饭的时间也应该在贞元十六年的春天。当贞元十五年的大门“咣当”一声关掉，命运就载着我们的主人公来到了贞元十六年。饭局中张生曾问莺莺的年纪，“郑曰：‘今天子甲子岁之七月，终今贞元庚辰，生年十七矣。’”贞元庚辰，正是贞元十六年，那年元稹二十二岁，莺莺十七岁。\n拿破仑指示说“请客的菜一定要好”，这个世间有好多的阴谋和决策在餐桌上议定，有好多缠绵或者惨烈的故事由餐桌上发端。郑国的子宋因为吃饭的时候分不到王八汤，结果一怒就干掉了郑灵公；而我们的张生，也就是元微之同学因为吃饭认识了莺莺姑娘。这表明吃饭是一次冒险，运气好的可以吃出一段情缘，运气不好的就要丢了性命，所以列位正要去吃饭相亲的同学们，你们要小心啊。\n吃饭的时候，郑氏让儿子、女儿出来拜会救命恩人。那时侯未出阁的女子特别是大户人家的女子仿佛家之重宝，秘不见人；而郑氏却突然在一个年轻的刚认识不久的远房亲戚面前把女儿拉出来亮相，还要陪吃饭，哪怕这个年轻是救命恩人，这样的行为也是很突兀的，所以莺莺才会推三阻四的不想出来见面。郑氏这般的举动连一千多年后的我也想入非非，无疑也给了元稹兄弟很多假设的可能。不论当初的郑氏出于什么样的考虑做了这个决定，反正莺莺姑娘就此登场了。第一次召唤推说有疾，郑氏看起来很生气的说“张兄保尔之命，不然，尔且掳矣，能复远嫌乎”，这其中的话外之音，只能读者自己体会了。又过了很久，莺莺终于出场了。\n“常服睟容，不加新饰，垂鬟接黛，双脸销红而已。颜色艳异，光辉动人”，简直惊为天人啊。我们很可以理解元稹的心情，在记忆里，那个已经离开的初恋情人总是最美丽的，而那第一次的见面总是浪漫得无法言说，第一眼里情人的样貌也是美艳不可方物。但是假如当时有照相的话，看到莺莺的照片也许你会失望，那个时代普遍流行的美女的体态是肥胖丰满的，那个时代美女的画像普遍有双下巴（有些是三下巴或者更多），面颊鼓鼓外凸，因为胖所以嘴巴也被挤的小小的嘟起来，实乃人间惨剧，竟无语凝噎！幸好莺莺不加新饰，保持了一点自然状态，否则那个惨白的面容、用红颜料描出的樱桃小嘴、脸上贴的花状的金钿和浓晕蛾翅眉足足可以把你吓死。\n后面一句话很有意思：“张惊，为之礼。”张生看到莺莺那么漂亮，忙起来对她行礼。这个描写很传神，一般男子看到普通的女子，都保持一点点的风度，淡淡的仿佛视若不见；惟独见到美女，眼睛一亮，慌忙起身行礼，态度谦恭。足见莺莺之美。后来她坐到郑氏旁边，因为是郑氏强迫她出见的，所以她“凝睇怨绝，若不胜其体者”，那个样子就是《喜剧之王》里张柏芝所谓的“鹌鹑状”。如此楚楚动人的姿势，叫张生魂不守舍。问了年纪，只有十七岁，正是花季过后，果季之前，鲜脆欲滴，天真纯情的年纪啊！张生想和她找话题说话，但是莺莺就是不理睬他，一直到吃完饭也没有什么好说的。记得以前去参加一个朋友生日活动，饭桌遇上了朋友的表妹，也是一样的年轻明艳，也是一样的不理睬人，和她搭讪也装做没听见，搞得我们很没有面子，所以说，古往今来的好女孩一般都是很矜持的。由于没有机会接触，张生的思念就象潮水一样把他包围，所以他捉摸着要找个机会表白一下。\n于是他从莺莺的小伙伴，侍女红娘那边入手。这个策略在以后的无数次实践当中被证明是极端正确的。大学里你要追求某个女生，先要从她寝室的室友下手，打通所有关节，请他们吃喝玩乐，最后那个女孩子身边所有的朋友都在说你好话，那你就成功一大半了。红娘被张生吓了一跳，问了个问题：“你既然那么喜欢，何不凭借你对我们家的恩情向夫人正式提亲呢（何不因其德而求娶焉）？”张生回答的话简直有点无耻了：“我从孩童时候起，性情就不随便附合。有时和妇女们在一起，也不曾看过谁。当年不肯做的事，如今到底还是在习惯上做不来。昨天在宴会上，我几乎不能控制自己。这几天来，走路忘了到什么地方去，吃饭也感觉不出饱还是没饱。恐怕过不了早晚，我就会因相思而死了。如果通过媒人去娶亲，又要‘纳采’，又要‘问名’，手续多得很，少说也得三四个月，那时恐我也就不会在人世了。你说我该怎么办呢？（余始自孩提，性不苟合。或时纨绮闲居，曾莫流盼。不为当年，终有所蔽。昨日一席间，几不自持。数日来，行忘止，食忘饱，恐不能逾旦暮。若因媒氏而娶，纳采问名，则三数月间，索我于枯鱼之肆矣。尔其谓我何？）”先吹捧自己性格不随便，然后表明见到莺莺姑娘连这样的性情也抛掉了，再不快点接近自己，就挂掉了，哪有时间挺到纳采问名啊。我从来不知道爱一个人，居然连三四个月都无法等待，这是赤裸裸的情欲，而非爱情；张生的第一目标是得到莺莺，而非和她相爱。情欲是正常的，但是不正常的是张生光明正大的以自己的情欲作为接近的借口，在一套绚丽机巧的辞藻下，其实裹挟着的不过是阿Q对吴妈的那句“我要跟你困觉”！\n但是也许张生妇女工作做的好，红娘还真的帮他出主意，让他摇动笔杆。想来那时躲在深闺的大家闺秀并不知道外边文青的名声有多臭，结果一场悲剧上演了。\n亚里士多德《诗学》言道：“性格为悲剧六大要素之一。”毫无疑问，莺莺的性格决定了她的悲剧结局。在她的身上我们看到矜持和热情，顺从和叛逆，坚定和认命矛盾的结合在了一起。前面我们已经注意到莺莺出场时的矜持，和在她母亲召唤下不肯出来见面的叛逆，但是当她看了张生的情诗之后却用那首暧昧的《明月三五夜》作为回应，把张生招来相见。“待月西厢下，迎风户半开。拂墙花影动，疑是玉人来。”这诗不论莺莺怎么强调“犹惧兄之见难,是用鄙靡之词，以求其必至”,都无法掩盖字里行间的情意和期盼。\n二月十五的晚上，月亮大的吓人,文学青年元稹踏着美丽的月色，攀着墙边的杏花树翻过墙头投奔他的初恋去了。他来到西厢房,却只看到红娘躺在床上，双方都很奇怪。在红娘通报后，莺莺姑娘这才出现了。可能原本元大才子准备着类似“长夜漫漫，无心睡眠，没想到莺莺姑娘你也睡不着”之类的桥段，可是如此以来完全用不上了，而且莺莺姑娘一身包裹严实，表情严肃，狠狠地训斥了他一顿，然后扬长而去。元大才子只好承认都是月亮惹的祸，那样的月色太美太温柔，于是绝望了。元稹没有写他失恋后寻死觅活，更不像他自己说的“索之于枯鱼之肆”。但是很吊诡的是三天后莺莺就自荐枕席了。鉴于这段情节的突兀，《董解元西厢记诸宫调》里就设计了张生患相思病，莺莺探病的情节，王实甫也继承发扬了这段情节。这段情节看似让整个的故事情节更加合理，也让人物性格和心理有一定的起承转合，但其实是画蛇添足的一笔。\n莺莺是一个性格矛盾的人，她对待未知的将来既期待又恐惧，她知道自己所做的是不容于世的，但是她对于爱情满怀憧憬而渴望冒险。在爱情的冲动下，她一步步滑向张生的怀抱。也许从第一次出来见这个救命恩人的时候，她便已经心存好感，起码我们知道张生的相貌世让人赏心悦目，这是爱情的基础；当看到张生的两首诗，更加倾慕于他。唐代的女孩子也和现在的女孩子一样，有自己心目中的白马王子。也许那个时代比较流行的梦中情人形象，就是元稹这样的才子。于是她情不自禁回了一首诗，也许只是想见他一面，但是理智告诉她这样做法的危险性。也许在红娘去通报的时候，她还在那里犹豫到底要不要去见。最后她决定去看一眼那个自己衷情的男子，她穿戴齐整。当爱上一个男人的女子，在那个男人面前总是很低很低,低到尘埃里,尘埃里便开出花来，于是她潜意识的想保持自己的尊严，她不想被他看成是轻薄的女子。她终于见到了他，在月色下，俊朗的男子期盼地看着自己，眼神顾盼之间，让人心旌摇荡；那淡淡的笑容，刚毅的嘴角，也许随着那夜的月色一起留在莺莺地记忆深处。她发觉自己陷入一种前所未有的危机，一种爱上别人为了那男子可以不顾一切的冲动，于是她板下脸来，义正词严地拒绝了那个男子。“非礼之动，能不愧心？特愿以礼自持，毋及于乱！”这些话在我看来倒有一大半是在对自己萌动的心说的，莺莺在警告自己不要逾越了礼，否则将万劫不复。男子一脸地失望，仿佛满地月光都成了严霜。她还是转身离去。但是正如元稹在《会真诗》里所写的“戏调初微拒，柔情已暗通”。我不知道莺莺在这三天里是如何地心情，我也不知道其中红娘起了多大地作用，但是我知道到了十八日的晚上，莺莺终于做了自己一生中最重要的决定。\n“数夕，张生临轩独寝，忽有人觉之。惊骇而起，则红娘敛衾携枕而至，抚张曰：‘至矣！至矣！睡何为哉！’并枕重衾而去。张生拭目危坐久之，犹疑梦寐；然而修谨以俟。俄而红娘捧崔氏而至。至，则娇羞融冶，力不能运支体，曩时端庄，不复同矣。是夕，旬有八日也。斜月晶莹，幽辉半床。”唐贞元十六年二月十八日的夜晚，那一夜的经历对于元稹来说是如此的深刻，以至于很久以后依然清楚的记得那天的日期，那夜的月色。元稹在《会真诗》里清楚地描写了缠绵的经过，在千年之后的人们看来，那诗依然写得香艳露骨，荡人心旌：“微月透帘栊，萤光度碧空；遥天初缥缈，低树渐葱茏……低鬟蝉影动，回步玉尘蒙；转面流花雪，登床抱绮丛；鸳鸯交颈舞，翡翠合欢笼；眉黛羞频聚，朱唇暖更融；气清兰蕊馥，肤润玉肌丰；无力慵移腕，多娇爱敛躬；汗光珠点点，发乱绿松松……”。在晶莹的斜月下，天真善良的莺莺投奔了爱情，为了自己心爱的男子，为了梦想中的爱情，抛弃了一切，奉献了一切。也许古往今来有很多的人有这般的经历，曾经真心单纯地去爱一个人，为他（她）付出了一切。不管结果如何，起码在那一刻，付出的人是幸福的，虽然这样的幸福可能是要遭到报应的。\n在现代人的眼光来看，莺莺这床也上的太快了些。其实这还不算彻底的，汉代的司马相如不过弹了次琴，卓文君便跟着他私奔了，连富翁老爹也不认了。那个时代，女子应允了一份爱情就等于一生一世，不会再有给你重来改过的机会。那是个严肃的时代，女子地位低下，虽然相对于其他朝代，唐朝的风气算是比较开明宽松，但是逾越礼制的爱情依然不容于世，和一个男子相恋，要么嫁给他，要么就是再也得不到幸福和爱情。如那位被元稹好友白居易赞为“醉娇胜不得，风嫋牡丹花”的徐州名妓关盼盼，在其丈夫徐州守帅张愔死后却被白居易讽刺她不肯殉情，逼得她不得不绝食自尽；又如步非烟，因为父母之命而嫁于功曹参军武公业，毫无爱情可言，于是她红杏出墙，爱上了攻读课业的书生赵象，被丈夫发现后，只是淡淡说了句“生既相爱，死亦何恨”，于是从容淡定，任凭丈夫拷打，不肯开口求饶一句，最后终于被活活打死，以暴疾而亡的名义埋了。那个时代的女子，很少可以拥有幸福的爱情，所以这充分体现了新社会的优越性，起码你谈几场恋爱没有关系，女孩子只要不失身还是会有幸福的。\n红娘把枕头也带来了,在古时候,共同倚靠的枕头是充满暗示意味的情物，是在一起温柔缠绵的明证。本朝初年高阳公主嫁于房玄龄之子房遗爱为妻，却不爱房遗爱，在新婚之夜就把新郎拒于洞房之外。高贵的公主爱上了玄奘的高徒、最年轻却最聪慧的高僧辩机和尚，那时高阳公主十六岁，辩机和尚二十一岁。高阳公主送给辩机一个“金玉宝枕”，却被小偷偷出。结果事情因此泄露，高贵的辩机被腰斩于市，而高阳公主也一辈子恨上了自己的家族，“帝崩无哀容”。或许唐代的女子血液里奔流着冒险的因子，所以为了爱情不顾一切，哪怕被抛弃被鄙夷被万夫所指天地不容也再所不惜。于是整个唐朝给我们后人留下了一大堆让人向往的爱情故事。莺莺对待爱情的勇气，无疑是秉承了大唐女子一贯的风气，虽然她的命运因此让人心痛，但是她的形象也因此让人爱怜，在千百年后的今天依然让我爱慕钦佩。\n“有顷，寺钟鸣，天将晓。红娘促去。崔氏娇啼宛转，红娘又捧之而去，终夕无一言。”如此“金风玉露一相逢”的时光过的总是很快，古寺的朝钟响起，天快亮了，莺莺也要离去了。对于类似的幽会后的早晨，《诗经》里便有很细致的描述：《郑风·女曰鸡鸣》里写道“女曰鸡鸣，士曰昧旦；子兴视夜，明星有烂”，女子在催促说“鸡已经在打啼了”，男子眷恋枕衾，“天还没全亮；你起身看夜空，启明星还闪闪发光”，然后慢慢谈到工作，谈到两个人的未来，谈到恩爱到白头，“宜言饮酒，与子偕老。琴瑟在御，莫不静好”；《齐风．鸡鸣》里写道“鸡既鸣矣，朝既盈矣。匪鸡则鸣，苍蝇之声。东方明矣，朝既昌矣。匪东方则明，月出之光”，女子催促男子快起身，男子淹留不肯，“那不是鸡叫，是苍蝇嗡嗡声，东边也没亮，那是月亮光而已”，回答言语可爱缠绵。钱钟书说：“莎士比亚剧中写情人欢会，女曰：‘天尚未明，此夜莺啼，非云雀鸣也。’男曰：‘云雀报曙，东方云开透日矣。’女曰：‘此非晨光，乃流星耳。’用以比勘。”但是我们注意到，莺莺和张生一夜缠绵，居然不交一词，只是在天明将别的时候，呜咽哭泣。这个写法相当传神，我们可以从那“山盟海誓”的缺失和离别时的哭泣，感受到莺莺内心的矛盾：她明知道她正在做一件可能万劫不复的错事，但是却无法控制内心对于张生的情意，爱情的那种使双方合二为一的强烈愿望战胜了对命运的恐惧，她不敢说话，因为说话就代表了清醒，她宁愿在一种迷醉的状态下委身于自己的爱人，抛却一切利益的得失、道德的禁梏；当天明将别，她仿佛恍然从梦中惊醒，好象做错了事的孩子一样，为自己的选择和命运哭泣，为自己所失去的哭泣。当然在这眼泪之中，对于离别的伤感，也占了一定的比重，所以在未来的十多天里，她再也没有和张生联系。\n直到张生“赋《会真诗》三十韵，未毕，而红娘适至，因授之，以贻崔氏”，才又来与张生相会。想来未完的《会真诗》是个很好的说服自己的借口，只是来探讨文学罢了，但是总免不了“向谁行宿,不如休去”的挽留。于是这样相处了将近一个月。\n“张生常诘郑氏之情，则曰：‘我不可奈何矣。’因欲就成之。”这是最常见的断句，莺莺说：“我没有办法告诉她。”于是张生便想亲自和郑氏谈谈，促成这件事。但是见家长的事突然没有下文，很快张生也去了长安，这样的情节安排无论如何都是不通的。幸好还有另外一个版本：“张生常诘郑氏之情，则曰：‘知不可奈何矣，因欲就成之。’”莺莺说她妈知道也没其他办法了，所以想促成我们的婚事。他们相处同居了一个月，而寺院内有崔家那么多的仆役，就算郑氏再昏懵，也应该了解到女儿的事情了。事已既此，无可奈何，女儿大了，心向外人，现在也只能期盼那男人能负责任把她娶去了。这样的心情很可以理解，我的一个朋友，和她女朋友两地分居，而且女孩子在当地做了教师，不错的职业，眼看因为家里反对要分手了，但是有天女孩子的父母偷听他们的电话，知道了女儿已经失身于我的朋友，于是第二天就让女儿把我的朋友叫去见面，很快便结了婚。所以很多时候，我都分不清自己到底是生活在古代还是生活在现代，一千多年下来，对待某些问题的做法还是一点都没变化。\n但是张生可能很害怕被一桩寒门的婚姻套牢，一听这话赶快跑路；于是借口“为了梦想中金碧辉煌的长安,都市里充满了神奇的历险,满足一个男儿宏伟的心愿”，西下长安去了。去之前还先告诉了莺莺，“崔氏宛无难词，然而愁怨之容动人矣”。有一种哀伤，是哭不出来的，它会慢慢渗透进你的骨子，日日夜夜一点一滴地侵蚀你的情绪。或许她害怕自己会控制不住自己面对离别的悲伤，所以在张生将要走的第二天晚上，莺莺没有来。我总是不能理解女子的心思，明明想念你的，却不肯见面；明明想把你留下的，却早早地说出一路顺风的祝福；明明在说没有留下更多的甜蜜回忆，却连分手了也不肯来见最后一面，谁都无法想见女子的心里到底在想些什么，或许正是这样的复杂，才成就了莺莺形象的丰满。\n但是很快，张生又回到了蒲州，又与莺莺相处了好几个月，也许是他无法放下这段感情，也许是长安尚未有“实现一个男儿宏伟志向”的机会，更可能是长安还没那么早开考，想最后的缠绵一下。莺莺的字和文章写的都很好，却从不给张生看；她写文章的水平很好，但是却好象什么都不懂的样子；她言辞敏捷，但是在外人面前却很少说话。或许这样的女孩子最是让人怜爱。“待张之意甚厚，然未尝以词继之。时愁艳幽邃，恒若不识，喜愠之容，亦罕形见”，莺莺是个内向的女孩子，有了情绪却不轻易流露，她不会口口声声地和你说“我爱你”，但是连她注视你的目光都能让你感到无限柔情，你无法知晓她的想法，但是却沉溺于她时时流露的情意。她喜欢弹琴来抒发情感，可能是心情忧郁，所以弹奏的曲子异常伤感。\n不久张生便要去长安应试了，或许是下了决心终要割断前缘，一心功名，所以这个男人连说分手的勇气都没有，只能对着莺莺忧愁哀叹，自然他也是不肯去承诺些什么的。莺莺自然明白他的心思，面对爱人的负心薄情，做为一个弱女子又能说什么呢。莺莺是个坚强而又自尊的女子，她不会低声哀求张生留下，她态度恭敬，声音柔和，慢慢地对张生说：“始乱之，终弃之，固其宜矣，愚不敢恨。必也君乱之，君终之，君之惠也。则没身之誓，其有终矣，又何必深感于此行？然而君既不怿，无以奉宁。君常谓我善鼓琴，向时羞颜，所不能及。今且往矣，既君此诚。” 莺莺平静的面容下说出“始乱之，终弃之，固其宜矣，愚不敢恨”那是怎样的一种心痛呢，假如仅仅是个人爱情的失败也就罢了，但是其中还昭显出整个家族的衰败和老母最后一丝期望的落空。人很多时候并非为自己而活，所以人最不能承受的并非自身的失败，而是自身的失败给自己亲爱之人所带来的伤害。张生挥一挥衣袖，固然不带走一片云彩，还可以得到时人“善补过者”的赞誉，但是对于莺莺来说，不但她这一生的命运已经凄惨无疑，而且也给了她衰颓式微的家族一次重重的羞辱和打击。\n她终于明白了“则没身之誓，其有终矣”，古往今来男女说着“山无陵，江水为竭，冬雷阵阵，夏雨雪，天地合，乃敢与君绝”的誓言，可大多数的人言语远比自身华丽，现实远没有恶化到世界末日，便已经支持不住，爱情一如华美的琉璃，碰触现实难免粉碎。\n于是她为自己心爱的男子弹了最后一首曲子《霓裳羽衣曲序》，琴声因为心情悲伤而纷乱错杂，旁边的人都听着流泪，她终于弹不下去，扔下琴哭着跑到母亲的房里，再也没出来。在这部作品里，郑氏出场只有一次，侧面描写也并不多，但是我们却依然能想象一千多年前那位母亲的悲痛，为自己的命运，为家族的命运，更为自己女儿的命运感到悲伤。\n第二天我们的元大才子便神清气爽地踏上西去长安的路途，但是那年他没有考中。于是他留在了长安，从莺莺的信中我们了解到，这个鄙薄的文青曾托人给莺莺寄去一封信，让她看开些，“以广其意”，顺便送去“花胜一合、口脂五寸”做为分手礼物。唐代女子喜欢用绢纸、金银等材料做出一朵朵花形的小物件，贴在脸上，唐代就称之为“花胜”或者“花钿”。元稹很潇洒地给分手后的情人送去长安最时尚的化妆品和首饰，想以此来弥补内心的愧疚。但凡女子都爱最新潮时尚的化妆品，犹以情人所赠为甚；但是我不知道淹留蒲州普救寺的母女，在这个穷乡僻壤突然看到负心的男人送来长安的时尚货色，会是怎样的心情，或许如后世李清照所言“泪融残粉花钿重”。\n孤独无望地留在普救寺的莺莺回了一封信，那信却被张生炫耀于长安的朋友之间。就好象胡兰成把曾与他恩爱缠绵的女子都写进《今生今世》，古今文人下作起来都是一样。\n对于自己的负心，元稹还借用了《左传》那句“夫有尤物,足以移人,苟非道德,则必有祸”，义正词严地发表了一通高论：“大凡天之所命尤物也，不妖其身，必妖于人。使崔氏子遇合富贵，乘宠娇，不为云为雨，则为蛟为螭，吾不知其变化矣。昔殷之辛，周之幽，据百万之国，其势甚厚。然而一女子败之，溃其众，屠其身，至今为天下戮笑。予之德不足以胜妖孽，是用忍情。”最可怕的是听众的反应，“于时坐者皆为深叹”，大家叹口气，居然没人指责张生的负心薄幸，或者有一点小小的同情给予莺莺。\n对于美貌女子的恐惧，其实不过只是自身懦弱的借口罢了，男子严于律女子，宽于律己，实在是很无耻。《世说新语》里记载着石崇宴客让美人劝酒，如客人不饮，便杀掉劝酒的美人。有一次丞相王导和大将军王敦去赴宴，王导不善饮酒，也只好勉强自己喝，以至于喝醉了；而王敦死活不肯给面子，就是不喝，“已斩三人，颜色如故，尚不肯饮”。而此事，却被刘义庆归为“汰侈”，意思是奢侈浪费。在这里我们看到的是人正常情感的缺位，对于爱情和女性的残忍，却成了男子气度的象征。记得唐代曾有一个很出名的事件：军官冯燕，和同事张婴的漂亮老婆私通，张婴酗酒而归，冯燕逃避不及，只好藏到床底，却发觉自己的头巾还留在枕边，幸好张婴喝醉了并没发觉。于是冯燕指指头巾示意张妻把头巾取来免得事情败露，可是张妻会错了意，竟把枕边张婴的佩刀递给了他。冯燕看了张妻几眼，觉得这个女人太狠毒，就一刀砍下了张妻的头，然后戴上头巾走了。张婴于是就被认为杀害自己的妻子，被判死刑；结果在刑场上，冯燕出现了，他宣称张婴是无辜的，张妻是自己杀的。军政长官贾耽将此案据实上奏，并表示，宁愿免去自己的官职，也要为冯燕赎罪。最后皇帝的敕令是，将滑地的全部死刑犯同时赦免。这件案子影响很大，以至于那个时代的流行小说家沈下贤专门为之创作了传奇《冯燕传》；著名诗人司空图则写了长篇叙事诗《冯燕歌》，其中有一句诗写道“已为不平能割爱”，也就是说为了所谓的道德规范，能割舍爱情的才是大英雄。于是世情普遍鄙薄男欢女爱，积极培养冷血寡情的人，于是婚姻便成利益的交换，所谓的爱情只能沦落到勾栏瓦舍里去了。对比西方，希罗多德《历史》曾讲过吕底亚王坎道列斯的故事。坎道列斯认为自己的妻子是世上最美丽的女子，于是他想拿来炫耀了，他强迫他的亲信巨吉斯看王后的身体，以便确认这一点；不得已，巨吉斯只好藏在卧室，看了王后的身体。王后知道此事后，认为是奇耻大辱，就将巨吉斯召来，给他两个选择：要么他杀掉国王，“变成我的丈夫并取得吕底亚的王位”；要么被处死。结果巨吉斯选择了前者，他杀死了国王，并娶了王后，登上了吕底亚的王位。我们从中可以看到东西方文明对待情欲的差别。遗风留至如今，家里关心你的结婚对象，不是双方有多么相爱，感情有多深厚，而是这个人家里怎样，是不是老实，有没有本事赚钱升官；假如你斗胆和他们说起你们的爱情，于是大家都开始哄堂大笑或者不屑一顾，仿佛看你就是一个不成熟的孩子、精神错乱的病人。对于爱情的信仰，或许只存在于看戏的那段辰光。\n有了这样一种社会心理氛围，再加上有太子少保韦夏卿的赏识，那么元稹抛弃寒门女子莺莺而迎娶豪门韦家的千金韦丛，也就顺理成章了。但吊诡的是在蒋防写的《霍小玉传》里，元稹的老丈人韦夏卿却对负心薄行的朋友李益这般说：“风光甚丽，草木荣华。伤哉郑卿，衔冤空室！足下终能弃置，实是忍人。丈夫之心，不宜如此。足下宜为思之！”蒋防此人在仕途上得到过元稹的推荐，所以他写及元稹的岳父时总要润色拔高一下，只是他的恩公看到这番话时是否会心头一颤？\n或许是虬髯客已没，不会再有人“衔之十年”也要去取“天下负心者”的头颅心肝下酒，所以男人也就越发理直气壮地负心薄幸。负心人元稹没有得到什么报应，又过了一年多后，也就是贞元十九年他登拔萃科，署秘书省校书郎，娶了韦夏卿之女韦丛为妻，并在那一年与同中书判拔萃科的白居易相识订交，从此元白之名满天下。元稹在《梦游春七十韵》中写道：“当年二纪初，嘉节三星度……韦门正全盛，出入多欢裕。”在元稹志得意满，欢娱畅快之时，莺莺也匆匆嫁于他人了。后来元稹偶然路过莺莺居住的地方，以莺莺表兄的身份求见，终不得一见。莺莺的不复相见，是对情人的深深失望，或许她会深深的认同鱼玄机说的“易求无价宝，难得有情郎”；她没有霍小玉那般刚烈，她也许也会哀怜自己“我为女子，薄命如斯，是丈夫负心若此”，但她却说不出“我死之後，必为厉鬼，使君妻妾，终日不安”的话。莺莺只写了首诗给元稹，硬着骨头咬着牙说“弃置今何道，当时且自亲”，既然都已经分开了不爱我了又有什么好说的呢，当时恩爱缠绵也就足够了，让他“还将旧时意，怜取眼前人”，因为懂得，所以慈悲。当爱情归于寂寥，繁华消于落寞，一切都只存在与记忆里，曾经的美好，只能活在心底。“惆怅旧欢如梦，觉来无处追寻”。或许她也明白，往事只能追忆，不可重温。曾经年少单纯的莺莺已经死了，只留下一具逐渐衰老的躯壳和悲伤的灵魂继续苟活。现实那样丑恶，我们却不得不活下去。\n我真的怀疑元稹所谓的“曾经沧海难为水，除却巫山不是云”到底指哪一位，是莺莺，还是韦丛，抑或是薛涛？元和四年，韦丛去世，元稹写了三十三篇诗来悼念她，其中最有名的一句：“惟将终夜长开眼，报答平生未展眉。”根据陈寅恪先生的考证，这个“长开眼”不仅仅是睡不着的意思，“所谓‘常开眼’者，自比鳏鱼（有“鳏鱼眼长开”这一说法），即自誓终鳏之义”（陈寅恪《元白诗笺证稿》），元稹信誓旦旦的要为韦丛终生不娶，鳏孤到死了。但事实证明，元稹是个文过饰非的人，在韦丛凑趣去世的那年，他邂逅薛涛，两人相恋了一年后将之抛弃，可怜薛涛为之终身不嫁，“只欲栏边安枕席，夜深闲共说相思”；两年后纳妾安氏，又过数年续弦裴淑。简直是“取次花丛频回顾”啊！所以观陈寅恪先生对其评价“自私自利。综其一生行迹，巧宦固不待言，而巧婚尤为可恶也。岂其多情哉？实多诈而已矣”并不为过。\n读《元长庆集》，常免不了痛恨为什么如此深情优美的诗句却出自一个那么薄情负心的伧夫之手。雪莱在《致云雀》中说：“我们最甜美的歌，就是那些倾吐最哀伤的思想的。”不知道元稹所哀伤的到底是什么。贝克尔在《抗拒死亡》中说的：“所有动人心弦的事中，对死的恐惧是首当其冲的。”他的悼亡诗写的那么情深意切，大概是出于对死亡本身的恐惧和悲哀吧。\n或许不该过分指责元稹，他也不过是为了功名奔波的庸人，这个世界原本就是为庸人所设的。太过恩爱的情侣总是不容于世：苏东坡与王弗已是“十年生死两茫茫”了；陆游和唐婉儿只能“一怀愁绪，几年离索”；刘克庄在哀叹“旧日风烟草树，而今总断人肠”；冒辟疆和董小宛“一生清福,九年占尽,九年折尽矣”；还有纳兰性德，感慨着“被酒莫惊春睡重，睹书消得泼茶香，当时只道是寻常”。但是起码他们是能真心相爱的，就算不能“执子之手，与子偕老”，起码也是“骨化形销而丹诚不泯”，却可怜了单纯的莺莺，一个人用余生去背负全部的思念、悔恨和指摘。\n史籍上再没有关于莺莺以后生活的记载，或许她一生坎坷，慢慢地消磨了纯真善良，成了世间常见的庸俗势利的妇人。但哪怕是这样，我依然相信在她心底的最幽深隐蔽的角落、最柔嫩脆弱的地方，记忆会像一把锯齿慢慢地来回剧着那根最纤细的神经，午夜梦回的时候，依然会为贞元十六年的那个男子泪流满面。\n我怕我鄙薄的文字无法完美地译出那女子悲伤的文字，且让我们再细细读一读那信的原文,体会一下她的心情吧：\n捧览来问，抚爱过深。儿女之情，悲喜交集。兼惠花胜一合、口脂五寸，致耀首膏唇之饰。虽荷殊恩，谁复为容？睹物增怀，但积悲叹耳。伏承使于京中就业，进修之道，固在便安。但恨僻陋之人，永以遐弃。命也如此，知复何言！自去秋已来，常忽忽如有所失。于喧哗之下，或勉为语笑，闲宵自处，无不泪零。乃至梦寐之间，亦多感咽离忧之思。绸缪缱绻，暂若寻常，幽会未终，惊魂已断。虽半衾如暖，而思之甚遥。一昨拜辞，倏逾旧岁。长安行乐之地，触绪牵情。何幸不忘幽微，眷念无斁，鄙薄之志，无以奉酬。至于终始之盟，则固不忒。鄙昔中表相因，或同宴处。婢仆见诱，遂致私诚。儿女之心，不能自固。君子有援琴之挑，鄙人无投梭之拒。及荐寝席，义盛意深。愚陋之情，永谓终托。岂期既见君子，而不能定情，致有自献之羞，不复明侍巾帻。没身永恨，含叹何言！倘仁人用心，俯遂幽眇，虽死之日，犹生之年。如或达士略情，舍小从大，以先配为丑行，以要盟为可欺，则当骨化形销，丹诚不泯，因风委露，犹托清尘。存没之诚，言尽于此。临纸呜咽，情不能申。千万珍重，珍重千万！玉环一枚，是儿婴年所弄，寄充君子下体所佩。玉取其坚润不渝，环取其终始不绝。兼乱丝一绚、文竹茶碾子一枚。此数物不足见珍，意者欲君子如玉之真，弊志如环不解。泪痕在竹，愁绪萦丝，因物达情，永以为好耳。心迩身遐，拜会无期。幽愤所钟，千里神合。千万珍重！春风多厉，强饭为嘉。慎言自保，无以鄙为深念。\n","permalink":"/post/c0-life/readings/yingyingzhuan/","summary":"\u003cblockquote\u003e\n\u003cp\u003e《西厢记》的书评:『琉璃易碎，人言易坠——关于《莺莺传》的叙事』转载\n…全文:\u003ca href=\"https://www.douban.com/doubanapp/dispatch?uri=/review/1200691/\"\u003e(豆瓣link)\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e“半欲天明半未明，醉闻花气睡闻莺。 狌儿撼起钟声动，二十年来晓寺情。 ”男人四十的元微之写着酸酸的诗，回忆年少风流。假如我是元微之，我一定会这般写道：天空尚未亮透，微微透着点光，远处传来钟声，让我的思绪一下子回忆到二十年前，也是这样的一个早晨，在那所古寺的西厢，那个散发着鲜花一样香气的女子，用鸟儿般宛转的声音在我耳边低语：“钟声响了，想来我也该回去了。”那声音一直萦绕在耳边，十年、二十年、也许一辈子在我在记忆深处响起……。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e夜宿古刹，偶遇佳人，相伴遥夜，缠绵缱绻，天明而别。这样的际遇，是最最典型的古代书生的爱情幻想。在一个陌生的地方，遇到一个陌生人，发生一段有始无终的感情。书生注定要做个过客，一生漂泊在对那个女子的思念中，却没有勇气长相守。\u003c/p\u003e\n\u003cp\u003e当我还是一个初中生的时候，我买来人民文学出版社的《西厢记》，上面盖本教科书，堂而皇之的上课看。但是很快，除了王实甫那华丽的辞藻，整个大团圆的故事构架让我兴趣索然，而前言里现代人给它冠上的什么“礼教叛逆者反抗封建卫道士”的宏大内涵更让我倒尽胃口。\u003c/p\u003e\n\u003cp\u003e在书后还附着元稹的《莺莺传》。《莺莺传》所描写的其实只是两个人的故事，两个恋爱的人后来分开的故事，没有太宏大的叙事，没有那些官腔的说教和露骨的批判。这样的故事是我所喜的；这样的故事，也是中国文人所津津乐道的。关于类似内容的作品也就汗牛充栋，数不胜数。或许从《诗经》的“氓之蚩蚩，抱布贸丝”开始，就没有谁打算给自己的爱情故事赋予太宏大的命题，只是后来的人突然犯失心疯，发现了字里行间的微言大义。所以我很景仰孔夫子他老人家，他的《论语》里每一个字都可以养活一大批的圣贤大师。\u003c/p\u003e\n\u003cp\u003e元稹的这篇传奇被人考据出是以自己为原型的故事，是一篇忏悔录。忏悔的味道我闻不出来，但是众前辈大师言之凿凿说张生便是元大才子，那我也就相信了罢。\u003c/p\u003e\n\u003cp\u003e《莺莺传》的开头，交代道“在贞元年间，有位张生，他性格温和而富有感情，风度潇洒，容貌漂亮，意志坚强，脾气孤僻”。古人向来有画脸谱的习惯，只要不是丑的太离谱，一般的名士贤臣都被描写成“性温茂，美风容”之类。但是据说元稹的家族是著名的鲜卑拓跋，鲜卑人的美貌是相当出名的，就好象现在说日本人长的猥亵一样出名，所以我有理由相信，元稹在这点上也许没有吹牛。\u003c/p\u003e\n\u003cp\u003e文章写道“以是年二十三，未尝近女色”，后面他自己解释道“登徒子非好色者，是有凶行；余真好色者，而适不我值。何以言之？大凡物之尤者，未尝不留连于心，是知其非忘情者也”，就仿佛现在的大学男生在卧谈会上被迫承认自己二十三岁高龄还是个处男，被人取笑之下只好解释“其实我哪里是没能力啊，我只是没遇到真正让我心动的；一般的庸脂俗粉我看不上眼，要是真有出类拔萃的，我也会追的。我是谈感情的，和你们玩肉体的垃圾是不一样的”诸如此类。但是考察元稹的家庭情况，他八岁丧父，在家族里又被同父异母的兄弟欺凌，从小随着母亲投奔舅氏，生活贫困，母亲教她念书。我们可以想象，一个幼年便寄人篱下，遭受贫困欺凌的味道，他只比林黛玉多了一个母亲而已，但是林黛玉在物质生活上绝对比他适意。我们的脑海里可以浮现这样一个人物性格：幼年丧父的人，对于男人所称道的齐家治国平天下之类的宏伟功名有着不同于常人的热情和执著，范仲淹就是很好的例子，所以元稹在事业上一直很上进努力，为达目的不惜代价不择手段，由于尝尽人情冷暖世态炎凉，他很敏感，这样的人物让我想到了《红与黑》里的主人公于连；他自幼由一个母亲抚养成人，一般这样的人具有恋母情结，对于女性有异于常人的喜好，所以他的性格里又有滥情懦弱的一面。多情和薄幸，坚毅和懦弱，正义和无耻都矛盾地体现在他身上，这也就能让我们更好的理解他后来为了追求功名而抛弃莺莺的举动了。由于家境贫寒，极端律己，自卑和敏感的元微之“内秉坚孤，非礼不可入”，就算偶尔参加朋友一起的游宴——古人的游宴和现在去歌舞厅唱歌跳舞一样，一般都安排了色情服务——“扰杂其间，他人皆汹汹拳拳，若将不及”，而他“容顺而已，终不能乱”。我不清楚他是不是冬天还要帮别人洗衣服赚钱，但是可以肯定他不会参与打牌这样不合礼仪的活动，所以也就不会有谁去污蔑他打牌作弊，不会有“樗蒲不胜，槌杀四生”的惨剧了。\u003c/p\u003e\n\u003cp\u003e在这里他第一次提到“物之尤者”，后面他还有段很著名的话也提到“尤物”，为自己抛弃莺莺的行为做解释“大凡天之所命尤物也，不妖其身，必妖于人”。如此看来，仿佛我们的元大才子是个叶公好龙式的人物，这边在说假如能遇到尤物一定会动真情，那边厢却在说尤物不害她自身，必定祸害他人。没有得到的时候千方百计的追求，到手以后又不迭地甩掉去追求新的目标。人总是这样矛盾的动物，永远不明白自己所追求的到底是什么。我们知道最后元稹娶了豪门韦家的女儿为妻，使得他在仕途平步青云。于此，我们不妨看成是理智和情欲的对立，一边是代表事业投机的豪门韦家联姻的机会，而一边只是爱过的漂亮的女子，理智告诉他应该离开那个女子，但是情欲却欲罢不能，但是最后我们知道理智战胜了情欲，感情只好盘踞在文字里去凭吊，所以元微之为我们贡献了很多首脍炙人口的情诗。\u003c/p\u003e\n\u003cp\u003e后来，张生，也就是元稹路过蒲州，搭救了寄住在普救寺的崔家寡妇一家。“是岁，浑瑊薨于蒲，有中人丁文雅，不善于军，军人因丧而扰，大掠蒲人。……先是张与蒲将之党有善，请吏护之，遂不及于难。十余日，廉使杜确将天子命以总戎节，令于军，军由是戢。”据《旧唐书·德宗纪》，贞元十五年十二月，河中绛州节度使浑瑊卒，以同州刺史杜确为河中尹、河中绛州观察使。元稹在贞元九年举明经科，并于贞元十五年在河中府任卑职，所以他和蒲将之党有交情，打个招呼关照一下也在情理之中；但据唐代举士制度，士之及第者还需要经过吏部考试才能正式任命官职，所以我们可以推测出在贞元十五年年底的时候，元稹便上路去长安应考，于是在蒲州遇上了莺莺一家。\u003c/p\u003e\n\u003cp\u003e我们知道这篇传奇是有虚构的成分，就如元稹在里边成了张君瑞，但是有一点细节仍然需要注意的，就是莺莺家族的姓氏。在唐朝时候，年轻人普遍的梦想有两个，金榜题名，娶七姓女；就如同现在的大学生的梦想，考上公务员，讨个有钱人做老婆。娶个有钱人做老婆可以少奋斗十年，这是基于现实利益的考量，而娶七姓女等于瞬间提升了自身家族的社会层次，也是基于现实利益的考量。在中国人的现实生活里，找不到“爱情”这两个字\u0026ndash;有时候看历史真的会看到掩卷叹息，中国人过了几千年，还是一点长进都没有啊。唐代的士族世家已经逐渐没落，但是依然地位显赫，其中以陇西李氏、太原王氏、荥阳郑氏、范阳卢氏、清河崔氏、博陵崔氏、赵郡李氏等七姓十族最为著名，一般这些世家大族互为婚姻，自惜羽毛。唐高宗时宰相李义府为子向山东士族求婚不遂，而向朝廷建议禁止七姓十族自为婚姻。可见娶个望族女子为妻，是多么的艰难啊。莺莺是姓崔的，而且“财产甚厚，多奴仆”，很自然的就联想到了清河崔氏、博陵崔氏这些世家大族；但是很奇怪的是元稹描写的张生居然抛弃了莺莺，一个出身寒族的士子抛弃了一个那么美貌温柔的世家女子，仅仅只为了他自己所谓的“予之德不足以胜妖孽，是用忍情”么？考察元某人在政治上趋炎附势的态度，我是不相信他冠冕堂皇的话的。姑且让我用自己邪恶的想法去揣测他：那个被唤作莺莺的女子必定不是什么世家望族，所以元稹为了前途而抛弃了她，之所以故意写成崔氏，只是制造了一种假象，让读者有个印象那个莺莺是世家女子，我元微之离开她只是因为好男儿不该沉溺于爱情，你看为了理想我连世家女都放弃了啊。这便是文人的下作！\u003c/p\u003e\n\u003cp\u003e为了答谢这位刚认的远亲的救命之恩，于是请吃饭，贞元十五年十二月很快就在危机中渡过，这顿饭的时间也应该在贞元十六年的春天。当贞元十五年的大门“咣当”一声关掉，命运就载着我们的主人公来到了贞元十六年。饭局中张生曾问莺莺的年纪，“郑曰：‘今天子甲子岁之七月，终今贞元庚辰，生年十七矣。’”贞元庚辰，正是贞元十六年，那年元稹二十二岁，莺莺十七岁。\u003c/p\u003e\n\u003cp\u003e拿破仑指示说“请客的菜一定要好”，这个世间有好多的阴谋和决策在餐桌上议定，有好多缠绵或者惨烈的故事由餐桌上发端。郑国的子宋因为吃饭的时候分不到王八汤，结果一怒就干掉了郑灵公；而我们的张生，也就是元微之同学因为吃饭认识了莺莺姑娘。这表明吃饭是一次冒险，运气好的可以吃出一段情缘，运气不好的就要丢了性命，所以列位正要去吃饭相亲的同学们，你们要小心啊。\u003c/p\u003e\n\u003cp\u003e吃饭的时候，郑氏让儿子、女儿出来拜会救命恩人。那时侯未出阁的女子特别是大户人家的女子仿佛家之重宝，秘不见人；而郑氏却突然在一个年轻的刚认识不久的远房亲戚面前把女儿拉出来亮相，还要陪吃饭，哪怕这个年轻是救命恩人，这样的行为也是很突兀的，所以莺莺才会推三阻四的不想出来见面。郑氏这般的举动连一千多年后的我也想入非非，无疑也给了元稹兄弟很多假设的可能。不论当初的郑氏出于什么样的考虑做了这个决定，反正莺莺姑娘就此登场了。第一次召唤推说有疾，郑氏看起来很生气的说“张兄保尔之命，不然，尔且掳矣，能复远嫌乎”，这其中的话外之音，只能读者自己体会了。又过了很久，莺莺终于出场了。\u003c/p\u003e\n\u003cp\u003e“常服睟容，不加新饰，垂鬟接黛，双脸销红而已。颜色艳异，光辉动人”，简直惊为天人啊。我们很可以理解元稹的心情，在记忆里，那个已经离开的初恋情人总是最美丽的，而那第一次的见面总是浪漫得无法言说，第一眼里情人的样貌也是美艳不可方物。但是假如当时有照相的话，看到莺莺的照片也许你会失望，那个时代普遍流行的美女的体态是肥胖丰满的，那个时代美女的画像普遍有双下巴（有些是三下巴或者更多），面颊鼓鼓外凸，因为胖所以嘴巴也被挤的小小的嘟起来，实乃人间惨剧，竟无语凝噎！幸好莺莺不加新饰，保持了一点自然状态，否则那个惨白的面容、用红颜料描出的樱桃小嘴、脸上贴的花状的金钿和浓晕蛾翅眉足足可以把你吓死。\u003c/p\u003e\n\u003cp\u003e后面一句话很有意思：“张惊，为之礼。”张生看到莺莺那么漂亮，忙起来对她行礼。这个描写很传神，一般男子看到普通的女子，都保持一点点的风度，淡淡的仿佛视若不见；惟独见到美女，眼睛一亮，慌忙起身行礼，态度谦恭。足见莺莺之美。后来她坐到郑氏旁边，因为是郑氏强迫她出见的，所以她“凝睇怨绝，若不胜其体者”，那个样子就是《喜剧之王》里张柏芝所谓的“鹌鹑状”。如此楚楚动人的姿势，叫张生魂不守舍。问了年纪，只有十七岁，正是花季过后，果季之前，鲜脆欲滴，天真纯情的年纪啊！张生想和她找话题说话，但是莺莺就是不理睬他，一直到吃完饭也没有什么好说的。记得以前去参加一个朋友生日活动，饭桌遇上了朋友的表妹，也是一样的年轻明艳，也是一样的不理睬人，和她搭讪也装做没听见，搞得我们很没有面子，所以说，古往今来的好女孩一般都是很矜持的。由于没有机会接触，张生的思念就象潮水一样把他包围，所以他捉摸着要找个机会表白一下。\u003c/p\u003e\n\u003cp\u003e于是他从莺莺的小伙伴，侍女红娘那边入手。这个策略在以后的无数次实践当中被证明是极端正确的。大学里你要追求某个女生，先要从她寝室的室友下手，打通所有关节，请他们吃喝玩乐，最后那个女孩子身边所有的朋友都在说你好话，那你就成功一大半了。红娘被张生吓了一跳，问了个问题：“你既然那么喜欢，何不凭借你对我们家的恩情向夫人正式提亲呢（何不因其德而求娶焉）？”张生回答的话简直有点无耻了：“我从孩童时候起，性情就不随便附合。有时和妇女们在一起，也不曾看过谁。当年不肯做的事，如今到底还是在习惯上做不来。昨天在宴会上，我几乎不能控制自己。这几天来，走路忘了到什么地方去，吃饭也感觉不出饱还是没饱。恐怕过不了早晚，我就会因相思而死了。如果通过媒人去娶亲，又要‘纳采’，又要‘问名’，手续多得很，少说也得三四个月，那时恐我也就不会在人世了。你说我该怎么办呢？（余始自孩提，性不苟合。或时纨绮闲居，曾莫流盼。不为当年，终有所蔽。昨日一席间，几不自持。数日来，行忘止，食忘饱，恐不能逾旦暮。若因媒氏而娶，纳采问名，则三数月间，索我于枯鱼之肆矣。尔其谓我何？）”先吹捧自己性格不随便，然后表明见到莺莺姑娘连这样的性情也抛掉了，再不快点接近自己，就挂掉了，哪有时间挺到纳采问名啊。我从来不知道爱一个人，居然连三四个月都无法等待，这是赤裸裸的情欲，而非爱情；张生的第一目标是得到莺莺，而非和她相爱。情欲是正常的，但是不正常的是张生光明正大的以自己的情欲作为接近的借口，在一套绚丽机巧的辞藻下，其实裹挟着的不过是阿Q对吴妈的那句“我要跟你困觉”！\u003c/p\u003e\n\u003cp\u003e但是也许张生妇女工作做的好，红娘还真的帮他出主意，让他摇动笔杆。想来那时躲在深闺的大家闺秀并不知道外边文青的名声有多臭，结果一场悲剧上演了。\u003c/p\u003e\n\u003cp\u003e亚里士多德《诗学》言道：“性格为悲剧六大要素之一。”毫无疑问，莺莺的性格决定了她的悲剧结局。在她的身上我们看到矜持和热情，顺从和叛逆，坚定和认命矛盾的结合在了一起。前面我们已经注意到莺莺出场时的矜持，和在她母亲召唤下不肯出来见面的叛逆，但是当她看了张生的情诗之后却用那首暧昧的《明月三五夜》作为回应，把张生招来相见。“待月西厢下，迎风户半开。拂墙花影动，疑是玉人来。”这诗不论莺莺怎么强调“犹惧兄之见难,是用鄙靡之词，以求其必至”,都无法掩盖字里行间的情意和期盼。\u003c/p\u003e\n\u003cp\u003e二月十五的晚上，月亮大的吓人,文学青年元稹踏着美丽的月色，攀着墙边的杏花树翻过墙头投奔他的初恋去了。他来到西厢房,却只看到红娘躺在床上，双方都很奇怪。在红娘通报后，莺莺姑娘这才出现了。可能原本元大才子准备着类似“长夜漫漫，无心睡眠，没想到莺莺姑娘你也睡不着”之类的桥段，可是如此以来完全用不上了，而且莺莺姑娘一身包裹严实，表情严肃，狠狠地训斥了他一顿，然后扬长而去。元大才子只好承认都是月亮惹的祸，那样的月色太美太温柔，于是绝望了。元稹没有写他失恋后寻死觅活，更不像他自己说的“索之于枯鱼之肆”。但是很吊诡的是三天后莺莺就自荐枕席了。鉴于这段情节的突兀，《董解元西厢记诸宫调》里就设计了张生患相思病，莺莺探病的情节，王实甫也继承发扬了这段情节。这段情节看似让整个的故事情节更加合理，也让人物性格和心理有一定的起承转合，但其实是画蛇添足的一笔。\u003c/p\u003e\n\u003cp\u003e莺莺是一个性格矛盾的人，她对待未知的将来既期待又恐惧，她知道自己所做的是不容于世的，但是她对于爱情满怀憧憬而渴望冒险。在爱情的冲动下，她一步步滑向张生的怀抱。也许从第一次出来见这个救命恩人的时候，她便已经心存好感，起码我们知道张生的相貌世让人赏心悦目，这是爱情的基础；当看到张生的两首诗，更加倾慕于他。唐代的女孩子也和现在的女孩子一样，有自己心目中的白马王子。也许那个时代比较流行的梦中情人形象，就是元稹这样的才子。于是她情不自禁回了一首诗，也许只是想见他一面，但是理智告诉她这样做法的危险性。也许在红娘去通报的时候，她还在那里犹豫到底要不要去见。最后她决定去看一眼那个自己衷情的男子，她穿戴齐整。当爱上一个男人的女子，在那个男人面前总是很低很低,低到尘埃里,尘埃里便开出花来，于是她潜意识的想保持自己的尊严，她不想被他看成是轻薄的女子。她终于见到了他，在月色下，俊朗的男子期盼地看着自己，眼神顾盼之间，让人心旌摇荡；那淡淡的笑容，刚毅的嘴角，也许随着那夜的月色一起留在莺莺地记忆深处。她发觉自己陷入一种前所未有的危机，一种爱上别人为了那男子可以不顾一切的冲动，于是她板下脸来，义正词严地拒绝了那个男子。“非礼之动，能不愧心？特愿以礼自持，毋及于乱！”这些话在我看来倒有一大半是在对自己萌动的心说的，莺莺在警告自己不要逾越了礼，否则将万劫不复。男子一脸地失望，仿佛满地月光都成了严霜。她还是转身离去。但是正如元稹在《会真诗》里所写的“戏调初微拒，柔情已暗通”。我不知道莺莺在这三天里是如何地心情，我也不知道其中红娘起了多大地作用，但是我知道到了十八日的晚上，莺莺终于做了自己一生中最重要的决定。\u003c/p\u003e\n\u003cp\u003e“数夕，张生临轩独寝，忽有人觉之。惊骇而起，则红娘敛衾携枕而至，抚张曰：‘至矣！至矣！睡何为哉！’并枕重衾而去。张生拭目危坐久之，犹疑梦寐；然而修谨以俟。俄而红娘捧崔氏而至。至，则娇羞融冶，力不能运支体，曩时端庄，不复同矣。是夕，旬有八日也。斜月晶莹，幽辉半床。”唐贞元十六年二月十八日的夜晚，那一夜的经历对于元稹来说是如此的深刻，以至于很久以后依然清楚的记得那天的日期，那夜的月色。元稹在《会真诗》里清楚地描写了缠绵的经过，在千年之后的人们看来，那诗依然写得香艳露骨，荡人心旌：“微月透帘栊，萤光度碧空；遥天初缥缈，低树渐葱茏……低鬟蝉影动，回步玉尘蒙；转面流花雪，登床抱绮丛；鸳鸯交颈舞，翡翠合欢笼；眉黛羞频聚，朱唇暖更融；气清兰蕊馥，肤润玉肌丰；无力慵移腕，多娇爱敛躬；汗光珠点点，发乱绿松松……”。在晶莹的斜月下，天真善良的莺莺投奔了爱情，为了自己心爱的男子，为了梦想中的爱情，抛弃了一切，奉献了一切。也许古往今来有很多的人有这般的经历，曾经真心单纯地去爱一个人，为他（她）付出了一切。不管结果如何，起码在那一刻，付出的人是幸福的，虽然这样的幸福可能是要遭到报应的。\u003c/p\u003e\n\u003cp\u003e在现代人的眼光来看，莺莺这床也上的太快了些。其实这还不算彻底的，汉代的司马相如不过弹了次琴，卓文君便跟着他私奔了，连富翁老爹也不认了。那个时代，女子应允了一份爱情就等于一生一世，不会再有给你重来改过的机会。那是个严肃的时代，女子地位低下，虽然相对于其他朝代，唐朝的风气算是比较开明宽松，但是逾越礼制的爱情依然不容于世，和一个男子相恋，要么嫁给他，要么就是再也得不到幸福和爱情。如那位被元稹好友白居易赞为“醉娇胜不得，风嫋牡丹花”的徐州名妓关盼盼，在其丈夫徐州守帅张愔死后却被白居易讽刺她不肯殉情，逼得她不得不绝食自尽；又如步非烟，因为父母之命而嫁于功曹参军武公业，毫无爱情可言，于是她红杏出墙，爱上了攻读课业的书生赵象，被丈夫发现后，只是淡淡说了句“生既相爱，死亦何恨”，于是从容淡定，任凭丈夫拷打，不肯开口求饶一句，最后终于被活活打死，以暴疾而亡的名义埋了。那个时代的女子，很少可以拥有幸福的爱情，所以这充分体现了新社会的优越性，起码你谈几场恋爱没有关系，女孩子只要不失身还是会有幸福的。\u003c/p\u003e\n\u003cp\u003e红娘把枕头也带来了,在古时候,共同倚靠的枕头是充满暗示意味的情物，是在一起温柔缠绵的明证。本朝初年高阳公主嫁于房玄龄之子房遗爱为妻，却不爱房遗爱，在新婚之夜就把新郎拒于洞房之外。高贵的公主爱上了玄奘的高徒、最年轻却最聪慧的高僧辩机和尚，那时高阳公主十六岁，辩机和尚二十一岁。高阳公主送给辩机一个“金玉宝枕”，却被小偷偷出。结果事情因此泄露，高贵的辩机被腰斩于市，而高阳公主也一辈子恨上了自己的家族，“帝崩无哀容”。或许唐代的女子血液里奔流着冒险的因子，所以为了爱情不顾一切，哪怕被抛弃被鄙夷被万夫所指天地不容也再所不惜。于是整个唐朝给我们后人留下了一大堆让人向往的爱情故事。莺莺对待爱情的勇气，无疑是秉承了大唐女子一贯的风气，虽然她的命运因此让人心痛，但是她的形象也因此让人爱怜，在千百年后的今天依然让我爱慕钦佩。\u003c/p\u003e\n\u003cp\u003e“有顷，寺钟鸣，天将晓。红娘促去。崔氏娇啼宛转，红娘又捧之而去，终夕无一言。”如此“金风玉露一相逢”的时光过的总是很快，古寺的朝钟响起，天快亮了，莺莺也要离去了。对于类似的幽会后的早晨，《诗经》里便有很细致的描述：《郑风·女曰鸡鸣》里写道“女曰鸡鸣，士曰昧旦；子兴视夜，明星有烂”，女子在催促说“鸡已经在打啼了”，男子眷恋枕衾，“天还没全亮；你起身看夜空，启明星还闪闪发光”，然后慢慢谈到工作，谈到两个人的未来，谈到恩爱到白头，“宜言饮酒，与子偕老。琴瑟在御，莫不静好”；《齐风．鸡鸣》里写道“鸡既鸣矣，朝既盈矣。匪鸡则鸣，苍蝇之声。东方明矣，朝既昌矣。匪东方则明，月出之光”，女子催促男子快起身，男子淹留不肯，“那不是鸡叫，是苍蝇嗡嗡声，东边也没亮，那是月亮光而已”，回答言语可爱缠绵。钱钟书说：“莎士比亚剧中写情人欢会，女曰：‘天尚未明，此夜莺啼，非云雀鸣也。’男曰：‘云雀报曙，东方云开透日矣。’女曰：‘此非晨光，乃流星耳。’用以比勘。”但是我们注意到，莺莺和张生一夜缠绵，居然不交一词，只是在天明将别的时候，呜咽哭泣。这个写法相当传神，我们可以从那“山盟海誓”的缺失和离别时的哭泣，感受到莺莺内心的矛盾：她明知道她正在做一件可能万劫不复的错事，但是却无法控制内心对于张生的情意，爱情的那种使双方合二为一的强烈愿望战胜了对命运的恐惧，她不敢说话，因为说话就代表了清醒，她宁愿在一种迷醉的状态下委身于自己的爱人，抛却一切利益的得失、道德的禁梏；当天明将别，她仿佛恍然从梦中惊醒，好象做错了事的孩子一样，为自己的选择和命运哭泣，为自己所失去的哭泣。当然在这眼泪之中，对于离别的伤感，也占了一定的比重，所以在未来的十多天里，她再也没有和张生联系。\u003c/p\u003e\n\u003cp\u003e直到张生“赋《会真诗》三十韵，未毕，而红娘适至，因授之，以贻崔氏”，才又来与张生相会。想来未完的《会真诗》是个很好的说服自己的借口，只是来探讨文学罢了，但是总免不了“向谁行宿,不如休去”的挽留。于是这样相处了将近一个月。\u003c/p\u003e\n\u003cp\u003e“张生常诘郑氏之情，则曰：‘我不可奈何矣。’因欲就成之。”这是最常见的断句，莺莺说：“我没有办法告诉她。”于是张生便想亲自和郑氏谈谈，促成这件事。但是见家长的事突然没有下文，很快张生也去了长安，这样的情节安排无论如何都是不通的。幸好还有另外一个版本：“张生常诘郑氏之情，则曰：‘知不可奈何矣，因欲就成之。’”莺莺说她妈知道也没其他办法了，所以想促成我们的婚事。他们相处同居了一个月，而寺院内有崔家那么多的仆役，就算郑氏再昏懵，也应该了解到女儿的事情了。事已既此，无可奈何，女儿大了，心向外人，现在也只能期盼那男人能负责任把她娶去了。这样的心情很可以理解，我的一个朋友，和她女朋友两地分居，而且女孩子在当地做了教师，不错的职业，眼看因为家里反对要分手了，但是有天女孩子的父母偷听他们的电话，知道了女儿已经失身于我的朋友，于是第二天就让女儿把我的朋友叫去见面，很快便结了婚。所以很多时候，我都分不清自己到底是生活在古代还是生活在现代，一千多年下来，对待某些问题的做法还是一点都没变化。\u003c/p\u003e\n\u003cp\u003e但是张生可能很害怕被一桩寒门的婚姻套牢，一听这话赶快跑路；于是借口“为了梦想中金碧辉煌的长安,都市里充满了神奇的历险,满足一个男儿宏伟的心愿”，西下长安去了。去之前还先告诉了莺莺，“崔氏宛无难词，然而愁怨之容动人矣”。有一种哀伤，是哭不出来的，它会慢慢渗透进你的骨子，日日夜夜一点一滴地侵蚀你的情绪。或许她害怕自己会控制不住自己面对离别的悲伤，所以在张生将要走的第二天晚上，莺莺没有来。我总是不能理解女子的心思，明明想念你的，却不肯见面；明明想把你留下的，却早早地说出一路顺风的祝福；明明在说没有留下更多的甜蜜回忆，却连分手了也不肯来见最后一面，谁都无法想见女子的心里到底在想些什么，或许正是这样的复杂，才成就了莺莺形象的丰满。\u003c/p\u003e\n\u003cp\u003e但是很快，张生又回到了蒲州，又与莺莺相处了好几个月，也许是他无法放下这段感情，也许是长安尚未有“实现一个男儿宏伟志向”的机会，更可能是长安还没那么早开考，想最后的缠绵一下。莺莺的字和文章写的都很好，却从不给张生看；她写文章的水平很好，但是却好象什么都不懂的样子；她言辞敏捷，但是在外人面前却很少说话。或许这样的女孩子最是让人怜爱。“待张之意甚厚，然未尝以词继之。时愁艳幽邃，恒若不识，喜愠之容，亦罕形见”，莺莺是个内向的女孩子，有了情绪却不轻易流露，她不会口口声声地和你说“我爱你”，但是连她注视你的目光都能让你感到无限柔情，你无法知晓她的想法，但是却沉溺于她时时流露的情意。她喜欢弹琴来抒发情感，可能是心情忧郁，所以弹奏的曲子异常伤感。\u003c/p\u003e\n\u003cp\u003e不久张生便要去长安应试了，或许是下了决心终要割断前缘，一心功名，所以这个男人连说分手的勇气都没有，只能对着莺莺忧愁哀叹，自然他也是不肯去承诺些什么的。莺莺自然明白他的心思，面对爱人的负心薄情，做为一个弱女子又能说什么呢。莺莺是个坚强而又自尊的女子，她不会低声哀求张生留下，她态度恭敬，声音柔和，慢慢地对张生说：“始乱之，终弃之，固其宜矣，愚不敢恨。必也君乱之，君终之，君之惠也。则没身之誓，其有终矣，又何必深感于此行？然而君既不怿，无以奉宁。君常谓我善鼓琴，向时羞颜，所不能及。今且往矣，既君此诚。” 莺莺平静的面容下说出“始乱之，终弃之，固其宜矣，愚不敢恨”那是怎样的一种心痛呢，假如仅仅是个人爱情的失败也就罢了，但是其中还昭显出整个家族的衰败和老母最后一丝期望的落空。人很多时候并非为自己而活，所以人最不能承受的并非自身的失败，而是自身的失败给自己亲爱之人所带来的伤害。张生挥一挥衣袖，固然不带走一片云彩，还可以得到时人“善补过者”的赞誉，但是对于莺莺来说，不但她这一生的命运已经凄惨无疑，而且也给了她衰颓式微的家族一次重重的羞辱和打击。\u003c/p\u003e\n\u003cp\u003e她终于明白了“则没身之誓，其有终矣”，古往今来男女说着“山无陵，江水为竭，冬雷阵阵，夏雨雪，天地合，乃敢与君绝”的誓言，可大多数的人言语远比自身华丽，现实远没有恶化到世界末日，便已经支持不住，爱情一如华美的琉璃，碰触现实难免粉碎。\u003c/p\u003e\n\u003cp\u003e于是她为自己心爱的男子弹了最后一首曲子《霓裳羽衣曲序》，琴声因为心情悲伤而纷乱错杂，旁边的人都听着流泪，她终于弹不下去，扔下琴哭着跑到母亲的房里，再也没出来。在这部作品里，郑氏出场只有一次，侧面描写也并不多，但是我们却依然能想象一千多年前那位母亲的悲痛，为自己的命运，为家族的命运，更为自己女儿的命运感到悲伤。\u003c/p\u003e\n\u003cp\u003e第二天我们的元大才子便神清气爽地踏上西去长安的路途，但是那年他没有考中。于是他留在了长安，从莺莺的信中我们了解到，这个鄙薄的文青曾托人给莺莺寄去一封信，让她看开些，“以广其意”，顺便送去“花胜一合、口脂五寸”做为分手礼物。唐代女子喜欢用绢纸、金银等材料做出一朵朵花形的小物件，贴在脸上，唐代就称之为“花胜”或者“花钿”。元稹很潇洒地给分手后的情人送去长安最时尚的化妆品和首饰，想以此来弥补内心的愧疚。但凡女子都爱最新潮时尚的化妆品，犹以情人所赠为甚；但是我不知道淹留蒲州普救寺的母女，在这个穷乡僻壤突然看到负心的男人送来长安的时尚货色，会是怎样的心情，或许如后世李清照所言“泪融残粉花钿重”。\u003c/p\u003e\n\u003cp\u003e孤独无望地留在普救寺的莺莺回了一封信，那信却被张生炫耀于长安的朋友之间。就好象胡兰成把曾与他恩爱缠绵的女子都写进《今生今世》，古今文人下作起来都是一样。\u003c/p\u003e\n\u003cp\u003e对于自己的负心，元稹还借用了《左传》那句“夫有尤物,足以移人,苟非道德,则必有祸”，义正词严地发表了一通高论：“大凡天之所命尤物也，不妖其身，必妖于人。使崔氏子遇合富贵，乘宠娇，不为云为雨，则为蛟为螭，吾不知其变化矣。昔殷之辛，周之幽，据百万之国，其势甚厚。然而一女子败之，溃其众，屠其身，至今为天下戮笑。予之德不足以胜妖孽，是用忍情。”最可怕的是听众的反应，“于时坐者皆为深叹”，大家叹口气，居然没人指责张生的负心薄幸，或者有一点小小的同情给予莺莺。\u003c/p\u003e\n\u003cp\u003e对于美貌女子的恐惧，其实不过只是自身懦弱的借口罢了，男子严于律女子，宽于律己，实在是很无耻。《世说新语》里记载着石崇宴客让美人劝酒，如客人不饮，便杀掉劝酒的美人。有一次丞相王导和大将军王敦去赴宴，王导不善饮酒，也只好勉强自己喝，以至于喝醉了；而王敦死活不肯给面子，就是不喝，“已斩三人，颜色如故，尚不肯饮”。而此事，却被刘义庆归为“汰侈”，意思是奢侈浪费。在这里我们看到的是人正常情感的缺位，对于爱情和女性的残忍，却成了男子气度的象征。记得唐代曾有一个很出名的事件：军官冯燕，和同事张婴的漂亮老婆私通，张婴酗酒而归，冯燕逃避不及，只好藏到床底，却发觉自己的头巾还留在枕边，幸好张婴喝醉了并没发觉。于是冯燕指指头巾示意张妻把头巾取来免得事情败露，可是张妻会错了意，竟把枕边张婴的佩刀递给了他。冯燕看了张妻几眼，觉得这个女人太狠毒，就一刀砍下了张妻的头，然后戴上头巾走了。张婴于是就被认为杀害自己的妻子，被判死刑；结果在刑场上，冯燕出现了，他宣称张婴是无辜的，张妻是自己杀的。军政长官贾耽将此案据实上奏，并表示，宁愿免去自己的官职，也要为冯燕赎罪。最后皇帝的敕令是，将滑地的全部死刑犯同时赦免。这件案子影响很大，以至于那个时代的流行小说家沈下贤专门为之创作了传奇《冯燕传》；著名诗人司空图则写了长篇叙事诗《冯燕歌》，其中有一句诗写道“已为不平能割爱”，也就是说为了所谓的道德规范，能割舍爱情的才是大英雄。于是世情普遍鄙薄男欢女爱，积极培养冷血寡情的人，于是婚姻便成利益的交换，所谓的爱情只能沦落到勾栏瓦舍里去了。对比西方，希罗多德《历史》曾讲过吕底亚王坎道列斯的故事。坎道列斯认为自己的妻子是世上最美丽的女子，于是他想拿来炫耀了，他强迫他的亲信巨吉斯看王后的身体，以便确认这一点；不得已，巨吉斯只好藏在卧室，看了王后的身体。王后知道此事后，认为是奇耻大辱，就将巨吉斯召来，给他两个选择：要么他杀掉国王，“变成我的丈夫并取得吕底亚的王位”；要么被处死。结果巨吉斯选择了前者，他杀死了国王，并娶了王后，登上了吕底亚的王位。我们从中可以看到东西方文明对待情欲的差别。遗风留至如今，家里关心你的结婚对象，不是双方有多么相爱，感情有多深厚，而是这个人家里怎样，是不是老实，有没有本事赚钱升官；假如你斗胆和他们说起你们的爱情，于是大家都开始哄堂大笑或者不屑一顾，仿佛看你就是一个不成熟的孩子、精神错乱的病人。对于爱情的信仰，或许只存在于看戏的那段辰光。\u003c/p\u003e\n\u003cp\u003e有了这样一种社会心理氛围，再加上有太子少保韦夏卿的赏识，那么元稹抛弃寒门女子莺莺而迎娶豪门韦家的千金韦丛，也就顺理成章了。但吊诡的是在蒋防写的《霍小玉传》里，元稹的老丈人韦夏卿却对负心薄行的朋友李益这般说：“风光甚丽，草木荣华。伤哉郑卿，衔冤空室！足下终能弃置，实是忍人。丈夫之心，不宜如此。足下宜为思之！”蒋防此人在仕途上得到过元稹的推荐，所以他写及元稹的岳父时总要润色拔高一下，只是他的恩公看到这番话时是否会心头一颤？\u003c/p\u003e\n\u003cp\u003e或许是虬髯客已没，不会再有人“衔之十年”也要去取“天下负心者”的头颅心肝下酒，所以男人也就越发理直气壮地负心薄幸。负心人元稹没有得到什么报应，又过了一年多后，也就是贞元十九年他登拔萃科，署秘书省校书郎，娶了韦夏卿之女韦丛为妻，并在那一年与同中书判拔萃科的白居易相识订交，从此元白之名满天下。元稹在《梦游春七十韵》中写道：“当年二纪初，嘉节三星度……韦门正全盛，出入多欢裕。”在元稹志得意满，欢娱畅快之时，莺莺也匆匆嫁于他人了。后来元稹偶然路过莺莺居住的地方，以莺莺表兄的身份求见，终不得一见。莺莺的不复相见，是对情人的深深失望，或许她会深深的认同鱼玄机说的“易求无价宝，难得有情郎”；她没有霍小玉那般刚烈，她也许也会哀怜自己“我为女子，薄命如斯，是丈夫负心若此”，但她却说不出“我死之後，必为厉鬼，使君妻妾，终日不安”的话。莺莺只写了首诗给元稹，硬着骨头咬着牙说“弃置今何道，当时且自亲”，既然都已经分开了不爱我了又有什么好说的呢，当时恩爱缠绵也就足够了，让他“还将旧时意，怜取眼前人”，因为懂得，所以慈悲。当爱情归于寂寥，繁华消于落寞，一切都只存在与记忆里，曾经的美好，只能活在心底。“惆怅旧欢如梦，觉来无处追寻”。或许她也明白，往事只能追忆，不可重温。曾经年少单纯的莺莺已经死了，只留下一具逐渐衰老的躯壳和悲伤的灵魂继续苟活。现实那样丑恶，我们却不得不活下去。\u003c/p\u003e\n\u003cp\u003e我真的怀疑元稹所谓的“曾经沧海难为水，除却巫山不是云”到底指哪一位，是莺莺，还是韦丛，抑或是薛涛？元和四年，韦丛去世，元稹写了三十三篇诗来悼念她，其中最有名的一句：“惟将终夜长开眼，报答平生未展眉。”根据陈寅恪先生的考证，这个“长开眼”不仅仅是睡不着的意思，“所谓‘常开眼’者，自比鳏鱼（有“鳏鱼眼长开”这一说法），即自誓终鳏之义”（陈寅恪《元白诗笺证稿》），元稹信誓旦旦的要为韦丛终生不娶，鳏孤到死了。但事实证明，元稹是个文过饰非的人，在韦丛凑趣去世的那年，他邂逅薛涛，两人相恋了一年后将之抛弃，可怜薛涛为之终身不嫁，“只欲栏边安枕席，夜深闲共说相思”；两年后纳妾安氏，又过数年续弦裴淑。简直是“取次花丛频回顾”啊！所以观陈寅恪先生对其评价“自私自利。综其一生行迹，巧宦固不待言，而巧婚尤为可恶也。岂其多情哉？实多诈而已矣”并不为过。\u003c/p\u003e\n\u003cp\u003e读《元长庆集》，常免不了痛恨为什么如此深情优美的诗句却出自一个那么薄情负心的伧夫之手。雪莱在《致云雀》中说：“我们最甜美的歌，就是那些倾吐最哀伤的思想的。”不知道元稹所哀伤的到底是什么。贝克尔在《抗拒死亡》中说的：“所有动人心弦的事中，对死的恐惧是首当其冲的。”他的悼亡诗写的那么情深意切，大概是出于对死亡本身的恐惧和悲哀吧。\u003c/p\u003e\n\u003cp\u003e或许不该过分指责元稹，他也不过是为了功名奔波的庸人，这个世界原本就是为庸人所设的。太过恩爱的情侣总是不容于世：苏东坡与王弗已是“十年生死两茫茫”了；陆游和唐婉儿只能“一怀愁绪，几年离索”；刘克庄在哀叹“旧日风烟草树，而今总断人肠”；冒辟疆和董小宛“一生清福,九年占尽,九年折尽矣”；还有纳兰性德，感慨着“被酒莫惊春睡重，睹书消得泼茶香，当时只道是寻常”。但是起码他们是能真心相爱的，就算不能“执子之手，与子偕老”，起码也是“骨化形销而丹诚不泯”，却可怜了单纯的莺莺，一个人用余生去背负全部的思念、悔恨和指摘。\u003c/p\u003e\n\u003cp\u003e史籍上再没有关于莺莺以后生活的记载，或许她一生坎坷，慢慢地消磨了纯真善良，成了世间常见的庸俗势利的妇人。但哪怕是这样，我依然相信在她心底的最幽深隐蔽的角落、最柔嫩脆弱的地方，记忆会像一把锯齿慢慢地来回剧着那根最纤细的神经，午夜梦回的时候，依然会为贞元十六年的那个男子泪流满面。\u003c/p\u003e\n\u003cp\u003e我怕我鄙薄的文字无法完美地译出那女子悲伤的文字，且让我们再细细读一读那信的原文,体会一下她的心情吧：\u003c/p\u003e\n\u003cp\u003e捧览来问，抚爱过深。儿女之情，悲喜交集。兼惠花胜一合、口脂五寸，致耀首膏唇之饰。虽荷殊恩，谁复为容？睹物增怀，但积悲叹耳。伏承使于京中就业，进修之道，固在便安。但恨僻陋之人，永以遐弃。命也如此，知复何言！自去秋已来，常忽忽如有所失。于喧哗之下，或勉为语笑，闲宵自处，无不泪零。乃至梦寐之间，亦多感咽离忧之思。绸缪缱绻，暂若寻常，幽会未终，惊魂已断。虽半衾如暖，而思之甚遥。一昨拜辞，倏逾旧岁。长安行乐之地，触绪牵情。何幸不忘幽微，眷念无斁，鄙薄之志，无以奉酬。至于终始之盟，则固不忒。鄙昔中表相因，或同宴处。婢仆见诱，遂致私诚。儿女之心，不能自固。君子有援琴之挑，鄙人无投梭之拒。及荐寝席，义盛意深。愚陋之情，永谓终托。岂期既见君子，而不能定情，致有自献之羞，不复明侍巾帻。没身永恨，含叹何言！倘仁人用心，俯遂幽眇，虽死之日，犹生之年。如或达士略情，舍小从大，以先配为丑行，以要盟为可欺，则当骨化形销，丹诚不泯，因风委露，犹托清尘。存没之诚，言尽于此。临纸呜咽，情不能申。千万珍重，珍重千万！玉环一枚，是儿婴年所弄，寄充君子下体所佩。玉取其坚润不渝，环取其终始不绝。兼乱丝一绚、文竹茶碾子一枚。此数物不足见珍，意者欲君子如玉之真，弊志如环不解。泪痕在竹，愁绪萦丝，因物达情，永以为好耳。心迩身遐，拜会无期。幽愤所钟，千里神合。千万珍重！春风多厉，强饭为嘉。慎言自保，无以鄙为深念。\u003c/p\u003e","tags":["故事","《莺莺传》","读书笔记"],"title":"「转」琉璃易碎，人言易坠——关于《莺莺传》的叙事"},{"categories":["工具"],"content":"前言 本文主要内容为博客搭建的记录与分享，我采用了Hexo博客框架，NexT主题和Gitment评论系统。本文中记录了我博客的安装流程和使用过程中的改进细节。\n对Next主题版本的一些说明：我使用的是version: 5.1.0。而使用新版本的NexT v6 主题的同学，有些功能如gitment已经实现，可以直接使用V6。此V6版本对于图片的使用可能会出现问题。仅需看看我下面的2.2小节。\n有时间我会将我修改后的hexo Next theme 基于version: 5.1.0主题，给个独立的git仓，放到github 上。\n小技巧：在文章中可以使用\u0026lt;!-- more --\u0026gt;手动进行截断，more上面部分将被放到主页上显示。此为Hexo 提供的方式。\n下面就是用\u0026lt;!-- more --\u0026gt;截断的～～\n在看安装教程的时候，发现怎么要涉及这么多东西，请大家不要担心，一步步来。同时也不用在意会不会nodejs，框架这些东西，人家已经帮我们把东西都写好了，我们做的就是改改配置文件，最多改改里面swig的模版的一些代码。最后，望大家见谅的是，我对js不太熟，有些地方不是很清楚。欢迎大家在下面评论，或者在github上开issue，共同讨论。\n1. 安装 1.1 简易安装使用 使用新版本的 NexT v6 主题即可，有些功能如 gitment 已经实现。对于图片的使用可能会出现问题。仅需看看我下面的2.2小节。我使用的是 version: 5.1.0 。\n1.2 从头安装 安装 nodejs，从nodejs 官网下载安装包 download page 安装git客户端 git 安装Hexo npm install -g hexo-cli hexo 中文安装文档 Hexo中文网站 安装NexT ，NexT是一个比较火的主题。 按官网教程NexT安装即可，官网安装和配置教程比较美滋滋。 http://theme-next.iissnan.com/getting-started.html NexT Github https://github.com/iissnan/hexo-theme-next 另外，NexT开发者的博客（最近Next 变成组织了，祝贺）http://notes.iissnan.com Ubuntu安装记录\n# for Ubuntu16.04 $ sudo apt install npm nodejs-legacy $ sudo npm install hexo-cli -g $ hexo init blog $ cd blog $ npm install $ hexo server ok，安装完的目录结构。\n. ├── node_modules # nodejs的目录 ├── public # 输出网站目录 ├── scaffolds # hexo 的一些预设模版 ├── source # 独立submodule ├── themes # 主题 里面也有主题的配置文件不要与项目的配置文件搞混 ├── README.md ├── _config.yml # 整个项目配置文件 ├── db.json ├── index.html。 # 用于跳转到public下 └── package.json 5 directories, 5 files 我对博客项目的安排是这样的，总共有两个github项目，一个放素材，一个用hexo框架生成html文件。 在上面的文件目录只能够，将source 文件夹作为一个submodule 用 git submodule\n# 对于我来说 $ cd path/to/your/github.io/project $ git submodule add https://github.com/talengu/blog_source source 在生成html，下面操作都在 path/to/your/github.io/project，hexo找不到node_modules\n# clone 项目 $ git clone https://github.com/talengu/talengu.github.io $ git submodule init $ git submodule update # 切换到最新的submodule $ cd source $ git merge origin/master $ git submodule update # 执行npm按照，由于已经生成它会按照package.json文件自动安装 # 没有npm的话 安装 https://nodejs.org/en/download/ $ npm install 2. 配置 对于在NexT主页上介绍的配置我就不写了，请参考http://theme-next.iissnan.com/getting-started.html 。\n下面主要对重要的和我自己修改的部分说明没有的进行配置，值得注意的是我的NexT版本是version: 5.1.0。\n2.1 NexT官网的设置 MathJax\n编辑 主题配置文件， 将 mathjax 下的 enable 设定为 true 即可。 cdn 用于指定 MathJax 的脚本地址，默认是 MathJax 官方提供的 CDN 地址。\n# MathJax Support mathjax: enable: true cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML 下面测试 $\\frac{d}{dx}c^n=nx^{n-1}$\n$\\frac{d}{dx}c^n=nx^{n-1}$\nLocal Search (推荐) 本地内容搜索引擎。\n安装 hexo-generator-searchdb，在站点的根目录下执行以下命令：\nnpm install hexo-generator-searchdb --save\n编辑 站点配置文件，新增以下内容到任意位置：\nsearch: path: search.xml field: post format: html limit: 10000 编辑 主题配置文件，启用本地搜索功能：\n# Local search local_search: enable: true 2.2 markdown图片 网上的图片链接可以直接使用，下面对本地图片使用进行配置。\n使用\n安装插件npm install https://github.com/CodeFalling/hexo-asset-image --save\n在 主题配置文件（不是next的_config.yml）中设置permalink: :year/:month/:day/:title/，设置 post_asset_folder: true，这主要将文件拷贝到/public文件夹。其中permalink很关键，只能这样设置。\n图片必须放到和md文件名字一样的同名字文件夹。 如使用Typora软件写md的话，设置一下image保存路径即可，如下。\n2.3 代码复制 为了提高博客代码块的用户体验，仅仅代码高亮还不行，最好还能一键复制代码。故此文将讲述 Hexo NexT 主题博客的代码块复制功能配置。转 Hexo NexT 代码块复制功能\n2.3.1 下载 clipboard.js 三方插件 clipboardjs ，相关介绍和兼容性它主页或 github 上看。\n下载地址：\nclipboard.js clipboard.min.js 推荐 保存文件clipboard.js / clipboard.min.js ，目录如下： .\\themes\\next\\source\\js\\src\n2.3.2 clipboardjs 使用 也是在.\\themes\\next\\source\\js\\src目录下，创建clipboard-use.js，文件内容如下：\n/*页面载入完成后，创建复制按钮*/ !function (e, t, a) { /* code */ var initCopyCode = function(){ var copyHtml = \u0026#39;\u0026#39;; copyHtml += \u0026#39;\u0026lt;button class=\u0026#34;btn-copy\u0026#34; data-clipboard-snippet=\u0026#34;\u0026#34;\u0026gt;\u0026#39;; copyHtml += \u0026#39; \u0026lt;i class=\u0026#34;fa fa-globe\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;span\u0026gt;copy\u0026lt;/span\u0026gt;\u0026#39;; copyHtml += \u0026#39;\u0026lt;/button\u0026gt;\u0026#39;; $(\u0026#34;.highlight .code pre\u0026#34;).before(copyHtml); new ClipboardJS(\u0026#39;.btn-copy\u0026#39;, { target: function(trigger) { return trigger.nextElementSibling; } }); } initCopyCode(); }(window, document); 在.\\themes\\next\\source\\css\\_custom\\custom.styl样式文件中添加下面代码：\n//代码块复制按钮 .highlight{ //方便copy代码按钮（btn-copy）的定位 position: relative; } .btn-copy { display: inline-block; cursor: pointer; background-color: #eee; background-image: linear-gradient(#fcfcfc,#eee); border: 1px solid #d5d5d5; border-radius: 3px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-appearance: none; font-size: 13px; font-weight: 700; line-height: 20px; color: #333; -webkit-transition: opacity .3s ease-in-out; -o-transition: opacity .3s ease-in-out; transition: opacity .3s ease-in-out; padding: 2px 6px; position: absolute; right: 5px; top: 5px; opacity: 0; } .btn-copy span { margin-left: 5px; } .highlight:hover .btn-copy{ opacity: 1; } 2.3.3 引用 在.\\themes\\next\\layout\\_layout.swig文件中，添加引用（注：在 swig 末尾或 body 结束标签（\u0026lt;/body\u0026gt;）之前添加）：\n\u0026lt;!-- 代码块复制功能 --\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;/js/src/clipboard.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;/js/src/clipboard-use.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 想看效果的可以去我博客看，截图如下:\n熟悉的也可以将clipboard.min.js和clipboard-use.js合并为一个文件，再在.\\themes\\next\\layout\\_layout.swig文件中使用。当然clipboard.min.js也可以直接用三方 cdn 的方式引入也行。\n2.4 Gitment 评论功能 集成 giment 评论系统的过程。gitment 把评论放到 github 的 issues 系统里，评论支持 md，比较适合程序员.\n# 安装gitment $ npm install gitment --save 2.4.1 注册 OAuth Application 点击 https://github.com/settings/applications/new 注册，注意Authorization callback URL填自己的网站 url `httClient Secret**.\n在新版本NexT v6里面已经支持gitment了所以你只要在github上注册一下 OAuth Application ，填上Client ID 和 Client Secret.即可\n2.4.2 修改themes/next/_config.yml 在其中添加:\n# Gitment # Introduction: https://imsun.net/posts/gitment-introduction/ gitment: enable: true githubID: yourid repo: yourrepo ClientID: yourid ClientSecret: yoursecret lazy: true 注意: 格式要正确，该空格的一定要空格。所有的 yourXXX 都换成自己的.\n在主题的en.yml增加:\ngitmentbutton: Show comments from Gitment zh-Hans.yml增加:\ngitmentbutton: 显示 Gitment 评论 2.4.3 修改主题layout/_partials/comments.swig 找到这个文件里的这两行:\n{% elseif theme.valine.appid and theme.valine.appkey %} \u0026lt;div id=\u0026#34;vcomments\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; 上面是最后一个elseif分支，在下面加一个elseif分支:\n{% elseif theme.gitment.enable %} {% if theme.gitment.lazy %} \u0026lt;div onclick=\u0026#34;ShowGitment()\u0026#34; id=\u0026#34;gitment-display-button\u0026#34;\u0026gt;{{ __(\u0026#39;gitmentbutton\u0026#39;) }}\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;gitment-container\u0026#34; style=\u0026#34;display:none\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; {% else %} \u0026lt;div id=\u0026#34;gitment-container\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; {% endif %} 加完之后下面的内容是原来的，保持不变:\n{% endif %} \u0026lt;/div\u0026gt; {% endif %} 2.4.4 增加gitment.swig 在主题下layout/_third-party/comments/目录下中添加文件gitment.swig：\n{% if theme.gitment.enable %} {% set owner = theme.gitment.githubID %} {% set repo = theme.gitment.repo %} {% set cid = theme.gitment.ClientID %} {% set cs = theme.gitment.ClientSecret %} \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://imsun.github.io/gitment/style/default.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://imsun.github.io/gitment/dist/gitment.browser.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; {% if not theme.gitment.lazy %} \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; var gitment = new Gitment({ id: window.location.pathname, owner: \u0026#39;{{owner}}\u0026#39;, repo: \u0026#39;{{repo}}\u0026#39;, oauth: { client_id: \u0026#39;{{cid}}\u0026#39;, client_secret: \u0026#39;{{cs}}\u0026#39;, }}); gitment.render(\u0026#39;gitment-container\u0026#39;); \u0026lt;/script\u0026gt; {% else %} \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; function ShowGitment(){ document.getElementById(\u0026#34;gitment-display-button\u0026#34;).style.display = \u0026#34;none\u0026#34;; document.getElementById(\u0026#34;gitment-container\u0026#34;).style.display = \u0026#34;block\u0026#34;; var gitment = new Gitment({ id: document.location.href, owner: \u0026#39;{{owner}}\u0026#39;, repo: \u0026#39;{{repo}}\u0026#39;, oauth: { client_id: \u0026#39;{{cid}}\u0026#39;, client_secret: \u0026#39;{{cs}}\u0026#39;, }}); gitment.render(\u0026#39;gitment-container\u0026#39;); } \u0026lt;/script\u0026gt; {% endif %} {% endif %} 然后在主题下layout/_third-party/comments/index.swig文件中引入 gitment.swig 文件：\n{% include \u0026#39;gitment.swig\u0026#39; %} 2.4.5 添加gitment.styl 在主题下source/css/_common/components/third-party/目录下添加gitment.styl文件，设置 button 的样式：\n#gitment-display-button{ display: inline-block; padding: 0 15px; color: #0a9caf; cursor: pointer; font-size: 14px; border: 1px solid #0a9caf; border-radius: 4px; } #gitment-display-button:hover{ color: #fff; background: #0a9caf; } 然后在主题下source/css/_common/components/third-party/third-party.styl文件中引入相应的 CSS 样式即可:\n@import \u0026#34;gitment\u0026#34;; 这样就 ok 了！\n2.4.6 易错点 修改themes/next/_config.yml这个文件时，格式要正确。另外，repo 是你要想创建 issues 的仓库，完全可以跟博文所放的仓库不一个。id 就写自己的 github 用户名就可以，这个用户名跟 repo 必须匹配。 gitment 可能不支持链接地址里有中文，所以安装 gitment 前一定要参考前文把链接持久化搞成全是英文的。 同一篇文章需要初始化 comment 两次的问题，是因为 http://xxx.com/post/ab9bb85a.html 和点击阅读全文进去的链接 http://xxx.com/post/ab9bb85a.html#more 对 issues 来说是不同的，所以创建两次。解决方法就是gitment.swig里 id 弄成window.location.pathname而不是document.location.href。 初始化评论后，可以到 github 里自己放 issues 的仓库查看 issues 是否创建成功，有时候浏览器可能会有缓存依然提示你初始化评论。一般过个两分钟就显示正常了。 2.4.7 参考文档 主要参考文档 一种相对简略的配置方式 作者 issue 2.x gittalk 评论系统 https://iochen.com/2018/01/06/use-gitalk-in-hexo/\n403 error:\nhttps://zhuanlan.zhihu.com/p/350735142\n申请个人worker https://dash.cloudflare.com/\n2.x glup加速 npm install --global gulp npm install gulp-minify-css gulp-uglify gulp-htmlmin gulp-htmlclean gulp-imagemin --save 使用Gulp压缩Hexo博客静态资源, 加快响应速度 https://blog.csdn.net/cpohui/article/details/98525437\n// 设置 淘宝镜像源 npm config set registry https://registry.npm.taobao.org // 查看 使用的 镜像源 npm config get registry // 安装 淘宝镜像源 npm install -g cnpm --registry=https://registry.npm.taobao.org 2.x 字体大小 Hexo 修改字体大小 https://www.jianshu.com/p/02fbd409988c\nthemes/next/source/css/_variables 页面美化\n2.x 利用 Github Actions 自动部署 Hexo 博客 生成RSA密码对，部署到任务仓。 https://sanonz.github.io/2020/deploy-a-hexo-blog-from-github-actions/\n2.5 copyright文字添加 效果 可以在md文件里面控制是否使用这个组建。\n使用\n在md文件中的front-head部分，设置 copyright:true如下面。 设置next/_config.yml 文件，中设置post_copyright 的选项 enable。\n--- title: 个人主页搭建 date: 2016-12-22 12:39:04 categories: - 博客搭建 tags: - Hexo comments: true copyright: true --- 说明 对原next的改变\n对于一些原创的文本可以设置版权的声明，这个是next自带的，我进行了修改。next的_config.yml 文件，中设置post_copyright 的选项，启用它会对所有的页面添加，我多加了一个page的copyright使能判断。 对next/layout/_macro/post-copyright.swig修改。下面为修改后的文件。\n{% if theme.post_copyright.enable %} {% if page.copyright %} \u0026lt;!-- 加上page md文件头部使能--\u0026gt; \u0026lt;ul class=\u0026#34;post-copyright\u0026#34;\u0026gt; \u0026lt;li class=\u0026#34;post-copyright-author\u0026#34;\u0026gt; \u0026lt;strong\u0026gt;{{ __(\u0026#39;post.copyright.author\u0026#39;) + __(\u0026#39;symbol.colon\u0026#39;) }}\u0026lt;/strong\u0026gt; {{ config.author }} \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;post-copyright-link\u0026#34;\u0026gt; \u0026lt;strong\u0026gt;{{ __(\u0026#39;post.copyright.link\u0026#39;) + __(\u0026#39;symbol.colon\u0026#39;) }}\u0026lt;/strong\u0026gt; \u0026lt;!-- url的修正，可能要根据你的情况修改--\u0026gt; \u0026lt;a href=\u0026#34;{{ config.url }}{{ config.root }}{{ post.path }}\u0026#34; title=\u0026#34;{{ post.title }}\u0026#34;\u0026gt;{{ config.url }}{{ config.root }}{{ post.path }}\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;post-copyright-license\u0026#34;\u0026gt; \u0026lt;strong\u0026gt;{{ __(\u0026#39;post.copyright.license_title\u0026#39;) + __(\u0026#39;symbol.colon\u0026#39;) }} \u0026lt;/strong\u0026gt; {{ __(\u0026#39;post.copyright.license_content\u0026#39;, theme.post_copyright.license_url, theme.post_copyright.license) }} \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; {% endif %} {% endif %} 2.6 RSS (可选) 对一些网站的feed 的订阅 如rss，使用来进行订阅网站的rss，现在一些网站已经没有rss服务，google也停掉了google rss reader的项目，所以看你的喜好。\n# 安装hexo-generator-feed npm install hexo-generator-feed --save # 在_config.yml 启用feed tips: 由于我博客在public文件夹下，导致hexo-generator-feed生成的地址不对。 在node_modules/hexo-generator-feed/lib/generator.js` 第35行下面添加一行:\nurl += \u0026#39;public/\u0026#39; 可用此脚本替换 sed -i \u0026quot;36c url += 'public/';\u0026quot; node_modules/hexo-generator-feed/lib/generator.js note: mac中手动修改，sed指令不一样\n2.7 添加 fork me github 效果\n在GitHub Ribbons或GitHub Corners选择一款你喜欢的挂饰。比如下面的 github corners 在your-url填上你的 url 。\n将刚刚复制的挂饰代码，添加到themes/next/layout/_layout.swig文件中，添加位置，放在\u0026lt;div class=\u0026quot;headband\u0026quot;\u0026gt;\u0026lt;/div\u0026gt;的下方如下图。\n2.8 添加注脚 hexo-renderer-markdown-it插件，参考\n首先卸载原来的markdown渲染插件（我这里原来是marked，这是Hexo提供的默认渲染插件），然后把hexo-renderer-markdown-it装上：\nnpm un hexo-renderer-marked --save npm i hexo-renderer-markdown-it --save 然后在根目录下的_config.yml中进行相应的配置。简单的配置方法只包括设置markdown格式，这里就不详述了。高级的配置方法中包含很多可选项。\n## Docs: https://github.com/celsomiranda/hexo-renderer-markdown-it/wiki markdown: # 渲染设置 render: # 置为true时，html内容保持不变；置为false时，html内容将被转义成普通字符串 html: true # 是否生成与XHTML完全兼容的标签（虽然我不懂是什么意思） xhtmlOut: false # 置为true时，每个换行符都被渲染成一个\u0026lt;br\u0026gt;（即Hexo的默认表现）；置为false时，只有空行才会被渲染为\u0026lt;br\u0026gt;（GFM的默认表现） breaks: true # 是否自动识别链接并把它渲染成链接 linkify: true # 是否自动识别印刷格式（意思是把(c)渲染为©这样的） typographer: true # 如果typographer被设置为true，则该选项用于设置将dumb quotes（\u0026#34;\u0026#34;）自动替换为smart quotes quotes: \u0026#39;“”‘’\u0026#39; # 设置所需插件 plugins: - markdown-it-abbr - markdown-it-footnote - markdown-it-ins - markdown-it-sub - markdown-it-sup # 锚点设置（因为我没有尝试相关内容，所以就不翻译相关说明了） anchors: level: 2 collisionSuffix: \u0026#39;v\u0026#39; permalink: true permalinkClass: header-anchor permalinkSymbol: ¶ # ref https://www.dazhuanlan.com/2019/11/22/5dd6faa42d279/ ## Docs: https://github.com/celsomiranda/hexo-renderer-markdown-it/wiki markdown: # 渲染设置 render: # 置为true时，html内容保持不变；置为false时，html内容将被转义成普通字符串 html: true # 是否生成与XHTML完全兼容的标签（虽然我不懂是什么意思） xhtmlOut: false # 置为true时，每个换行符都被渲染成一个\u0026lt;br\u0026gt;（即Hexo的默认表现）；置为false时，只有空行才会被渲染为\u0026lt;br\u0026gt;（GFM的默认表现） breaks: true # 是否自动识别链接并把它渲染成链接 linkify: true # 是否自动识别印刷格式（意思是把(c)渲染为©这样的） typographer: true # 如果typographer被设置为true，则该选项用于设置将dumb quotes（\u0026#34;\u0026#34;）自动替换为smart quotes quotes: \u0026#39;“”‘’\u0026#39; # 设置所需插件 plugins: - markdown-it-abbr - markdown-it-footnote - markdown-it-ins - markdown-it-sub - markdown-it-sup # 锚点设置（因为我没有尝试相关内容，所以就不翻译相关说明了） # anchors: # level: 2 # collisionSuffix: \u0026#39;v\u0026#39; # permalink: true # permalinkClass: header-anchor # permalinkSymbol: ¶ anchors: # Minimum level for ID creation. (Ex. h2 to h6) level: 2 # A suffix that is prepended to the number given if the ID is repeated. collisionSuffix: \u0026#39;\u0026#39; # If `true`, creates an anchor tag with a permalink besides the heading. permalink: true # Class used for the permalink anchor tag. permalinkClass: header-anchor # Set to \u0026#39;right\u0026#39; to add permalink after heading permalinkSide: \u0026#39;left\u0026#39; # The symbol used to make the permalink permalinkSymbol: ¶ # Transform anchor to (1) lower case; (2) upper case case: 0 # Replace space with a character separator: \u0026#39;-\u0026#39; 2.x 添加运行时间 https://blog.csdn.net/jieruis/article/details/104024884?utm_source=app\u0026app_version=4.21.0\n2.x 使用Github Action 自动布置 ruanyifeng\nhttp://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html\n![](https://github.com/组织或个人/仓库 /workflows/执行Action的Name注意转码/badge.svg) 编译过程图标 https://lindexi.oschina.io/post/Github-%E6%B7%BB%E5%8A%A0-Action-%E7%BC%96%E8%AF%91%E5%9B%BE%E6%A0%87.html\n自动部署\nref: https://sanonz.github.io/2020/deploy-a-hexo-blog-from-github-actions/\n2.x 配置clustrmaps 网站注册后，访问 Enter your website address 添加自己的网站地址，选择免费的服务。 \u0026lt;script type=\u0026#34;text/javascript\u0026#34; id=\u0026#34;clustrmaps\u0026#34; src=\u0026#34;//clustrmaps.com/map_v2.js?d=5Y5S382WVdS5Rafm-8SR-tSr5c6erGKcUlEEEb5LZBc\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 将代码插入到 \\themes\\next\\layout\\_macro\\sidebar.swig 文件的图层。\n\u0026lt;aside \u0026gt; {% if theme.sidebar.onmobile %} \u0026lt;div \u0026gt;\u0026lt;/div\u0026gt; {% endif %} \u0026lt;div class=\u0026#34;sidebar-inner\u0026#34;\u0026gt; {% set display_toc = is_post and theme.toc.enable or is_page and theme.toc.enable %} \u0026lt;!-- Insert clustrmaps.com --\u0026gt; \u0026lt;script type=\u0026#39;text/javascript\u0026#39; id=\u0026#39;clustrmaps\u0026#39; src=\u0026#39;//cdn.clustrmaps.com/map_v2.js? cl=ffffff\u0026amp;w=a\u0026amp;t=n\u0026amp;d=4sW93oXXX0e8\u0026#39;\u0026gt;\u0026lt;/script\u0026gt; {% if display_toc and toc(page.content).length \u0026gt; 1 %} ref: https://www.likecs.com/show-305889652.html#sc=500\nTODO 这个TODO中放的是，我接下来对博客搭建这个项目，要做的事。平台的debug，内容的设计等等。\n续写这篇博客，后面根据内容多少看要不要拆分这个博客。\n永久化连接 permalink ​ 这permalink 和本地图片的拷贝复制有关不好改，下面是可能的方法，由于现在的评论还比较少，后面改进。 ​ https://github.com/rozbo/hexo-abbrlink ​ https://github.com/EqualMa/hexo-plugin-permalink-pathed-title\ngitment object ProgressEvent #170 ​ gitment 出现问题 作者好像放弃了，所以网上有一些解决方案，(gitment issue #170)(https://github.com/imsun/gitment/issues/170)\n​ 临时使用https://www.wenjunjiang.win/js/gitment.js 这个gitment.js\n编写规范 得写一个博客的编写规范。分类、标签的使用，图片的使用，公式的使用等等\n博客编写规范 github上有项目图片就从项目中链接过来，比如头像就是我github的头像 重要的图片存在本项目中 Typora的使用 参考 Hexo-NexT配置超炫网页效果 好多新奇玩意儿～\nHexo gitment\n原文地址\n图标网站 icon8 web 比较舒服 http://fontawesome.io 标准风格 https://www.easyicon.net/ 国内的图标\n补充修改进行中，，，\n","permalink":"/post/c7-toolchain/hexo-blog/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e本文主要内容为博客搭建的记录与分享，我采用了Hexo博客框架，NexT主题和Gitment评论系统。本文中记录了我博客的安装流程和使用过程中的改进细节。\u003c/p\u003e\n\u003cp\u003e对Next主题版本的一些说明：我使用的是\u003ccode\u003eversion: 5.1.0\u003c/code\u003e。而使用新版本的NexT v6 主题的同学，有些功能如gitment已经实现，可以直接使用V6。此V6版本对于图片的使用可能会出现问题。仅需看看我下面的2.2小节。\u003c/p\u003e\n\u003cp\u003e有时间我会将我修改后的hexo Next theme 基于\u003ccode\u003eversion: 5.1.0\u003c/code\u003e主题，给个独立的git仓，放到github 上。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e小技巧：在文章中可以使用\u003ccode\u003e\u0026lt;!-- more --\u0026gt;\u003c/code\u003e手动进行截断，more上面部分将被放到主页上显示。此为Hexo 提供的方式。\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e下面就是用\u003ccode\u003e\u0026lt;!-- more --\u0026gt;\u003c/code\u003e截断的～～\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e在看安装教程的时候，发现怎么要涉及这么多东西，请大家不要担心，一步步来。同时也不用在意会不会nodejs，框架这些东西，人家已经帮我们把东西都写好了，我们做的就是改改配置文件，最多改改里面swig的模版的一些代码。最后，望大家见谅的是，我对js不太熟，有些地方不是很清楚。欢迎大家在下面评论，或者在github上开issue，共同讨论。\u003c/p\u003e\n\u003ch2 id=\"1-安装\"\u003e1. 安装\u003c/h2\u003e\n\u003ch3 id=\"11-简易安装使用\"\u003e1.1 简易安装使用\u003c/h3\u003e\n\u003cp\u003e使用新版本的 \u003ccode\u003eNexT v6\u003c/code\u003e 主题即可，有些功能如 \u003ccode\u003egitment\u003c/code\u003e 已经实现。对于图片的使用可能会出现问题。仅需看看我下面的2.2小节。我使用的是 \u003ccode\u003eversion: 5.1.0\u003c/code\u003e 。\u003c/p\u003e\n\u003ch3 id=\"12-从头安装\"\u003e1.2 从头安装\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e安装 nodejs，从nodejs 官网下载安装包 \u003ca href=\"https://nodejs.org/en/download/\"\u003edownload page\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e安装git客户端 \u003ca href=\"https://git-scm.com/\"\u003egit\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e安装Hexo \u003ccode\u003enpm install -g hexo-cli\u003c/code\u003e\n\u003ca href=\"https://hexo.io/zh-cn/docs/\"\u003ehexo 中文安装文档\u003c/a\u003e\n\u003ca href=\"https://hexo.io/zh-cn/\"\u003eHexo中文网站\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e安装NexT ，NexT是一个比较火的主题。\n按官网教程NexT安装即可，官网安装和配置教程比较美滋滋。\n\u003ca href=\"http://theme-next.iissnan.com/getting-started.html\"\u003ehttp://theme-next.iissnan.com/getting-started.html\u003c/a\u003e\nNexT Github  \u003ca href=\"https://github.com/iissnan/hexo-theme-next\"\u003ehttps://github.com/iissnan/hexo-theme-next\u003c/a\u003e\n另外，NexT开发者的博客（最近Next 变成组织了，祝贺）\u003ca href=\"http://notes.iissnan.com\"\u003ehttp://notes.iissnan.com\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eUbuntu安装记录\u003c/strong\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# for Ubuntu16.04\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ sudo apt install npm nodejs-legacy\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ sudo npm install hexo-cli -g\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ hexo init blog\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ cd blog\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ npm install\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$ hexo server\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eok，安装完的目录结构。\u003c/p\u003e","tags":["Hexo","NexT","博客搭建","知识管理"],"title":"hexo个人主页搭建"},{"categories":["工具"],"content":"前言 从YouTube上看只有中文或英文分开的字幕，下载好视频，想要中英文字幕。可从 Getting Youtube subtitles 获取中或英文字幕，然后将其合并，即成中英文双字幕。下面是Python脚本。\n\u0026#39;\u0026#39;\u0026#39; 本脚本完成了中英文srt合并的功能 \u0026#39;\u0026#39;\u0026#39; import os def srt2lis(name): lines = open(\u0026#39;srt/\u0026#39;+name, \u0026#39;r\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;).readlines() lis = [] tmp = [] for i, line in enumerate(lines): # 以\\n 结尾的一个时间点 if line == \u0026#39;\\n\u0026#39;: lis.append(tmp) tmp = [] else: tmp.append(line) return lis def hebing(name_zh): name_en = name_zh[:-7] + \u0026#39;.srt\u0026#39; out_name=\u0026#39;out/\u0026#39;+name_en f=open(out_name,\u0026#39;w\u0026#39;,encoding=\u0026#39;utf-8\u0026#39;) lis_en=srt2lis(name_en) lis_zh=srt2lis(name_zh) for i,item in enumerate(lis_en): print(item[0]) f.write(item[0]) f.write(item[1]) for line in lis_zh[i][2:]: f.write(line) for line in item[2:]: f.write(line) f.write(\u0026#39;\\n\u0026#39;) f.close() flis=os.listdir(\u0026#39;srt/\u0026#39;) if not os.path.exists(\u0026#39;out\u0026#39;): os.mkdir(\u0026#39;out\u0026#39;) for name in flis: print(name) if name[-6:-4]==\u0026#39;zh\u0026#39;: hebing(name) ","permalink":"/post/c7-toolchain/python-youtube-src-combine/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e从YouTube上看只有中文或英文分开的字幕，下载好视频，想要中英文字幕。可从 \u003ca href=\"http://mo.dbxdb.com/Yang/setting.html\"\u003eGetting Youtube subtitles\u003c/a\u003e 获取中或英文字幕，然后将其合并，即成中英文双字幕。下面是Python脚本。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e本脚本完成了中英文srt合并的功能\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e os\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrt2lis\u003c/span\u003e(name):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    lines \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;srt/\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003ename, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;r\u0026#39;\u003c/span\u003e, encoding\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf-8\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereadlines()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    lis \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    tmp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i, line \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e enumerate(lines):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# 以\\n 结尾的一个时间点\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e line \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            lis\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(tmp)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            tmp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            tmp\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(line)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e lis\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehebing\u003c/span\u003e(name_zh):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    name_en \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e name_zh[:\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;.srt\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    out_name\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;out/\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003ename_en\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    f\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eopen(out_name,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e,encoding\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;utf-8\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    lis_en\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esrt2lis(name_en)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    lis_zh\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esrt2lis(name_zh)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i,item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e enumerate(lis_en):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(item[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(item[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(item[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e line \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e lis_zh[i][\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e:]:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(line)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e line \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e item[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e:]:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(line)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eclose()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eflis\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003elistdir(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;srt/\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexists(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;out\u0026#39;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emkdir(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;out\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e name \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e flis:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(name)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e name[\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e:\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;zh\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        hebing(name)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","tags":["python","字幕"],"title":"SRT中英文合并Python脚本"},{"categories":["机器人"],"content":"前言 通过matlab对数字信号进行滤波器的设计后，我们要将设计好的参数放到嵌入式系统中进行滤波。本文就是一个滤波程序。\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;malloc.h\u0026gt; //z变换转成差分方程然后迭代 //Talen @UESTC 2015.6.5 //打印数组 void print(float *x,int len); //取后第1-n个 float* aminusone(float* a,int ar); //差分中间值 float gtcet(float *t,float *x,int xr,int s,int d); //主要滤波函数 float* gfilter(float *b,int br,float *a,int ar,float *x,int xr); void print(float *x,int len) { for(int i=0;i\u0026lt;len;i++) {printf(\u0026#34;%9.3f \u0026#34;,x[i]); if((i%7)==6) printf(\u0026#34;\\n\u0026#34;);} printf(\u0026#34;\\n\u0026#34;); } float* aminusone(float* a,int ar){ float* am = (float *)malloc((ar-1) * sizeof(float)); for(int i=0;i\u0026lt;ar-1;i++) am[i]=a[i+1]; return am; } float gtcet(float *t,float *x,int xr,int s,int d) //x[]数据源 r数据源长度 s开始点(0开始) d数据长度 //t可以是a[] b[] 长度与d一样 { float sum=0; float* w = (float *)malloc(d * sizeof(float)); for(int i=0;i\u0026lt;d;i++) { int temp=s-i; if(temp\u0026gt;=0\u0026amp;\u0026amp;temp\u0026lt;xr) w[i]=x[temp]; else w[i]=0; //核心语句 sum=sum+w[i]*t[i]; } return sum; } float* gfilter(float *b,int br,float *a,int ar,float *x,int xr) //b a x br b的长度 ar a的长度 xr数据长度 //use本程序定义的gtcet()和aminusone() //输入数据，b，a，x得出滤波后的y { float* y = (float *)malloc(xr* sizeof(float)); for(int ti=0;ti\u0026lt;xr;ti++) y[ti]=0; for(int i=0;i\u0026lt;xr;i++) { //最核心语句，此处迭代 y[i]=gtcet(b,x,xr,i,br)-gtcet(aminusone(a,ar),y,xr,i-1,ar-1); } return y; } int main() { //input 源数据 可修改 //////////////////////////////////////////////////////////////// float x[120]={-4, -2, 0, -4, -6, -4, -2, -4, -6, -6, -4, -4,\\ -6, -6, -2, 6, 12, 8, 0, -16, -38, -60, -84,\\ -90, -66, -32, -4, 2, -4, 8, 12, 12, 10, 6,\\ 6, 6, 4, 0, 0, 0, 0, 0, -2, -4, 0, 0, 0, -2,\\ -2, 0, 0, -2, -2, -2, -2, 0, -2, -4, -2, 0,\\ -2, -4, -4, 2, 0, 0, -2, -4, -2, 0, 0, -2,\\ -4, -2, 0, 0, -4, -4, -2, -2, -4, -6, -6,\\ -4, -4, 8, -10, -8, -6, -6, -8, -12, -10,\\ -8, -8, -10, -12, -10, -8, -8, -10, -10,\\ -8, -6, -6, -8, -8, -4, -2, -4, -4, -4,\\ 0, 0, -2, -4, -2, -2, 0, -4}; //参数 float b[7]={ 0.0007,0.0044,0.0111,0.0148,0.0111,0.0044,0.0007}; float a[7]={ 1.0000,-3.1836,4.6222,-3.7795,1.8136,-0.4800,0.0544}; ////////////////////////////////////////////////////////////////// //不要修改 int xr=sizeof(x)/sizeof(float); int br=sizeof(b)/sizeof(float); int ar=sizeof(a)/sizeof(float); //output 滤波后数据 float *y; printf(\u0026#34;参数b：\\n\u0026#34;);print(b,br); printf(\u0026#34;参数a：\\n\u0026#34;);print(a,ar); printf(\u0026#34;原数据：\\n\u0026#34;);print(x,xr); y=gfilter(b,br,a,ar,x,xr); printf(\u0026#34;滤波后数据：\\n\u0026#34;);print(y,xr); getchar(); return 0; } ","permalink":"/post/c2-robotics/dsp/dsp-filter/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e通过matlab对数字信号进行滤波器的设计后，我们要将设计好的参数放到嵌入式系统中进行滤波。本文就是一个滤波程序。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;malloc.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e//z变换转成差分方程然后迭代\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//Talen @UESTC 2015.6.5\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//打印数组\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ex,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e len);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//取后第1-n个\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaminusone\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e a,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e ar);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//差分中间值\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egtcet\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003et,\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ex,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e xr,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e s,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e d);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//主要滤波函数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egfilter\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eb,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e br,\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ea,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e ar,\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ex,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e xr);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprint\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ex,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e len)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;i\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003elen;i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%9.3f \u0026#34;\u003c/span\u003e,x[i]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e((i\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaminusone\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e a,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e ar){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e am \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#a6e22e\"\u003emalloc\u003c/span\u003e((ar\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;i\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003ear\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        am[i]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ea[i\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e am;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egtcet\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003et,\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ex,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e xr,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e s,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e d)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e//x[]数据源 r数据源长度 s开始点(0开始) d数据长度\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#75715e\"\u003e//t可以是a[] b[] 长度与d一样\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e sum\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e w \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#a6e22e\"\u003emalloc\u003c/span\u003e(d \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;i\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003ed;i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e temp\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003es\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003ei;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(temp\u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003etemp\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003exr)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            w[i]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ex[temp];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            w[i]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e//核心语句\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        sum\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esum\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003ew[i]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003et[i];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e sum;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egfilter\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eb,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e br,\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ea,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e ar,\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ex,\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e xr)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e//b a x br b的长度 ar a的长度 xr数据长度\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#75715e\"\u003e//use本程序定义的gtcet()和aminusone()\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#75715e\"\u003e//输入数据，b，a，x得出滤波后的y\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e y \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e)\u003cspan style=\"color:#a6e22e\"\u003emalloc\u003c/span\u003e(xr\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e ti\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;ti\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003exr;ti\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        y[ti]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;i\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003exr;i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e//最核心语句，此处迭代\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        y[i]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003egtcet\u003c/span\u003e(b,x,xr,i,br)\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003egtcet\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eaminusone\u003c/span\u003e(a,ar),y,xr,i\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,ar\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e y;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e//input 源数据 可修改\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#75715e\"\u003e////////////////////////////////////////////////////////////////\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e x[\u003cspan style=\"color:#ae81ff\"\u003e120\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e38\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e60\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e84\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e90\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e66\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e32\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e//参数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e b[\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{ \u003cspan style=\"color:#ae81ff\"\u003e0.0007\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0.0044\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0.0111\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0.0148\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0.0111\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0.0044\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0.0007\u003c/span\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e a[\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{ \u003cspan style=\"color:#ae81ff\"\u003e1.0000\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e3.1836\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e4.6222\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e3.7795\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1.8136\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.4800\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0.0544\u003c/span\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e//////////////////////////////////////////////////////////////////\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#75715e\"\u003e//不要修改\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e xr\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(x)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e br\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(b)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e ar\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(a)\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003esizeof\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e//output 滤波后数据\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003efloat\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003ey;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;参数b：\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\u003cspan style=\"color:#a6e22e\"\u003eprint\u003c/span\u003e(b,br);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;参数a：\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\u003cspan style=\"color:#a6e22e\"\u003eprint\u003c/span\u003e(a,ar);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;原数据：\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\u003cspan style=\"color:#a6e22e\"\u003eprint\u003c/span\u003e(x,xr);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    y\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003egfilter\u003c/span\u003e(b,br,a,ar,x,xr);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;滤波后数据：\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\u003cspan style=\"color:#a6e22e\"\u003eprint\u003c/span\u003e(y,xr);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003egetchar\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","tags":["滤波器","数字信号处理"],"title":"DSP滤波程序"},{"categories":["工具"],"content":"前言 网上有很多用笔记本设置无线热点的批处理，我中和了一下。复制下面代码到记事本，改后缀为bat就行了。其中，mssid和mkey可自定义\n@echo off set mssid=GOODGOOD ::网络名字 set mkey=123456789 ::大于八位密码 echo *********************************************** echo 打开承载网络 1 echo 关闭承载网络 2 echo 承载网络信息 3 echo 设置网络信息 set echo 退出 e echo （网络名字、密码可在源文件中改） echo （请以管理员身份打开!!!） echo *********************************************** :start set /p var=请选择: if %var%==1 netsh wlan start hostednetwork \u0026amp;\u0026amp; echo 网络名字:%mssid% 密码:%mkey% \u0026amp;\u0026amp; GOTO start if %var%==2 netsh wlan stop hostednetwork \u0026amp;\u0026amp; GOTO start if %var%==3 netsh wlan show hostednetwork \u0026amp;\u0026amp; echo 网络名字:%mssid% 密码:%mkey% \u0026amp;\u0026amp; GOTO start if %var%==set netsh wlan set hostednetwork mode=allow ssid=%mssid% key=%mkey% \u0026amp;\u0026amp; echo 网络名字:%mssid% 密码:%mkey% \u0026amp;\u0026amp; GOTO start if %var%==e pause 播放声音 保存为播放声音.vbs,可以播放声音\nCreateObject(\u0026#34;SAPI.SpVoice\u0026#34;).Speak \u0026#34;hello world\u0026#34; ","permalink":"/post/c7-toolchain/cmd-windowns-share-wifi/","summary":"\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e网上有很多用笔记本设置无线热点的批处理，我中和了一下。复制下面代码到记事本，改后缀为bat就行了。其中，mssid和mkey可自定义\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e@echo off\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eset mssid\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eGOODGOOD\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e::网络名字\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eset mkey\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e123456789\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e::大于八位密码\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho ***********************************************\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho              打开承载网络  \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho              关闭承载网络  \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho              承载网络信息  \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho              设置网络信息  set\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho              退出          e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho        （网络名字、密码可在源文件中改）\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho           （请以管理员身份打开!!!）\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho ***********************************************\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e:start\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eset /p var\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e请选择:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e %var%\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e netsh wlan start hostednetwork \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e echo 网络名字:%mssid% 密码:%mkey% \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e GOTO start\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e %var%\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e netsh wlan stop hostednetwork \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e GOTO start\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e %var%\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e netsh wlan show hostednetwork \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e echo 网络名字:%mssid% 密码:%mkey% \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e GOTO start\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e %var%\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003eset netsh wlan set hostednetwork mode\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eallow ssid\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e%mssid% key\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e%mkey% \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e echo 网络名字:%mssid% 密码:%mkey% \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e GOTO start\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e %var%\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003ee pause\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"播放声音\"\u003e播放声音\u003c/h2\u003e\n\u003cp\u003e保存为\u003ccode\u003e播放声音.vbs\u003c/code\u003e,可以播放声音\u003c/p\u003e","tags":["共享wifi","cmd"],"title":"Windows笔记本开共享wifi"},{"categories":["生活"],"content":"欢迎来到这里，送你个东西 ~\n博客算是一种有趣的玩物，体现出一个人很多个性的东西。书籍基本都有个引人入胜的序，我想为我的博客也写个序，如能引人入胜那便是赚到了。开博明意，本博客主要记录学习工作中自然科学、人文社科的芝麻知识点，以及生活的休闲杂记。记忆这东西很神奇，莫名其妙地记住一些事，但也不知不觉丢了些东西。在互联网或者说移动互联网之前，人们的记事方式更多的是纸质的，学习也是按照课本一页页去掌握，如今竞争的压力，信息的爆炸，技术信息发布平台多样，信息短快乱，工作与学习所用的知识点越来越多，越来越细，碎片化地学习无法避免的。\n如何去记录这些碎片的知识，整理归纳的方法论需求已经迫在眉睫。在Github上搭建一个带版本控制和评论功能的博客，我认为是个不错的想法。利用Markdown写文档比较方便，不需涉及很多格式设置的问题，风格想换就换，各个博客平台也支持这种语法格式。git对文本的版本控制比较舒服，我可以在多个终端进行编写，同步也方便，合并后利用hexo框架就可以发布。hexo的主题也比较多样，选用的Next主题有很多差价。Next主题在评论支持方面以前使用的是网易云跟帖，但这个功能网易关了，现在使用的Gitment，利用github的isuue功能的评论框架，现在仅支持github用户登录评论，但就用户面来说，我觉得够了，我写的这些博客主要是给自己看的。\n对我博客的寄语。希望利用博客建立个人有效的知识体系，锻炼写文章的水平，留下生活中有趣的事物，同时传递出有趣的想法，有效的和各位大牛交流相关领域的经验，在互联网村里共同成长与进步。\n笔者的hexo搭建的过程已废弃，当前使用hugohugo搭建.\n人是一棵会思考的芦苇，并有一个有趣的灵魂。\n不忘初心，活波严谨。\n感谢 The Internet And The World.\n联系方式 QQmail: tianchenggu@qq.com\nGmail: talenapp@gmail.com\nGithub as you know\n简单·有效\nKeep It Simple Stupid.\n登高·望远\nStanding on Shoulders of Giants.\nThank you !!!\n","permalink":"/post/c0-life/about/","summary":"\u003cp\u003e欢迎来到这里，送你个东西 ~\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n    \n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"london.jpeg\" \n     alt=\"london\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e博客算是一种有趣的玩物，体现出一个人很多个性的东西。书籍基本都有个引人入胜的序，我想为我的博客也写个序，如能引人入胜那便是赚到了。开博明意，本博客主要记录学习工作中自然科学、人文社科的芝麻知识点，以及生活的休闲杂记。记忆这东西很神奇，莫名其妙地记住一些事，但也不知不觉丢了些东西。在互联网或者说移动互联网之前，人们的记事方式更多的是纸质的，学习也是按照课本一页页去掌握，如今竞争的压力，信息的爆炸，技术信息发布平台多样，信息短快乱，工作与学习所用的知识点越来越多，越来越细，碎片化地学习无法避免的。\u003c/p\u003e\n\u003cp\u003e如何去记录这些碎片的知识，整理归纳的方法论需求已经迫在眉睫。在Github上搭建一个带版本控制和评论功能的博客，我认为是个不错的想法。利用Markdown写文档比较方便，不需涉及很多格式设置的问题，风格想换就换，各个博客平台也支持这种语法格式。git对文本的版本控制比较舒服，我可以在多个终端进行编写，同步也方便，合并后利用hexo框架就可以发布。hexo的主题也比较多样，选用的Next主题有很多差价。Next主题在评论支持方面以前使用的是网易云跟帖，但这个功能网易关了，现在使用的Gitment，利用github的isuue功能的评论框架，现在仅支持github用户登录评论，但就用户面来说，我觉得够了，我写的这些博客主要是给自己看的。\u003c/p\u003e\n\u003cp\u003e对我博客的寄语。希望利用博客建立个人有效的知识体系，锻炼写文章的水平，留下生活中有趣的事物，同时传递出有趣的想法，有效的和各位大牛交流相关领域的经验，在互联网村里共同成长与进步。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"../c7-toolchain/hexo-blog.md\"\u003e笔者的hexo搭建的过程\u003c/a\u003e已废弃，当前使用hugo\u003ca href=\"../c7-toolchain/hugo-build.md\"\u003ehugo搭建\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e人是一棵会思考的芦苇，并有一个有趣的灵魂。\u003c/p\u003e\n\u003cp\u003e不忘初心，活波严谨。\u003c/p\u003e\n\u003ch2 id=\"感谢\"\u003e感谢\u003c/h2\u003e\n\u003cp\u003eThe Internet And The World.\u003c/p\u003e\n\u003ch2 id=\"联系方式\"\u003e联系方式\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eQQmail: \u003ca href=\"mailto:tianchenggu@qq.com\"\u003etianchenggu@qq.com\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGmail:  \u003ca href=\"mailto:talenapp@gmail.com\"\u003etalenapp@gmail.com\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGithub as you know\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e简单·有效\u003c/p\u003e\n\u003cp\u003eKeep It Simple Stupid.\u003c/p\u003e\n\u003cp\u003e登高·望远\u003c/p\u003e\n\u003cp\u003eStanding on Shoulders of Giants.\u003c/p\u003e\n\u003cp\u003eThank you !!!\u003c/p\u003e","tags":["序言","博客"],"title":"序言"},{"categories":["工具"],"content":"文件head，设置标题、日期、分类、标签、评论、版权、是否使用公式，如下。\n--- title: 模版文件 date: 2019-07-25 12:00:00 updated: 2019-07-25 12:00:00 categories: - 博客搭建 - 模版文件 tags: - Writing comments: true copyright: true math: true --- 摘要\n本部分说明文章的写作意图。涉及的背景、主要内容、本文与其他文章关系等。\n本文为Hexo博客模版文件，以Markdown语言书写。\n前言一般放到主页，可利用 \u0026lt;!-- more --\u0026gt; 隔断。 1 构思与起草 对文章的阅读群体、写作意图和反馈（Audience Intention Response AIR）要有一个清楚的认识。照顾沟通对象的需要、你的意图（信息）以及希望的反馈。 在思维导图上，放上你需要的关键名词，然后依次在它基础上添加动词，在加上形容词。最后以一定顺序组织你将要阐述的信息。比如重要性排序，对比优势劣势，方案的不同层面，时间上逻辑上的因果性等等。 2 主体内容 文章的主要内容，包括你对跟进过程或发现成果的描述，以数据、事实证据以及其他的信息支撑主要内容。在你的论说中，你应该把对客观事实的描述和写作者对事情的主管阐述区分开来。\n当你在报告中对一个观点进行陈述的时候，你需要记住以下几点：\n清晰的呈现事实 有逻辑地提出论据 引用相关的语录、简明易懂的事实和例子来支持你的论点 给出支持或反对该行为的理由 始终围绕主要观点进行讨论 处理好重要的假设关系 区分说明（具体阐述）和论证（有理有据） 链接：https://talengu.github.io/\n2.1 图 ![GDP](http://www.stats.gov.cn/sj/zxfb/202302/W020230228515999473627.png) \u0026lt;div align=\u0026#39;center\u0026#39;\u0026gt; \u0026lt;b\u0026gt;图1 2022年国内生产总值及其增速度\u0026lt;/b\u0026gt;\u0026lt;/div\u0026gt; 这两行代码生成下面的图和标题。\n图 1 展示的是2018-2022年的GDP和增长速度，来自1。图中数据反应出国内生产总值在2018-2022年度增长率存在波动但稳中向好的情况。\n2.2 表 \u0026lt;div align=\u0026#39;center\u0026#39;\u0026gt; \u0026lt;b\u0026gt;表1 2018年年末人口数及其构成\u0026lt;/b\u0026gt;\u0026lt;/div\u0026gt; | 指标 | 年末数（万人） | 比重（%） | | ---------- | -------------- | --------- | | 全国总人口 | 139538 | 100.0 | | 其中：城镇 | 83137 | 59.58 | | 乡村 | 56401 | 40.42 | 这两行代码生成下面的表和标题。\n表1 2018年年末人口数及其构成 指标 年末数（万人） 比重（%） 全国总人口 139538 100.0 城镇 83137 59.58 乡村 56401 40.42 从表1中得出，2018年年末城镇人口占总人口的59.58%，乡村人口占总人口的40.42%，城镇人口大比例超过乡村人口。\n2.3 公式 $$ f=w_1 x_1 + w_2 x_2 \\tag{1} $$ 数学Tex代码渲染成下面的公式，见公式（1）。公式可以在网站2 进行可视化编写。 $$ f=w_1 x_1 + w_2 x_2 \\tag{1} $$\n定理证明 定理 3.1 如果时域混合场积分方程是时域电场积分方程与时域磁场积分方程的线性组合……\n证明：\n首先，由于 ……\n……\n根据 ……，结论得证。 ■\n3 写作检查 主体内容完成后，要进行写作检查。\n保证信息的准确性，时间地点等信息的准确。 确保语法规范性 段落写作 主题句，核心思想 使用关联词，但勿滥 表示转折：虽然，尽管，但是，相反的是，另一方面 对已阐述观点的强调：此外，与此同时，除此以外，再补充一点 阐述结果：结果是，相应的结果是，因此 简单的句子 15-25 精心选择词语 同一个意思，换一下说法 少用名词，多用动词。我们想用名词表达意思，采用动名组合，或者一个意群搭配上动词会更有力。 多用主动动词，少用被动动词 核对标点符号，逗号，与分号。英文的话，检查一下拼写 注意行为的语气 保持连贯性，使用一种统一的方式表达。 添加iframes \u0026lt;!-- {}替换为视频id，同时去掉{} --\u0026gt; \u0026lt;!-- 小破站 --\u0026gt; \u0026lt;iframe src=\u0026#34;https://player.bilibili.com/player.html?bvid={}\u0026#34; width=\u0026#34;640\u0026#34; height=\u0026#34;430\u0026#34;\u0026gt; \u0026lt;/iframe\u0026gt; \u0026lt;!-- youtube --\u0026gt; \u0026lt;iframe src=\u0026#34;https://www.youtube.com/embed/{}\u0026#34; width=\u0026#34;640\u0026#34; height=\u0026#34;430\u0026#34;\u0026gt; \u0026lt;/iframe\u0026gt; \u0026lt;!-- 腾讯视频 --\u0026gt; \u0026lt;iframe src=\u0026#34;http://v.qq.com/iframe/player.html?vid={}\u0026#34; width=\u0026#34;640\u0026#34; height=\u0026#34;430\u0026#34;\u0026gt; \u0026lt;/iframe\u0026gt; \u0026lt;!-- 优酷视频 --\u0026gt; \u0026lt;iframe src=\u0026#39;https://player.youku.com/embed/{}\u0026#39; width=\u0026#34;640\u0026#34; height=\u0026#34;430\u0026#34;\u0026gt; \u0026lt;/iframe\u0026gt; \u0026lt;!-- PDF --\u0026gt; \u0026lt;iframe src=\u0026#39;https://arxiv.org/pdf/1406.2661.pdf\u0026#39; width=\u0026#34;800\u0026#34; height=\u0026#34;450\u0026#34;\u0026gt; \u0026lt;/iframe\u0026gt; \u0026lt;!-- HTML --\u0026gt; \u0026lt;iframe src=\u0026#39;https://www.sohu.com/a/287817933_100118081\u0026#39; width=\u0026#34;800\u0026#34; height=\u0026#34;450\u0026#34;\u0026gt; \u0026lt;/iframe\u0026gt; 4 总结 一个清晰的总结应该概括全部论点。\n其他 逻辑清楚，达情切意3。准备看一些基础的逻辑学。 写完要读两遍，修改错别字，标点，语序连接等等。3 修改可以反着读，正着读对熟悉的材料会有一种连贯性忽略掉错误或者不顺的地方。 参考\n[^statics_report_2022]: [国家统计局：2022年国民经济和社会发展统计公报](http://www.stats.gov.cn/tjsj/zxfb/201902/t20190228_1651265.html) [^latex_editor]: [Latex公式在线可视化编辑器](http://latex.codecogs.com/eqneditor/editor.php) [^hetang]: 美学散步系列书籍 - 朱自清的《荷塘清韵》 国家统计局：2022年国民经济和社会发展统计公报\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nLatex公式在线可视化编辑器 or Latex\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n美学散步系列书籍 - 朱自清的《荷塘清韵》\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"/post/template/","summary":"\u003cp\u003e文件head，设置标题、日期、分类、标签、评论、版权、是否使用公式，如下。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e---\ntitle: 模版文件\ndate: 2019-07-25 12:00:00\nupdated: 2019-07-25 12:00:00\ncategories:\n  - 博客搭建\n  - 模版文件\ntags:\n  - Writing\ncomments: true\ncopyright: true\nmath: true\n---\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e摘要\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e本部分说明文章的写作意图。涉及的背景、主要内容、本文与其他文章关系等。\u003c/p\u003e\n\u003cp\u003e本文为Hexo博客模版文件，以Markdown语言书写。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e前言一般放到主页，可利用 \u0026lt;!-- more --\u0026gt; 隔断。\n\u003c/code\u003e\u003c/pre\u003e\u003c!-- more --\u003e\n\u003ch2 id=\"1-构思与起草\"\u003e1 构思与起草\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e对文章的阅读群体、写作意图和反馈（Audience Intention Response AIR）要有一个清楚的认识。照顾沟通对象的需要、你的意图（信息）以及希望的反馈。\u003c/li\u003e\n\u003cli\u003e在思维导图上，放上你需要的关键名词，然后依次在它基础上添加动词，在加上形容词。最后以一定顺序组织你将要阐述的信息。比如重要性排序，对比优势劣势，方案的不同层面，时间上逻辑上的因果性等等。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"2-主体内容\"\u003e2 主体内容\u003c/h2\u003e\n\u003cp\u003e文章的主要内容，包括你对跟进过程或发现成果的描述，以数据、事实证据以及其他的信息支撑主要内容。在你的论说中，你应该把对客观事实的描述和写作者对事情的主管阐述区分开来。\u003c/p\u003e\n\u003cp\u003e当你在报告中对一个观点进行陈述的时候，你需要记住以下几点：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e清晰的呈现事实\u003c/li\u003e\n\u003cli\u003e有逻辑地提出论据\u003c/li\u003e\n\u003cli\u003e引用相关的语录、简明易懂的事实和例子来支持你的论点\u003c/li\u003e\n\u003cli\u003e给出支持或反对该行为的理由\u003c/li\u003e\n\u003cli\u003e始终围绕主要观点进行讨论\u003c/li\u003e\n\u003cli\u003e处理好重要的假设关系\u003c/li\u003e\n\u003cli\u003e区分说明（具体阐述）和论证（有理有据）\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e链接：https://talengu.github.io/\u003c/p\u003e\n\u003ch3 id=\"21-图\"\u003e2.1 图\u003c/h3\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e![GDP](http://www.stats.gov.cn/sj/zxfb/202302/W020230228515999473627.png)\n\u0026lt;div align=\u0026#39;center\u0026#39;\u0026gt; \u0026lt;b\u0026gt;图1 2022年国内生产总值及其增速度\u0026lt;/b\u0026gt;\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这两行代码生成下面的图和标题。\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n\n\u003cdiv style=\"text-align: center;\"\u003e\n\u003cimg src=\"http://www.stats.gov.cn/sj/zxfb/202302/W020230228515999473627.png\" \n     alt=\"GDP\" \n      \n     style=\"width:80%;\"  \n/\u003e\n\u003c/div\u003e图 1 展示的是2018-2022年的GDP和增长速度，来自\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e。图中数据反应出国内生产总值在2018-2022年度增长率存在波动但稳中向好的情况。\u003c/p\u003e\n\u003ch3 id=\"22-表\"\u003e2.2 表\u003c/h3\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026lt;div align=\u0026#39;center\u0026#39;\u0026gt; \u0026lt;b\u0026gt;表1 2018年年末人口数及其构成\u0026lt;/b\u0026gt;\u0026lt;/div\u0026gt;\n\n| 指标       | 年末数（万人） | 比重（%） |\n| ---------- | -------------- | --------- |\n| 全国总人口 | 139538         | 100.0     |\n| 其中：城镇 | 83137          | 59.58     |\n| 乡村       | 56401          | 40.42     |\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这两行代码生成下面的表和标题。\u003c/p\u003e","tags":["博客模版","工具"],"title":"博客模版"},{"categories":null,"content":"This is first page\n","permalink":"/about/","summary":"\u003cp\u003eThis is first page\u003c/p\u003e","tags":null,"title":"Hello Hugo"}]