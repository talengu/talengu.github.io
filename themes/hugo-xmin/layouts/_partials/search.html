<li style="float:right; position:relative; margin-left:1em;">
  <input type="text" id="search-box" placeholder="æœç´¢æ–‡ç« ..." 
         style="padding:0.3em 0.6em; border-radius:4px; border:1px solid #ccc; width:150px; min-width:100px; max-width:250px;">
  <ul id="search-results" 
      style="position:absolute; top:100%; right:0; background:#fff; border:1px solid #ccc; 
             max-height:300px; overflow-y:auto; display:none; z-index:1000; list-style:none; 
             padding:0; margin:0; width:250px;"></ul>
</li>

<!-- CSS å¯ä»¥æ”¾åœ¨ partial é‡Œæˆ–å•ç‹¬å¼•ç”¨ -->
<style>
/* ===== æœç´¢ç»“æœåŸºç¡€æ ·å¼ ===== */

.search-item {
  padding: 0.4em 0.6em;
}

.search-link {
  display: block;
  font-weight: 500;
  text-decoration: none;
  color: #007acc;
}

.search-snippet {
  font-size: 0.85em;
  color: #555;
  margin-top: 0.2em;
  line-height: 1.4;
}

/* é«˜äº®å…³é”®è¯ */
.search-highlight {
  background: rgba(255, 235, 59, 0.5);
  padding: 0 0.15em;
  border-radius: 3px;
}

/* hover æ•ˆæœ */
.search-item:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

/* ===== ğŸŒ™ è‡ªåŠ¨æ·±è‰²æ¨¡å¼ ===== */
@media (prefers-color-scheme: dark) {

  .search-link {
    color: #4fc3f7;
  }

  .search-snippet {
    color: #aaa;
  }

  .search-item:hover {
    background-color: rgba(104, 99, 99, 0.273);
  }

  .search-highlight {
    background: rgba(255, 193, 7, 0.35);
  }
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
<script>
fetch('{{ "/post/index.json" | relURL }}')
  .then(res => res.json())
  .then(data => {

    const fuse = new Fuse(data, {
      keys: [
        { name: "title", weight: 2 },
        { name: "summary", weight: 1 },
        { name: "content", weight: 0.7 }
      ],
      threshold: 0.3,
      ignoreLocation: true,
      minMatchCharLength: 2
    });

    const input = document.getElementById('search-box');
    const resultsEl = document.getElementById('search-results');

    function highlight(text, keyword) {
      if (!text) return '';
      const escaped = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const regex = new RegExp(`(${escaped})`, 'gi');
      return text.replace(regex, '<mark class="search-highlight">$1</mark>');
    }

    function excerpt(text, keyword, length = 80) {
      const idx = text.toLowerCase().indexOf(keyword.toLowerCase());
      if (idx === -1) return text.slice(0, length) + 'â€¦';

      const start = Math.max(0, idx - length / 2);
      const end = Math.min(text.length, idx + length / 2);
      return 'â€¦' + text.slice(start, end) + 'â€¦';
    }

    input.addEventListener('input', function () {
      const query = this.value.trim();
      if (!query) {
        resultsEl.style.display = 'none';
        resultsEl.innerHTML = '';
        return;
      }

      const results = fuse.search(query);

      resultsEl.innerHTML = results.slice(0, 8).map(r => {
        const item = r.item;
        const snippet = excerpt(item.content || item.summary || '', query);

        return `
          <li class="search-item">
            <a href="${item.permalink}" class="search-link">
              ${highlight(item.title, query)}
            </a>
            <div class="search-snippet">
              ${highlight(snippet, query)}
            </div>
          </li>
        `;
      }).join('');

      resultsEl.style.display = results.length ? 'block' : 'none';
    });

    document.addEventListener('click', e => {
      if (!input.contains(e.target) && !resultsEl.contains(e.target)) {
        resultsEl.style.display = 'none';
      }
    });
  });
</script>