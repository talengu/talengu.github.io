<!doctype html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/public/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/public/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/public/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="隧道技术,"><link rel="alternate" href="/public/atom.xml" title="一塘" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/public/images/favicon_blog.png?v=5.1.0"><meta name="description" content="本文由 简悦 SimpRead 转码， 原文地址 juejin.cn   ¶0. 前言 在学习 ipsec 过程中，一般都会涉及到 ipsec 的局限性：ipsec 协议是一种点对点协议，不支持组播，也不能保护组播、广播报文。因此 ipsec 协议无法用于音视频会议等场合，此时通常的解决办法是采用 GRE Over IPSec . 给出的解释是：GRE 协议可以封装组播、广播报文，但是无法对业务"><meta name="keywords" content="隧道技术"><meta property="og:type" content="article"><meta property="og:title" content="「转」GRE隧道测试"><meta property="og:url" content="https://talengu.github.io/2022/05/05/linux/gre_test/index.html"><meta property="og:site_name" content="一塘"><meta property="og:description" content="本文由 简悦 SimpRead 转码， 原文地址 juejin.cn   ¶0. 前言 在学习 ipsec 过程中，一般都会涉及到 ipsec 的局限性：ipsec 协议是一种点对点协议，不支持组播，也不能保护组播、广播报文。因此 ipsec 协议无法用于音视频会议等场合，此时通常的解决办法是采用 GRE Over IPSec . 给出的解释是：GRE 协议可以封装组播、广播报文，但是无法对业务"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/e31bac5bcb1347a59142486adaf94e30.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/db260d2dc98445f9988f1c768ca3e744.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/412f1154b6c64d74acd7b8cb31f713a5.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/e080bb892ca045a3b92f83ace7642a68.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/4759759198334a2ebc2c296e548026b0.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/772109c097cd48cab17c50d4dad64b10.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/2410e66154a84a70b95d16a5df32e360.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/f70bfbe84af74c21bab5b21a5bea3821.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/26f4422a5f9d4772ac9a354db2dd9847.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/2df9a98e03d54319ad3b00704fc31a32.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/b01f9527ea6842b68acbf612ec34c084.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/8752f3648dbc4dc4bd9036f00348ec9c.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/773d0b1700254e8ba9f847fdc2e79fd4.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/fbefdbdcba514312960176a103139de9.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/199432ae8e9e40e8b993ec0a0bca9016.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/e9e2f1e4871f4c42ade68774b4bb4e75.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/8618b40c1afb497dbc85234fd0c58ad8.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/da52fb97c1044858bd28e645df512622.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/1a28e720a97746f3a801a824a9ff95fd.jpg"><meta property="og:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/5d3739151b0843c98c1c7352e91008c3.jpg"><meta property="og:updated_time" content="2022-10-05T22:52:28.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="「转」GRE隧道测试"><meta name="twitter:description" content="本文由 简悦 SimpRead 转码， 原文地址 juejin.cn   ¶0. 前言 在学习 ipsec 过程中，一般都会涉及到 ipsec 的局限性：ipsec 协议是一种点对点协议，不支持组播，也不能保护组播、广播报文。因此 ipsec 协议无法用于音视频会议等场合，此时通常的解决办法是采用 GRE Over IPSec . 给出的解释是：GRE 协议可以封装组播、广播报文，但是无法对业务"><meta name="twitter:image" content="https://talengu.github.io/public/2022/05/05/linux/gre_test/e31bac5bcb1347a59142486adaf94e30.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/public/",scheme:"Pisces",sidebar:{position:"left",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!0},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://talengu.github.io/2022/05/05/linux/gre_test/"><title> 「转」GRE隧道测试 | 一塘</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/talengu" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/public/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">一塘</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/public/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-archives"><a href="/public/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 往期</a></li><li class="menu-item menu-item-categories"><a href="/public/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-tags"><a href="/public/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://talengu.github.io/public/2022/05/05/linux/gre_test/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="一塘"><meta itemprop="description" content><meta itemprop="image" content="https://avatars1.githubusercontent.com/u/10290923?v=3&s=460"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="一塘"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 「转」GRE隧道测试</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-05-05T22:52:28+00:00">2022-05-05</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <time title="更新于" itemprop="dateModified" datetime="2022-10-05T22:52:28+00:00">2022-10-05</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/public/categories/计算机网络/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a></span></span> <span class="post-meta-divider">|</span><span class="page-pv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span title="字数统计">3.3k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span title="阅读时长">16</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>本文由 <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">简悦 SimpRead</a> 转码， 原文地址 <a href="https://juejin.cn/post/6988645230987706398" target="_blank" rel="noopener">juejin.cn</a></p></blockquote><p><img src="/public/2022/05/05/linux/gre_test/e31bac5bcb1347a59142486adaf94e30.jpg" alt></p><h2 id="0-前言"><a class="header-anchor" href="#0-前言">¶</a>0. 前言</h2><p>在学习 ipsec 过程中，一般都会涉及到 ipsec 的局限性：ipsec 协议是一种点对点协议，不支持组播，也不能保护组播、广播报文。因此 ipsec 协议无法用于音视频会议等场合，此时通常的解决办法是采用 <strong>GRE Over IPSec</strong> .</p><p>给出的解释是：GRE 协议可以封装组播、广播报文，但是无法对业务内容进行加密；而 ipsec 可以对报文进行加密，但是无法封装组播和广播报文。因此将两种协议结合，因而 GRE over IPSec 协议应运而生。 但是我找了很多资料 (其实没有多少)，都没有找到为什么 GRE 协议支持封装组播和广播报文，而 ipsec 不行；他们作为点对点协议，为什么 GRE 可以而 IPsec 不行呢？因为没有找到答案，所以不能证实自己的想法正确与否，于是通过搭建 GRE 隧道环境，学习 Linux 内核中 GRE 隧道的操作配置原则，希望能从中得到些许启发。</p><p>搭建 GRE 隧道环境实际上是很简单的，因为 Linux 内核已经支持了 GRE 隧道，因此直接在虚拟机 (ubuntu 和 CentOS) 里进行简单的配置即可完成操作。</p><a id="more"></a><p><img src="/public/2022/05/05/linux/gre_test/db260d2dc98445f9988f1c768ca3e744.jpg" alt></p><h2 id="1-Linux-内核支持的隧道类型"><a class="header-anchor" href="#1-Linux-内核支持的隧道类型">¶</a>1. Linux 内核支持的隧道类型</h2><p>目前 Linux 内核已经支持多种隧道类型，包括：IPIP 隧道，GRE 隧道，... 。其余这几个我也没见过。当然除了这几种，还有 ipsec 协议，l2tp 协议，可以的是我目前都还没有用过，实在是暴殄天物，罪过罪过</p><p><img src="/public/2022/05/05/linux/gre_test/412f1154b6c64d74acd7b8cb31f713a5.jpg" alt></p><p><img src="/public/2022/05/05/linux/gre_test/e080bb892ca045a3b92f83ace7642a68.jpg" alt></p><p>下面通过搭建两组拓扑环境，来学习 GRE 隧道的基本规则，然后在此基础上分析下 GRE 和 IPSEC 在组播和广播报文封装的表现出不同行为的可能原因 (另写一遍文章喽)。</p><h2 id="2-GRE-隧道跨-公-网连接相同子网地址主机"><a class="header-anchor" href="#2-GRE-隧道跨-公-网连接相同子网地址主机">¶</a>2. GRE 隧道跨 (公) 网连接相同子网地址主机</h2><h3 id="2-1-拓扑环境"><a class="header-anchor" href="#2-1-拓扑环境">¶</a>2.1 拓扑环境</h3><p><img src="/public/2022/05/05/linux/gre_test/4759759198334a2ebc2c296e548026b0.jpg" alt></p><p>家里设备有限，只有一台电脑，还是通过无线网卡来上网的，因此拓扑环境比较寒酸，其实这些并不重要，只需明白我的两台虚拟机 Ubantu 和 CentOS 通过桥接的方式连在一起，网络上可以通讯即可。</p><p>现在，我准备将两个地址分别为 10.1.2.1/24、10.1.2.2/24 的两台主机 (假的，只是个 IP 地址而已) 通过 GRE 隧道连接起来进行通讯。原则上这两个地址属于不同的子网中(Ubantu 中的子网和 CentOS 中的子网，只是这两个子网的网段相同仅此而已)，无法直接通讯。</p><h3 id="2-1-ubuntu-配置"><a class="header-anchor" href="#2-1-ubuntu-配置">¶</a>2.1 ubuntu 配置</h3><p>首先，我确定了下该虚拟机中是否存在 gre 相关的接口，结果当然是没有了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/home/toney<span class="comment"># ifconfig -a</span></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.10  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 2409:8a00:18e9:810:f8dd:500e:b1a:463b  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 fe80::8e84:574c:7a8b:440a  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:fb:db:ad  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 3581  bytes 1030105 (1.0 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 1177  bytes 114532 (114.5 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 160  bytes 12920 (12.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 160  bytes 12920 (12.9 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="2-1-1-添加-GRE-隧道"><a class="header-anchor" href="#2-1-1-添加-GRE-隧道">¶</a>2.1.1 添加 GRE 隧道</h4><blockquote><p>ip tunnel add Tunnel-1 mode gre remote 192.168.1.13 local 192.168.1.10</p></blockquote><p>添加 GRE 隧道时, 需要指定隧道的名称，我这里叫做 Tunnel-1; 因为要搭建 GRE 类型隧道，因此 mode 为 gre。 而 GRE 隧道的地址为 192.168.1.13&lt;========&gt;192.168.1.10。</p><p>由于是第一次执行此命令，底层实际上安装上了 gre 隧道相关的驱动。用户只有在此基础上才能配置 GRE 隧道，不过，无需担心，内核自动完成。</p><p>如果在添加隧道时不指定 remote 和 local 地址，也是可以的，它实际上是只是安装 gre 隧道相关驱动。下面是添加隧道时没有指定 remote 和 local 地址时的结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">root@ubantu:/home/toney<span class="comment"># ip tunnel add Tunnel-1</span></span><br><span class="line">cannot determine tunnel mode (ipip, gre, vti or sit)</span><br><span class="line">root@ubantu:/home/toney<span class="comment"># ifconfig -a</span></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.10  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 2409:8a00:18e9:810:200d:99e2:4f3d:cb6f  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 fe80::8e84:574c:7a8b:440a  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:fb:db:ad  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 5038  bytes 5896155 (5.8 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 2744  bytes 309264 (309.2 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 164  bytes 15044 (15.0 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 164  bytes 15044 (15.0 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">root@ubantu:/home/toney<span class="comment"># ip tunnel add Tunnel-1 mode gre</span></span><br><span class="line">add tunnel <span class="string">"gre0"</span> failed: File exists</span><br><span class="line">root@ubantu:/home/toney<span class="comment"># ifconfig -a</span></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.10  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 2409:8a00:18e9:810:200d:99e2:4f3d:cb6f  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 fe80::8e84:574c:7a8b:440a  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:fb:db:ad  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 5097  bytes 5900501 (5.9 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 2766  bytes 311496 (311.4 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">erspan0: flags=4098&lt;BROADCAST,MULTICAST&gt;  mtu 1450</span><br><span class="line">        ether 00:00:00:00:00:00  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">gre0: flags=128&lt;NOARP&gt;  mtu 1452</span><br><span class="line">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 1000  (UNSPEC)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">gretap0: flags=4098&lt;BROADCAST,MULTICAST&gt;  mtu 1462</span><br><span class="line">        ether 00:00:00:00:00:00  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 164  bytes 15044 (15.0 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 164  bytes 15044 (15.0 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">root@ubantu:/home/toney<span class="comment">#</span></span><br><span class="line">root@ubantu:/home/toney<span class="comment"># lsmod | grep gre</span></span><br><span class="line">ip_gre                 28672  0</span><br><span class="line">ip_tunnel              24576  1 ip_gre</span><br><span class="line">gre                    16384  1 ip_gre</span><br><span class="line">root@ubantu:/home/toney<span class="comment">#</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>如果输入完整的命令，则会成功添加上 Tunnel-1 隧道：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">root@ubantu:/home/toney<span class="comment"># ifconfig -a</span></span><br><span class="line">Tunnel-1: flags=144&lt;POINTOPOINT,NOARP&gt;  mtu 1476</span><br><span class="line">        unspec C0-A8-01-0A-00-00-00-87-00-00-00-00-00-00-00-00  txqueuelen 1000  (UNSPEC)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.10  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 2409:8a00:18e9:810:141:383c:ac6f:8b11  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 2409:8a00:18e9:810:200d:99e2:4f3d:cb6f  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 fe80::8e84:574c:7a8b:440a  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:fb:db:ad  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 5745  bytes 5947674 (5.9 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 2965  bytes 329731 (329.7 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">erspan0: flags=4098&lt;BROADCAST,MULTICAST&gt;  mtu 1450</span><br><span class="line">        ether 00:00:00:00:00:00  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">gre0: flags=128&lt;NOARP&gt;  mtu 1452</span><br><span class="line">        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 1000  (UNSPEC)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">gretap0: flags=4098&lt;BROADCAST,MULTICAST&gt;  mtu 1462</span><br><span class="line">        ether 00:00:00:00:00:00  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 169  bytes 15509 (15.5 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 169  bytes 15509 (15.5 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="2-1-2-配置-GRE-隧道接口-IP"><a class="header-anchor" href="#2-1-2-配置-GRE-隧道接口-IP">¶</a>2.1.2 配置 GRE 隧道接口 IP</h4><blockquote><p>ip addr add 10.1.2.1/24 dev Tunnel-1</p></blockquote><p>或者</p><blockquote><p>ifconfig Tunnel-1 10.1.2.1/24</p></blockquote><p>从添加隧道结果来看，Tunnel-1 接口虽然已经成功添加，但是处于 down 状态，此外也没有 IP 地址。 不，等等，那我们在添加隧道时指定的 remote 和 local 是什么呢？</p><p><strong>它是经过 <strong><strong>GRE</strong></strong> 隧道封装后的报文 <strong><strong>IP</strong></strong> 地址，但是针对什么报文进行封装，目前我们尚未配置</strong>。</p><p>配置此接口 IP 的目的是：为了确定哪些报文需要进入 GRE 接口，然后进行隧道封装。为什么需要添加 IP 呢？ 因为我们是通过路由将报文引入到 Tunnel-1 接口的, 如果不填 IP，那么我路由的下一条该写成什么呢， 是吧。</p><p><img src="/public/2022/05/05/linux/gre_test/772109c097cd48cab17c50d4dad64b10.jpg" alt></p><h4 id="2-1-3-激活-GRE-隧道接口-IP"><a class="header-anchor" href="#2-1-3-激活-GRE-隧道接口-IP">¶</a>2.1.3 激活 GRE 隧道接口 IP</h4><blockquote><p>ifconfig Tunnel-1 up</p></blockquote><p>或者</p><blockquote><p>ip link set Tunnel-1 up</p></blockquote><p>至于配置接口 IP 和是否 up 接口，没有什么先后顺序，把他们当做不同的 eth 接口处理即可。</p><p><img src="/public/2022/05/05/linux/gre_test/2410e66154a84a70b95d16a5df32e360.jpg" alt></p><h3 id="2-2-CentOS-配置"><a class="header-anchor" href="#2-2-CentOS-配置">¶</a>2.2 CentOS 配置</h3><p>CentOS 虚拟机的配置和 Ubantu 的配置完全相同，安照此步骤操作即可。</p><blockquote><p>ip tunnel add Tunnel-1 mode gre local 192.168.1.13 remote 192.168.1.10<br> ip link set Tunnel-1 up<br> ip addr add 10.1.2.2/24 dev Tunnel-1</p></blockquote><p>查看配置结果 r 如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@toney toney]#</span><br><span class="line">[root@toney toney]#</span><br><span class="line">[root@toney toney]# ifconfig</span><br><span class="line">Tunnel-1  Link encap:UNSPEC  HWaddr C0-A8-01-0D-FF-FF-90-6D-00-00-00-00-00-00-00-00</span><br><span class="line">          inet addr:10.1.2.2  P-t-P:10.1.2.2  Mask:255.255.255.0</span><br><span class="line">          UP POINTOPOINT RUNNING NOARP  MTU:1476  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0</span><br><span class="line">          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</span><br><span class="line"></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:DA:34:3C</span><br><span class="line">          inet addr:192.168.1.13  Bcast:192.168.1.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: 2409:8a00:18e9:810:20c:29ff:feda:343c/64 Scope:Global</span><br><span class="line">          inet6 addr: fe80::20c:29ff:feda:343c/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:3571 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:781 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000</span><br><span class="line">          RX bytes:236685 (231.1 KiB)  TX bytes:71021 (69.3 KiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:4 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:4 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0</span><br><span class="line">          RX bytes:240 (240.0 b)  TX bytes:240 (240.0 b)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>路由表信息如下：</p><p><img src="/public/2022/05/05/linux/gre_test/f70bfbe84af74c21bab5b21a5bea3821.jpg" alt></p><h3 id="2-3-ping-包测试通讯链路"><a class="header-anchor" href="#2-3-ping-包测试通讯链路">¶</a>2.3 ping 包测试通讯链路</h3><p>这里有一点需要注意：Linux 系统可能开了 iptables 过滤功能，因此在 ping 时出现了类似 &quot;ICMP host 192.168.1.13 unreachable - admin prohibited, length 116&quot; 信息，详情如下：</p><p><img src="/public/2022/05/05/linux/gre_test/26f4422a5f9d4772ac9a354db2dd9847.jpg" alt></p><p>百度一下, 在两台虚拟机上都执行如下操作即可：</p><blockquote><p>iptables -F</p></blockquote><p>然后在 ping 包测试，数据可通：</p><p><img src="/public/2022/05/05/linux/gre_test/2df9a98e03d54319ad3b00704fc31a32.jpg" alt></p><p><img src="/public/2022/05/05/linux/gre_test/b01f9527ea6842b68acbf612ec34c084.jpg" alt></p><p>至此，基本 GRE 隧道环境搭建成功。</p><h2 id="3-GRE-隧道跨-公-网连接不同子网地址主机"><a class="header-anchor" href="#3-GRE-隧道跨-公-网连接不同子网地址主机">¶</a>3. GRE 隧道跨 (公) 网连接不同子网地址主机</h2><h3 id="3-1-拓扑环境"><a class="header-anchor" href="#3-1-拓扑环境">¶</a>3.1 拓扑环境</h3><p><img src="/public/2022/05/05/linux/gre_test/8752f3648dbc4dc4bd9036f00348ec9c.jpg" alt></p><p><strong>目的：</strong> 通过 GRE 隧道将 20.1.2.1/24、20.1.3.2/24 两个子网连接起来进行通讯。</p><h3 id="3-2-Ubantu-配置"><a class="header-anchor" href="#3-2-Ubantu-配置">¶</a>3.2 Ubantu 配置</h3><h4 id="3-2-1-配置-ens33-子接口-IP"><a class="header-anchor" href="#3-2-1-配置-ens33-子接口-IP">¶</a>3.2.1 配置 ens33 子接口 IP</h4><blockquote><p>ifconfig eth0:1 192.168.100.1/24</p></blockquote><p>查看接口配置如下：</p><p><img src="/public/2022/05/05/linux/gre_test/773d0b1700254e8ba9f847fdc2e79fd4.jpg" alt></p><h4 id="3-2-2-添加另一个-GRE-隧道接口并-up"><a class="header-anchor" href="#3-2-2-添加另一个-GRE-隧道接口并-up">¶</a>3.2.2 添加另一个 GRE 隧道接口并 up</h4><blockquote><p>ip tunnel add Tunnel-2 mode gre local 192.168.100.1 remote 192.168.100.2</p><p>ifconfig Tunnel-2 up</p></blockquote><h4 id="3-2-3-配置隧道接口-IP"><a class="header-anchor" href="#3-2-3-配置隧道接口-IP">¶</a>3.2.3 配置隧道接口 IP</h4><blockquote><p>ifconfig Tunnel-2 20.1.2.1/24</p></blockquote><p><img src="/public/2022/05/05/linux/gre_test/fbefdbdcba514312960176a103139de9.jpg" alt></p><h4 id="3-2-4-添加对端子网路由表"><a class="header-anchor" href="#3-2-4-添加对端子网路由表">¶</a>3.2.4 添加对端子网路由表</h4><p>由于本端没有对端子网 20.1.3.0/24 的路由，因此需要添加路由，将该网段报文引入到 Tunnel-2 接口，这样便可以通过 GRE 隧道进行封装。</p><blockquote><p>route add -net 20.1.3.0/24 gw 20.1.2.1</p></blockquote><p><img src="/public/2022/05/05/linux/gre_test/199432ae8e9e40e8b993ec0a0bca9016.jpg" alt></p><h3 id="3-3-CentOS-配置"><a class="header-anchor" href="#3-3-CentOS-配置">¶</a>3.3 CentOS 配置</h3><h4 id="3-3-1-配置-ens33-子接口-IP"><a class="header-anchor" href="#3-3-1-配置-ens33-子接口-IP">¶</a>3.3.1 配置 ens33 子接口 IP</h4><blockquote><p>ifconfig ens33:1 192.168.100.2/24</p></blockquote><p><img src="/public/2022/05/05/linux/gre_test/e9e2f1e4871f4c42ade68774b4bb4e75.jpg" alt></p><h4 id="3-3-2-添加另一个-GRE-隧道接口并-up"><a class="header-anchor" href="#3-3-2-添加另一个-GRE-隧道接口并-up">¶</a>3.3.2 添加另一个 GRE 隧道接口并 up</h4><blockquote><p>ip tunnel add Tunnel-2 mode gre remote 192.168.100.1 local 192.168.100.2</p><p>ifconfig Tunnel-2 up</p></blockquote><p>结果如下：</p><p><img src="/public/2022/05/05/linux/gre_test/8618b40c1afb497dbc85234fd0c58ad8.jpg" alt></p><h4 id="3-3-3-配置隧道接口-IP"><a class="header-anchor" href="#3-3-3-配置隧道接口-IP">¶</a>3.3.3 配置隧道接口 IP</h4><blockquote><p>ifconfig Tunnel-2 20.1.3.1/24</p></blockquote><h4 id="3-3-4-添加对端子网路由表"><a class="header-anchor" href="#3-3-4-添加对端子网路由表">¶</a>3.3.4 添加对端子网路由表</h4><p>由于本端没有对端子网 20.1.2.0/24 的路由，因此需要添加路由，将该网段报文引入到 Tunnel-2 接口，这样便可以通过 GRE 隧道进行封装。</p><blockquote><p>route add -net 20.1.2.0/24 gw 20.1.3.1</p></blockquote><p><img src="/public/2022/05/05/linux/gre_test/da52fb97c1044858bd28e645df512622.jpg" alt></p><h3 id="3-4-ping-测试链路连通性"><a class="header-anchor" href="#3-4-ping-测试链路连通性">¶</a>3.4 ping 测试链路连通性</h3><p><img src="/public/2022/05/05/linux/gre_test/1a28e720a97746f3a801a824a9ff95fd.jpg" alt></p><p><img src="/public/2022/05/05/linux/gre_test/5d3739151b0843c98c1c7352e91008c3.jpg" alt></p><p>​</p></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/public/tags/隧道技术/" rel="tag"># 隧道技术</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/public/2022/04/16/rss_local_install/" rel="next" title="本地安装rss"><i class="fa fa-chevron-left"></i> 本地安装rss</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/public/2022/05/08/rss_ttrss_statics/" rel="prev" title="rss统计 基于ttrss的PostgresQL数据库">rss统计 基于ttrss的PostgresQL数据库<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="gitalk-container"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://avatars1.githubusercontent.com/u/10290923?v=3&s=460" alt="一塘"><p class="site-author-name" itemprop="name">一塘</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/public/archives"><span class="site-state-item-count">69</span> <span class="site-state-item-name">博客</span></a></div><div class="site-state-item site-state-categories"> <a href="/public/categories/index.html"><span class="site-state-item-count">57</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/public/tags/index.html"><span class="site-state-item-count">125</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/public/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/talengu" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="/public/2015/01/01/About" target="_blank" title="About"><i class="fa fa-fw fa-globe"></i> About</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-前言"><span class="nav-text">¶0. 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Linux-内核支持的隧道类型"><span class="nav-text">¶1. Linux 内核支持的隧道类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-GRE-隧道跨-公-网连接相同子网地址主机"><span class="nav-text">¶2. GRE 隧道跨 (公) 网连接相同子网地址主机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-拓扑环境"><span class="nav-text">¶2.1 拓扑环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-ubuntu-配置"><span class="nav-text">¶2.1 ubuntu 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-添加-GRE-隧道"><span class="nav-text">¶2.1.1 添加 GRE 隧道</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-配置-GRE-隧道接口-IP"><span class="nav-text">¶2.1.2 配置 GRE 隧道接口 IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-激活-GRE-隧道接口-IP"><span class="nav-text">¶2.1.3 激活 GRE 隧道接口 IP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-CentOS-配置"><span class="nav-text">¶2.2 CentOS 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-ping-包测试通讯链路"><span class="nav-text">¶2.3 ping 包测试通讯链路</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-GRE-隧道跨-公-网连接不同子网地址主机"><span class="nav-text">¶3. GRE 隧道跨 (公) 网连接不同子网地址主机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-拓扑环境"><span class="nav-text">¶3.1 拓扑环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Ubantu-配置"><span class="nav-text">¶3.2 Ubantu 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-配置-ens33-子接口-IP"><span class="nav-text">¶3.2.1 配置 ens33 子接口 IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-添加另一个-GRE-隧道接口并-up"><span class="nav-text">¶3.2.2 添加另一个 GRE 隧道接口并 up</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-配置隧道接口-IP"><span class="nav-text">¶3.2.3 配置隧道接口 IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-添加对端子网路由表"><span class="nav-text">¶3.2.4 添加对端子网路由表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-CentOS-配置"><span class="nav-text">¶3.3 CentOS 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-配置-ens33-子接口-IP"><span class="nav-text">¶3.3.1 配置 ens33 子接口 IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-添加另一个-GRE-隧道接口并-up"><span class="nav-text">¶3.3.2 添加另一个 GRE 隧道接口并 up</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-配置隧道接口-IP"><span class="nav-text">¶3.3.3 配置隧道接口 IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-添加对端子网路由表"><span class="nav-text">¶3.3.4 添加对端子网路由表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-ping-测试链路连通性"><span class="nav-text">¶3.4 ping 测试链路连通性</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2015 - <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">一塘</span></div><div class="timemark"> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("01/01/2015 17:38:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script></div><div class="powered-by"> 由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"> 主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a></div><div class="busuanzi-count"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span><span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/public/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/public/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/public/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/public/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/public/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/public/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/public/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/public/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/public/js/src/affix.js?v=5.1.0"></script><script type="text/javascript" src="/public/js/src/schemes/pisces.js?v=5.1.0"></script><script type="text/javascript" src="/public/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/public/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/public/js/src/bootstrap.js?v=5.1.0"></script><link rel="stylesheet" href="//cdn.bootcss.com/gitalk/1.6.2/gitalk.min.css"><script src="//cdn.bootcss.com/gitalk/1.6.2/gitalk.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"315ada12fed7a0ffb6b7",clientSecret:"5f15e644005fabee93cc7f50d70c78c57dce0e86",repo:"talengu.github.io",owner:"talengu",admin:["talengu"],id:location.pathname,labels:["Gitalk"],perPage:15,pagerDirection:"last",createIssueManually:!0,distractionFreeMode:!1,proxy:"https://gitalk.talengu.workers.dev/?https://github.com/login/oauth/access_token"});gitalk.render("gitalk-container")</script><script type="text/javascript">var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/public/"+search_path;function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".popup").toggle()}var searchFunc=function(e,c,s){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(c),r=document.getElementById(s);a.addEventListener("input",function(){var u=0,d='<ul class="search-result-list">',f=this.value.trim().toLowerCase().split(/[\s\-]+/);r.innerHTML="",1<this.value.trim().length&&t.forEach(function(e){var a=!1,r=e.title.trim().toLowerCase(),c=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),t=decodeURIComponent(e.url),s=-1,o=-1,n=-1;if(""!=r&&f.forEach(function(e,t){s=r.indexOf(e),o=c.indexOf(e),(0<=s||0<=o)&&(a=!0,0==t&&(n=o))}),a){u+=1,d+="<li><a href='"+t+"' class='search-result-title'>"+r+"</a>";var i=e.content.trim().replace(/<[^>]+>/g,"");if(0<=n){var l=n-20,p=n+80;l<0&&(l=0),0==l&&(p=50),p>i.length&&(p=i.length);var h=i.substring(l,p);f.forEach(function(e){var t=new RegExp(e,"gi");h=h.replace(t,'<b class="search-keyword">'+e+"</b>")}),d+='<p class="search-result">'+h+"...</p>"}d+="</li>"}}),d+="</ul>",0==u&&(d='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==f&&(d='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),r.innerHTML=d}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/javascript" src="/public/js/src/clipboard.min.js"></script><script type="text/javascript" src="/public/js/src/clipboard-use.js"></script></body></html>