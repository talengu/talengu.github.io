<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>温风·如酒</title>
  
  
  <link href="/public/atom.xml" rel="self"/>
  
  <link href="https://talengu.github.io/"/>
  <updated>2018-11-16T07:46:40.349Z</updated>
  <id>https://talengu.github.io/</id>
  
  <author>
    <name>小成</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>计算机视觉应用（1）- Real-time HeadPose</title>
    <link href="https://talengu.github.io/2018/11/16/cv/HeadPoseALL/"/>
    <id>https://talengu.github.io/2018/11/16/cv/HeadPoseALL/</id>
    <published>2018-11-15T16:00:00.000Z</published>
    <updated>2018-11-16T07:46:40.349Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://www.learnopencv.com/wp-content/uploads/2016/09/head-pose-example-1024x576.jpg" alt="Head Pose Example"></p><p>本文方法的流程：</p><ol><li><p>检测人脸 OpenCV DNN</p></li><li><p>检测landmark Dlib</p></li><li><p>利用landmark计算pose</p></li></ol><blockquote><p>landmark有68个点我用了其中6个点</p></blockquote><p><img src="http://1.bp.blogspot.com/-KWPRPli4qpE/WltxsJkPhRI/AAAAAAAAA4w/HU9hXyrUoZIwG2lmvVqdCLdcXXHtcN7XACK4BGAYYCw/s1600/Screenshot%2Bfrom%2B2018-01-14%2B09-43-26.png" alt="landmark_map"></p><a id="more"></a><p><strong>下面是代码：</strong></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> dlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测人脸</span></span><br><span class="line"><span class="comment"># OpenCV DNN supports 2 networks.</span></span><br><span class="line"><span class="comment"># 1. FP16 version of the original caffe implementation ( 5.4 MB )</span></span><br><span class="line"><span class="comment"># 2. 8 bit Quantized version using Tensorflow ( 2.7 MB )</span></span><br><span class="line"><span class="comment"># model:</span></span><br><span class="line"><span class="comment">#     https://github.com/spmallick/learnopencv/tree/master/FaceDetectionComparison/models</span></span><br><span class="line">DNN = <span class="string">"CAFFE"</span></span><br><span class="line"><span class="keyword">if</span> DNN == <span class="string">"CAFFE"</span>:</span><br><span class="line">    modelFile = <span class="string">"models/res10_300x300_ssd_iter_140000_fp16.caffemodel"</span></span><br><span class="line">    configFile = <span class="string">"models/deploy.prototxt"</span></span><br><span class="line">    net = cv2.dnn.readNetFromCaffe(configFile, modelFile)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    modelFile = <span class="string">"models/opencv_face_detector_uint8.pb"</span></span><br><span class="line">    configFile = <span class="string">"models/opencv_face_detector.pbtxt"</span></span><br><span class="line">    net = cv2.dnn.readNetFromTensorflow(modelFile, configFile)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detectFaceOpenCVDnn</span><span class="params">(net, frame)</span>:</span></span><br><span class="line">    conf_threshold = <span class="number">0.7</span></span><br><span class="line">    frameOpencvDnn = frame.copy()</span><br><span class="line">    frameHeight = frameOpencvDnn.shape[<span class="number">0</span>]</span><br><span class="line">    frameWidth = frameOpencvDnn.shape[<span class="number">1</span>]</span><br><span class="line">    blob = cv2.dnn.blobFromImage(frameOpencvDnn, <span class="number">1.0</span>, (<span class="number">300</span>, <span class="number">300</span>), [<span class="number">104</span>, <span class="number">117</span>, <span class="number">123</span>], <span class="keyword">False</span>, <span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">    net.setInput(blob)</span><br><span class="line">    detections = net.forward()</span><br><span class="line">    bboxes = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(detections.shape[<span class="number">2</span>]):</span><br><span class="line">        confidence = detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> confidence &gt; conf_threshold:</span><br><span class="line">            x1 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">3</span>] * frameWidth)</span><br><span class="line">            y1 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">4</span>] * frameHeight)</span><br><span class="line">            x2 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">5</span>] * frameWidth)</span><br><span class="line">            y2 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">6</span>] * frameHeight)</span><br><span class="line">            bboxes.append([x1, y1, x2, y2])</span><br><span class="line">            cv2.rectangle(frameOpencvDnn, (x1, y1), (x2, y2), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), int(round(frameHeight / <span class="number">150</span>)), <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">return</span> frameOpencvDnn, bboxes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成landmark</span></span><br><span class="line">predictor = dlib.shape_predictor(<span class="string">"models/shape_predictor_68_face_landmarks.dat"</span>)</span><br><span class="line"><span class="comment"># if not automatically downloaded, get it from:</span></span><br><span class="line"><span class="comment"># http://sourceforge.net/projects/dclib/files/dlib/v18.10/shape_predictor_68_face_landmarks.dat.bz2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_landmarks</span><span class="params">(img, bboxes)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_shape_to_np</span><span class="params">(shape)</span>:</span></span><br><span class="line">        xy = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">68</span>):</span><br><span class="line">            xy.append((shape.part(i).x, shape.part(i).y,))</span><br><span class="line">        xy = np.asarray(xy, dtype=<span class="string">'float32'</span>)</span><br><span class="line">        <span class="keyword">return</span> xy</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_det_to_dlib_rectangle</span><span class="params">(bbox)</span>:</span></span><br><span class="line">        bbox = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> bbox[:<span class="number">4</span>]]</span><br><span class="line">        <span class="keyword">return</span> dlib.rectangle(bbox[<span class="number">0</span>], bbox[<span class="number">1</span>], bbox[<span class="number">2</span>], bbox[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    shape = predictor(img, _det_to_dlib_rectangle(bboxes[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    xy = _shape_to_np(shape)</span><br><span class="line">    <span class="comment"># lmarks.append(xy)</span></span><br><span class="line">    <span class="comment"># lmarks = np.asarray(lmarks, dtype='float32')</span></span><br><span class="line">    <span class="comment"># display_landmarks(img, dets, shapes)</span></span><br><span class="line">    <span class="comment"># return lmarks</span></span><br><span class="line">    <span class="keyword">return</span> xy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getlandmark</span><span class="params">(img, bboxs)</span>:</span></span><br><span class="line">    landmark = get_landmarks(img, bboxs)</span><br><span class="line">    sixPoints = [landmark[<span class="number">30</span>],</span><br><span class="line">                 landmark[<span class="number">8</span>],</span><br><span class="line">                 landmark[<span class="number">36</span>],</span><br><span class="line">                 landmark[<span class="number">45</span>],</span><br><span class="line">                 landmark[<span class="number">48</span>],</span><br><span class="line">                 landmark[<span class="number">54</span>]</span><br><span class="line">                 ]</span><br><span class="line">    <span class="keyword">return</span> sixPoints</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算pose</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showHeadPose</span><span class="params">(im, sixPoints)</span>:</span></span><br><span class="line">    <span class="comment"># Read Image</span></span><br><span class="line">    <span class="comment"># im = cv2.imread("headPose.jpg")</span></span><br><span class="line">    size = im.shape</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2D image points. If you change the image, you need to change vector</span></span><br><span class="line">    <span class="comment"># image_points = np.array([</span></span><br><span class="line">    <span class="comment">#                             (359, 391),     # Nose tip           30  # start with 0</span></span><br><span class="line">    <span class="comment">#                             (399, 561),     # Chin                8</span></span><br><span class="line">    <span class="comment">#                             (337, 297),     # Left eye left corner  36</span></span><br><span class="line">    <span class="comment">#                             (513, 301),     # Right eye right corne  45</span></span><br><span class="line">    <span class="comment">#                             (345, 465),     # Left Mouth corner    48</span></span><br><span class="line">    <span class="comment">#                             (453, 469)      # Right mouth corner    54</span></span><br><span class="line">    <span class="comment">#                         ], dtype="double")</span></span><br><span class="line">    image_points = np.array(sixPoints, dtype=<span class="string">"double"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3D model points.</span></span><br><span class="line">    model_points = np.array([</span><br><span class="line">        (<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>),  <span class="comment"># Nose tip</span></span><br><span class="line">        (<span class="number">0.0</span>, <span class="number">-330.0</span>, <span class="number">-65.0</span>),  <span class="comment"># Chin</span></span><br><span class="line">        (<span class="number">-225.0</span>, <span class="number">170.0</span>, <span class="number">-135.0</span>),  <span class="comment"># Left eye left corner</span></span><br><span class="line">        (<span class="number">225.0</span>, <span class="number">170.0</span>, <span class="number">-135.0</span>),  <span class="comment"># Right eye right corne</span></span><br><span class="line">        (<span class="number">-150.0</span>, <span class="number">-150.0</span>, <span class="number">-125.0</span>),  <span class="comment"># Left Mouth corner</span></span><br><span class="line">        (<span class="number">150.0</span>, <span class="number">-150.0</span>, <span class="number">-125.0</span>)  <span class="comment"># Right mouth corner</span></span><br><span class="line"></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Camera internals</span></span><br><span class="line"></span><br><span class="line">    focal_length = size[<span class="number">1</span>]</span><br><span class="line">    center = (size[<span class="number">1</span>] / <span class="number">2</span>, size[<span class="number">0</span>] / <span class="number">2</span>)</span><br><span class="line">    camera_matrix = np.array(</span><br><span class="line">        [[focal_length, <span class="number">0</span>, center[<span class="number">0</span>]],</span><br><span class="line">         [<span class="number">0</span>, focal_length, center[<span class="number">1</span>]],</span><br><span class="line">         [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]], dtype=<span class="string">"double"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Camera Matrix :\n &#123;0&#125;"</span>.format(camera_matrix)</span><br><span class="line"></span><br><span class="line">    dist_coeffs = np.zeros((<span class="number">4</span>, <span class="number">1</span>))  <span class="comment"># Assuming no lens distortion</span></span><br><span class="line">    (success, rotation_vector, translation_vector) = cv2.solvePnP(model_points, image_points, camera_matrix,</span><br><span class="line">                                                                  dist_coeffs, flags=cv2.SOLVEPNP_ITERATIVE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Rotation Vector:\n &#123;0&#125;"</span>.format(rotation_vector)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Translation Vector:\n &#123;0&#125;"</span>.format(translation_vector)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Project a 3D point (0, 0, 1000.0) onto the image plane.</span></span><br><span class="line">    <span class="comment"># We use this to draw a line sticking out of the nose</span></span><br><span class="line"></span><br><span class="line">    (nose_end_point2D, jacobian) = cv2.projectPoints(np.array([(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1000.0</span>)]), rotation_vector,</span><br><span class="line">                                                     translation_vector, camera_matrix, dist_coeffs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> image_points:</span><br><span class="line">        cv2.circle(im, (int(p[<span class="number">0</span>]), int(p[<span class="number">1</span>])), <span class="number">3</span>, (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    p1 = (int(image_points[<span class="number">0</span>][<span class="number">0</span>]), int(image_points[<span class="number">0</span>][<span class="number">1</span>]))</span><br><span class="line">    p2 = (int(nose_end_point2D[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]), int(nose_end_point2D[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    cv2.line(im, p1, p2, (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> im</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Display image</span></span><br><span class="line"><span class="comment"># cv2.imshow("Output", im)</span></span><br><span class="line"><span class="comment"># cv2.waitKey(0)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># source = "orginal.avi"</span></span><br><span class="line">    source = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span>:</span><br><span class="line">        source = sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    cap = cv2.VideoCapture(source)</span><br><span class="line">    hasFrame, frame = cap.read()</span><br><span class="line">    CV_CAP_PROP_FRAME_WIDTH = <span class="number">3</span>  <span class="comment"># 视频的宽</span></span><br><span class="line">    CV_CAP_PROP_FRAME_HEIGHT = <span class="number">4</span>  <span class="comment"># 视频的高</span></span><br><span class="line">    width = cap.get(CV_CAP_PROP_FRAME_WIDTH)</span><br><span class="line">    height = cap.get(CV_CAP_PROP_FRAME_HEIGHT)</span><br><span class="line">    SizeTuple = (int(width / <span class="number">2</span>), int(height / <span class="number">2</span>))</span><br><span class="line">    vid_writer = cv2.VideoWriter(<span class="string">'output-&#123;&#125;.avi'</span>.format(str(source).split(<span class="string">"."</span>)[<span class="number">0</span>]),cv2.VideoWriter_fourcc(<span class="string">'M'</span>,<span class="string">'J'</span>,<span class="string">'P'</span>,<span class="string">'G'</span>), <span class="number">15</span>, SizeTuple)</span><br><span class="line"></span><br><span class="line">    frame_count = <span class="number">0</span></span><br><span class="line">    tt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">        hasFrame, frame = cap.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasFrame:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        frame_count += <span class="number">1</span></span><br><span class="line">        frame = cv2.resize(frame, SizeTuple)</span><br><span class="line">        frame = cv2.flip(frame, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            t = time.time()</span><br><span class="line">            outOpencvDnn, bboxes = detectFaceOpenCVDnn(net, frame)</span><br><span class="line"></span><br><span class="line">            sixPoints = getlandmark(outOpencvDnn, bboxes)</span><br><span class="line">            <span class="comment"># 添加headpose的操作</span></span><br><span class="line">            outHeadPoseImg = showHeadPose(outOpencvDnn, sixPoints)</span><br><span class="line"></span><br><span class="line">            tt += time.time() - t</span><br><span class="line">            fpsOpencvDnn = frame_count / tt</span><br><span class="line">            label = <span class="string">"OpenCV DNN ; FPS : &#123;:.2f&#125;"</span>.format(fpsOpencvDnn)</span><br><span class="line">            cv2.putText(outOpencvDnn, label, (<span class="number">10</span>, <span class="number">50</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.6</span>, (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">1</span>, cv2.LINE_AA)</span><br><span class="line">            frame = outHeadPoseImg</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        cv2.imshow(<span class="string">"Face Detection and Head Pose"</span>, frame)</span><br><span class="line"></span><br><span class="line">        vid_writer.write(frame)</span><br><span class="line">        <span class="keyword">if</span> frame_count == <span class="number">1</span>:</span><br><span class="line">            tt_opencvDnn = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        k = cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">27</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line">    vid_writer.release()</span><br></pre></td></tr></table></figure><h2 id="TODOS"><a href="#TODOS" class="headerlink" title="TODOS"></a>TODOS</h2><ul><li style="list-style: none"><input type="checkbox"> 在landmark检测中模型太大，不利于放到手机上（90Mb）<ul><li>模型68点检测 重新训练5点检测</li><li>将landmark方法转移到opencv上</li></ul></li><li style="list-style: none"><input type="checkbox"> landmark抖动<ul><li>加上一些滤波？kalman Savgol 滤波器？</li><li>带上眼镜的误差也比较大</li></ul></li><li style="list-style: none"><input type="checkbox"> 对本文的理论再进行解释清楚，主要参考 <a href="https://www.learnopencv.com/head-pose-estimation-using-opencv-and-dlib/" target="_blank" rel="noopener">headpose learnopencv</a><ul><li>代码里面没有合并landmark部分的代码</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://www.learnopencv.com/wp-content/uploads/2016/09/head-pose-example-1024x576.jpg&quot; alt=&quot;Head Pose Example&quot;&gt;&lt;/p&gt;
&lt;p&gt;本文方法的流程：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;检测人脸 OpenCV DNN&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;检测landmark Dlib&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;利用landmark计算pose&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;landmark有68个点我用了其中6个点&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-KWPRPli4qpE/WltxsJkPhRI/AAAAAAAAA4w/HU9hXyrUoZIwG2lmvVqdCLdcXXHtcN7XACK4BGAYYCw/s1600/Screenshot%2Bfrom%2B2018-01-14%2B09-43-26.png&quot; alt=&quot;landmark_map&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="计算机视觉应用" scheme="https://talengu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%BA%94%E7%94%A8/"/>
    
      <category term="HeadPose" scheme="https://talengu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%BA%94%E7%94%A8/HeadPose/"/>
    
    
      <category term="OpenCV" scheme="https://talengu.github.io/tags/OpenCV/"/>
    
      <category term="DeepLearning" scheme="https://talengu.github.io/tags/DeepLearning/"/>
    
      <category term="HeadPose" scheme="https://talengu.github.io/tags/HeadPose/"/>
    
  </entry>
  
  <entry>
    <title>[译] Hand Keypoint Detection using Deep Learning and OpenCV</title>
    <link href="https://talengu.github.io/2018/11/13/cv/HandKeypointDetection/"/>
    <id>https://talengu.github.io/2018/11/13/cv/HandKeypointDetection/</id>
    <published>2018-11-12T16:00:00.000Z</published>
    <updated>2018-11-14T05:57:32.716Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>我的翻译里面带了好多英文对应，为了我以后写作服务，请读者朋友原谅。:cat: :cat:<br>原文地址 <a href="https://www.learnopencv.com/hand-keypoint-detection-using-deep-learning-and-opencv/" target="_blank" rel="noopener">https://www.learnopencv.com/hand-keypoint-detection-using-deep-learning-and-opencv/</a></p><p>重要结论：</p><p>作者github代码 <a href="https://github.com/spmallick/learnopencv/tree/master/HandPose" target="_blank" rel="noopener">HandPose</a><br>tip：仅下载一个文件夹会比较快 <code>svn checkout https://github.com/spmallick/learnopencv/trunk/HandPose</code></p><p>代码说明：为了使文章显得简洁一些，在文中只提供关键的代码片段。在github项目中详细代码，包括。。。。。</p></blockquote><a id="more"></a><center><iframe width="100%" height="360" frameborder="0" src="http://v.qq.com/iframe/player.html?vid=a0738qjijoe&tiny=0&auto=0" allowfullscreen></iframe></center><p>Hand Keypoint detection is the process of finding the joints on the fingers as well as the finger-tips in a given image. It is similar to finding keypoints on Face ( a.k.a <a herf="/facemark-facial-landmark-detection-using-opencv/">Facial Landmark Detection</a> ) or Body ( a.k.a <a href="/deep-learning-based-human-pose-estimation-using-opencv-cpp-python/">Human Body Pose Estimation</a> ), but, different from Hand Detection since in that case, we treat the whole hand as one object.</p><p>In our previous blog posts on Pose estimation – <a href="/deep-learning-based-human-pose-estimation-using-opencv-cpp-python/">Single Person</a>, <a href="/multi-person-pose-estimation-in-opencv-using-openpose/">Multi-Person</a>, we had discussed how to use deep learning models in OpenCV to extract body pose in an image or video.</p><p>The researchers at CMU Perceptual Computing Lab have also released models for keypoint detection of Hand and Face along with the body. The Hand Keypoint detector is based on <strong><a href="https://arxiv.org/pdf/1704.07809.pdf" target="_blank" rel="noopener">this paper</a></strong>. We will take a quick look at the network architecture and then share code in C++ and Python for predicting hand keypoints using OpenCV.</p><h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h2><p><a href="/wp-content/uploads/2018/10/handpose-detection-architecture.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/handpose-detection-architecture-1024x306.jpg" alt=""></a></p><p><a href="https://arxiv.org/pdf/1704.07809.pdf" target="_blank" rel="noopener">[Image taken from the paper]</a></p><p>They start with a small set of labelled hand images and use a neural network ( <a href="https://arxiv.org/pdf/1602.00134.pdf" target="_blank" rel="noopener">Convolutional Pose Machines</a> – similar to Body Pose ) to get rough estimates of the hand keypoints. They have a huge multi-view system set up to take images from different view-points or angles comprising of <strong>31 HD cameras</strong>.</p><p>They pass these images through the detector to get many rough keypoint predictions. Once you get the detected keypoints of the same hand from different views, Keypoint triangulation is performed to get the 3D location of the keypoints. The 3D location of keypoints is used to robustly predict the keypoints through reprojection from 3D to 2D. This is especially crucial for images where keypoints are difficult to predict. This way they get a much improved detector in a few iterations.</p><p>In summary, they use keypoint detectors and multi-view images to come up with an improved detector. The detection architecture used is similar to the one used for body pose. The main source of improvement is the multi-view images for the labelled set of images.</p><p>The model produces 22 keypoints. The hand has 21 points while the 22nd point signifies the background. The points are as shown below:</p><p><a href="/wp-content/uploads/2018/09/handpose-demo-keypoints.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/09/handpose-demo-keypoints.jpg" alt=""></a></p><p>Let us see how to use the model in OpenCV.</p><h2 id="2-代码"><a href="#2-代码" class="headerlink" title="2.  代码"></a>2.  代码</h2><p>Code for Hand Keypoint Detection</p><h3 id="2-1-Download-model-for-Hand-Keypoint"><a href="#2-1-Download-model-for-Hand-Keypoint" class="headerlink" title="2.1. Download model for Hand Keypoint"></a>2.1. Download model for Hand Keypoint</h3><p>First thing is to download the model weights file. The config file has been provided with the code. You can either use the getModels.sh script to download the file to the hand/ folder. Go to the code folder and run the following command from the Terminal.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+x getModels.sh</span><br><span class="line">./getModels.sh</span><br></pre></td></tr></table></figure><p>You can also download the model from <strong><a href="http://posefs1.perception.cs.cmu.edu/OpenPose/models/hand/pose_iter_102000.caffemodel" target="_blank" rel="noopener">this link</a></strong>. Please put the model in the hand/ folder after downloading.</p><h3 id="2-2-Load-Model-and-Image"><a href="#2-2-Load-Model-and-Image" class="headerlink" title="2.2. Load Model and Image"></a>2.2. Load Model and Image</h3><p>First, we will load the image and the model into memory. Make sure you have the model downloaded and in the correct folder as specified in the variable.</p><h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> protoFile = <span class="string">"hand/pose_deploy.prototxt"</span>;</span><br><span class="line"><span class="built_in">string</span> weightsFile = <span class="string">"hand/pose_iter_102000.caffemodel"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nPoints = <span class="number">22</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> imageFile = <span class="string">"hand.jpg"</span>;</span><br><span class="line"></span><br><span class="line">Mat frame = imread(imageFile);</span><br><span class="line">Net net = readNetFromCaffe(protoFile, weightsFile);</span><br></pre></td></tr></table></figure><h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">protoFile = <span class="string">"hand/pose_deploy.prototxt"</span></span><br><span class="line">weightsFile = <span class="string">"hand/pose_iter_102000.caffemodel"</span></span><br><span class="line">nPoints = <span class="number">22</span></span><br><span class="line"></span><br><span class="line">frame = cv2.imread(<span class="string">"hand.jpg"</span>)</span><br><span class="line">net = cv2.dnn.readNetFromCaffe(protoFile, weightsFile)</span><br></pre></td></tr></table></figure><h3 id="2-3-Get-Predictions"><a href="#2-3-Get-Predictions" class="headerlink" title="2.3. Get Predictions"></a>2.3. Get Predictions</h3><p>We convert the BGR image to blob so that it can be fed to the network. Then we do a forward pass to get the predictions.</p><h4 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Mat inpBlob = blobFromImage(frame, <span class="number">1.0</span> / <span class="number">255</span>, Size(inWidth, inHeight), Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">net.setInput(inpBlob);</span><br><span class="line"></span><br><span class="line">Mat output = net.forward();</span><br></pre></td></tr></table></figure><h4 id="Python-1"><a href="#Python-1" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">inpBlob = cv2.dnn.blobFromImage(frame, <span class="number">1.0</span> / <span class="number">255</span>, (inWidth, inHeight),</span><br><span class="line">                          (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), swapRB=<span class="keyword">False</span>, crop=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">net.setInput(inpBlob)</span><br><span class="line"></span><br><span class="line">output = net.forward()</span><br></pre></td></tr></table></figure><h3 id="2-4-Show-Detections"><a href="#2-4-Show-Detections" class="headerlink" title="2.4. Show Detections"></a>2.4. Show Detections</h3><p>The output has 22 matrices with each matrix being the Probability Map of a keypoint. Given below is the probability heatmap superimposed on the original image for the keypoint belonging to the tip of thumb and base of little finger.</p><p><a href="/wp-content/uploads/2018/10/handpose-heatmap-thumbtip.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/handpose-heatmap-thumbtip.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/handpose-heatmap-little.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/handpose-heatmap-little.jpg" alt=""></a></p><p>For finding the exact keypoints, first, we scale the probabilty map to the size of the original image. Then find the location of the keypoint by finding the maxima of the probability map. This is done using the <strong>minmaxLoc</strong> function in OpenCV. We draw the detected points along with the numbering on the image.</p><h4 id="C-2"><a href="#C-2" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find the position of the body parts</span></span><br><span class="line"><span class="built_in">vector</span>&lt;Point&gt; points(nPoints);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> n=<span class="number">0</span>; n &lt; nPoints; n++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Probability map of corresponding body's part.</span></span><br><span class="line">    <span class="function">Mat <span class="title">probMap</span><span class="params">(H, W, CV_32F, output.ptr(<span class="number">0</span>,n))</span></span>;</span><br><span class="line">    resize(probMap, probMap, Size(frameWidth, frame_width));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Point maxLoc;</span><br><span class="line"><span class="keyword">double</span> prob;</span><br><span class="line">minMaxLoc(probMap, <span class="number">0</span>, &amp;prob, <span class="number">0</span>, &amp;maxLoc);</span><br><span class="line"><span class="keyword">if</span> (prob &gt; thresh)</span><br><span class="line">&#123;</span><br><span class="line">    circle(frameCopy, cv::Point((<span class="keyword">int</span>)maxLoc.x, (<span class="keyword">int</span>)maxLoc.y), <span class="number">8</span>, Scalar(<span class="number">0</span>,<span class="number">255</span>,<span class="number">255</span>), <span class="number">-1</span>);</span><br><span class="line">    cv::putText(frameCopy, cv::format(<span class="string">"%d"</span>, n), cv::Point((<span class="keyword">int</span>)maxLoc.x, (<span class="keyword">int</span>)maxLoc.y), cv::FONT_HERSHEY_COMPLEX, <span class="number">1</span>, cv::Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">points[n] = maxLoc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imshow(<span class="string">"Output-Keypoints"</span>, frameCopy);</span><br></pre></td></tr></table></figure><h4 id="Python-2"><a href="#Python-2" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">points = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(nPoints):</span><br><span class="line">    <span class="comment"># confidence map of corresponding body's part.</span></span><br><span class="line">    probMap = output[<span class="number">0</span>, i, :, :]</span><br><span class="line">    probMap = cv2.resize(probMap, (frameWidth, frameHeight))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Find global maxima of the probMap.</span></span><br><span class="line">minVal, prob, minLoc, point = cv2.minMaxLoc(probMap)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> prob &gt; threshold :</span><br><span class="line">    cv2.circle(frameCopy, (int(point[<span class="number">0</span>]), int(point[<span class="number">1</span>])), <span class="number">8</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>), thickness=<span class="number">-1</span>, lineType=cv2.FILLED)</span><br><span class="line">    cv2.putText(frameCopy, <span class="string">"&#123;&#125;"</span>.format(i), (int(point[<span class="number">0</span>]), int(point[<span class="number">1</span>])), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">1</span>, (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>, lineType=cv2.LINE_AA)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add the point to the list if the probability is greater than the threshold</span></span><br><span class="line">    points.append((int(point[<span class="number">0</span>]), int(point[<span class="number">1</span>])))</span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    points.append(<span class="keyword">None</span>)cv2.imshow(<span class="string">'Output-Keypoints'</span>, frameCopy)</span><br></pre></td></tr></table></figure><p><a href="/wp-content/uploads/2018/05/hand-output-Keypoints.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/05/hand-output-Keypoints.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/hand-output-keypoints.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/hand-output-keypoints.jpg" alt=""></a></p><center>Sample Result with keypoints numbered using the Hand keypoint Detector</center><h3 id="2-5-Draw-Skeleton"><a href="#2-5-Draw-Skeleton" class="headerlink" title="2.5. Draw Skeleton"></a>2.5. Draw Skeleton</h3><p>We will use the detected points to get the skeleton formed by the keypoints and draw them on the image.</p><h4 id="C-3"><a href="#C-3" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> nPairs = <span class="keyword">sizeof</span>(POSE_PAIRS)/<span class="keyword">sizeof</span>(POSE_PAIRS[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; nPairs; n++)</span><br><span class="line">&#123;</span><br><span class="line">​    <span class="comment">// lookup 2 connected body/hand parts</span></span><br><span class="line">​    Point2f partA = points[POSE_PAIRS[n][<span class="number">0</span>]];</span><br><span class="line">​    Point2f partB = points[POSE_PAIRS[n][<span class="number">1</span>]];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (partA.x&lt;=<span class="number">0</span> || partA.y&lt;=<span class="number">0</span> || partB.x&lt;=<span class="number">0</span> || partB.y&lt;=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">line(frame, partA, partB, Scalar(<span class="number">0</span>,<span class="number">255</span>,<span class="number">255</span>), <span class="number">8</span>);</span><br><span class="line">circle(frame, partA, <span class="number">8</span>, Scalar(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>), <span class="number">-1</span>);</span><br><span class="line">circle(frame, partB, <span class="number">8</span>, Scalar(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>), <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imshow(<span class="string">"Output-Skeleton"</span>, frame);</span><br></pre></td></tr></table></figure><h4 id="Python-3"><a href="#Python-3" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Draw Skeleton</span></span><br><span class="line"><span class="keyword">for</span> pair <span class="keyword">in</span> POSE_PAIRS:</span><br><span class="line">    partA = pair[<span class="number">0</span>]</span><br><span class="line">    partB = pair[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> points[partA] <span class="keyword">and</span> points[partB]:</span><br><span class="line">    cv2.line(frame, points[partA], points[partB], (<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">    cv2.circle(frame, points[partA], <span class="number">8</span>, (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), thickness=<span class="number">-1</span>, lineType=cv2.FILLED)</span><br><span class="line"></span><br><span class="line">cv2.imshow(<span class="string">'Output-Skeleton'</span>, frame)</span><br></pre></td></tr></table></figure><p><a href="/wp-content/uploads/2018/05/hand-output-Skeleton.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/05/hand-output-Skeleton.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/hand-output-skeleton.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/hand-output-skeleton.jpg" alt=""></a></p><center>Result showing the skeleton obtained by joining the keypoint pairs</center><blockquote><p>One thing to note is that the detector expects a bounding box around the hand to predict the keypoints. Thus, for better results, the hand should be close to the camera or it should be cropped using a hand detector and then fed to the network.<br>Also, the code given can detect only one hand at a time. You can easily port it to detecting multiple hands with the help of the probability maps and applying some heuristics.</p></blockquote><h2 id="3-应用"><a href="#3-应用" class="headerlink" title="3. 应用"></a>3. 应用</h2><p>The model just discussed can be used in many practical applications such as:</p><ul><li>Gesture Recognition</li><li>Sign Language understanding for disabled</li><li>Activity Recognition based on Hand</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>1. <a href="https://www.pexels.com/photo/white-laptop-female-hand-note-pen-phone-desk-6471/" target="_blank" rel="noopener">[Image used in the post]</a><br>2. <a href="https://arxiv.org/pdf/1704.07809.pdf" target="_blank" rel="noopener">[Hand Keypoint Detection Paper]</a><br>3. <a href="https://github.com/CMU-Perceptual-Computing-Lab/openpose/tree/master/models/hand" target="_blank" rel="noopener">[Hand Keypoint Detection model]</a><br>4. <a href="https://www.youtube.com/watch?v=b0eQNN4BJGU" target="_blank" rel="noopener">[Link to demo video]</a><br>5. <a href="http://csr.bu.edu/asl/asllvd/annotate/index.html" target="_blank" rel="noopener">[Link to american sign language video]</a><br>6. <a href="https://en.wikipedia.org/wiki/Hand#/media/File:Human-Hands-Front-Back.jpg" target="_blank" rel="noopener">[Hand Image from Wikipedia]</a></p><p>前几日分享了 learnopencv.com 博主 Satya Mallick 发表的关于 OpenCV Mask RCNN 实例分割的博文（详见：），展示了 OpenCV 作为 DNN 推断工具的简单用法。<br>昨日 Satya Mallick 又发表了使用 OpenCV 调用 OpenPose 工程中的手部关键点检测（hand pose estimation）模型的文章，对于想要使用手部关键点检测做手势识别、手语识别、抽烟检测等工程开发的朋友来说这是一个非常简单的上手教程。<br>先来看看作者发布的视频效果：</p><center><iframe width="100%" height="360" frameborder="0" src="http://v.qq.com/iframe/player.html?vid=a0738qjijoe&tiny=0&auto=0" allowfullscreen></iframe></center><p>在大部分情况下还是不错的，但也出现了少数帧关键点跳变的情况。</p><h2 id="1-算法思想"><a href="#1-算法思想" class="headerlink" title="1. 算法思想"></a>1. 算法思想</h2><p>该文中作者使用的算法模型是 CMU Perceptual Computing Lab 开源的集合人体、人脸、手部关键点检测的开源库 OpenPose，其中手部关键点检测（Hand Keypoint detector）算法来自 CVPR2017 的论文《Hand Keypoint Detection in Single Images using Multiview Bootstrapping》。<br>人手在 3D 空间由于视角不同、灵活的精细动作等原因，较难得到精确标注的数据集。在该论文中，作者提出了一种称之为 Multiview Bootstrapping 的手部关键点检测迭代改进算法，实现了具有较高精度的检测算法。     <img src="https://www.52cv.net/wp-content/uploads/2018/10/handpose-detection-architecture-1024x306-1024x306.jpg" alt=""><br>如上图所示，作者提出首先使用少量标注的含有人手关键点的数据集训练 Convolutional Pose Machines 神经网络，使用 31 个不同视角的高清摄像头拍摄人手，用上述检测模型初步检测关键点，将这些关键点根据摄像机的位姿构建三角（triangulation），得到关键点的 3D 位置，再将计算得到的 3D 点位置重投影到每一幅不同视角的 2D 图像，再使用这些 2D 图像和关键点标注训练检测模型网络，经过几次迭代，即可以得到较为精确的手部关键点检测模型。<br>原论文中提出的模型可生成 22 个关键点，其中 21 个点是人手部的，第 22 个点代表着背景。下图展示了人手部的 21 个关键点位置。<br><img src="https://www.52cv.net/wp-content/uploads/2018/10/hand-output-Keypoints1.jpg" alt=""></p><h2 id="2-OpenCV-手部关键点检测主要流程"><a href="#2-OpenCV-手部关键点检测主要流程" class="headerlink" title="2. OpenCV 手部关键点检测主要流程"></a>2. OpenCV 手部关键点检测主要流程</h2><p>1）下载模型<br>运行开源工程中的 getModels.sh 下载模型，</p><p><img src="https://www.52cv.net/wp-content/uploads/2018/10/微信图片_20181010004455.png" alt=""><br>或者直接在网址：<br><a href="http://posefs1.perception.cs.cmu.edu/OpenPose/models/hand/pose_iter_102000.caffemodel" target="_blank" rel="noopener">http://posefs1.perception.cs.cmu.edu/OpenPose/models/hand/pose_iter_102000.caffemodel</a><br>下载。将模型放到 “hand/” 文件夹下。</p><p>2）加载模型和图像<br>使用 OpenCV DNN 函数 <strong>readNetFromCaffe 函数</strong>加载模型权重。<br><img src="https://www.52cv.net/wp-content/uploads/2018/10/微信图片_20181010003802.png" alt=""></p><p>3）推断预测<br><strong>blobFromImage</strong> 将图像转为 <strong>blob</strong>,<strong>forward</strong> 函数实现网络推断。<br><img src="https://www.52cv.net/wp-content/uploads/2018/10/微信图片_201810100038021.png" alt=""></p><p>4）获取关键点精确位置并显示<br>上述网络计算的结果是 22 个矩阵，每个矩阵代表某个特定关键点最可能出现在图像中哪个位置的热图，需要调用 <strong>minmaxLoc</strong> 函数找到精确位置，进而将其画出并标注序号。<br><img src="https://www.52cv.net/wp-content/uploads/2018/10/微信图片_201810100038022.png" alt=""></p><p>5）画出骨架<br><img src="https://www.52cv.net/wp-content/uploads/2018/10/微信图片_201810100038023.png" alt=""></p><p>视频效果：</p><center><iframe width="100%" height="360" frameborder="0" src="http://v.qq.com/iframe/player.html?vid=a0738qjijoe&tiny=0&auto=0" allowfullscreen></iframe></center><h2 id="3-去抖"><a href="#3-去抖" class="headerlink" title="3. 去抖"></a>3. 去抖</h2><p>从视频中可以看出关键点有抖动，且有部分帧出现关键点跳变，如何让其更稳定呢？</p><p>在该博文评论区，某大佬提出使用 Savgol 滤波器对数据进行平滑可以得到较满意的结果。<br>看看效果如何：</p><center><iframe width="100%" height="360" frameborder="0" src="http://v.qq.com/iframe/player.html?vid=c07388bnird&tiny=0&auto=0" allowfullscreen></iframe></center><p>是不是感觉立刻好了很多？</p><p><strong>关键点平滑代码：</strong><br><a href="https://stackoverflow.com/questions/52450681/how-can-i-use-smoothing-techniques-to-remove-jitter-in-pose-estimation/" target="_blank" rel="noopener">https://stackoverflow.com/questions/52450681/how-can-i-use-smoothing-techniques-to-remove-jitter-in-pose-estimation/</a></p><p><strong>原博文地址：</strong><br><a href="https://www.learnopencv.com/hand-keypoint-detection-using-deep-learning-and-opencv/" target="_blank" rel="noopener">https://www.learnopencv.com/hand-keypoint-detection-using-deep-learning-and-opencv/</a><br><strong>代码地址：</strong><br><a href="https://github.com/spmallick/learnopencv/tree/master/HandPose" target="_blank" rel="noopener">https://github.com/spmallick/learnopencv/tree/master/HandPose</a></p><p>转载请注明：《<a href="https://www.52cv.net/?p=1494" target="_blank" rel="noopener">OpenCV 深度学习手部关键点检测（手势识别）代码示例</a>》</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><p>合并上面的工作</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;我的翻译里面带了好多英文对应，为了我以后写作服务，请读者朋友原谅。:cat: :cat:&lt;br&gt;原文地址 &lt;a href=&quot;https://www.learnopencv.com/hand-keypoint-detection-using-deep-learning-and-opencv/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.learnopencv.com/hand-keypoint-detection-using-deep-learning-and-opencv/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;重要结论：&lt;/p&gt;
&lt;p&gt;作者github代码 &lt;a href=&quot;https://github.com/spmallick/learnopencv/tree/master/HandPose&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;HandPose&lt;/a&gt;&lt;br&gt;tip：仅下载一个文件夹会比较快 &lt;code&gt;svn checkout https://github.com/spmallick/learnopencv/trunk/HandPose&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;代码说明：为了使文章显得简洁一些，在文中只提供关键的代码片段。在github项目中详细代码，包括。。。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="博客转载" scheme="https://talengu.github.io/categories/%E5%8D%9A%E5%AE%A2%E8%BD%AC%E8%BD%BD/"/>
    
      <category term="cv" scheme="https://talengu.github.io/categories/%E5%8D%9A%E5%AE%A2%E8%BD%AC%E8%BD%BD/cv/"/>
    
    
      <category term="OpenCV" scheme="https://talengu.github.io/tags/OpenCV/"/>
    
      <category term="Hand Keypoint Detection" scheme="https://talengu.github.io/tags/Hand-Keypoint-Detection/"/>
    
      <category term="DeepLearning" scheme="https://talengu.github.io/tags/DeepLearning/"/>
    
  </entry>
  
  <entry>
    <title>[译] Face Detection – OpenCV, Dlib and Deep Learning ( C++ / Python )</title>
    <link href="https://talengu.github.io/2018/11/12/cv/FaceDetectionComparison/"/>
    <id>https://talengu.github.io/2018/11/12/cv/FaceDetectionComparison/</id>
    <published>2018-11-12T10:00:00.000Z</published>
    <updated>2018-11-12T16:36:53.761Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>我的翻译里面带了好多英文对应，为了我以后写作服务，请读者朋友原谅。:cat: :cat:<br>原文地址 <a href="https://www.learnopencv.com/face-detection-opencv-dlib-and-deep-learning-c-python/" target="_blank" rel="noopener">https://www.learnopencv.com/face-detection-opencv-dlib-and-deep-learning-c-python/</a></p><p>重要结论：在多数场景中，我们提前不知道图片大小，因此 选用 OpenCV – DNN 相当快也很精确，甚至对于小人脸也不错，各种人脸角度也可以。选用这个在大多情况下是最优的。</p><p>作者github代码 <a href="https://github.com/spmallick/learnopencv/tree/master/FaceDetectionComparison" target="_blank" rel="noopener">FaceDetectionComparison</a> </p><p>代码说明：为了使文章显得简洁一些，在文中只提供关键的代码片段。在github项目中详细代码，包括每个方法独立的代码和整合在一起的cpp和py文件（run-all.py 和 run-all.cpp），同时里面也有运行代码所使用的人脸检测模型。</p></blockquote><p>在这篇文章中，作者讨论使用了OpenCV或Dlib的多种人脸检测的代码，并给出性能分析。作者使用的 Face Detector 包括以下四个，后面分别给出 c++ 和 python 实现。</p><ol><li>OpenCV 的 Haar Cascade Face Detector</li><li>OpenCV 的 Deep Learning based Face Detector</li><li>Dlib 的 HoG Face Detector</li><li>Dlib 的 Deep Learning based Face Detector</li></ol><p>作者限于篇幅没有对对理论进行深入解读，只讨论框架的使用，同时分享一些应用上的选择权衡的经验。</p><a id="more"></a><center><iframe width="100%" height="360" frameborder="0" src="http://v.qq.com/iframe/player.html?vid=k07615vrzj8&tiny=0&auto=0" allowfullscreen></iframe></center><blockquote><p>实验的图片尺寸是  image size 300×300</p></blockquote><h2 id="1-OpenCV-Haar"><a href="#1-OpenCV-Haar" class="headerlink" title="1. OpenCV-Haar"></a>1. OpenCV-Haar</h2><p>在2001年，Viola 和 Jones提出Haar Cascade 特征为基础的 Face Detector，在以后的多年内都是最优的人脸检测算法。以他们的算法为基础人们做了很多改进。OpenCV提供了很多Haar特征的模型算法，更多的Haar特征模型 <strong><a href="https://github.com/opencv/opencv/tree/master/data/haarcascades" target="_blank" rel="noopener">here</a></strong></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">faceCascade = cv2.CascadeClassifier(<span class="string">'./haarcascade_frontalface_default.xml'</span>)</span><br><span class="line">faces = faceCascade.detectMultiScale(frameGray)</span><br><span class="line"><span class="keyword">for</span> face <span class="keyword">in</span> faces:</span><br><span class="line">    x1, y1, w, h = face</span><br><span class="line">    x2 = x1 + w</span><br><span class="line">    y2 = y1 + h</span><br></pre></td></tr></table></figure><h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">faceCascadePath = <span class="string">"./haarcascade_frontalface_default.xml"</span>;</span><br><span class="line">faceCascade.load( faceCascadePath )</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Rect&gt; faces;</span><br><span class="line">faceCascade.detectMultiScale(frameGray, faces);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; faces.size(); i++ )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> x1 = faces[i].x;</span><br><span class="line">  <span class="keyword">int</span> y1 = faces[i].y;</span><br><span class="line">  <span class="keyword">int</span> x2 = faces[i].x + faces[i].width;</span><br><span class="line">  <span class="keyword">int</span> y2 = faces[i].y + faces[i].height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对图片灰度变化（grayscale）后，再应用 haar cascade 特征，输出是脸的list。list中每个item有四个element 分别为 top-left corner的(x, y) 、检测出来脸的大小(width, height) 。</p><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li>在CPU上几乎是实时的（real-time）</li><li>简单的框架 （Simple Architecture）</li><li>能检测不同大小的脸 （different scales）</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li>主要缺点是有很多错误的预测（False predictions），会多预测出人脸。</li><li>人脸非正面效果不好 （non-frontal）</li><li>人脸遮挡效果不好 （under occlusion）</li></ol><h2 id="2-OpenCV-DNN"><a href="#2-OpenCV-DNN" class="headerlink" title="2. OpenCV-DNN"></a>2. OpenCV-DNN</h2><p>在 OpenCV 3.3 中引入这个方法。DNN模型使用SSD <strong><a href="https://arxiv.org/abs/1512.02325" target="_blank" rel="noopener">Single-Shot-Multibox detector</a></strong>框架和  ResNet-10 特征提取网络（backbone）。这个模型喂的数据是从网上采集的，但是训练的源代码没有公开。OpenCV提供了2个模型文件。</p><ol><li>Float 16 位版本模型，使用原始的 caffe 训练  (5.4 MB)</li><li>8 bit quantized 版本模型，使用 Tensorflow 训练 (2.7 MB)</li></ol><p>代码 <a href="https://github.com/spmallick/learnopencv/tree/master/FaceDetectionComparison" target="_blank" rel="noopener">FaceDetectionComparison</a>  里面放了这两个模型文件。</p><h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><h4 id="Python-1"><a href="#Python-1" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DNN = <span class="string">"TF"</span></span><br><span class="line"><span class="keyword">if</span> DNN == <span class="string">"CAFFE"</span>:</span><br><span class="line">    modelFile = <span class="string">"res10_300x300_ssd_iter_140000_fp16.caffemodel"</span></span><br><span class="line">    configFile = <span class="string">"deploy.prototxt"</span></span><br><span class="line">    net = cv2.dnn.readNetFromCaffe(configFile, modelFile)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    modelFile = <span class="string">"opencv_face_detector_uint8.pb"</span></span><br><span class="line">    configFile = <span class="string">"opencv_face_detector.pbtxt"</span></span><br><span class="line">    net = cv2.dnn.readNetFromTensorflow(modelFile, configFile)</span><br></pre></td></tr></table></figure><h4 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> caffeConfigFile = <span class="string">"./deploy.prototxt"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> caffeWeightFile = <span class="string">"./res10_300x300_ssd_iter_140000_fp16.caffemodel"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> tensorflowConfigFile = <span class="string">"./opencv_face_detector.pbtxt"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> tensorflowWeightFile = <span class="string">"./opencv_face_detector_uint8.pb"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">ifdef</span> CAFFE</span></span><br><span class="line"></span><br><span class="line">  Net net = cv::dnn::readNetFromCaffe(caffeConfigFile, caffeWeightFile);</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">else</span></span></span><br><span class="line"></span><br><span class="line">  Net net = cv::dnn::readNetFromTensorflow(tensorflowWeightFile, tensorflowConfigFile);</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>caffe 和 Tensorflow 框架加载模型的代码。使用 Float 16 的 Caffe 模型，需要 caffemodel 和 prototxt 文件。使用 8 bit quantized 的 Tensorflow 模型，需要 Tensorflow 配置文件和模型。</p><h4 id="Python-2"><a href="#Python-2" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">blob = cv2.dnn.blobFromImage(frameOpencvDnn, <span class="number">1.0</span>, (<span class="number">300</span>, <span class="number">300</span>), [<span class="number">104</span>, <span class="number">117</span>, <span class="number">123</span>], <span class="keyword">False</span>, <span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">net.setInput(blob)</span><br><span class="line">detections = net.forward()</span><br><span class="line">bboxes = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(detections.shape[<span class="number">2</span>]):</span><br><span class="line">    confidence = detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> confidence &gt; conf_threshold:</span><br><span class="line">        x1 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">3</span>] * frameWidth)</span><br><span class="line">        y1 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">4</span>] * frameHeight)</span><br><span class="line">        x2 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">5</span>] * frameWidth)</span><br><span class="line">        y2 = int(detections[<span class="number">0</span>, <span class="number">0</span>, i, <span class="number">6</span>] * frameHeight)</span><br></pre></td></tr></table></figure><h4 id="C-2"><a href="#C-2" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CAFFE</span></span><br><span class="line">cv::Mat inputBlob = cv::dnn::blobFromImage(frameOpenCVDNN, inScaleFactor, cv::Size(inWidth, inHeight), meanVal, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">cv::Mat inputBlob = cv::dnn::blobFromImage(frameOpenCVDNN, inScaleFactor, cv::Size(inWidth, inHeight), meanVal, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">net.setInput(inputBlob, <span class="string">"data"</span>);</span><br><span class="line">cv::Mat detection = net.forward(<span class="string">"detection_out"</span>);</span><br><span class="line"></span><br><span class="line">cv::<span class="function">Mat <span class="title">detectionMat</span><span class="params">(detection.size[<span class="number">2</span>], detection.size[<span class="number">3</span>], CV_32F, detection.ptr&lt;<span class="keyword">float</span>&gt;())</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; detectionMat.rows; i++)</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">float</span> confidence = detectionMat.at&lt;<span class="keyword">float</span>&gt;(i, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (confidence &gt; confidenceThreshold)</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="keyword">int</span> x1 = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(detectionMat.at&lt;<span class="keyword">float</span>&gt;(i, <span class="number">3</span>) * frameWidth);</span><br><span class="line">         <span class="keyword">int</span> y1 = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(detectionMat.at&lt;<span class="keyword">float</span>&gt;(i, <span class="number">4</span>) * frameHeight);</span><br><span class="line">         <span class="keyword">int</span> x2 = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(detectionMat.at&lt;<span class="keyword">float</span>&gt;(i, <span class="number">5</span>) * frameWidth);</span><br><span class="line">         <span class="keyword">int</span> y2 = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(detectionMat.at&lt;<span class="keyword">float</span>&gt;(i, <span class="number">6</span>) * frameHeight);</span><br><span class="line"></span><br><span class="line">        cv::rectangle(frameOpenCVDNN, cv::Point(x1, y1), cv::Point(x2, y2), cv::Scalar(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的代码里面，图像转为blob输入进network里，利用前向传播函数forward()，得到一个4-D matrix。 #TODO :这里不是很理解，代码跑起来看一下？？？</p><ul><li>The 3rd dimension iterates over the detected faces. (i is the iterator over the number of faces)</li><li>The fourth dimension contains information about the bounding box and score for each face. For example, detections[0,0,0,2] gives the confidence score for the first face, and detections[0,0,0,3:6] give the bounding box.</li></ul><p>The output coordinates of the bounding box are normalized between [0,1]. Thus the coordinates should be multiplied by the height and width of the original image to get the correct bounding box on the image.</p><h3 id="优点（merits）"><a href="#优点（merits）" class="headerlink" title="优点（merits）"></a>优点（merits）</h3><ol><li>在本文四个方法中最精确（Most accurate）</li><li>可以在CPU上实时运行（real-time）</li><li>人脸不同方向效果不错（上下左右，侧脸等）up, down, left, right, side-face etc</li><li>人脸不同大小效果不错哦（various scales, big and tiny OK）</li></ol><p>OpenCV的这个DNN方法克服了 Haar cascade 方法的不足，同时精度也不比它差。暂时没有发现这个方法其他有不足地方，除了比后面的 Dlib HoG 方法速度慢一点以外。</p><p>作者建议，在使用OpenCV时，比Haar方法，可以优先考虑DNN方法。</p><h2 id="3-Dlib-HoG"><a href="#3-Dlib-HoG" class="headerlink" title="3. Dlib-HoG"></a>3. Dlib-HoG</h2><p>HoG 人脸检测方法被广泛的使用，基于 HoG 特征和 SVM 分类。作者还写了一篇 HoG 的博客 <a href="https://www.learnopencv.com/histogram-of-oriented-gradients/" target="_blank" rel="noopener">post</a>。模型有5个 HOG filters 滤波器（ front looking, left looking, right looking, front looking but rotated left, and a front looking but rotated right），模型直接放在了头文件里面 <strong><a href="https://github.com/davisking/dlib/blob/master/dlib/image_processing/frontal_face_detector.h" target="_blank" rel="noopener">header file</a></strong>。</p><p>训练模型的数据库，来自LFW dataset，由 Davis King (Dlib的作者) 手工标记 （manually annotated）共2825张。需要的话，数据库从这里可以下载 <strong><a href="http://dlib.net/files/data/dlib_face_detector_training_data.tar.gz" target="_blank" rel="noopener">dlib_face_detector_training_data.tar.gz</a></strong>.</p><h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><h4 id="Python-3"><a href="#Python-3" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hogFaceDetector = dlib.get_frontal_face_detector()</span><br><span class="line">faceRects = hogFaceDetector(frameDlibHogSmall, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> faceRect <span class="keyword">in</span> faceRects:</span><br><span class="line">    x1 = faceRect.left()</span><br><span class="line">    y1 = faceRect.top()</span><br><span class="line">    x2 = faceRect.right()</span><br><span class="line">    y2 = faceRect.bottom()</span><br></pre></td></tr></table></figure><h4 id="C-3"><a href="#C-3" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">frontal_face_detector hogFaceDetector = get_frontal_face_detector();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Convert OpenCV image format to Dlib's image format</span></span><br><span class="line">cv_image&lt;bgr_pixel&gt; dlibIm(frameDlibHogSmall);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Detect faces in the image</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;dlib::rectangle&gt; faceRects = hogFaceDetector(dlibIm);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; faceRects.size(); i++ )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> x1 = faceRects[i].left();</span><br><span class="line">  <span class="keyword">int</span> y1 = faceRects[i].top();</span><br><span class="line">  <span class="keyword">int</span> x2 = faceRects[i].right();</span><br><span class="line">  <span class="keyword">int</span> y2 = faceRects[i].bottom();</span><br><span class="line">  cv::rectangle(frameDlibHog, Point(x1, y1), Point(x2, y2), Scalar(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>), (<span class="keyword">int</span>)(frameHeight/<span class="number">150.0</span>), <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的代码中，首先加载 face detector，然后将图像输入给 detector 。其中第二个参数代表，想要上采样图片的倍数（times of upscale）。你给的数字越大，小脸检测出的概率越大。但是upscaling 会在计算上花费可观的时间（ substantial impact on the computation speed）。输出是脸的list， 框框对角的坐标（diagonal corners）。</p><h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><ol><li>在cpu上最快的方法（在四个方法中）</li><li>对正面和轻微非正面的方法效果很不错</li><li>模型比较少对于其他三个的文件来说</li><li>轻微遮挡下可以检测</li></ol><p>大概以上，这个方法多数情况可以工作，除了下面的情况。</p><h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><ol><li>主要缺点对小人脸不识别。由于训练在最小 80×80 的数据集上，要确保你的使用环境，不然的话你要自己再训练一下小人脸。</li><li>人脸框经常去掉了人额头一部分，有时脸颊一部分。<br>（part of forehead and even part of chin sometimes）</li><li>在明显的遮挡情况下效果不好</li><li>在测量和极端不正面的脸情况不工作，像向上看，和向下看的情况。</li></ol><h2 id="4-Dlib-CNN"><a href="#4-Dlib-CNN" class="headerlink" title="4. Dlib-CNN"></a>4. Dlib-CNN</h2><p>这个模型使用了<strong><a href="https://arxiv.org/pdf/1502.00046.pdf" target="_blank" rel="noopener">Maximum-Margin Object Detector (MMOD)</a></strong> 加CNN的特征的方法。训练过程相当简单，也不需要大量的数据去训练一个新的 object detector。更多的训练套路，在这个网站上 <strong><a href="http://blog.dlib.net/2016/10/easily-create-high-quality-object.html" target="_blank" rel="noopener">website</a></strong>.</p><p>使用的模型可以从 <strong><a href="https://github.com/davisking/dlib-models" target="_blank" rel="noopener">dlib-models repository</a></strong> 下载。</p><p>训练使用的数据库是dlib的作者 Davis King 手工标的，7220张从  ImageNet, PASCAL VOC, VGG, WIDER, Face Scrub等数据库里面挑的。这个数据库可以下载到。<a href="http://dlib.net/files/data/dlib_face_detection_dataset-2016-09-30.tar.gz" target="_blank" rel="noopener"><strong>dlib_face_detection_dataset-2016-09-30.tar.gz</strong></a></p><h3 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h3><h4 id="Python-4"><a href="#Python-4" class="headerlink" title="Python"></a>Python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dnnFaceDetector = dlib.cnn_face_detection_model_v1(<span class="string">"./mmod_human_face_detector.dat"</span>)</span><br><span class="line">faceRects = dnnFaceDetector(frameDlibHogSmall, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> faceRect <span class="keyword">in</span> faceRects:</span><br><span class="line">    x1 = faceRect.rect.left()</span><br><span class="line">    y1 = faceRect.rect.top()</span><br><span class="line">    x2 = faceRect.rect.right()</span><br><span class="line">    y2 = faceRect.rect.bottom()</span><br></pre></td></tr></table></figure><h4 id="C-4"><a href="#C-4" class="headerlink" title="C++"></a>C++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">String mmodModelPath = <span class="string">"./mmod_human_face_detector.dat"</span>;</span><br><span class="line">net_type mmodFaceDetector;</span><br><span class="line">deserialize(mmodModelPath) &gt;&gt; mmodFaceDetector;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Convert OpenCV image format to Dlib's image format</span></span><br><span class="line">cv_image&lt;bgr_pixel&gt; dlibIm(frameDlibMmodSmall);</span><br><span class="line">matrix&lt;rgb_pixel&gt; dlibMatrix;</span><br><span class="line">assign_image(dlibMatrix, dlibIm);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Detect faces in the image</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;dlib::mmod_rect&gt; faceRects = mmodFaceDetector(dlibMatrix);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; faceRects.size(); i++ )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> x1 = faceRects[i].rect.left();</span><br><span class="line">  <span class="keyword">int</span> y1 = faceRects[i].rect.top();</span><br><span class="line">  <span class="keyword">int</span> x2 = faceRects[i].rect.right();</span><br><span class="line">  <span class="keyword">int</span> y2 = faceRects[i].rect.bottom();</span><br><span class="line">  cv::rectangle(frameDlibMmod, Point(x1, y1), Point(x2, y2), Scalar(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>), (<span class="keyword">int</span>)(frameHeight/<span class="number">150.0</span>), <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码和  HoG detector 差不多，除了下载的 CNN face detection 的模型文件。</p><h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><ol><li>不同的脸朝向效果不错 （face orientations）</li><li>遮挡比较稳定 （occlusion）</li><li>在GPU上很快</li><li>训练模型过程很简单</li></ol><h3 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h3><ol><li>CPU上很慢</li><li>脸大小于 80×80  检测不出，因为模型在小脸训练的。所以要考虑你应用的具体场景脸的大小，当然也可以对小脸数据库再训练一下。</li><li>人脸框 bounding box 甚至比 HoG detector 还小。</li></ol><h2 id="5-精度比较"><a href="#5-精度比较" class="headerlink" title="5. 精度比较"></a>5. 精度比较</h2><p>（Accuracy Comparison）</p><p>作者评估这四个模型使用的是 FDDB 数据库，其中评估OpenCV-DNN 脚本为 <a href="https://github.com/opencv/opencv/blob/master/modules/dnn/misc/face_detector_accuracy.py" target="_blank" rel="noopener">OpenCV face_detector_accuracy.py</a>. </p><p>作者发现奇怪的结果。Dlib 的结果比 Haar OpenCV还要低，然而实际从图片上效果比较好。下图是这四个方法的精度得分（ Precision scores）。</p><p><a href="/wp-content/uploads/2018/10/face-detection-coco-comparison.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/face-detection-coco-comparison.jpg" alt=""></a></p><p>指标说明（Metric）：<br>AP_50 = Precision when overlap between Ground Truth and predicted bounding box is at least 50% (IoU = 50%)<br>AP_75 = Precision when overlap between Ground Truth and predicted bounding box is at least 75% (IoU = 75%)<br>AP_Small = Average Precision for small size faces (Average of IoU = 50% to 95%)<br>AP_medium = Average Precision for medium size faces (Average of IoU = 50% to 95%)<br>AP_Large = Average Precision for large size faces (Average of IoU = 50% to 95%)<br>mAP = Average precision across different IoU (Average of IoU = 50% to 95%)</p><p><strong>作者最近的发现评估过程对 Dlib 不够公平，科学。</strong></p><h3 id="5-1-评估过程出错了，分析的二个原因！"><a href="#5-1-评估过程出错了，分析的二个原因！" class="headerlink" title="5.1. 评估过程出错了，分析的二个原因！"></a>5.1. 评估过程出错了，分析的二个原因！</h3><p>根据我们的分析，Dlib拿到低的精度的原因如下：<br><strong>第一个主要原因是训练dlib的是标准数据库没有加标签（annotations）</strong>。数据库图片是由dlib作者自己切的，因此可以发现同样是人脸检测的框，同OpenCV 中的两个方法 OpenCV-Haar 或者 OpenCV-DNN 相比，dlib的方法会裁掉额头一部分或者脸颊一部分（forehead chin）。下面的图中可以看到。</p><p><a href="/wp-content/uploads/2018/10/fd-acc-result1-e1539872852547.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-acc-result1-e1539872861105.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-acc-result2-e1539872827875.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-acc-result2-e1539872827875.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-acc-result3-e1539872783684.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-acc-result3-e1539872783684.jpg" alt=""></a></p><p>这个问题可以导致 在上个柱状图中 dlib 分数会低。AP_X 代表着  X% 预测框和真实框交叠的面积占合起来面积的比率。dlib 的 AP_75 的得分为0，尽管有在 AP_75 比 Haar 还高。这个就意味着：<strong>Dlib 模型可以预测更多的人脸比 Haar 特征，但是dlib的框的 AP_75 得分比较低</strong>。</p><p><strong>第二个原因是 dlib 不能检测小的人脸，进一步拉低了得分。</strong></p><p><strong>因此，比较 OpenCV 和 Dlib 精确性的一个相对合理的指标是 AP_50 （或者可以使用小于50%的指标，我们只是设阈值用来计算人头的个数）</strong> 以上分析大家使用 Dlib 的时候注意一下。</p><h2 id="6-速度比较"><a href="#6-速度比较" class="headerlink" title="6. 速度比较"></a>6. 速度比较</h2><p>Speed Comparison</p><p>我们使用 300x300 图像做的对比实验。Dlib 的 MMOD 模型可以利用上GPU，但是OpenCV方法对 NVIDIA GPUs 支持还没有。所以我们评估对比这些方法在CPU上，但我们也给出 GPU 版本 MMOD 结果。</p><p>(这段话以后写论文的时候可以用到，保留:cat:) We used a 300×300 image for the comparison of the methods. The MMOD detector can be run on a GPU, but the support for NVIDIA GPUs in OpenCV is still not there. So, we evaluate the methods on CPU only and also report result for MMOD on GPU as well as CPU.</p><h3 id="硬件的配置"><a href="#硬件的配置" class="headerlink" title="硬件的配置"></a>硬件的配置</h3><p>Processor : Intel Core i7 6850K – 6 Core<br>RAM : 32 GB<br>GPU : NVIDIA GTX 1080 Ti with 11 GB RAM<br>OS : Linux 16.04 LTS<br>Programming Language : Python</p><p>我们跑了10次，每次对图片进行10000趟测试得总时间，然后对这10次取平均。下面的柱状图是结果。We run each method 10000 times on the given image and take 10 such iterations and average the time taken. Given below are the results.</p><p><a href="/wp-content/uploads/2018/10/face-detection-speed-comparison.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/face-detection-speed-comparison.jpg" alt=""></a></p><p>从图中可以看到，对于 300x300 的图片，除了 MMOD。MMOD 在GPU上还是很快的，CPU上就是渣渣了。As you can see that for the image of this size, all the methods perform in real-time, except MMOD. MMOD detector is very fast on a GPU but is very slow on a CPU.</p><p>以上的结果在不同电脑硬软件环境下可能不一样。</p><h2 id="7-多种情况讨论"><a href="#7-多种情况讨论" class="headerlink" title="7. 多种情况讨论"></a>7. 多种情况讨论</h2><p>除了速度和精度外，我们在选择哪个模型来使用还有一些因素可以考虑。在这节中，将考虑这些情况下的选择。主要为人脸大小变化、非正脸、遮挡。</p><h3 id="7-1-人脸大小变化"><a href="#7-1-人脸大小变化" class="headerlink" title="7.1. 人脸大小变化"></a>7.1. 人脸大小变化</h3><p>Detection across scale</p><p>下面有一个例子视频，这位帅哥在做一个前后的健身动作，使得脸部区域变大变小。可以看到OpenCV DNN 检测出了所有的脸，而 Dlib 的方法只有在大于某个 size 的时候才被检测出来。</p><p><a href="/wp-content/uploads/2018/10/face-detection-scale-comparison.gif"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/face-detection-scale-comparison.gif" alt=""></a></p><p>我们测试后，脸大于 70×70 才能被 dlib检测出。正如在前面说到的，对小人脸检测是dlib方法的一个大的缺点。我们也可以将图片上采样，但这样的话速度的话相对于 OpenCV-DNN 就太慢了。</p><p>It can be seen that dlib based methods are able to detect faces of size upto ~(70×70) after which they fail to detect. As we discussed earlier, I think this is the major drawback of Dlib based methods. Since it is not possible to know the size of the face before-hand in most cases. We can get rid of this problem by upscaling the image, but then the speed advantage of dlib as compared to OpenCV-DNN goes away.</p><h3 id="7-2-非正脸"><a href="#7-2-非正脸" class="headerlink" title="7.2. 非正脸"></a>7.2. 非正脸</h3><p>Non-frontal Face</p><p>对于非正脸的测试，我们选用了 looking towards right, left, up, down。为了对 dlib 公平，我们选择了face 大于 80×80 的图片。下面是一些例子。</p><p>Non-frontal can be looking towards right, left, up, down. Again, to be fair with dlib, we make sure the face size is more than 80×80. Given below are some examples.</p><p><a href="/wp-content/uploads/2018/10/fd-non-frontal-result7.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-non-frontal-result7.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-non-frontal-result6.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-non-frontal-result6.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-non-frontal-result5.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-non-frontal-result5.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-non-frontal-result4.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-non-frontal-result4.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-non-frontal-result2.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-non-frontal-result2.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-non-frontal-result1.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-non-frontal-result1.jpg" alt=""></a></p><p>和预期的一样，OpenCV Haar 方法完全败了。Dlib HoG能检测出 left 或 right looking faces，但是精度不如那些DNN方法。</p><p>As expected, Haar based detector fails totally. HoG based detector does detect faces for left or right looking faces (since it was trained on them) but not as accurately as the DNN based detectors of OpenCV and Dlib.</p><h3 id="7-3-遮挡"><a href="#7-3-遮挡" class="headerlink" title="7.3. 遮挡"></a>7.3. 遮挡</h3><p>Occlusion</p><p>接下来看一下遮挡的情况。Let us see how well the methods perform under occlusion.</p><p><a href="/wp-content/uploads/2018/10/fd-occlusion-result1.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-occlusion-result1.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-occlusion-result2.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-occlusion-result2.jpg" alt=""></a></p><p><a href="/wp-content/uploads/2018/10/fd-occlusion-result3.jpg"><img src="https://www.learnopencv.com/wp-content/uploads/2018/10/fd-occlusion-result3.jpg" alt=""></a></p><p>再一次看到，DNN方法比其他方法更优，OpenCV-DNN 比  Dlib-MMOD 还好一点。这是因为CNN 特征 比 HoG or Haar 更加鲁棒，稳定。</p><p>Again, the DNN methods outperform the other two, with OpenCV-DNN slightly better than Dlib-MMOD. This is mainly because the CNN features are much more robust than HoG or Haar features.</p><h2 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h2><p>我们讨论了每个方法的优缺点。个人建议使用 OpenCV-DNN 和 Dlib-HoG 在应用和设备成本权衡中。以下我们的建议：</p><p>We had discussed the pros and cons of each method in the respective sections. I recommend to try both OpenCV-DNN and HoG methods for your application and decide accordingly. We share some tips to get started.</p><h3 id="8-1-大多数的情况"><a href="#8-1-大多数的情况" class="headerlink" title="8.1 大多数的情况"></a>8.1 大多数的情况</h3><p>General Case</p><p>在多数场景中，我们提前不知道图片大小，因此 选用 OpenCV – DNN 相当快也很精确，甚至对于小人脸也不错，各种人脸角度也可以。选用这个在大多情况下是最优的。</p><p>In most applications, we won’t know the size of the face in the image before-hand. Thus, it is better to use OpenCV – DNN method as it is pretty fast and very accurate, even for small sized faces. It also detects faces at various angles. We recommend to use OpenCV-DNN in most</p><h3 id="8-2-大小中等或大一点图片"><a href="#8-2-大小中等或大一点图片" class="headerlink" title="8.2 大小中等或大一点图片"></a>8.2 大小中等或大一点图片</h3><p>For medium to large image sizes</p><p>Dlib HoG 在 cpu上是最快的一个方法。但是它不能检测出 face size (&lt; 70x70) 的图片。所以你得清楚使用的场景，比如自拍的话就可以。如果能使用GPU的话 dlib-MMOD 是一个最好的选择，因为它支持GPU，跑得也比较快，也能适应人脸的角度变化。</p><p>Dlib HoG is the fastest method on CPU. But it does not detect small sized faces (&lt; 70x70). So, if you know that your application will not be dealing with very small sized faces ( for example a selfie app ), then HoG based Face detector is a better option. Also, If you can use a GPU, then MMOD face detector is the best option as it is very fast on GPU and also provides detection at various angles.</p><h3 id="8-3-高分辨率图像"><a href="#8-3-高分辨率图像" class="headerlink" title="8.3 高分辨率图像"></a>8.3 高分辨率图像</h3><p>High resolution images</p><p>对于这些方法来说，高分辨图像都有点难度，计算时间比较长。可能采用的方法是resize图像 （ scale down the image），HoG / MMOD方法可能就识别不出了，但是可以使用 OpenCV-DNN 尝试一下。我认为也可以将图片分割开再识别呀，嘻嘻。</p><p>Since feeding high resolution images is not possible to these algorithms (for computation speed), HoG / MMOD detectors might fail when you scale down the image. On the other hand, OpenCV-DNN method can be used for these since it detects small faces.</p><p>有任何建议，欢迎在下面评论。<br>Have any other suggestions? Please mention in the comments and we’ll update the post with them!</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/opencv/opencv/blob/master/modules/dnn/misc/face_detector_accuracy.py" target="_blank" rel="noopener">[FDDB Comparison code]</a><br><a href="http://blog.dlib.net/2016/10/easily-create-high-quality-object.html" target="_blank" rel="noopener">[Dlib Blog]</a><br><a href="http://dlib.net/cnn_face_detector.py.html" target="_blank" rel="noopener">[dlib mmod python example]</a><br><a href="http://dlib.net/dnn_mmod_face_detection_ex.cpp.html" target="_blank" rel="noopener">[dlib mmod cpp example]</a><br><a href="https://github.com/opencv/opencv/tree/master/samples/dnn/face_detector" target="_blank" rel="noopener">[OpenCV DNN Face detector]</a><br><a href="https://docs.opencv.org/3.4/d7/d8b/tutorial_py_face_detection.html" target="_blank" rel="noopener">[Haar Based Face Detector]</a></p><h2 id="TODOS"><a href="#TODOS" class="headerlink" title="TODOS"></a>TODOS</h2><p>文章作者是 <a href="https://www.learnopencv.com/author/vikas/" target="_blank" rel="noopener">VIKAS GUPTA</a> </p><p>来，看看这个是站长大佬的图片，是不是很熟悉？膜拜一哈。</p><p><img src="https://secure.gravatar.com/avatar/708995cd13fb5756f6bc418aecb23b78?s=250&amp;d=mm&amp;r=g" alt="blog_author"></p><p>我订阅后文章后，作者发的邮件内容，并没有给文章页的代码。</p><ul><li><a href="https://www.learnopencv.com/wp-content/uploads/2015/05/Computer-Vision-Resources.pdf" target="_blank" rel="noopener">给的Computer-Vision-Resources.pdf</a></li><li><a href="https://github.com/spmallick/dlib" target="_blank" rel="noopener">作者的Dlib fork</a></li></ul><p><strong>重要资源</strong> </p><ul><li><p>作者博客 <a href="https://www.learnopencv.com/" target="_blank" rel="noopener">link</a></p></li><li><p>作者的所有代码拿走不谢 <a href="https://github.com/spmallick/learnopencv" target="_blank" rel="noopener">link</a></p></li></ul><ul><li style="list-style: none"><input type="checkbox" checked> 翻译</li><li style="list-style: none"><input type="checkbox"> 代码运行</li><li style="list-style: none"><input type="checkbox"> 根据该作者的博客继续翻译，学习，向大佬致敬。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;我的翻译里面带了好多英文对应，为了我以后写作服务，请读者朋友原谅。:cat: :cat:&lt;br&gt;原文地址 &lt;a href=&quot;https://www.learnopencv.com/face-detection-opencv-dlib-and-deep-learning-c-python/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.learnopencv.com/face-detection-opencv-dlib-and-deep-learning-c-python/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;重要结论：在多数场景中，我们提前不知道图片大小，因此 选用 OpenCV – DNN 相当快也很精确，甚至对于小人脸也不错，各种人脸角度也可以。选用这个在大多情况下是最优的。&lt;/p&gt;
&lt;p&gt;作者github代码 &lt;a href=&quot;https://github.com/spmallick/learnopencv/tree/master/FaceDetectionComparison&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;FaceDetectionComparison&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;代码说明：为了使文章显得简洁一些，在文中只提供关键的代码片段。在github项目中详细代码，包括每个方法独立的代码和整合在一起的cpp和py文件（run-all.py 和 run-all.cpp），同时里面也有运行代码所使用的人脸检测模型。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在这篇文章中，作者讨论使用了OpenCV或Dlib的多种人脸检测的代码，并给出性能分析。作者使用的 Face Detector 包括以下四个，后面分别给出 c++ 和 python 实现。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;OpenCV 的 Haar Cascade Face Detector&lt;/li&gt;
&lt;li&gt;OpenCV 的 Deep Learning based Face Detector&lt;/li&gt;
&lt;li&gt;Dlib 的 HoG Face Detector&lt;/li&gt;
&lt;li&gt;Dlib 的 Deep Learning based Face Detector&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;作者限于篇幅没有对对理论进行深入解读，只讨论框架的使用，同时分享一些应用上的选择权衡的经验。&lt;/p&gt;
    
    </summary>
    
      <category term="博客转载" scheme="https://talengu.github.io/categories/%E5%8D%9A%E5%AE%A2%E8%BD%AC%E8%BD%BD/"/>
    
      <category term="cv" scheme="https://talengu.github.io/categories/%E5%8D%9A%E5%AE%A2%E8%BD%AC%E8%BD%BD/cv/"/>
    
    
      <category term="Face Detection" scheme="https://talengu.github.io/tags/Face-Detection/"/>
    
      <category term="OpenCV" scheme="https://talengu.github.io/tags/OpenCV/"/>
    
      <category term="Dlib" scheme="https://talengu.github.io/tags/Dlib/"/>
    
  </entry>
  
  <entry>
    <title>希腊罗马神话</title>
    <link href="https://talengu.github.io/2018/11/05/readings/Gods_stories/"/>
    <id>https://talengu.github.io/2018/11/05/readings/Gods_stories/</id>
    <published>2018-11-05T08:00:04.000Z</published>
    <updated>2018-11-12T10:28:16.292Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概要：<br>古代希腊罗马神话。最近在看一些古代希腊罗马的神话故事，挺好玩的，记录一下。</p></blockquote><a id="more"></a><h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>在我电的图书馆的还书柜子里面偶然所得，一本叫《希腊罗马神话对英语语言文化的影响》吕海平 著 江苏大学初版社，然后莫名的想研究一下，发现挺不错的。</p><p>古希腊罗马的神的关系还是比较乱的，尤其是jupiter 或者zeus的奥林匹斯神系。从上古的神系，总共有三代。</p><p>网上有个人（<a href="http://www.veritablehokum.com/" target="_blank" rel="noopener">Korwin Briggs</a>）做的关系图很不错。后面我也会对其进行整理，以后给大家分享。</p><p><img src="http://www.veritablehokum.com/wp-content/uploads/2018/08/Roman-God-Family-Tree.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;概要：&lt;br&gt;古代希腊罗马神话。最近在看一些古代希腊罗马的神话故事，挺好玩的，记录一下。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="读书笔记" scheme="https://talengu.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="神话" scheme="https://talengu.github.io/tags/%E7%A5%9E%E8%AF%9D/"/>
    
      <category term="希腊罗马神话" scheme="https://talengu.github.io/tags/%E5%B8%8C%E8%85%8A%E7%BD%97%E9%A9%AC%E7%A5%9E%E8%AF%9D/"/>
    
      <category term="语言文化" scheme="https://talengu.github.io/tags/%E8%AF%AD%E8%A8%80%E6%96%87%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>linux代理的使用</title>
    <link href="https://talengu.github.io/2018/07/24/linux/linux_proxy/"/>
    <id>https://talengu.github.io/2018/07/24/linux/linux_proxy/</id>
    <published>2018-07-24T14:00:00.000Z</published>
    <updated>2018-11-21T17:58:41.853Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近要下载一个在youtube上的数据库，用来训练模型，由于下载比较慢，我选择了代理方式下载。shadowsocks和tsocks实现命令行的代理和一些常用小工具的代理。</p></blockquote><a id="more"></a><blockquote><p>本文以科学研究为目的，请勿滥用。</p></blockquote><h2 id="1-shadowsocks"><a href="#1-shadowsocks" class="headerlink" title="1. shadowsocks"></a>1. shadowsocks</h2><p><strong>Shadowsocks</strong>是一个轻量级socks5代理工具。</p><blockquote><p>TIP:下面的ssserver和sslocal都在pip安装的shadowsocks包里面。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install python-pip</span><br><span class="line">$ pip install shadowsocks</span><br><span class="line"></span><br><span class="line"># 或者对于shadowsocksr</span><br><span class="line">$ pip install git+https://github.com/shadowsocks/shadowsocks.git@master</span><br></pre></td></tr></table></figure><p>其他平台安装 参考 shadowsocks <a href="https://github.com/shadowsocks/shadowsocks/tree/master#install" target="_blank" rel="noopener">install</a></p><h3 id="1-1-vps-配置-Shadowsocks-server"><a href="#1-1-vps-配置-Shadowsocks-server" class="headerlink" title="1.1 vps 配置 Shadowsocks server"></a>1.1 vps 配置 Shadowsocks server</h3><p>远程ssh连接到（Virtual Private Server）vps上，可以开个screen来执行<code>ssserver -c server_shadowsocks.json</code></p><p>新建文件 <strong>server_shadowsocks.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="attr">"server_port"</span>:<span class="number">443</span>,</span><br><span class="line">    <span class="attr">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">"password"</span>:<span class="string">"密码"</span>,</span><br><span class="line">    <span class="attr">"timeout"</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line">    <span class="attr">"fast_open"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-本地linux-配置-Shadowsocks-client"><a href="#1-2-本地linux-配置-Shadowsocks-client" class="headerlink" title="1.2 本地linux 配置 Shadowsocks client"></a>1.2 本地linux 配置 Shadowsocks client</h3><p>开个screen来执行<code>sslocal -c client_shadowsocks.json</code>，也可以使用-d 参数放在后台运行。更多见 <a href="https://wiki.archlinux.org/index.php/Shadowsocks_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">archlinux Shadowsocks</a>)<br><code>sslocal -c client_shadowsocks.json -d start</code></p><p>新建文件 <strong>client_shadowsocks.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="attr">"server"</span>:<span class="string">"服务器ip或域名"</span>,</span><br><span class="line">        <span class="attr">"server_port"</span>:<span class="number">443</span>,</span><br><span class="line">        <span class="attr">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">        <span class="attr">"local_port"</span>:<span class="number">1280</span>,</span><br><span class="line">        <span class="attr">"password"</span>:<span class="string">"密码"</span>,</span><br><span class="line">        <span class="attr">"timeout"</span>:<span class="number">300</span>,</span><br><span class="line">        <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line">        <span class="attr">"fast_open"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"workers"</span>:<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-tsocks"><a href="#2-tsocks" class="headerlink" title="2. tsocks"></a>2. tsocks</h2><p><strong>tsocks</strong> 是个给终端使用的类似于proxychains，它可以直接和shadowsocks的socks 5配置，配置较为简单。</p><p>linux安装tsocks 命令：<code>apt install tsocks</code><br>mac 安装参考 <a href="https://github.com/Anakros/homebrew-tsocks" target="_blank" rel="noopener">homebrew-tsocks</a></p><p>修改tsock配置文件：<code>/etc/tsocks.conf</code> 更改以下内容：<br><strong>/etc/tsocks.conf</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">local = 192.168.1.0/255.255.255.0</span><br><span class="line">server = 127.0.0.1</span><br><span class="line">server_type = 5</span><br><span class="line">server_port = 1080</span><br></pre></td></tr></table></figure><h2 id="3-实用工具的代理使用"><a href="#3-实用工具的代理使用" class="headerlink" title="3. 实用工具的代理使用"></a>3. 实用工具的代理使用</h2><h3 id="3-1-tsocks-使用"><a href="#3-1-tsocks-使用" class="headerlink" title="3.1 tsocks 使用"></a>3.1 tsocks 使用</h3><p>在所需代理的命令前加个tsocks就行，如：<br><code>tsocks wget -c xxxx</code>,<code>tsocks axel -n 10 -av xxxx</code>,<code>tsocks curl xxx</code></p><h3 id="3-2-youtube-dl-绑定proxy"><a href="#3-2-youtube-dl-绑定proxy" class="headerlink" title="3.2 youtube-dl 绑定proxy"></a>3.2 youtube-dl 绑定proxy</h3><p>youtube-dl是批量下载youtube视频的好工具。安装脚本 <code>pip install --upgrade youtube-dl</code></p><p>一个down.sh脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URL=https://www.youtube.com/playlist?list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax</span><br><span class="line">./youtube-dl --proxy socks5://127.0.0.1:1280 $&#123;URL&#125;</span><br></pre></td></tr></table></figure></p><p><strong>youtube-dl待解决的问题？？</strong><br>我的任务是下载一个视频中的一部分，不用下载整个视频。太奢侈了，我的vpn的流量有限，还未找到解决办法，我找到的issue，忘有朋友会的指导一下。<br><a href="https://github.com/rg3/youtube-dl/issues/4821" target="_blank" rel="noopener">is it possible to download only desired time interval?</a></p><h2 id="4-出现的问题"><a href="#4-出现的问题" class="headerlink" title="4. 出现的问题"></a>4. 出现的问题</h2><p><strong>dns解析不了google.com</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 临时在 /etc/resolv.conf</span><br><span class="line">$ sudo echo &quot;nameserver 8.8.8.8&quot; &gt;&gt; /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"># 永久 /etc/resolvconf/resolv.conf.d/head</span><br><span class="line">$ sudo echo &quot;nameserver 8.8.8.8&quot; &gt;&gt; /etc/resolvconf/resolv.conf.d/head</span><br><span class="line"># 更新 /etc/resolv.conf</span><br><span class="line">$ /etc/init.d/resolvconf restart</span><br></pre></td></tr></table></figure></p><p><strong>需要展示net相关信息</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli d show</span><br></pre></td></tr></table></figure></p><p>这里对linux的网络修改并不太会参考 <a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/sec-network_config_using_nmcli" target="_blank" rel="noopener">redlinux 的nmcli介绍</a>。不要用nmcli配置网络，我发现用nmcli重启机器无法自动连接有线网络，最后还是去ubuntu的界面手动删除配置才可以。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;最近要下载一个在youtube上的数据库，用来训练模型，由于下载比较慢，我选择了代理方式下载。shadowsocks和tsocks实现命令行的代理和一些常用小工具的代理。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://talengu.github.io/categories/Linux/"/>
    
    
      <category term="Ubuntu" scheme="https://talengu.github.io/tags/Ubuntu/"/>
    
      <category term="proxy代理" scheme="https://talengu.github.io/tags/proxy%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>bashrc与vimrc的配置</title>
    <link href="https://talengu.github.io/2018/07/12/linux/bash_bashrc/"/>
    <id>https://talengu.github.io/2018/07/12/linux/bash_bashrc/</id>
    <published>2018-07-12T08:00:04.000Z</published>
    <updated>2018-11-21T17:30:58.792Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概要：<br>对于bashrc和vimrc的一些记录。<br><a id="more"></a></p></blockquote><p>在<code>cd ~</code>下建立talen_bashrc文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> HOME_BASHRC=xxxx/talen_bashrc</span><br><span class="line"> alias vimbashrc=&apos;vim $HOME_BASHRC &amp;&amp; source $HOME_BASHRC&apos;</span><br><span class="line"># files</span><br><span class="line"> alias countfiles=&apos;echo &quot;total num: &quot; &amp;&amp; ls | wc -l &amp;&amp; du -sh&apos;</span><br><span class="line"> alias ll=&apos;ls -htrlF --time-style=&quot;+%H:%M %Y/%m/%d&quot;&apos;</span><br><span class="line"> alias dum=&apos;du -a -d 1 -m |sort -nr&apos;</span><br><span class="line"> alias dug=&apos;df -h /dev/sdbxxx &amp;&amp; du -BG -d 1 --time |sort -nr&apos;</span><br><span class="line"></span><br><span class="line"> alias pi=&apos;pip install -i https://pypi.tuna.tsinghua.edu.cn/simple&apos;</span><br><span class="line"> alias gpuwatch=&apos;watch -n 1 nvidia-smi&apos;</span><br><span class="line"></span><br><span class="line"> alias gitm=&apos;git commit -m&apos;</span><br><span class="line"> alias gits=&apos;git status -s&apos;</span><br><span class="line"></span><br><span class="line"> export PYTHONPATH=$PYTHONPATH:xxxxxxx</span><br><span class="line"></span><br><span class="line"># vimrc</span><br><span class="line"> export MYVIMRC=xxxx/.vim/.vimrc</span><br><span class="line"> export VIMINIT=&quot;let &amp;rtp=&apos;xxxx/.vim,&apos; . &amp;rtp</span><br><span class="line"> so $MYVIMRC&quot;</span><br></pre></td></tr></table></figure></p><p><strong>对于anaconda虚拟环境的激活</strong><br>在<code>~/.bashrc</code>中加入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias talen=&apos;source xxx/talen_bashrc &amp;&amp; source activate xxx/envs&apos;</span><br><span class="line">alias utalen=&apos;source deactivate&apos;</span><br></pre></td></tr></table></figure></p><p>github <a href="https://github.com/talengu/vim/blob/master/talen.bashrc" target="_blank" rel="noopener">bashrc</a></p><p>其他的vimrc配置见我的github项目<a href="https://github.com/talengu/vim" target="_blank" rel="noopener">vimrc</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;概要：&lt;br&gt;对于bashrc和vimrc的一些记录。&lt;br&gt;&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://talengu.github.io/categories/Linux/"/>
    
    
      <category term="Ubuntu" scheme="https://talengu.github.io/tags/Ubuntu/"/>
    
      <category term="Bashrc" scheme="https://talengu.github.io/tags/Bashrc/"/>
    
      <category term="Vimrc" scheme="https://talengu.github.io/tags/Vimrc/"/>
    
  </entry>
  
  <entry>
    <title>Jupyter notebook的配置</title>
    <link href="https://talengu.github.io/2017/07/03/linux/jupyter_notebook/"/>
    <id>https://talengu.github.io/2017/07/03/linux/jupyter_notebook/</id>
    <published>2017-07-03T08:00:04.000Z</published>
    <updated>2018-11-21T17:35:21.758Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概要：<br>jupyter notebook的安装</p></blockquote><a id="more"></a><h2 id="1-安装与配置"><a href="#1-安装与配置" class="headerlink" title="1. 安装与配置"></a>1. 安装与配置</h2><h3 id="安装jupyter"><a href="#安装jupyter" class="headerlink" title="安装jupyter"></a>安装jupyter</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda install jupyter</span><br><span class="line"><span class="comment"># pip install jupyter -y</span></span><br></pre></td></tr></table></figure><h3 id="配置文件修改"><a href="#配置文件修改" class="headerlink" title="配置文件修改"></a>配置文件修改</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成配置文件</span></span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line">vim ~/.jupyter/jupyter_notebook_config.py</span><br></pre></td></tr></table></figure><p>修改配置文件里面的对应内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.ip = <span class="string">'*'</span></span><br><span class="line">c.NotebookApp.port = <span class="number">8018</span></span><br><span class="line"><span class="comment"># 设置密码</span></span><br><span class="line">c.NotebookApp.password = <span class="string">u'sha1:bcd259ccf...your hashed password here'</span></span><br></pre></td></tr></table></figure><blockquote><p>Tip: 利用ipython 生成密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; In [1]: from IPython.lib import passwd</span><br><span class="line">&gt; In [2]: passwd()</span><br><span class="line">&gt;   Enter password:</span><br><span class="line">&gt;   Verify password:</span><br><span class="line">&gt;   Out[2]: &apos;sha1:67xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&apos;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></blockquote><p>此处我选用的是一个密码的方案，jupyter的密码其他设置方案见 <a href="https://zhuanlan.zhihu.com/p/23110830" target="_blank" rel="noopener">link</a></p><h3 id="安装插件-nbextensions"><a href="#安装插件-nbextensions" class="headerlink" title="安装插件 nbextensions"></a>安装插件 <strong>nbextensions</strong></h3><p><strong>nbextensions</strong>是对于jupyter notebook 的一些插件，有很多有趣的插件，我选用了几个。jupyter_contrib_nbextensions <a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions" target="_blank" rel="noopener">github</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用conda安装</span></span><br><span class="line">conda install jupyter</span><br><span class="line">conda install -c conda-forge jupyter_contrib_nbextensions</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip安装</span></span><br><span class="line">pip install jupyter_contrib_nbextensions --user</span><br><span class="line"><span class="comment"># 使能</span></span><br><span class="line">jupyter contrib nbextension install --user</span><br></pre></td></tr></table></figure><p>我启用的一些插件</p><table><thead><tr><th>plugins</th><th></th><th></th></tr></thead><tbody><tr><td>Table of Contents (2)</td><td></td><td></td></tr><tr><td>Freeze</td><td>比较好的一个插件，可以用来冻住cell</td><td></td></tr><tr><td>nbTranslate</td><td>这个插件利用Google翻译cell很好用</td><td><a href="https://github.com/jfbercher/jupyter_nbTranslate/blob/master/languages.js" target="_blank" rel="noopener">support languages</a></td></tr><tr><td>ExecuteTime</td><td>显示执行时间</td></tr></tbody></table><h2 id="2-使用的技巧"><a href="#2-使用的技巧" class="headerlink" title="2. 使用的技巧"></a>2. 使用的技巧</h2><h3 id="2-1-基本操作"><a href="#2-1-基本操作" class="headerlink" title="2.1 基本操作"></a>2.1 基本操作</h3><p><strong>快捷键</strong></p><table><thead><tr><th>在非激活状态即是蓝颜色的边框</th><th>内容</th></tr></thead><tbody><tr><td>A</td><td>insert cell above</td></tr><tr><td>B</td><td>insert cell below</td></tr><tr><td>H</td><td>查看帮助</td></tr><tr><td>⌃↩(ctrl + enter)</td><td>run selected cells</td></tr></tbody></table><h3 id="2-2-技巧"><a href="#2-2-技巧" class="headerlink" title="2.2 技巧"></a>2.2 技巧</h3><p>主要是画图、显示视频和音频的方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图片</span></span><br><span class="line">%%HTML</span><br><span class="line">&lt;img src=<span class="string">"xxx.jpg"</span>  alt=<span class="string">"title"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 视频</span></span><br><span class="line">%%HTML</span><br><span class="line">&lt;video width=<span class="string">"330"</span> height=<span class="string">"150"</span> controls&gt;</span><br><span class="line">&lt;source src=<span class="string">"out_all.mp4"</span> type=<span class="string">"video/mp4"</span>&gt;</span><br><span class="line">&lt;/video&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 语音</span></span><br><span class="line">%%HTML</span><br><span class="line">&lt;audio src=<span class="string">"out.wav"</span> controls=<span class="string">"controls"</span>&gt;</span><br><span class="line">Your browser does <span class="keyword">not</span> support the audio element.</span><br><span class="line">&lt;/audio&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># html t是html的字符串</span></span><br><span class="line"><span class="keyword">from</span> IPython.core.display <span class="keyword">import</span> HTML</span><br><span class="line">HTML(str(t))</span><br></pre></td></tr></table></figure><h3 id="2-3-其他技巧"><a href="#2-3-其他技巧" class="headerlink" title="2.3 其他技巧"></a>2.3 其他技巧</h3><h4 id="修复视频文件"><a href="#修复视频文件" class="headerlink" title="修复视频文件"></a>修复视频文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fix_use_ffmpeg</span><span class="params">(in_name, out_name,message=<span class="string">""</span>)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(out_name):</span><br><span class="line">    os.remove(out_name)</span><br><span class="line">    cmd = <span class="string">'ffmpeg -i %s %s'</span> % (in_name, out_name)</span><br><span class="line">    log_lines = os.popen(cmd).readlines()</span><br><span class="line">    print(message,<span class="string">"ok"</span>)</span><br></pre></td></tr></table></figure><h4 id="加载自己的模块文件"><a href="#加载自己的模块文件" class="headerlink" title="加载自己的模块文件"></a>加载自己的模块文件</h4><p>出于性能考虑，每个模块在每个解释器会话中只导入一遍。因此，如果你修改了你的模块，需要重启解释器；或者，如果你就是想交互式的测试这么一个模块，可以用 imp.reload() 重新加载，例如 <code>import imp; imp.reload(modulename)</code></p><h4 id="导出pdf支持中文"><a href="#导出pdf支持中文" class="headerlink" title="导出pdf支持中文"></a>导出pdf支持中文</h4><p>Jupyter Notebook 输出PDF中文支持 <a href="https://www.jianshu.com/p/c3f660188766" target="_blank" rel="noopener">link</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/lib/python3.6/site-packages/nbconvert/templates/latex</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在里面的模版中添加，前提是安装好了texlive</span></span><br><span class="line">% add</span><br><span class="line">\usepackage&#123;ctex&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;概要：&lt;br&gt;jupyter notebook的安装&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Jupyter" scheme="https://talengu.github.io/categories/Jupyter/"/>
    
    
      <category term="Python" scheme="https://talengu.github.io/tags/Python/"/>
    
      <category term="Notebook" scheme="https://talengu.github.io/tags/Notebook/"/>
    
      <category term="Tools" scheme="https://talengu.github.io/tags/Tools/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu引导修复</title>
    <link href="https://talengu.github.io/2017/06/14/linux/boot_recovery/"/>
    <id>https://talengu.github.io/2017/06/14/linux/boot_recovery/</id>
    <published>2017-06-14T08:00:04.000Z</published>
    <updated>2018-11-07T14:38:21.078Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概要：<br>修复ubuntu引导，修改ubuntu盘的大小<br>参考：<a href="http://www.cnblogs.com/jloveu/p/Ubuntu-partition-expansion-record.html" target="_blank" rel="noopener">http://www.cnblogs.com/jloveu/p/Ubuntu-partition-expansion-record.html</a><br>我直接用Ubuntu live，里面自带gparted分区工具，还有grub修复工具<br><a id="more"></a></p></blockquote><h2 id="修复启动"><a href="#修复启动" class="headerlink" title="修复启动"></a>修复启动</h2><p>执行以下命令（以root身份）：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/mydir</span><br><span class="line">mount /dev/sda8 /tmp/mydir  (注：其中的`/dev/sda8`为我的`/`分区标识，根据自己情况修改为自己的`/`分区标识)</span><br><span class="line">mount /dev/sda11 /tmp/mydir/boot  (注：同上，`/dev/sda11`为`/boot`分区标识)</span><br><span class="line">mount --bind /dev /tmp/mydir/dev</span><br><span class="line">mount --bind /proc /tmp/mydir/proc</span><br><span class="line">mount --bind /sys /tmp/mydir/sys</span><br><span class="line">chroot /tmp/mydir  (此步可能输出一些信息，可以无视)</span><br><span class="line">grub-install /dev/sda  (注：其中的`/dev/sda`为`/`分区所在硬盘的标识)</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p><h2 id="修改Ubuntu多系统的默认启动顺序"><a href="#修改Ubuntu多系统的默认启动顺序" class="headerlink" title="修改Ubuntu多系统的默认启动顺序"></a>修改Ubuntu多系统的默认启动顺序</h2><p><a href="http://jingyan.baidu.com/article/f71d60379e16021ab641d1ab.html" target="_blank" rel="noopener">link</a><br>打开该配置文件”/etc/default/grub”<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br></pre></td></tr></table></figure></p><p>其中的“GRUB_DEFAULT=0”为设置默认启动项。系统启动菜单Windows10的启动项在第5项，修改为4（GRUB启动项是从0开始的）。<br><img src="/public/2017/06/14/linux/boot_recovery/boot_file.png" alt="GRUB修改"></p><h2 id="去除多余GRUB启动项（直接）"><a href="#去除多余GRUB启动项（直接）" class="headerlink" title="去除多余GRUB启动项（直接）"></a>去除多余GRUB启动项（直接）</h2><p><a href="https://zhidao.baidu.com/question/472571337.html" target="_blank" rel="noopener">link</a><br>注释掉“/boot/grub/grub.cfg”中对应<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;概要：&lt;br&gt;修复ubuntu引导，修改ubuntu盘的大小&lt;br&gt;参考：&lt;a href=&quot;http://www.cnblogs.com/jloveu/p/Ubuntu-partition-expansion-record.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.cnblogs.com/jloveu/p/Ubuntu-partition-expansion-record.html&lt;/a&gt;&lt;br&gt;我直接用Ubuntu live，里面自带gparted分区工具，还有grub修复工具&lt;br&gt;&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://talengu.github.io/categories/Linux/"/>
    
    
      <category term="Ubuntu" scheme="https://talengu.github.io/tags/Ubuntu/"/>
    
      <category term="BootRecovery" scheme="https://talengu.github.io/tags/BootRecovery/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu的优化与设置</title>
    <link href="https://talengu.github.io/2017/05/22/linux/ubuntu/"/>
    <id>https://talengu.github.io/2017/05/22/linux/ubuntu/</id>
    <published>2017-05-22T10:00:04.000Z</published>
    <updated>2018-11-07T14:40:07.301Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概要：<br>本文整理了一下我在使用ubuntu过程中的一些小技巧。<br>一个好的Ubuntu教程.<a href="http://www.cnblogs.com/dutlei/archive/2012/11/20/2778327.html" target="_blank" rel="noopener">原文链接</a><br>Linux有很多分支，Ubuntu的使用安装比较方便.Ubuntu 16.04 LTS</p></blockquote><a id="more"></a><h2 id="1-个性化"><a href="#1-个性化" class="headerlink" title="1.个性化"></a>1.个性化</h2><h3 id="窗口颜色设置浅绿色"><a href="#窗口颜色设置浅绿色" class="headerlink" title="窗口颜色设置浅绿色"></a>窗口颜色设置浅绿色</h3><p>窗口编程浅绿色  <a href="http://jingyan.baidu.com/article/ff42efa9195eb8c19e2202ec.html" target="_blank" rel="noopener">link</a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/themes/Ambiance/gtk-3.0</span><br><span class="line">sudo gedit gtk-main.css</span><br></pre></td></tr></table></figure></p><p>编辑该文件,将base_color <code>#ffffff</code>修改成 <code>#CCE8CF</code><br>对应RGB  48,19,36</p><h2 id="2-常用环境"><a href="#2-常用环境" class="headerlink" title="2. 常用环境"></a>2. 常用环境</h2><h3 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h3><p>打开文件 <code>vim ~/.bashrc</code>，在文件后面添加下面几行，其中<code>JAVA_HOME</code>根据自己的java安装位置修改。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add java path</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java/jdk1.7</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure></p><p>别忘了，<code>source ~/.bashrc</code>激活环境</p><h2 id="3-安装软件"><a href="#3-安装软件" class="headerlink" title="3. 安装软件"></a>3. 安装软件</h2><h3 id="在线软件安装"><a href="#在线软件安装" class="headerlink" title="在线软件安装"></a>在线软件安装</h3><p><strong>源列表地址修改(可选)</strong>，如果选用靠近的源速度会比较快，但是可能不是最新的软件。现在好像ubuntu china的官方节点速度还不错。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份源列表地址</span></span><br><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list_backup</span><br><span class="line"><span class="comment"># 修改</span></span><br><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure></p><p><strong>在线安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新源</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包search</span></span><br><span class="line">apt-cache search xxx</span><br></pre></td></tr></table></figure></p><h3 id="deb本地软件安装"><a href="#deb本地软件安装" class="headerlink" title="deb本地软件安装"></a>deb本地软件安装</h3><p><strong>安装软件</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装deb包命令</span></span><br><span class="line">dpkg -i *.deb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果缺少依赖执行</span></span><br><span class="line">apt-get -f install</span><br></pre></td></tr></table></figure></p><h2 id="4-常用软件"><a href="#4-常用软件" class="headerlink" title="4. 常用软件"></a>4. 常用软件</h2><h3 id="mpv播放器"><a href="#mpv播放器" class="headerlink" title="mpv播放器"></a>mpv播放器</h3><h3 id="有道字典"><a href="#有道字典" class="headerlink" title="有道字典"></a>有道字典</h3><p>有道字典 需要修改一下才能使用。 <a href="http://www.w2bc.com/article/227083" target="_blank" rel="noopener">link</a></p><h3 id="atom"><a href="#atom" class="headerlink" title="atom"></a>atom</h3><p>高分屏字体大小，Settings-&gt;Themes-&gt;your stylesheet<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">atom-pane</span> &#123;</span><br><span class="line">     <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="selector-class">.command-palette</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><h3 id="图标设置"><a href="#图标设置" class="headerlink" title="图标设置"></a>图标设置</h3><p>对于一些绿化软件来说没有图标，我们可以手动创建一个图标。<br>在/usr/share/applications目录下创建eclipse启动器配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/applications</span><br><span class="line">vim eclipse.desktop</span><br></pre></td></tr></table></figure><p>编辑eclipse.desktop并保存。简单的配置示例：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/env xdg-open</span></span><br><span class="line"></span><br><span class="line">[Desktop Entry]</span><br><span class="line">Version=22.0</span><br><span class="line">Name=eclipse</span><br><span class="line">Exec=/home/gtc/Android/adt-bundle-linux/eclipse/eclipse</span><br><span class="line">Terminal=false</span><br><span class="line">Icon=/home/gtc/Android/adt-bundle-linux/eclipse/icon.xpm</span><br><span class="line">Type=Application</span><br><span class="line">Categories=Development</span><br></pre></td></tr></table></figure></p><h2 id="5-其他优化"><a href="#5-其他优化" class="headerlink" title="5. 其他优化"></a>5. 其他优化</h2><h3 id="关闭错误报告"><a href="#关闭错误报告" class="headerlink" title="关闭错误报告"></a>关闭错误报告</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 关闭烦人的错误报告</span></span><br><span class="line">sudo gedit /etc/default/apport</span><br></pre></td></tr></table></figure><h3 id="CPU-100-占用"><a href="#CPU-100-占用" class="headerlink" title="CPU 100%占用"></a>CPU 100%占用</h3><p>gvfsd-smb-browse CPU 100%占用<br>我没有修改，它就自己停了，可以在mointer里中止这个进程<br>地址<br><a href="http://tieba.baidu.com/p/4505730863" target="_blank" rel="noopener">http://tieba.baidu.com/p/4505730863</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/lib/gvfs</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将gvfsd-smb-brows权限改成744，取消普通用户的执行权限，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 也挺有意思，暂时没引发别的问题</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;概要：&lt;br&gt;本文整理了一下我在使用ubuntu过程中的一些小技巧。&lt;br&gt;一个好的Ubuntu教程.&lt;a href=&quot;http://www.cnblogs.com/dutlei/archive/2012/11/20/2778327.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;原文链接&lt;/a&gt;&lt;br&gt;Linux有很多分支，Ubuntu的使用安装比较方便.Ubuntu 16.04 LTS&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://talengu.github.io/categories/Linux/"/>
    
    
      <category term="Ubuntu" scheme="https://talengu.github.io/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>红楼梦与我</title>
    <link href="https://talengu.github.io/2017/05/14/readings/hongloumeng/"/>
    <id>https://talengu.github.io/2017/05/14/readings/hongloumeng/</id>
    <published>2017-05-14T04:39:04.000Z</published>
    <updated>2018-11-12T10:28:35.598Z</updated>
    
    <content type="html"><![CDATA[<p>红楼梦是我国四大名著之一，主要内容是贾府的兴衰和宝黛的悲剧爱情。电视剧红楼梦2010版，我是从八月开始看的，看完到现在，也有小一个月了。在网上大家对这版电视剧褒贬不一。与我来说，我是喜欢这部剧的，不能说拍得很好，但这部剧却勾起了我读书与写字的兴趣。于是乎，做了一篇随笔，以记录我的一些感触。  </p><a id="more"></a><p>我记得最早是小学，我们还是顾着打玻璃珠和丢沙包的年纪，学校旁边的小书店里，也都是七龙珠，哆啦A梦，柯南的小人书，老师们讲到四大名著，顺带提了下红楼梦，其他没印象了。我们学习最多的是中文的拼音和书写，作文都是打油，日记也闹了不少笑话。后来上初中，有一次寒假附加作业是阅读红楼梦，我虽毫无兴趣，但还是硬着头皮，去新华书店，试看红楼梦。120章的红楼，厚得连看下去的勇气也没有。略看了几下，最后，做了一个红楼梦不好看的论断，也就放在那边了。那时有老版的红楼梦电视剧播映，打开电视偶尔会遇见，但是立马换台，央视的西游记与情深深雨蒙蒙，湖南电视台的还珠格格，也是欣赏了好几遍。再者，有动画片谁有兴趣去看这些什么破剧，关于书本，最多也就是看看汤姆索亚历险记。</p><p>再后来，去启中读书，学习上比较紧张，再加上理科班的非文学氛围，对这些文学的东西更不感冒。尽管偶尔也会入耳一些其中的人物，比如林妹妹，刘姥姥，也是不用大脑耳朵直接过滤。当时，大伙是杂志，读者，青年文摘读得比较多，班上一本，全班查阅，杂志文章篇幅较小，读起很顺很舒服。期间，与红楼的唯一一次接触是，高中教科书上有刘姥姥进大观园的章节，翻了一遍，当时，感叹人物好多，理不出人物关系，完全放弃看完红楼的欲望。以为姥姥是贾府的姥姥，猩猩然想着以后可以说看过一段红楼，红楼也比较贵不如多买几本读者，积累作文素材。不知什么时候，班上网络小说之风随着mp4和智能手机的普及而吹起，我也用MP4刷完了一两部网络小说，感觉都是一个套路，主角都是绝处逢生，越来越无敌，也就不敢兴趣了。</p><p>再然后，我上大学，藏书400百万册的成电图书馆，也并没有引起我读文学类的欲望，大学四年借的专业工具类书比较多，想来也是浪费资源。在一个工科高校，文学方面的课程几乎没有，虽说有个大学语文的选修课，俨然不感兴趣。大学里，再一次看到有人在看红楼梦电视剧，也是大二的时候的人工智能课上，也是闲得无聊。再后来，大四时，手机上自带一个蜻蜓网络电台应用，无聊点开蒋勋老师评述的红楼梦音频，红学大师讲到他与红楼梦的相遇，同时，他介绍的红楼基本背景和人物，通俗易懂，一下子引起我的兴趣。他说红楼梦写的都是15、6岁人的故事，15、16岁就可以读了。回想我15、16岁，基本没看什么名著。要说四大名著，我也就看了三国和水浒的少年版。上次回家，看美剧，老妈突然蹦出句，不能光看英文也应当看看我们老祖宗的文化。</p><p>现在得空，就这样抱着惭愧和一丝尝试我看起了2010版红楼梦。在这我得承认，我是个演员控。不得不说，三大主演都很不错。</p><p>50集过后，原来红楼讲得是这个，并表示有兴趣去读读名著了。原来有这么多原来。</p><ul><li><p>人物家族命运令人感慨。作者写出超越那个时代的朦胧的爱情与不得不提的丧心病狂的全部悲剧，果然是个失意文人的作品。 可叹停机德，堪怜咏絮才。宝钗落落大方德才兼备，黛玉因情而伤而痛去世，宝玉虽与宝钗结婚，最后离家成道去。精于人情世故,，胸有城府的王熙凤，平日的爽朗笑声终究悲剧，贾府里多么好的领导，最后也人情冷暖，不免为其伤心。刘姥姥，其实是个成功的投机分子，但也是朴实善良的“穷亲戚”，最后救了巧儿。十二金钗各有个的悲剧，正如宝玉在虚幻仙境里警幻仙姑给的设定。原来故事一开始就把结局告诉了读者。</p></li><li><p>体验古代贵族文化。里面还有个诗社的组织，古人的结社，好有雅致，也会给人起“绰号”。除此以外还有击鼓传花，有时主题是讲笑话有时对诗。猜灯谜，中秋赏月，生日宴会等等。</p></li><li><p>语言魅力。打秋风，这是形容刘姥姥找找贾府接济用的。恼，生气，或者使生气。不同人的称谓，宝兄弟，宝二爷，宝姐姐或者好姐姐，林妹妹或者好妹妹。</p></li><li><p>情节回味无穷。刘姥姥进大观园，是贾母和姥姥差不多年纪想和她聊聊，邀请她的。乡村来打秋风的刘姥姥像是在参观皇宫。在后面时期  ，家族里一次比一次捉襟见肘的聚会，可以看见这些家族的衰落。中国的各种人情世故体现在这里面。四个大家族，一个小社会。</p></li></ul><p>以上是我的一点点感悟。</p><p>只是，我与红楼梦，还差80章书页，希望还能有计划地读完。</p><p>2016年于成电</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;红楼梦是我国四大名著之一，主要内容是贾府的兴衰和宝黛的悲剧爱情。电视剧红楼梦2010版，我是从八月开始看的，看完到现在，也有小一个月了。在网上大家对这版电视剧褒贬不一。与我来说，我是喜欢这部剧的，不能说拍得很好，但这部剧却勾起了我读书与写字的兴趣。于是乎，做了一篇随笔，以记录我的一些感触。  &lt;/p&gt;
    
    </summary>
    
      <category term="读书笔记" scheme="https://talengu.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="故事" scheme="https://talengu.github.io/tags/%E6%95%85%E4%BA%8B/"/>
    
      <category term="《红楼梦》" scheme="https://talengu.github.io/tags/%E3%80%8A%E7%BA%A2%E6%A5%BC%E6%A2%A6%E3%80%8B/"/>
    
  </entry>
  
  <entry>
    <title>数学问题 - 一个空间解析几何问题</title>
    <link href="https://talengu.github.io/2017/05/05/math/math_q1/"/>
    <id>https://talengu.github.io/2017/05/05/math/math_q1/</id>
    <published>2017-05-05T08:00:04.000Z</published>
    <updated>2018-11-07T14:43:05.504Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概要：<br>一个数学问题，我有空试着练习一下，顺便练习一下Latex输入公式。如果有错误或更好的解答，欢迎在下面回复。</p></blockquote><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>为什么会经过这个空隙？  </p><p><img src="/public/2017/05/05/math/math_q1/math_q1_show.gif" alt="动图"></p><a id="more"></a><h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><p>首先建立空间直角坐标系，$P$ 点为水平杆与斜杆的交点，$Q$点为垂直杆与水平杆的交点，<br>将斜杆标记为 $L$，假设 $OQ=q$ ，$QP=r$ 。</p><p>设水平杆 $ QP $ 绕 $ z $ 轴以 $ \omega\, rad/s $ 的角速度旋转，并设开始旋转的时间长度为$t$ 秒，<br>则$ P(r\cos{\omega t}, r\sin{\omega t}, q) $  </p><p>$$<br> \overrightarrow{OQ}=(0, 0, q) \qquad \overrightarrow{QP}=(r\cos{\omega t}, r\sin{\omega t}, 0)<br>$$</p><p>我们知道 $\overrightarrow{QP}$ 与斜杆 $L$ 垂直，假设 $\overrightarrow{OQ}$ 与斜杆 $L$ 成固定角 $\theta$ ，设 $L$ 的方向向量 $\overrightarrow{s}=(A, B, C)$</p><p>斜杆 $L$ 代表的直线：<br>$$<br>\frac{x-r\cos{\omega t}}{A}=\frac{y-r\sin{\omega t}}{B}=\frac{z-q}{C}<br>$$</p><p>$$<br>\begin{cases}<br>0=\overrightarrow{QP} \cdot \overrightarrow{s} \\<br>\cos{\theta}=\frac{\overrightarrow{OQ} \cdot \overrightarrow{s}}{\left|\overrightarrow{OQ}\right| \left| \overrightarrow{s}\right|}<br>\end{cases}<br>$$</p><p>$$<br>\frac{A}{C}=\frac{-\sin{\omega t}}{\cos{\omega t}}<br>$$</p><p>$$<br>B^{2}(\tan{\theta})^{2}=A^{2}+C^{2}<br>$$</p><p>$$   \frac{B^{2}}{C^{2}}=\frac{1}{(\tan{\theta})^{2}(\cos{\omega t})^{2}} $$</p><p>为了求直线组$L$与$xoy$平面相交的图形，我们令$z=0$<br>$$  \frac{x-r\cos{\omega t}}{A}=\frac{y-q}{B}=\frac{-r\sin{\omega t}}{C} $$</p><p>$$ \begin{cases}<br>\frac{A}{C}=\frac{1}{(\tan{\theta})^{2}(\cos{\omega t})^{2}}\\<br>\frac{x-r\cos{\omega t}}{A}=\frac{-r\sin{\omega t}}{C}<br>\end{cases} $$</p><p>$$ \cos{tx}=r $$</p><p>$$ (\cos{\omega t})^{2}=\frac{r^{2}}{x^{2}} $$</p><p>$$ (\sin{\omega t})^{2}=\frac{x^{2}-r^{2}}{x^{2}} $$</p><p>$$ \begin{cases}<br>\frac{B^{2}}{C^{2}}=\frac{1}{(\tan{\theta})^{2}(\cos{\omega t})^{2}}\\<br>\frac{y-q}{B}=\frac{-r\sin{\omega t}}{C}<br>\end{cases} $$</p><p>消去 $ (\cos{\omega t})^{2} $ 和 $ (\sin{\omega t})^{2} $<br>得 $ x^{2}-(\tan{\theta})^{2}(y-q)^{2}=r^{2} $<br>易知为双曲线方程，所以在 $ xoy $ 平面相交得图形为双曲线。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;概要：&lt;br&gt;一个数学问题，我有空试着练习一下，顺便练习一下Latex输入公式。如果有错误或更好的解答，欢迎在下面回复。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h2&gt;&lt;p&gt;为什么会经过这个空隙？  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/public/2017/05/05/math/math_q1/math_q1_show.gif&quot; alt=&quot;动图&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="数学问题" scheme="https://talengu.github.io/categories/%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98/"/>
    
    
      <category term="空间解析几何" scheme="https://talengu.github.io/tags/%E7%A9%BA%E9%97%B4%E8%A7%A3%E6%9E%90%E5%87%A0%E4%BD%95/"/>
    
      <category term="Latex" scheme="https://talengu.github.io/tags/Latex/"/>
    
      <category term="Math" scheme="https://talengu.github.io/tags/Math/"/>
    
  </entry>
  
  <entry>
    <title>琉璃易碎，人言易坠——关于《莺莺传》的叙事</title>
    <link href="https://talengu.github.io/2017/04/14/readings/yingyingzhuan/"/>
    <id>https://talengu.github.io/2017/04/14/readings/yingyingzhuan/</id>
    <published>2017-04-14T04:39:04.000Z</published>
    <updated>2018-11-07T14:44:25.838Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>《西厢记》的书评:【琉璃易碎，人言易坠——关于《莺莺传》的叙事】转载<br>…全文:<a href="https://www.douban.com/doubanapp/dispatch?uri=/review/1200691/" target="_blank" rel="noopener">(豆瓣link)</a></p></blockquote><p>“半欲天明半未明，醉闻花气睡闻莺。 狌儿撼起钟声动，二十年来晓寺情。 ”男人四十的元微之写着酸酸的诗，回忆年少风流。假如我是元微之，我一定会这般写道：天空尚未亮透，微微透着点光，远处传来钟声，让我的思绪一下子回忆到二十年前，也是这样的一个早晨，在那所古寺的西厢，那个散发着鲜花一样香气的女子，用鸟儿般宛转的声音在我耳边低语：“钟声响了，想来我也该回去了。”那声音一直萦绕在耳边，十年、二十年、也许一辈子在我在记忆深处响起……。</p><a id="more"></a><p>夜宿古刹，偶遇佳人，相伴遥夜，缠绵缱绻，天明而别。这样的际遇，是最最典型的古代书生的爱情幻想。在一个陌生的地方，遇到一个陌生人，发生一段有始无终的感情。书生注定要做个过客，一生漂泊在对那个女子的思念中，却没有勇气长相守。</p><p>当我还是一个初中生的时候，我买来人民文学出版社的《西厢记》，上面盖本教科书，堂而皇之的上课看。但是很快，除了王实甫那华丽的辞藻，整个大团圆的故事构架让我兴趣索然，而前言里现代人给它冠上的什么“礼教叛逆者反抗封建卫道士”的宏大内涵更让我倒尽胃口。</p><p>在书后还附着元稹的《莺莺传》。《莺莺传》所描写的其实只是两个人的故事，两个恋爱的人后来分开的故事，没有太宏大的叙事，没有那些官腔的说教和露骨的批判。这样的故事是我所喜的；这样的故事，也是中国文人所津津乐道的。关于类似内容的作品也就汗牛充栋，数不胜数。或许从《诗经》的“氓之蚩蚩，抱布贸丝”开始，就没有谁打算给自己的爱情故事赋予太宏大的命题，只是后来的人突然犯失心疯，发现了字里行间的微言大义。所以我很景仰孔夫子他老人家，他的《论语》里每一个字都可以养活一大批的圣贤大师。</p><p>元稹的这篇传奇被人考据出是以自己为原型的故事，是一篇忏悔录。忏悔的味道我闻不出来，但是众前辈大师言之凿凿说张生便是元大才子，那我也就相信了罢。</p><p>《莺莺传》的开头，交代道“在贞元年间，有位张生，他性格温和而富有感情，风度潇洒，容貌漂亮，意志坚强，脾气孤僻”。古人向来有画脸谱的习惯，只要不是丑的太离谱，一般的名士贤臣都被描写成“性温茂，美风容”之类。但是据说元稹的家族是著名的鲜卑拓跋，鲜卑人的美貌是相当出名的，就好象现在说日本人长的猥亵一样出名，所以我有理由相信，元稹在这点上也许没有吹牛。</p><p>文章写道“以是年二十三，未尝近女色”，后面他自己解释道“登徒子非好色者，是有凶行；余真好色者，而适不我值。何以言之？大凡物之尤者，未尝不留连于心，是知其非忘情者也”，就仿佛现在的大学男生在卧谈会上被迫承认自己二十三岁高龄还是个处男，被人取笑之下只好解释“其实我哪里是没能力啊，我只是没遇到真正让我心动的；一般的庸脂俗粉我看不上眼，要是真有出类拔萃的，我也会追的。我是谈感情的，和你们玩肉体的垃圾是不一样的”诸如此类。但是考察元稹的家庭情况，他八岁丧父，在家族里又被同父异母的兄弟欺凌，从小随着母亲投奔舅氏，生活贫困，母亲教她念书。我们可以想象，一个幼年便寄人篱下，遭受贫困欺凌的味道，他只比林黛玉多了一个母亲而已，但是林黛玉在物质生活上绝对比他适意。我们的脑海里可以浮现这样一个人物性格：幼年丧父的人，对于男人所称道的齐家治国平天下之类的宏伟功名有着不同于常人的热情和执著，范仲淹就是很好的例子，所以元稹在事业上一直很上进努力，为达目的不惜代价不择手段，由于尝尽人情冷暖世态炎凉，他很敏感，这样的人物让我想到了《红与黑》里的主人公于连；他自幼由一个母亲抚养成人，一般这样的人具有恋母情结，对于女性有异于常人的喜好，所以他的性格里又有滥情懦弱的一面。多情和薄幸，坚毅和懦弱，正义和无耻都矛盾地体现在他身上，这也就能让我们更好的理解他后来为了追求功名而抛弃莺莺的举动了。由于家境贫寒，极端律己，自卑和敏感的元微之“内秉坚孤，非礼不可入”，就算偶尔参加朋友一起的游宴——古人的游宴和现在去歌舞厅唱歌跳舞一样，一般都安排了色情服务——“扰杂其间，他人皆汹汹拳拳，若将不及”，而他“容顺而已，终不能乱”。我不清楚他是不是冬天还要帮别人洗衣服赚钱，但是可以肯定他不会参与打牌这样不合礼仪的活动，所以也就不会有谁去污蔑他打牌作弊，不会有“樗蒲不胜，槌杀四生”的惨剧了。</p><p>在这里他第一次提到“物之尤者”，后面他还有段很著名的话也提到“尤物”，为自己抛弃莺莺的行为做解释“大凡天之所命尤物也，不妖其身，必妖于人”。如此看来，仿佛我们的元大才子是个叶公好龙式的人物，这边在说假如能遇到尤物一定会动真情，那边厢却在说尤物不害她自身，必定祸害他人。没有得到的时候千方百计的追求，到手以后又不迭地甩掉去追求新的目标。人总是这样矛盾的动物，永远不明白自己所追求的到底是什么。我们知道最后元稹娶了豪门韦家的女儿为妻，使得他在仕途平步青云。于此，我们不妨看成是理智和情欲的对立，一边是代表事业投机的豪门韦家联姻的机会，而一边只是爱过的漂亮的女子，理智告诉他应该离开那个女子，但是情欲却欲罢不能，但是最后我们知道理智战胜了情欲，感情只好盘踞在文字里去凭吊，所以元微之为我们贡献了很多首脍炙人口的情诗。</p><p>后来，张生，也就是元稹路过蒲州，搭救了寄住在普救寺的崔家寡妇一家。“是岁，浑瑊薨于蒲，有中人丁文雅，不善于军，军人因丧而扰，大掠蒲人。……先是张与蒲将之党有善，请吏护之，遂不及于难。十余日，廉使杜确将天子命以总戎节，令于军，军由是戢。”据《旧唐书·德宗纪》，贞元十五年十二月，河中绛州节度使浑瑊卒，以同州刺史杜确为河中尹、河中绛州观察使。元稹在贞元九年举明经科，并于贞元十五年在河中府任卑职，所以他和蒲将之党有交情，打个招呼关照一下也在情理之中；但据唐代举士制度，士之及第者还需要经过吏部考试才能正式任命官职，所以我们可以推测出在贞元十五年年底的时候，元稹便上路去长安应考，于是在蒲州遇上了莺莺一家。</p><p>我们知道这篇传奇是有虚构的成分，就如元稹在里边成了张君瑞，但是有一点细节仍然需要注意的，就是莺莺家族的姓氏。在唐朝时候，年轻人普遍的梦想有两个，金榜题名，娶七姓女；就如同现在的大学生的梦想，考上公务员，讨个有钱人做老婆。娶个有钱人做老婆可以少奋斗十年，这是基于现实利益的考量，而娶七姓女等于瞬间提升了自身家族的社会层次，也是基于现实利益的考量。在中国人的现实生活里，找不到“爱情”这两个字–有时候看历史真的会看到掩卷叹息，中国人过了几千年，还是一点长进都没有啊。唐代的士族世家已经逐渐没落，但是依然地位显赫，其中以陇西李氏、太原王氏、荥阳郑氏、范阳卢氏、清河崔氏、博陵崔氏、赵郡李氏等七姓十族最为著名，一般这些世家大族互为婚姻，自惜羽毛。唐高宗时宰相李义府为子向山东士族求婚不遂，而向朝廷建议禁止七姓十族自为婚姻。可见娶个望族女子为妻，是多么的艰难啊。莺莺是姓崔的，而且“财产甚厚，多奴仆”，很自然的就联想到了清河崔氏、博陵崔氏这些世家大族；但是很奇怪的是元稹描写的张生居然抛弃了莺莺，一个出身寒族的士子抛弃了一个那么美貌温柔的世家女子，仅仅只为了他自己所谓的“予之德不足以胜妖孽，是用忍情”么？考察元某人在政治上趋炎附势的态度，我是不相信他冠冕堂皇的话的。姑且让我用自己邪恶的想法去揣测他：那个被唤作莺莺的女子必定不是什么世家望族，所以元稹为了前途而抛弃了她，之所以故意写成崔氏，只是制造了一种假象，让读者有个印象那个莺莺是世家女子，我元微之离开她只是因为好男儿不该沉溺于爱情，你看为了理想我连世家女都放弃了啊。这便是文人的下作！</p><p>为了答谢这位刚认的远亲的救命之恩，于是请吃饭，贞元十五年十二月很快就在危机中渡过，这顿饭的时间也应该在贞元十六年的春天。当贞元十五年的大门“咣当”一声关掉，命运就载着我们的主人公来到了贞元十六年。饭局中张生曾问莺莺的年纪，“郑曰：‘今天子甲子岁之七月，终今贞元庚辰，生年十七矣。’”贞元庚辰，正是贞元十六年，那年元稹二十二岁，莺莺十七岁。</p><p>拿破仑指示说“请客的菜一定要好”，这个世间有好多的阴谋和决策在餐桌上议定，有好多缠绵或者惨烈的故事由餐桌上发端。郑国的子宋因为吃饭的时候分不到王八汤，结果一怒就干掉了郑灵公；而我们的张生，也就是元微之同学因为吃饭认识了莺莺姑娘。这表明吃饭是一次冒险，运气好的可以吃出一段情缘，运气不好的就要丢了性命，所以列位正要去吃饭相亲的同学们，你们要小心啊。</p><p>吃饭的时候，郑氏让儿子、女儿出来拜会救命恩人。那时侯未出阁的女子特别是大户人家的女子仿佛家之重宝，秘不见人；而郑氏却突然在一个年轻的刚认识不久的远房亲戚面前把女儿拉出来亮相，还要陪吃饭，哪怕这个年轻是救命恩人，这样的行为也是很突兀的，所以莺莺才会推三阻四的不想出来见面。郑氏这般的举动连一千多年后的我也想入非非，无疑也给了元稹兄弟很多假设的可能。不论当初的郑氏出于什么样的考虑做了这个决定，反正莺莺姑娘就此登场了。第一次召唤推说有疾，郑氏看起来很生气的说“张兄保尔之命，不然，尔且掳矣，能复远嫌乎”，这其中的话外之音，只能读者自己体会了。又过了很久，莺莺终于出场了。</p><p>“常服睟容，不加新饰，垂鬟接黛，双脸销红而已。颜色艳异，光辉动人”，简直惊为天人啊。我们很可以理解元稹的心情，在记忆里，那个已经离开的初恋情人总是最美丽的，而那第一次的见面总是浪漫得无法言说，第一眼里情人的样貌也是美艳不可方物。但是假如当时有照相的话，看到莺莺的照片也许你会失望，那个时代普遍流行的美女的体态是肥胖丰满的，那个时代美女的画像普遍有双下巴（有些是三下巴或者更多），面颊鼓鼓外凸，因为胖所以嘴巴也被挤的小小的嘟起来，实乃人间惨剧，竟无语凝噎！幸好莺莺不加新饰，保持了一点自然状态，否则那个惨白的面容、用红颜料描出的樱桃小嘴、脸上贴的花状的金钿和浓晕蛾翅眉足足可以把你吓死。</p><p>后面一句话很有意思：“张惊，为之礼。”张生看到莺莺那么漂亮，忙起来对她行礼。这个描写很传神，一般男子看到普通的女子，都保持一点点的风度，淡淡的仿佛视若不见；惟独见到美女，眼睛一亮，慌忙起身行礼，态度谦恭。足见莺莺之美。后来她坐到郑氏旁边，因为是郑氏强迫她出见的，所以她“凝睇怨绝，若不胜其体者”，那个样子就是《喜剧之王》里张柏芝所谓的“鹌鹑状”。如此楚楚动人的姿势，叫张生魂不守舍。问了年纪，只有十七岁，正是花季过后，果季之前，鲜脆欲滴，天真纯情的年纪啊！张生想和她找话题说话，但是莺莺就是不理睬他，一直到吃完饭也没有什么好说的。记得以前去参加一个朋友生日活动，饭桌遇上了朋友的表妹，也是一样的年轻明艳，也是一样的不理睬人，和她搭讪也装做没听见，搞得我们很没有面子，所以说，古往今来的好女孩一般都是很矜持的。由于没有机会接触，张生的思念就象潮水一样把他包围，所以他捉摸着要找个机会表白一下。</p><p>于是他从莺莺的小伙伴，侍女红娘那边入手。这个策略在以后的无数次实践当中被证明是极端正确的。大学里你要追求某个女生，先要从她寝室的室友下手，打通所有关节，请他们吃喝玩乐，最后那个女孩子身边所有的朋友都在说你好话，那你就成功一大半了。红娘被张生吓了一跳，问了个问题：“你既然那么喜欢，何不凭借你对我们家的恩情向夫人正式提亲呢（何不因其德而求娶焉）？”张生回答的话简直有点无耻了：“我从孩童时候起，性情就不随便附合。有时和妇女们在一起，也不曾看过谁。当年不肯做的事，如今到底还是在习惯上做不来。昨天在宴会上，我几乎不能控制自己。这几天来，走路忘了到什么地方去，吃饭也感觉不出饱还是没饱。恐怕过不了早晚，我就会因相思而死了。如果通过媒人去娶亲，又要‘纳采’，又要‘问名’，手续多得很，少说也得三四个月，那时恐我也就不会在人世了。你说我该怎么办呢？（余始自孩提，性不苟合。或时纨绮闲居，曾莫流盼。不为当年，终有所蔽。昨日一席间，几不自持。数日来，行忘止，食忘饱，恐不能逾旦暮。若因媒氏而娶，纳采问名，则三数月间，索我于枯鱼之肆矣。尔其谓我何？）”先吹捧自己性格不随便，然后表明见到莺莺姑娘连这样的性情也抛掉了，再不快点接近自己，就挂掉了，哪有时间挺到纳采问名啊。我从来不知道爱一个人，居然连三四个月都无法等待，这是赤裸裸的情欲，而非爱情；张生的第一目标是得到莺莺，而非和她相爱。情欲是正常的，但是不正常的是张生光明正大的以自己的情欲作为接近的借口，在一套绚丽机巧的辞藻下，其实裹挟着的不过是阿Q对吴妈的那句“我要跟你困觉”！</p><p>但是也许张生妇女工作做的好，红娘还真的帮他出主意，让他摇动笔杆。想来那时躲在深闺的大家闺秀并不知道外边文青的名声有多臭，结果一场悲剧上演了。</p><p>亚里士多德《诗学》言道：“性格为悲剧六大要素之一。”毫无疑问，莺莺的性格决定了她的悲剧结局。在她的身上我们看到矜持和热情，顺从和叛逆，坚定和认命矛盾的结合在了一起。前面我们已经注意到莺莺出场时的矜持，和在她母亲召唤下不肯出来见面的叛逆，但是当她看了张生的情诗之后却用那首暧昧的《明月三五夜》作为回应，把张生招来相见。“待月西厢下，迎风户半开。拂墙花影动，疑是玉人来。”这诗不论莺莺怎么强调“犹惧兄之见难,是用鄙靡之词，以求其必至”,都无法掩盖字里行间的情意和期盼。</p><p>二月十五的晚上，月亮大的吓人,文学青年元稹踏着美丽的月色，攀着墙边的杏花树翻过墙头投奔他的初恋去了。他来到西厢房,却只看到红娘躺在床上，双方都很奇怪。在红娘通报后，莺莺姑娘这才出现了。可能原本元大才子准备着类似“长夜漫漫，无心睡眠，没想到莺莺姑娘你也睡不着”之类的桥段，可是如此以来完全用不上了，而且莺莺姑娘一身包裹严实，表情严肃，狠狠地训斥了他一顿，然后扬长而去。元大才子只好承认都是月亮惹的祸，那样的月色太美太温柔，于是绝望了。元稹没有写他失恋后寻死觅活，更不像他自己说的“索之于枯鱼之肆”。但是很吊诡的是三天后莺莺就自荐枕席了。鉴于这段情节的突兀，《董解元西厢记诸宫调》里就设计了张生患相思病，莺莺探病的情节，王实甫也继承发扬了这段情节。这段情节看似让整个的故事情节更加合理，也让人物性格和心理有一定的起承转合，但其实是画蛇添足的一笔。</p><p>莺莺是一个性格矛盾的人，她对待未知的将来既期待又恐惧，她知道自己所做的是不容于世的，但是她对于爱情满怀憧憬而渴望冒险。在爱情的冲动下，她一步步滑向张生的怀抱。也许从第一次出来见这个救命恩人的时候，她便已经心存好感，起码我们知道张生的相貌世让人赏心悦目，这是爱情的基础；当看到张生的两首诗，更加倾慕于他。唐代的女孩子也和现在的女孩子一样，有自己心目中的白马王子。也许那个时代比较流行的梦中情人形象，就是元稹这样的才子。于是她情不自禁回了一首诗，也许只是想见他一面，但是理智告诉她这样做法的危险性。也许在红娘去通报的时候，她还在那里犹豫到底要不要去见。最后她决定去看一眼那个自己衷情的男子，她穿戴齐整。当爱上一个男人的女子，在那个男人面前总是很低很低,低到尘埃里,尘埃里便开出花来，于是她潜意识的想保持自己的尊严，她不想被他看成是轻薄的女子。她终于见到了他，在月色下，俊朗的男子期盼地看着自己，眼神顾盼之间，让人心旌摇荡；那淡淡的笑容，刚毅的嘴角，也许随着那夜的月色一起留在莺莺地记忆深处。她发觉自己陷入一种前所未有的危机，一种爱上别人为了那男子可以不顾一切的冲动，于是她板下脸来，义正词严地拒绝了那个男子。“非礼之动，能不愧心？特愿以礼自持，毋及于乱！”这些话在我看来倒有一大半是在对自己萌动的心说的，莺莺在警告自己不要逾越了礼，否则将万劫不复。男子一脸地失望，仿佛满地月光都成了严霜。她还是转身离去。但是正如元稹在《会真诗》里所写的“戏调初微拒，柔情已暗通”。我不知道莺莺在这三天里是如何地心情，我也不知道其中红娘起了多大地作用，但是我知道到了十八日的晚上，莺莺终于做了自己一生中最重要的决定。</p><p>“数夕，张生临轩独寝，忽有人觉之。惊骇而起，则红娘敛衾携枕而至，抚张曰：‘至矣！至矣！睡何为哉！’并枕重衾而去。张生拭目危坐久之，犹疑梦寐；然而修谨以俟。俄而红娘捧崔氏而至。至，则娇羞融冶，力不能运支体，曩时端庄，不复同矣。是夕，旬有八日也。斜月晶莹，幽辉半床。”唐贞元十六年二月十八日的夜晚，那一夜的经历对于元稹来说是如此的深刻，以至于很久以后依然清楚的记得那天的日期，那夜的月色。元稹在《会真诗》里清楚地描写了缠绵的经过，在千年之后的人们看来，那诗依然写得香艳露骨，荡人心旌：“微月透帘栊，萤光度碧空；遥天初缥缈，低树渐葱茏……低鬟蝉影动，回步玉尘蒙；转面流花雪，登床抱绮丛；鸳鸯交颈舞，翡翠合欢笼；眉黛羞频聚，朱唇暖更融；气清兰蕊馥，肤润玉肌丰；无力慵移腕，多娇爱敛躬；汗光珠点点，发乱绿松松……”。在晶莹的斜月下，天真善良的莺莺投奔了爱情，为了自己心爱的男子，为了梦想中的爱情，抛弃了一切，奉献了一切。也许古往今来有很多的人有这般的经历，曾经真心单纯地去爱一个人，为他（她）付出了一切。不管结果如何，起码在那一刻，付出的人是幸福的，虽然这样的幸福可能是要遭到报应的。</p><p>在现代人的眼光来看，莺莺这床也上的太快了些。其实这还不算彻底的，汉代的司马相如不过弹了次琴，卓文君便跟着他私奔了，连富翁老爹也不认了。那个时代，女子应允了一份爱情就等于一生一世，不会再有给你重来改过的机会。那是个严肃的时代，女子地位低下，虽然相对于其他朝代，唐朝的风气算是比较开明宽松，但是逾越礼制的爱情依然不容于世，和一个男子相恋，要么嫁给他，要么就是再也得不到幸福和爱情。如那位被元稹好友白居易赞为“醉娇胜不得，风嫋牡丹花”的徐州名妓关盼盼，在其丈夫徐州守帅张愔死后却被白居易讽刺她不肯殉情，逼得她不得不绝食自尽；又如步非烟，因为父母之命而嫁于功曹参军武公业，毫无爱情可言，于是她红杏出墙，爱上了攻读课业的书生赵象，被丈夫发现后，只是淡淡说了句“生既相爱，死亦何恨”，于是从容淡定，任凭丈夫拷打，不肯开口求饶一句，最后终于被活活打死，以暴疾而亡的名义埋了。那个时代的女子，很少可以拥有幸福的爱情，所以这充分体现了新社会的优越性，起码你谈几场恋爱没有关系，女孩子只要不失身还是会有幸福的。</p><p>红娘把枕头也带来了,在古时候,共同倚靠的枕头是充满暗示意味的情物，是在一起温柔缠绵的明证。本朝初年高阳公主嫁于房玄龄之子房遗爱为妻，却不爱房遗爱，在新婚之夜就把新郎拒于洞房之外。高贵的公主爱上了玄奘的高徒、最年轻却最聪慧的高僧辩机和尚，那时高阳公主十六岁，辩机和尚二十一岁。高阳公主送给辩机一个“金玉宝枕”，却被小偷偷出。结果事情因此泄露，高贵的辩机被腰斩于市，而高阳公主也一辈子恨上了自己的家族，“帝崩无哀容”。或许唐代的女子血液里奔流着冒险的因子，所以为了爱情不顾一切，哪怕被抛弃被鄙夷被万夫所指天地不容也再所不惜。于是整个唐朝给我们后人留下了一大堆让人向往的爱情故事。莺莺对待爱情的勇气，无疑是秉承了大唐女子一贯的风气，虽然她的命运因此让人心痛，但是她的形象也因此让人爱怜，在千百年后的今天依然让我爱慕钦佩。</p><p>“有顷，寺钟鸣，天将晓。红娘促去。崔氏娇啼宛转，红娘又捧之而去，终夕无一言。”如此“金风玉露一相逢”的时光过的总是很快，古寺的朝钟响起，天快亮了，莺莺也要离去了。对于类似的幽会后的早晨，《诗经》里便有很细致的描述：《郑风·女曰鸡鸣》里写道“女曰鸡鸣，士曰昧旦；子兴视夜，明星有烂”，女子在催促说“鸡已经在打啼了”，男子眷恋枕衾，“天还没全亮；你起身看夜空，启明星还闪闪发光”，然后慢慢谈到工作，谈到两个人的未来，谈到恩爱到白头，“宜言饮酒，与子偕老。琴瑟在御，莫不静好”；《齐风．鸡鸣》里写道“鸡既鸣矣，朝既盈矣。匪鸡则鸣，苍蝇之声。东方明矣，朝既昌矣。匪东方则明，月出之光”，女子催促男子快起身，男子淹留不肯，“那不是鸡叫，是苍蝇嗡嗡声，东边也没亮，那是月亮光而已”，回答言语可爱缠绵。钱钟书说：“莎士比亚剧中写情人欢会，女曰：‘天尚未明，此夜莺啼，非云雀鸣也。’男曰：‘云雀报曙，东方云开透日矣。’女曰：‘此非晨光，乃流星耳。’用以比勘。”但是我们注意到，莺莺和张生一夜缠绵，居然不交一词，只是在天明将别的时候，呜咽哭泣。这个写法相当传神，我们可以从那“山盟海誓”的缺失和离别时的哭泣，感受到莺莺内心的矛盾：她明知道她正在做一件可能万劫不复的错事，但是却无法控制内心对于张生的情意，爱情的那种使双方合二为一的强烈愿望战胜了对命运的恐惧，她不敢说话，因为说话就代表了清醒，她宁愿在一种迷醉的状态下委身于自己的爱人，抛却一切利益的得失、道德的禁梏；当天明将别，她仿佛恍然从梦中惊醒，好象做错了事的孩子一样，为自己的选择和命运哭泣，为自己所失去的哭泣。当然在这眼泪之中，对于离别的伤感，也占了一定的比重，所以在未来的十多天里，她再也没有和张生联系。</p><p>直到张生“赋《会真诗》三十韵，未毕，而红娘适至，因授之，以贻崔氏”，才又来与张生相会。想来未完的《会真诗》是个很好的说服自己的借口，只是来探讨文学罢了，但是总免不了“向谁行宿,不如休去”的挽留。于是这样相处了将近一个月。</p><p>“张生常诘郑氏之情，则曰：‘我不可奈何矣。’因欲就成之。”这是最常见的断句，莺莺说：“我没有办法告诉她。”于是张生便想亲自和郑氏谈谈，促成这件事。但是见家长的事突然没有下文，很快张生也去了长安，这样的情节安排无论如何都是不通的。幸好还有另外一个版本：“张生常诘郑氏之情，则曰：‘知不可奈何矣，因欲就成之。’”莺莺说她妈知道也没其他办法了，所以想促成我们的婚事。他们相处同居了一个月，而寺院内有崔家那么多的仆役，就算郑氏再昏懵，也应该了解到女儿的事情了。事已既此，无可奈何，女儿大了，心向外人，现在也只能期盼那男人能负责任把她娶去了。这样的心情很可以理解，我的一个朋友，和她女朋友两地分居，而且女孩子在当地做了教师，不错的职业，眼看因为家里反对要分手了，但是有天女孩子的父母偷听他们的电话，知道了女儿已经失身于我的朋友，于是第二天就让女儿把我的朋友叫去见面，很快便结了婚。所以很多时候，我都分不清自己到底是生活在古代还是生活在现代，一千多年下来，对待某些问题的做法还是一点都没变化。</p><p>但是张生可能很害怕被一桩寒门的婚姻套牢，一听这话赶快跑路；于是借口“为了梦想中金碧辉煌的长安,都市里充满了神奇的历险,满足一个男儿宏伟的心愿”，西下长安去了。去之前还先告诉了莺莺，“崔氏宛无难词，然而愁怨之容动人矣”。有一种哀伤，是哭不出来的，它会慢慢渗透进你的骨子，日日夜夜一点一滴地侵蚀你的情绪。或许她害怕自己会控制不住自己面对离别的悲伤，所以在张生将要走的第二天晚上，莺莺没有来。我总是不能理解女子的心思，明明想念你的，却不肯见面；明明想把你留下的，却早早地说出一路顺风的祝福；明明在说没有留下更多的甜蜜回忆，却连分手了也不肯来见最后一面，谁都无法想见女子的心里到底在想些什么，或许正是这样的复杂，才成就了莺莺形象的丰满。</p><p>但是很快，张生又回到了蒲州，又与莺莺相处了好几个月，也许是他无法放下这段感情，也许是长安尚未有“实现一个男儿宏伟志向”的机会，更可能是长安还没那么早开考，想最后的缠绵一下。莺莺的字和文章写的都很好，却从不给张生看；她写文章的水平很好，但是却好象什么都不懂的样子；她言辞敏捷，但是在外人面前却很少说话。或许这样的女孩子最是让人怜爱。“待张之意甚厚，然未尝以词继之。时愁艳幽邃，恒若不识，喜愠之容，亦罕形见”，莺莺是个内向的女孩子，有了情绪却不轻易流露，她不会口口声声地和你说“我爱你”，但是连她注视你的目光都能让你感到无限柔情，你无法知晓她的想法，但是却沉溺于她时时流露的情意。她喜欢弹琴来抒发情感，可能是心情忧郁，所以弹奏的曲子异常伤感。</p><p>不久张生便要去长安应试了，或许是下了决心终要割断前缘，一心功名，所以这个男人连说分手的勇气都没有，只能对着莺莺忧愁哀叹，自然他也是不肯去承诺些什么的。莺莺自然明白他的心思，面对爱人的负心薄情，做为一个弱女子又能说什么呢。莺莺是个坚强而又自尊的女子，她不会低声哀求张生留下，她态度恭敬，声音柔和，慢慢地对张生说：“始乱之，终弃之，固其宜矣，愚不敢恨。必也君乱之，君终之，君之惠也。则没身之誓，其有终矣，又何必深感于此行？然而君既不怿，无以奉宁。君常谓我善鼓琴，向时羞颜，所不能及。今且往矣，既君此诚。” 莺莺平静的面容下说出“始乱之，终弃之，固其宜矣，愚不敢恨”那是怎样的一种心痛呢，假如仅仅是个人爱情的失败也就罢了，但是其中还昭显出整个家族的衰败和老母最后一丝期望的落空。人很多时候并非为自己而活，所以人最不能承受的并非自身的失败，而是自身的失败给自己亲爱之人所带来的伤害。张生挥一挥衣袖，固然不带走一片云彩，还可以得到时人“善补过者”的赞誉，但是对于莺莺来说，不但她这一生的命运已经凄惨无疑，而且也给了她衰颓式微的家族一次重重的羞辱和打击。</p><p>她终于明白了“则没身之誓，其有终矣”，古往今来男女说着“山无陵，江水为竭，冬雷阵阵，夏雨雪，天地合，乃敢与君绝”的誓言，可大多数的人言语远比自身华丽，现实远没有恶化到世界末日，便已经支持不住，爱情一如华美的琉璃，碰触现实难免粉碎。</p><p>于是她为自己心爱的男子弹了最后一首曲子《霓裳羽衣曲序》，琴声因为心情悲伤而纷乱错杂，旁边的人都听着流泪，她终于弹不下去，扔下琴哭着跑到母亲的房里，再也没出来。在这部作品里，郑氏出场只有一次，侧面描写也并不多，但是我们却依然能想象一千多年前那位母亲的悲痛，为自己的命运，为家族的命运，更为自己女儿的命运感到悲伤。</p><p>第二天我们的元大才子便神清气爽地踏上西去长安的路途，但是那年他没有考中。于是他留在了长安，从莺莺的信中我们了解到，这个鄙薄的文青曾托人给莺莺寄去一封信，让她看开些，“以广其意”，顺便送去“花胜一合、口脂五寸”做为分手礼物。唐代女子喜欢用绢纸、金银等材料做出一朵朵花形的小物件，贴在脸上，唐代就称之为“花胜”或者“花钿”。元稹很潇洒地给分手后的情人送去长安最时尚的化妆品和首饰，想以此来弥补内心的愧疚。但凡女子都爱最新潮时尚的化妆品，犹以情人所赠为甚；但是我不知道淹留蒲州普救寺的母女，在这个穷乡僻壤突然看到负心的男人送来长安的时尚货色，会是怎样的心情，或许如后世李清照所言“泪融残粉花钿重”。</p><p>孤独无望地留在普救寺的莺莺回了一封信，那信却被张生炫耀于长安的朋友之间。就好象胡兰成把曾与他恩爱缠绵的女子都写进《今生今世》，古今文人下作起来都是一样。</p><p>对于自己的负心，元稹还借用了《左传》那句“夫有尤物,足以移人,苟非道德,则必有祸”，义正词严地发表了一通高论：“大凡天之所命尤物也，不妖其身，必妖于人。使崔氏子遇合富贵，乘宠娇，不为云为雨，则为蛟为螭，吾不知其变化矣。昔殷之辛，周之幽，据百万之国，其势甚厚。然而一女子败之，溃其众，屠其身，至今为天下戮笑。予之德不足以胜妖孽，是用忍情。”最可怕的是听众的反应，“于时坐者皆为深叹”，大家叹口气，居然没人指责张生的负心薄幸，或者有一点小小的同情给予莺莺。</p><p>对于美貌女子的恐惧，其实不过只是自身懦弱的借口罢了，男子严于律女子，宽于律己，实在是很无耻。《世说新语》里记载着石崇宴客让美人劝酒，如客人不饮，便杀掉劝酒的美人。有一次丞相王导和大将军王敦去赴宴，王导不善饮酒，也只好勉强自己喝，以至于喝醉了；而王敦死活不肯给面子，就是不喝，“已斩三人，颜色如故，尚不肯饮”。而此事，却被刘义庆归为“汰侈”，意思是奢侈浪费。在这里我们看到的是人正常情感的缺位，对于爱情和女性的残忍，却成了男子气度的象征。记得唐代曾有一个很出名的事件：军官冯燕，和同事张婴的漂亮老婆私通，张婴酗酒而归，冯燕逃避不及，只好藏到床底，却发觉自己的头巾还留在枕边，幸好张婴喝醉了并没发觉。于是冯燕指指头巾示意张妻把头巾取来免得事情败露，可是张妻会错了意，竟把枕边张婴的佩刀递给了他。冯燕看了张妻几眼，觉得这个女人太狠毒，就一刀砍下了张妻的头，然后戴上头巾走了。张婴于是就被认为杀害自己的妻子，被判死刑；结果在刑场上，冯燕出现了，他宣称张婴是无辜的，张妻是自己杀的。军政长官贾耽将此案据实上奏，并表示，宁愿免去自己的官职，也要为冯燕赎罪。最后皇帝的敕令是，将滑地的全部死刑犯同时赦免。这件案子影响很大，以至于那个时代的流行小说家沈下贤专门为之创作了传奇《冯燕传》；著名诗人司空图则写了长篇叙事诗《冯燕歌》，其中有一句诗写道“已为不平能割爱”，也就是说为了所谓的道德规范，能割舍爱情的才是大英雄。于是世情普遍鄙薄男欢女爱，积极培养冷血寡情的人，于是婚姻便成利益的交换，所谓的爱情只能沦落到勾栏瓦舍里去了。对比西方，希罗多德《历史》曾讲过吕底亚王坎道列斯的故事。坎道列斯认为自己的妻子是世上最美丽的女子，于是他想拿来炫耀了，他强迫他的亲信巨吉斯看王后的身体，以便确认这一点；不得已，巨吉斯只好藏在卧室，看了王后的身体。王后知道此事后，认为是奇耻大辱，就将巨吉斯召来，给他两个选择：要么他杀掉国王，“变成我的丈夫并取得吕底亚的王位”；要么被处死。结果巨吉斯选择了前者，他杀死了国王，并娶了王后，登上了吕底亚的王位。我们从中可以看到东西方文明对待情欲的差别。遗风留至如今，家里关心你的结婚对象，不是双方有多么相爱，感情有多深厚，而是这个人家里怎样，是不是老实，有没有本事赚钱升官；假如你斗胆和他们说起你们的爱情，于是大家都开始哄堂大笑或者不屑一顾，仿佛看你就是一个不成熟的孩子、精神错乱的病人。对于爱情的信仰，或许只存在于看戏的那段辰光。</p><p>有了这样一种社会心理氛围，再加上有太子少保韦夏卿的赏识，那么元稹抛弃寒门女子莺莺而迎娶豪门韦家的千金韦丛，也就顺理成章了。但吊诡的是在蒋防写的《霍小玉传》里，元稹的老丈人韦夏卿却对负心薄行的朋友李益这般说：“风光甚丽，草木荣华。伤哉郑卿，衔冤空室！足下终能弃置，实是忍人。丈夫之心，不宜如此。足下宜为思之！”蒋防此人在仕途上得到过元稹的推荐，所以他写及元稹的岳父时总要润色拔高一下，只是他的恩公看到这番话时是否会心头一颤？</p><p>或许是虬髯客已没，不会再有人“衔之十年”也要去取“天下负心者”的头颅心肝下酒，所以男人也就越发理直气壮地负心薄幸。负心人元稹没有得到什么报应，又过了一年多后，也就是贞元十九年他登拔萃科，署秘书省校书郎，娶了韦夏卿之女韦丛为妻，并在那一年与同中书判拔萃科的白居易相识订交，从此元白之名满天下。元稹在《梦游春七十韵》中写道：“当年二纪初，嘉节三星度……韦门正全盛，出入多欢裕。”在元稹志得意满，欢娱畅快之时，莺莺也匆匆嫁于他人了。后来元稹偶然路过莺莺居住的地方，以莺莺表兄的身份求见，终不得一见。莺莺的不复相见，是对情人的深深失望，或许她会深深的认同鱼玄机说的“易求无价宝，难得有情郎”；她没有霍小玉那般刚烈，她也许也会哀怜自己“我为女子，薄命如斯，是丈夫负心若此”，但她却说不出“我死之後，必为厉鬼，使君妻妾，终日不安”的话。莺莺只写了首诗给元稹，硬着骨头咬着牙说“弃置今何道，当时且自亲”，既然都已经分开了不爱我了又有什么好说的呢，当时恩爱缠绵也就足够了，让他“还将旧时意，怜取眼前人”，因为懂得，所以慈悲。当爱情归于寂寥，繁华消于落寞，一切都只存在与记忆里，曾经的美好，只能活在心底。“惆怅旧欢如梦，觉来无处追寻”。或许她也明白，往事只能追忆，不可重温。曾经年少单纯的莺莺已经死了，只留下一具逐渐衰老的躯壳和悲伤的灵魂继续苟活。现实那样丑恶，我们却不得不活下去。</p><p>我真的怀疑元稹所谓的“曾经沧海难为水，除却巫山不是云”到底指哪一位，是莺莺，还是韦丛，抑或是薛涛？元和四年，韦丛去世，元稹写了三十三篇诗来悼念她，其中最有名的一句：“惟将终夜长开眼，报答平生未展眉。”根据陈寅恪先生的考证，这个“长开眼”不仅仅是睡不着的意思，“所谓‘常开眼’者，自比鳏鱼（有“鳏鱼眼长开”这一说法），即自誓终鳏之义”（陈寅恪《元白诗笺证稿》），元稹信誓旦旦的要为韦丛终生不娶，鳏孤到死了。但事实证明，元稹是个文过饰非的人，在韦丛凑趣去世的那年，他邂逅薛涛，两人相恋了一年后将之抛弃，可怜薛涛为之终身不嫁，“只欲栏边安枕席，夜深闲共说相思”；两年后纳妾安氏，又过数年续弦裴淑。简直是“取次花丛频回顾”啊！所以观陈寅恪先生对其评价“自私自利。综其一生行迹，巧宦固不待言，而巧婚尤为可恶也。岂其多情哉？实多诈而已矣”并不为过。</p><p>读《元长庆集》，常免不了痛恨为什么如此深情优美的诗句却出自一个那么薄情负心的伧夫之手。雪莱在《致云雀》中说：“我们最甜美的歌，就是那些倾吐最哀伤的思想的。”不知道元稹所哀伤的到底是什么。贝克尔在《抗拒死亡》中说的：“所有动人心弦的事中，对死的恐惧是首当其冲的。”他的悼亡诗写的那么情深意切，大概是出于对死亡本身的恐惧和悲哀吧。</p><p>或许不该过分指责元稹，他也不过是为了功名奔波的庸人，这个世界原本就是为庸人所设的。太过恩爱的情侣总是不容于世：苏东坡与王弗已是“十年生死两茫茫”了；陆游和唐婉儿只能“一怀愁绪，几年离索”；刘克庄在哀叹“旧日风烟草树，而今总断人肠”；冒辟疆和董小宛“一生清福,九年占尽,九年折尽矣”；还有纳兰性德，感慨着“被酒莫惊春睡重，睹书消得泼茶香，当时只道是寻常”。但是起码他们是能真心相爱的，就算不能“执子之手，与子偕老”，起码也是“骨化形销而丹诚不泯”，却可怜了单纯的莺莺，一个人用余生去背负全部的思念、悔恨和指摘。</p><p>史籍上再没有关于莺莺以后生活的记载，或许她一生坎坷，慢慢地消磨了纯真善良，成了世间常见的庸俗势利的妇人。但哪怕是这样，我依然相信在她心底的最幽深隐蔽的角落、最柔嫩脆弱的地方，记忆会像一把锯齿慢慢地来回剧着那根最纤细的神经，午夜梦回的时候，依然会为贞元十六年的那个男子泪流满面。</p><p>我怕我鄙薄的文字无法完美地译出那女子悲伤的文字，且让我们再细细读一读那信的原文,体会一下她的心情吧：</p><p>捧览来问，抚爱过深。儿女之情，悲喜交集。兼惠花胜一合、口脂五寸，致耀首膏唇之饰。虽荷殊恩，谁复为容？睹物增怀，但积悲叹耳。伏承使于京中就业，进修之道，固在便安。但恨僻陋之人，永以遐弃。命也如此，知复何言！自去秋已来，常忽忽如有所失。于喧哗之下，或勉为语笑，闲宵自处，无不泪零。乃至梦寐之间，亦多感咽离忧之思。绸缪缱绻，暂若寻常，幽会未终，惊魂已断。虽半衾如暖，而思之甚遥。一昨拜辞，倏逾旧岁。长安行乐之地，触绪牵情。何幸不忘幽微，眷念无斁，鄙薄之志，无以奉酬。至于终始之盟，则固不忒。鄙昔中表相因，或同宴处。婢仆见诱，遂致私诚。儿女之心，不能自固。君子有援琴之挑，鄙人无投梭之拒。及荐寝席，义盛意深。愚陋之情，永谓终托。岂期既见君子，而不能定情，致有自献之羞，不复明侍巾帻。没身永恨，含叹何言！倘仁人用心，俯遂幽眇，虽死之日，犹生之年。如或达士略情，舍小从大，以先配为丑行，以要盟为可欺，则当骨化形销，丹诚不泯，因风委露，犹托清尘。存没之诚，言尽于此。临纸呜咽，情不能申。千万珍重，珍重千万！玉环一枚，是儿婴年所弄，寄充君子下体所佩。玉取其坚润不渝，环取其终始不绝。兼乱丝一绚、文竹茶碾子一枚。此数物不足见珍，意者欲君子如玉之真，弊志如环不解。泪痕在竹，愁绪萦丝，因物达情，永以为好耳。心迩身遐，拜会无期。幽愤所钟，千里神合。千万珍重！春风多厉，强饭为嘉。慎言自保，无以鄙为深念。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;《西厢记》的书评:【琉璃易碎，人言易坠——关于《莺莺传》的叙事】转载&lt;br&gt;…全文:&lt;a href=&quot;https://www.douban.com/doubanapp/dispatch?uri=/review/1200691/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;(豆瓣link)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;“半欲天明半未明，醉闻花气睡闻莺。 狌儿撼起钟声动，二十年来晓寺情。 ”男人四十的元微之写着酸酸的诗，回忆年少风流。假如我是元微之，我一定会这般写道：天空尚未亮透，微微透着点光，远处传来钟声，让我的思绪一下子回忆到二十年前，也是这样的一个早晨，在那所古寺的西厢，那个散发着鲜花一样香气的女子，用鸟儿般宛转的声音在我耳边低语：“钟声响了，想来我也该回去了。”那声音一直萦绕在耳边，十年、二十年、也许一辈子在我在记忆深处响起……。&lt;/p&gt;
    
    </summary>
    
      <category term="读书笔记" scheme="https://talengu.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="故事" scheme="https://talengu.github.io/tags/%E6%95%85%E4%BA%8B/"/>
    
      <category term="《莺莺传》" scheme="https://talengu.github.io/tags/%E3%80%8A%E8%8E%BA%E8%8E%BA%E4%BC%A0%E3%80%8B/"/>
    
  </entry>
  
  <entry>
    <title>个人主页搭建</title>
    <link href="https://talengu.github.io/2016/12/22/build_blog/"/>
    <id>https://talengu.github.io/2016/12/22/build_blog/</id>
    <published>2016-12-22T04:39:04.000Z</published>
    <updated>2018-11-21T18:17:02.463Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>概要：<br>博客搭建的记录与分享，主要用了Hexo，NexT主题和Gitment评论系统。<br>这里记录了我从头到尾的安装流程，和使用过程中的改进。<br>如果想方便使用的话，后面会给个独立的hexo theme，放到github 项目上。</p></blockquote><blockquote><p>使用新版本的NexT v6 主题即可，有些功能如gitment已经实现。对于图片的使用可能会出现问题。仅需看看我下面的2.2小节。怕麻烦的同学，下面内容就不用看了，现在的v6支持的很好。2018.10</p><p>我现在还是使用的是<code>version: 5.1.0</code>。</p></blockquote><p>小技巧，在文章中使用<code>&lt;!-- more --&gt;</code>手动进行截断，Hexo 提供的方式。<br>下面就是用这个截断的～～<br><a id="more"></a></p><p>在开始看安装的时候，发现怎么涉及这么多东西，大家不要担心。也不用在意会不会nodejs，这些东西，人家已经帮我们把东西都写好了，我们做的就是改改配置文件，最多改改里面swig的模版的一些代码。望大家见谅的是，我对js不熟，有些地方不是很清楚。欢迎大家在下面评论，或者在github上开issue，共同讨论。</p><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><h3 id="1-1-简易安装使用"><a href="#1-1-简易安装使用" class="headerlink" title="1.1 简易安装使用"></a>1.1 简易安装使用</h3><p>使用新版本的NexT v6 主题即可，有些功能如gitment已经实现。对于图片的使用可能会出现问题。仅需看看我下面的2.2小节。我使用的是<code>version: 5.1.0</code>。</p><h3 id="1-2-从头安装"><a href="#1-2-从头安装" class="headerlink" title="1.2 从头安装"></a>1.2 从头安装</h3><ul><li>安装 nodejs，从nodejs 官网下载安装包 <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">download page</a></li><li>安装git客户端 <a href="https://git-scm.com/" target="_blank" rel="noopener">git</a></li><li>安装Hexo <code>npm install -g hexo-cli</code><br>  <a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">hexo 中文安装文档</a><br>  <a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo中文网站</a></li><li>安装NexT ，NexT是一个比较火的主题。<br>  按官网教程NexT安装即可，官网安装和配置教程比较美滋滋。<br>  <a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">http://theme-next.iissnan.com/getting-started.html</a><br>  NexT Github  <a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next</a><br>  另外，NexT开发者的博客（最近Next 变成组织了，祝贺）<a href="http://notes.iissnan.com" target="_blank" rel="noopener">http://notes.iissnan.com</a></li></ul><blockquote><p><strong>Ubuntu安装记录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for Ubuntu16.04</span></span><br><span class="line">$ sudo apt install npm nodejs-legacy</span><br><span class="line">$ sudo npm install hexo-cli -g</span><br><span class="line">$ hexo init blog</span><br><span class="line">$ <span class="built_in">cd</span> blog</span><br><span class="line">$ npm install</span><br><span class="line">$ hexo server</span><br></pre></td></tr></table></figure></p></blockquote><p>ok，安装完的目录结构。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── node_modules  <span class="comment"># nodejs的目录</span></span><br><span class="line">├── public        <span class="comment"># 输出网站目录</span></span><br><span class="line">├── scaffolds     <span class="comment"># hexo 的一些预设模版</span></span><br><span class="line">├── <span class="built_in">source</span>        <span class="comment"># 独立submodule</span></span><br><span class="line">├── themes        <span class="comment"># 主题 里面也有主题的配置文件不要与项目的配置文件搞混</span></span><br><span class="line">├── README.md</span><br><span class="line">├── _config.yml   <span class="comment"># 整个项目配置文件</span></span><br><span class="line">├── db.json</span><br><span class="line">├── index.html。  <span class="comment"># 用于跳转到public下</span></span><br><span class="line">└── package.json</span><br><span class="line"></span><br><span class="line">5 directories, 5 files</span><br></pre></td></tr></table></figure></p><p>我对博客项目的安排是这样的，总共有两个github项目，一个放素材，一个用hexo框架生成html文件。<br>在上面的文件目录只能够，将source 文件夹作为一个submodule 用 <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules" target="_blank" rel="noopener">git submodule</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对于我来说</span></span><br><span class="line">$ <span class="built_in">cd</span> path/to/your/github.io/project</span><br><span class="line">$ git submodule add https://github.com/talengu/blog_source <span class="built_in">source</span></span><br></pre></td></tr></table></figure></p><p>在生成html，下面操作都在 <code>path/to/your/github.io/project</code>，hexo找不到node_modules<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clone 项目</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/talengu/talengu.github.io</span><br><span class="line">$ git submodule init</span><br><span class="line">$ git submodule update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到最新的submodule</span></span><br><span class="line">$ <span class="built_in">cd</span> <span class="built_in">source</span></span><br><span class="line">$ git merge origin/master</span><br><span class="line">$ git submodule update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行npm按照，由于已经生成它会按照package.json文件自动安装</span></span><br><span class="line"><span class="comment"># 没有npm的话 安装 https://nodejs.org/en/download/</span></span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure></p><h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><p>对于在NexT主页上介绍的配置我就不写了，请参考<a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">http://theme-next.iissnan.com/getting-started.html</a>  。</p><p><img src="/public/2016/12/22/build_blog/image-20181112002650646.png" alt="image-20181112002650646"></p><p>下面主要对重要的和我自己修改的部分说明没有的进行配置，值得注意的是我的NexT版本是<code>version: 5.1.0</code>。</p><h3 id="2-1-NexT官网的设置"><a href="#2-1-NexT官网的设置" class="headerlink" title="2.1 NexT官网的设置"></a>2.1 NexT官网的设置</h3><p><strong>MathJax</strong></p><p>编辑 <code>主题配置文件</code>， 将 <code>mathjax</code> 下的 <code>enable</code> 设定为 <code>true</code> 即可。 <code>cdn</code> 用于指定 MathJax 的脚本地址，默认是 MathJax 官方提供的 CDN 地址。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MathJax Support</span></span><br><span class="line"><span class="attr">mathjax:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  cdn:</span> <span class="string">//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</span></span><br></pre></td></tr></table></figure><p>下面测试<br><code>$\frac{d}{dx}c^n=nx^{n-1}$</code> $\frac{d}{dx}c^n=nx^{n-1}$</p><p><strong>Local Search</strong> (推荐)<br>本地内容搜索引擎。</p><ul><li><p>安装 hexo-generator-searchdb，在站点的根目录下执行以下命令：</p><p><code>npm install hexo-generator-searchdb --save</code></p></li><li><p>编辑 站点配置文件，新增以下内容到任意位置：</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line"><span class="attr">   path:</span> <span class="string">search.xml</span></span><br><span class="line"><span class="attr">   field:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">   format:</span> <span class="string">html</span></span><br><span class="line"><span class="attr">   limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure></li><li><p>编辑 <code>主题配置文件</code>，启用本地搜索功能：</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-markdown图片"><a href="#2-2-markdown图片" class="headerlink" title="2.2 markdown图片"></a>2.2 markdown图片</h3><p>网上的图片链接可以直接使用，下面对本地图片使用进行配置。</p><p><strong>使用</strong></p><p>安装插件<code>npm install https://github.com/CodeFalling/hexo-asset-image --save</code></p><p>在 <code>主题配置文件</code>（不是next的_config.yml）中设置<code>permalink: :year/:month/:day/:title/</code>，设置 <code>post_asset_folder: true</code>，这主要将文件拷贝到/public文件夹。其中permalink很关键，只能这样设置。</p><blockquote><p>图片必须放到和md文件名字一样的同名字文件夹。<br>如使用Typora软件写md的话，设置一下image保存路径即可，如下。</p><p><img src="/public/2016/12/22/build_blog/typora_image.png" alt="typora_image"></p></blockquote><h3 id="2-3-代码复制"><a href="#2-3-代码复制" class="headerlink" title="2.3 代码复制"></a>2.3 代码复制</h3><p>为了提高博客代码块的用户体验，仅仅代码高亮还不行，最好还能一键复制代码。故此文将讲述 Hexo NexT 主题博客的代码块复制功能配置。转(Hexo NexT 代码块复制功能)[<a href="https://www.jianshu.com/p/3e9d614c1e77]" target="_blank" rel="noopener">https://www.jianshu.com/p/3e9d614c1e77]</a></p><h4 id="2-3-1-下载-clipboard-js"><a href="#2-3-1-下载-clipboard-js" class="headerlink" title="2.3.1 下载 clipboard.js"></a>2.3.1 下载 clipboard.js</h4><p>三方插件 clipboardjs ，相关介绍和兼容性<a href="https://clipboardjs.com/" target="_blank" rel="noopener">它主页</a>或 <a href="https://github.com/zenorocha/clipboard.js" target="_blank" rel="noopener">github</a> 上看。</p><p><strong>下载地址：</strong></p><ul><li><a href="https://raw.githubusercontent.com/zenorocha/clipboard.js/master/dist/clipboard.js" target="_blank" rel="noopener">clipboard.js</a></li><li><a href="https://raw.githubusercontent.com/zenorocha/clipboard.js/master/dist/clipboard.min.js" target="_blank" rel="noopener">clipboard.min.js</a> <strong>推荐</strong></li></ul><p>保存文件<code>clipboard.js / clipboard.min.js</code> ，目录如下：<br><code>.\themes\next\source\js\src</code></p><h4 id="2-3-2-clipboardjs-使用"><a href="#2-3-2-clipboardjs-使用" class="headerlink" title="2.3.2 clipboardjs 使用"></a>2.3.2 clipboardjs 使用</h4><p>也是在<code>.\themes\next\source\js\src</code>目录下，创建<code>clipboard-use.js</code>，文件内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*页面载入完成后，创建复制按钮*/</span></span><br><span class="line">!<span class="function"><span class="keyword">function</span> (<span class="params">e, t, a</span>) </span>&#123; </span><br><span class="line">  <span class="comment">/* code */</span></span><br><span class="line">  <span class="keyword">var</span> initCopyCode = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> copyHtml = <span class="string">''</span>;</span><br><span class="line">    copyHtml += <span class="string">'&lt;button class="btn-copy" data-clipboard-snippet=""&gt;'</span>;</span><br><span class="line">    copyHtml += <span class="string">'  &lt;i class="fa fa-globe"&gt;&lt;/i&gt;&lt;span&gt;copy&lt;/span&gt;'</span>;</span><br><span class="line">    copyHtml += <span class="string">'&lt;/button&gt;'</span>;</span><br><span class="line">    $(<span class="string">".highlight .code pre"</span>).before(copyHtml);</span><br><span class="line">    <span class="keyword">new</span> ClipboardJS(<span class="string">'.btn-copy'</span>, &#123;</span><br><span class="line">        target: <span class="function"><span class="keyword">function</span>(<span class="params">trigger</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> trigger.nextElementSibling;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  initCopyCode();</span><br><span class="line">&#125;(<span class="built_in">window</span>, <span class="built_in">document</span>);</span><br></pre></td></tr></table></figure><p>在<code>.\themes\next\source\css\_custom\custom.styl</code>样式文件中添加下面代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//代码块复制按钮</span><br><span class="line"><span class="selector-class">.highlight</span>&#123;</span><br><span class="line">  //方便copy代码按钮（btn-copy）的定位</span><br><span class="line">  <span class="selector-tag">position</span>: <span class="selector-tag">relative</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-copy</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(#fcfcfc,#eee);</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d5d5d5</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">-webkit-user-select</span>: none;</span><br><span class="line">    <span class="attribute">-moz-user-select</span>: none;</span><br><span class="line">    <span class="attribute">-ms-user-select</span>: none;</span><br><span class="line">    <span class="attribute">user-select</span>: none;</span><br><span class="line">    <span class="attribute">-webkit-appearance</span>: none;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">-webkit-transition</span>: opacity .<span class="number">3s</span> ease-in-out;</span><br><span class="line">    <span class="attribute">-o-transition</span>: opacity .<span class="number">3s</span> ease-in-out;</span><br><span class="line">    <span class="attribute">transition</span>: opacity .<span class="number">3s</span> ease-in-out;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-copy</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.highlight</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.btn-copy</span>&#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-3-引用"><a href="#2-3-3-引用" class="headerlink" title="2.3.3 引用"></a>2.3.3 引用</h4><p>在<code>.\themes\next\layout\_layout.swig</code>文件中，添加引用（注：在 swig 末尾或 body 结束标签（<code>&lt;/body&gt;</code>）之前添加）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 代码块复制功能 --&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/js/src/clipboard.min.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/js/src/clipboard-use.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>想看效果的可以去<a href="https://talengu.github.io/public/2016/12/22/build_blog/">我博客</a>看，截图如下:</p><p><img src="/public/2016/12/22/build_blog/image-20181112004401227.png" alt="image-20181112004401227"></p><blockquote><p>熟悉的也可以将<code>clipboard.min.js</code>和<code>clipboard-use.js</code>合并为一个文件，再在<code>.\themes\next\layout\_layout.swig</code>文件中使用。当然<code>clipboard.min.js</code>也可以直接用三方 cdn 的方式引入也行。</p></blockquote><h3 id="2-4-Gitment-评论功能"><a href="#2-4-Gitment-评论功能" class="headerlink" title="2.4 Gitment 评论功能"></a>2.4 Gitment 评论功能</h3><p> 集成 giment 评论系统的过程。gitment 把评论放到 github 的 issues 系统里，评论支持 md，比较适合程序员.<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装gitment</span><br><span class="line">$ npm install gitment --save</span><br></pre></td></tr></table></figure></p><h4 id="2-4-1-注册-OAuth-Application"><a href="#2-4-1-注册-OAuth-Application" class="headerlink" title="2.4.1 注册 OAuth Application"></a>2.4.1 注册 OAuth Application</h4><p>点击 <a href="https://github.com/settings/applications/new" target="_blank" rel="noopener">https://github.com/settings/applications/new</a> 注册，注意<code>Authorization callback URL</code>填自己的网站 url <code>https://xxxx.github.io/</code>. 记下 <strong>Client ID</strong> 和 <strong>Client Secret</strong>.</p><blockquote><p>在新版本NexT v6里面已经支持gitment了所以你只要在github上注册一下 OAuth Application ，填上<strong>Client ID</strong> 和 <strong>Client Secret</strong>.即可</p></blockquote><p>####2.4.2 修改<code>themes/next/_config.yml</code></p><p>在其中添加:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Gitment</span><br><span class="line"># Introduction: https://imsun.net/posts/gitment-introduction/</span><br><span class="line">gitment:</span><br><span class="line">  enable: true</span><br><span class="line">  githubID: yourid</span><br><span class="line">  repo: yourrepo</span><br><span class="line">  ClientID: yourid</span><br><span class="line">  ClientSecret: yoursecret</span><br><span class="line">  lazy: true</span><br></pre></td></tr></table></figure><p><strong>注意: 格式要正确，该空格的一定要空格。所有的 yourXXX 都换成自己的.</strong></p><p>在主题的<code>en.yml</code>增加:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitmentbutton: Show comments from Gitment</span><br></pre></td></tr></table></figure><p><code>zh-Hans.yml</code>增加:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitmentbutton: 显示 Gitment 评论</span><br></pre></td></tr></table></figure><h4 id="2-4-3-修改主题layout-partials-comments-swig"><a href="#2-4-3-修改主题layout-partials-comments-swig" class="headerlink" title="2.4.3 修改主题layout/_partials/comments.swig"></a>2.4.3 修改主题<code>layout/_partials/comments.swig</code></h4><p>找到这个文件里的这两行:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% elseif theme.valine.appid and theme.valine.appkey %&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"vcomments"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面是最后一个<code>elseif</code>分支，在下面加一个<code>elseif</code>分支:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% elseif theme.gitment.enable %&#125;</span><br><span class="line">   &#123;% if theme.gitment.lazy %&#125;</span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">"ShowGitment()"</span> <span class="attr">id</span>=<span class="string">"gitment-display-button"</span>&gt;</span>&#123;&#123;  __('gitmentbutton') &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"gitment-container"</span> <span class="attr">style</span>=<span class="string">"display:none"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   &#123;% else %&#125;</span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"gitment-container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   &#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>加完之后下面的内容是原来的，保持不变:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-4-增加gitment-swig"><a href="#2-4-4-增加gitment-swig" class="headerlink" title="2.4.4 增加gitment.swig"></a>2.4.4 增加<code>gitment.swig</code></h4><p>在主题下<code>layout/_third-party/comments/</code>目录下中添加文件<code>gitment.swig</code>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.gitment.enable %&#125;</span><br><span class="line">   &#123;% set owner = theme.gitment.githubID %&#125;</span><br><span class="line">   &#123;% set repo = theme.gitment.repo %&#125;</span><br><span class="line">   &#123;% set cid = theme.gitment.ClientID %&#125;</span><br><span class="line">   &#123;% set cs = theme.gitment.ClientSecret %&#125;</span><br><span class="line">   <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://imsun.github.io/gitment/style/default.css"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://imsun.github.io/gitment/dist/gitment.browser.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   &#123;% if not theme.gitment.lazy %&#125;</span><br><span class="line">       <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">           <span class="keyword">var</span> gitment = <span class="keyword">new</span> Gitment(&#123;</span></span><br><span class="line"><span class="javascript">               id: <span class="built_in">window</span>.location.pathname, </span></span><br><span class="line"><span class="javascript">               owner: <span class="string">'&#123;&#123;owner&#125;&#125;'</span>,</span></span><br><span class="line"><span class="javascript">               repo: <span class="string">'&#123;&#123;repo&#125;&#125;'</span>,</span></span><br><span class="line"><span class="undefined">               oauth: &#123;</span></span><br><span class="line"><span class="javascript">                   client_id: <span class="string">'&#123;&#123;cid&#125;&#125;'</span>,</span></span><br><span class="line"><span class="javascript">                   client_secret: <span class="string">'&#123;&#123;cs&#125;&#125;'</span>,</span></span><br><span class="line"><span class="undefined">               &#125;&#125;);</span></span><br><span class="line"><span class="javascript">           gitment.render(<span class="string">'gitment-container'</span>);</span></span><br><span class="line"><span class="undefined">       </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   &#123;% else %&#125;</span><br><span class="line">       <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">           <span class="function"><span class="keyword">function</span> <span class="title">ShowGitment</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">               <span class="built_in">document</span>.getElementById(<span class="string">"gitment-display-button"</span>).style.display = <span class="string">"none"</span>;</span></span><br><span class="line"><span class="javascript">               <span class="built_in">document</span>.getElementById(<span class="string">"gitment-container"</span>).style.display = <span class="string">"block"</span>;</span></span><br><span class="line"><span class="javascript">               <span class="keyword">var</span> gitment = <span class="keyword">new</span> Gitment(&#123;</span></span><br><span class="line"><span class="javascript">                   id: <span class="built_in">document</span>.location.href, </span></span><br><span class="line"><span class="javascript">                   owner: <span class="string">'&#123;&#123;owner&#125;&#125;'</span>,</span></span><br><span class="line"><span class="javascript">                   repo: <span class="string">'&#123;&#123;repo&#125;&#125;'</span>,</span></span><br><span class="line"><span class="undefined">                   oauth: &#123;</span></span><br><span class="line"><span class="javascript">                       client_id: <span class="string">'&#123;&#123;cid&#125;&#125;'</span>,</span></span><br><span class="line"><span class="javascript">                       client_secret: <span class="string">'&#123;&#123;cs&#125;&#125;'</span>,</span></span><br><span class="line"><span class="undefined">                   &#125;&#125;);</span></span><br><span class="line"><span class="javascript">               gitment.render(<span class="string">'gitment-container'</span>);</span></span><br><span class="line"><span class="undefined">           &#125;</span></span><br><span class="line"><span class="undefined">       </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   &#123;% endif %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>然后在主题下<code>layout/_third-party/comments/index.swig</code>文件中引入 gitment.swig 文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &apos;gitment.swig&apos; %&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-5-添加gitment-styl"><a href="#2-4-5-添加gitment-styl" class="headerlink" title="2.4.5 添加gitment.styl"></a>2.4.5 添加<code>gitment.styl</code></h4><p>在主题下<code>source/css/_common/components/third-party/</code>目录下添加<code>gitment.styl</code>文件，设置 button 的样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#gitment-display-button</span>&#123;</span><br><span class="line">     <span class="attribute">display</span>: inline-block;</span><br><span class="line">     <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line">     <span class="attribute">color</span>: <span class="number">#0a9caf</span>;</span><br><span class="line">     <span class="attribute">cursor</span>: pointer;</span><br><span class="line">     <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">     <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#0a9caf</span>;</span><br><span class="line">     <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="selector-id">#gitment-display-button</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">     <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">     <span class="attribute">background</span>: <span class="number">#0a9caf</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>然后在主题下<code>source/css/_common/components/third-party/third-party.styl</code>文件中引入相应的 CSS 样式即可:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;gitment&quot;;</span><br></pre></td></tr></table></figure><p>这样就 ok 了！</p><h4 id="2-4-6-易错点"><a href="#2-4-6-易错点" class="headerlink" title="2.4.6 易错点"></a>2.4.6 易错点</h4><ol><li>修改<code>themes/next/_config.yml</code>这个文件时，格式要正确。另外，repo 是你要想创建 issues 的仓库，完全可以跟博文所放的仓库不一个。id 就写自己的 github 用户名就可以，这个用户名跟 repo 必须匹配。</li><li>gitment 可能不支持链接地址里有中文，所以安装 gitment 前一定要参考<a href="http://yangq.me/post/19acb239.html" target="_blank" rel="noopener">前文</a>把链接持久化搞成全是英文的。</li><li>同一篇文章需要<a href="https://github.com/imsun/gitment/issues/68" target="_blank" rel="noopener">初始化 comment 两次的问题</a>，是因为 <a href="http://xxx.com/post/ab9bb85a.html" target="_blank" rel="noopener">http://xxx.com/post/ab9bb85a.html</a> 和点击<strong>阅读全文</strong>进去的链接 <a href="http://yangq.me/post/ab9bb85a.html#more" target="_blank" rel="noopener">http://xxx.com/post/ab9bb85a.html#more</a> 对 issues 来说是不同的，所以创建两次。解决方法就是<code>gitment.swig</code>里 id 弄成<code>window.location.pathname</code>而不是<code>document.location.href</code>。</li><li>初始化评论后，可以到 github 里自己放 issues 的仓库查看 issues 是否创建成功，有时候浏览器可能会有缓存依然提示你初始化评论。一般过个两分钟就显示正常了。</li></ol><h4 id="2-4-7-参考文档"><a href="#2-4-7-参考文档" class="headerlink" title="2.4.7 参考文档"></a>2.4.7 参考文档</h4><ol><li><a href="http://www.jianshu.com/p/10134c474991" target="_blank" rel="noopener">主要参考文档</a></li><li><a href="https://meesong.github.io/StaticBlog/2017/NexT+Gitment/" target="_blank" rel="noopener">一种相对简略的配置方式</a></li><li><a href="https://github.com/imsun/gitment/issues" target="_blank" rel="noopener">作者 issue</a></li></ol><h3 id="2-5-copyright文字添加"><a href="#2-5-copyright文字添加" class="headerlink" title="2.5 copyright文字添加"></a>2.5 copyright文字添加</h3><p><strong>效果</strong> 可以在md文件里面控制是否使用这个组建。</p><p><img src="/public/2016/12/22/build_blog/copyright.png" alt="copyright" title="copyright 效果"></p><p><strong>使用</strong></p><p>在md文件中的front-head部分，设置 <code>copyright:true</code>如下面。<br>设置next/_config.yml 文件，中设置<code>post_copyright</code> 的选项 <code>enable</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 个人主页搭建</span><br><span class="line">date: 2016-12-22 12:39:04</span><br><span class="line">categories:</span><br><span class="line">  - 博客搭建</span><br><span class="line">tags:</span><br><span class="line">  - Hexo</span><br><span class="line">comments: true</span><br><span class="line">copyright: true</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p><strong>说明</strong> 对原next的改变</p><p>对于一些原创的文本可以设置版权的声明，这个是next自带的，我进行了修改。next的_config.yml 文件，中设置<code>post_copyright</code> 的选项，启用它会对所有的页面添加，我多加了一个page的copyright使能判断。<br>对<code>next/layout/_macro/post-copyright.swig</code>修改。下面为修改后的文件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.post_copyright.enable %&#125;</span><br><span class="line">&#123;% if page.copyright %&#125; <span class="comment">&lt;!-- 加上page md文件头部使能--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"post-copyright"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"post-copyright-author"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123; __('post.copyright.author') + __('symbol.colon') &#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">      &#123;&#123; config.author &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"post-copyright-link"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123; __('post.copyright.link') + __('symbol.colon') &#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- url的修正，可能要根据你的情况修改--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; config.url &#125;&#125;&#123;&#123; config.root &#125;&#125;&#123;&#123; post.path &#125;&#125;"</span> <span class="attr">title</span>=<span class="string">"&#123;&#123; post.title &#125;&#125;"</span>&gt;</span>&#123;&#123; config.url &#125;&#125;&#123;&#123; config.root &#125;&#125;&#123;&#123; post.path &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"post-copyright-license"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123; __('post.copyright.license_title') + __('symbol.colon') &#125;&#125; <span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">      &#123;&#123; __('post.copyright.license_content', theme.post_copyright.license_url, theme.post_copyright.license) &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-RSS-可选"><a href="#2-6-RSS-可选" class="headerlink" title="2.6 RSS (可选)"></a>2.6 RSS (可选)</h3><p>对一些网站的feed 的订阅 如rss，使用来进行订阅网站的rss，现在一些网站已经没有rss服务，google也停掉了google rss reader的项目，所以看你的喜好。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装hexo-generator-feed</span></span><br><span class="line">npm install hexo-generator-feed --save</span><br><span class="line"><span class="comment"># 在_config.yml 启用feed</span></span><br></pre></td></tr></table></figure><h3 id="2-7-添加-fork-me-github"><a href="#2-7-添加-fork-me-github" class="headerlink" title="2.7 添加 fork me github"></a>2.7 添加 fork me github</h3><p>效果</p><p><img src="/public/2016/12/22/build_blog/image-20181122020200453.png" alt="image-20181122020200453"></p><p>在<a href="https://github.com/blog/273-github-ribbons" target="_blank" rel="noopener">GitHub Ribbons</a>或<a href="http://tholman.com/github-corners/" target="_blank" rel="noopener">GitHub Corners</a>选择一款你喜欢的挂饰。比如下面的 github corners 在<code>your-url</code>填上你的 url 。</p><p><img src="/public/2016/12/22/build_blog/image-20181122020427248.png" alt="image-20181122020427248"></p><p>将刚刚复制的挂饰代码，添加到<code>themes/next/layout/_layout.swig</code>文件中，添加位置，放在<code>&lt;div class=&quot;headband&quot;&gt;&lt;/div&gt;</code>的下方如下图。</p><p><img src="/public/2016/12/22/build_blog/image-20181122021516212.png" alt="image-20181122021516212"></p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO:"></a>TODO:</h2><p>这个TODO中放的是，我接下来对博客搭建这个项目，要做的事。平台的debug，内容的设计等等。</p><ul><li><p>[ ] 续写这篇博客，后面根据内容多少看要不要拆分这个博客。</p></li><li><p>[ ] 永久化连接 permalink<br>​    这permalink 和本地图片的拷贝复制有关不好改，下面是可能的方法，由于现在的评论还比较少，后面改进。<br>​    <a href="https://github.com/rozbo/hexo-abbrlink" target="_blank" rel="noopener">https://github.com/rozbo/hexo-abbrlink</a><br>​    <a href="https://github.com/EqualMa/hexo-plugin-permalink-pathed-title" target="_blank" rel="noopener">https://github.com/EqualMa/hexo-plugin-permalink-pathed-title</a></p></li><li><p>[ ] gitment object ProgressEvent #170<br>​    gitment 出现问题 作者好像放弃了，所以网上有一些解决方案，(gitment issue #170)(<a href="https://github.com/imsun/gitment/issues/170" target="_blank" rel="noopener">https://github.com/imsun/gitment/issues/170</a>)</p><p>​    临时使用<code>https://www.wenjunjiang.win/js/gitment.js</code> 这个gitment.js</p></li><li><p>[ ] 编写规范 得写一个博客的编写规范。分类、标签的使用，图片的使用，公式的使用等等</p></li></ul><h2 id="博客编写规范"><a href="#博客编写规范" class="headerlink" title="博客编写规范"></a>博客编写规范</h2><ul><li>github上有项目图片就从项目中链接过来，比如头像就是我github的头像</li><li>重要的图片存在本项目中</li><li>Typora的使用</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.jianshu.com/p/9f0e90cc32c2" target="_blank" rel="noopener">Hexo-NexT配置超炫网页效果</a> 好多新奇玩意儿～</p><p><a href="https://blog.csdn.net/yanzi1225627/article/details/77890414" target="_blank" rel="noopener">Hexo gitment</a></p><p>原文地址 </p><p>图标网站<br><a href="https://icons8.com/icon/new-icons/all" target="_blank" rel="noopener">icon8 web</a> 比较舒服<br><a href="http://fontawesome.io" target="_blank" rel="noopener">http://fontawesome.io</a> 标准风格<br><a href="https://www.easyicon.net/" target="_blank" rel="noopener">https://www.easyicon.net/</a> 国内的图标</p><p>【正在补充修改内容中～】</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;概要：&lt;br&gt;博客搭建的记录与分享，主要用了Hexo，NexT主题和Gitment评论系统。&lt;br&gt;这里记录了我从头到尾的安装流程，和使用过程中的改进。&lt;br&gt;如果想方便使用的话，后面会给个独立的hexo theme，放到github 项目上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;使用新版本的NexT v6 主题即可，有些功能如gitment已经实现。对于图片的使用可能会出现问题。仅需看看我下面的2.2小节。怕麻烦的同学，下面内容就不用看了，现在的v6支持的很好。2018.10&lt;/p&gt;
&lt;p&gt;我现在还是使用的是&lt;code&gt;version: 5.1.0&lt;/code&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;小技巧，在文章中使用&lt;code&gt;&amp;lt;!-- more --&amp;gt;&lt;/code&gt;手动进行截断，Hexo 提供的方式。&lt;br&gt;下面就是用这个截断的～～&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="博客搭建" scheme="https://talengu.github.io/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="Hexo" scheme="https://talengu.github.io/tags/Hexo/"/>
    
      <category term="NexT" scheme="https://talengu.github.io/tags/NexT/"/>
    
  </entry>
  
  <entry>
    <title>srt中英文合并python脚本</title>
    <link href="https://talengu.github.io/2016/04/14/shells/youtube_src_combine/"/>
    <id>https://talengu.github.io/2016/04/14/shells/youtube_src_combine/</id>
    <published>2016-04-14T04:39:04.000Z</published>
    <updated>2018-11-07T14:45:58.588Z</updated>
    
    <content type="html"><![CDATA[<p>从 <a href="http://mo.dbxdb.com/Yang/setting.html" target="_blank" rel="noopener">Getting Youtube subtitles</a> 或者中英文字幕，然后将其合并，变成中英文双字幕。</p><a id="more"></a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">这个脚本完成了中英文srt合并的功能</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">srt2lis</span><span class="params">(name)</span>:</span></span><br><span class="line">    lines = open(<span class="string">'srt/'</span>+name, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>).readlines()</span><br><span class="line">    lis = []</span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> i, line <span class="keyword">in</span> enumerate(lines):</span><br><span class="line">        <span class="comment"># 以\n 结尾的一个时间点</span></span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">'\n'</span>:</span><br><span class="line">            lis.append(tmp)</span><br><span class="line">            tmp = []</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp.append(line)</span><br><span class="line">    <span class="keyword">return</span> lis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hebing</span><span class="params">(name_zh)</span>:</span></span><br><span class="line">    name_en = name_zh[:<span class="number">-7</span>] + <span class="string">'.srt'</span></span><br><span class="line">    out_name=<span class="string">'out/'</span>+name_en</span><br><span class="line">    f=open(out_name,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    lis_en=srt2lis(name_en)</span><br><span class="line">    lis_zh=srt2lis(name_zh)</span><br><span class="line">    <span class="keyword">for</span> i,item <span class="keyword">in</span> enumerate(lis_en):</span><br><span class="line">        print(item[<span class="number">0</span>])</span><br><span class="line">        f.write(item[<span class="number">0</span>])</span><br><span class="line">        f.write(item[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lis_zh[i][<span class="number">2</span>:]:</span><br><span class="line">            f.write(line)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> item[<span class="number">2</span>:]:</span><br><span class="line">            f.write(line)</span><br><span class="line">        f.write(<span class="string">'\n'</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flis=os.listdir(<span class="string">'srt/'</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">'out'</span>):</span><br><span class="line">    os.mkdir(<span class="string">'out'</span>)</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> flis:</span><br><span class="line">    print(name)</span><br><span class="line">    <span class="keyword">if</span> name[<span class="number">-6</span>:<span class="number">-4</span>]==<span class="string">'zh'</span>:</span><br><span class="line">        hebing(name)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;从 &lt;a href=&quot;http://mo.dbxdb.com/Yang/setting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Getting Youtube subtitles&lt;/a&gt; 或者中英文字幕，然后将其合并，变成中英文双字幕。&lt;/p&gt;
    
    </summary>
    
      <category term="常用脚本" scheme="https://talengu.github.io/categories/%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"/>
    
    
      <category term="python脚本" scheme="https://talengu.github.io/tags/python%E8%84%9A%E6%9C%AC/"/>
    
      <category term="YouTube字幕合并" scheme="https://talengu.github.io/tags/YouTube%E5%AD%97%E5%B9%95%E5%90%88%E5%B9%B6/"/>
    
      <category term="src" scheme="https://talengu.github.io/tags/src/"/>
    
  </entry>
  
  <entry>
    <title>DSP滤波程序</title>
    <link href="https://talengu.github.io/2015/06/14/dsp/dsp_filter/"/>
    <id>https://talengu.github.io/2015/06/14/dsp/dsp_filter/</id>
    <published>2015-06-14T04:39:04.000Z</published>
    <updated>2018-11-07T14:41:10.644Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>通过matlab对数字信号进行滤波器的设计后，我们要将设计好的参数放到嵌入式系统中进行滤波。<br>IIR滤波器<br>FIR滤波器</p></blockquote><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="comment">//z变换转成差分方程然后迭代</span></span><br><span class="line"><span class="comment">//Talen @UESTC 2015.6.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//打印数组</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">float</span> *x,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"><span class="comment">//取后第1-n个</span></span><br><span class="line"><span class="function"><span class="keyword">float</span>* <span class="title">aminusone</span><span class="params">(<span class="keyword">float</span>* a,<span class="keyword">int</span> ar)</span></span>;</span><br><span class="line"><span class="comment">//差分中间值</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">gtcet</span><span class="params">(<span class="keyword">float</span> *t,<span class="keyword">float</span> *x,<span class="keyword">int</span> xr,<span class="keyword">int</span> s,<span class="keyword">int</span> d)</span></span>;</span><br><span class="line"><span class="comment">//主要滤波函数</span></span><br><span class="line"><span class="function"><span class="keyword">float</span>* <span class="title">gfilter</span><span class="params">(<span class="keyword">float</span> *b,<span class="keyword">int</span> br,<span class="keyword">float</span> *a,<span class="keyword">int</span> ar,<span class="keyword">float</span> *x,<span class="keyword">int</span> xr)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">float</span> *x,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;<span class="built_in">printf</span>(<span class="string">"%9.3f "</span>,x[i]);</span><br><span class="line">    <span class="keyword">if</span>((i%<span class="number">7</span>)==<span class="number">6</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);&#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span>* <span class="title">aminusone</span><span class="params">(<span class="keyword">float</span>* a,<span class="keyword">int</span> ar)</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span>* am = (<span class="keyword">float</span> *)<span class="built_in">malloc</span>((ar<span class="number">-1</span>) * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ar<span class="number">-1</span>;i++)</span><br><span class="line">        am[i]=a[i+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> am;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">gtcet</span><span class="params">(<span class="keyword">float</span> *t,<span class="keyword">float</span> *x,<span class="keyword">int</span> xr,<span class="keyword">int</span> s,<span class="keyword">int</span> d)</span></span></span><br><span class="line"><span class="function">    <span class="comment">//x[]数据源 r数据源长度 s开始点(0开始) d数据长度</span></span></span><br><span class="line"><span class="function">    <span class="comment">//t可以是a[] b[] 长度与d一样</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span>* w = (<span class="keyword">float</span> *)<span class="built_in">malloc</span>(d * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;d;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> temp=s-i;</span><br><span class="line">        <span class="keyword">if</span>(temp&gt;=<span class="number">0</span>&amp;&amp;temp&lt;xr)</span><br><span class="line">            w[i]=x[temp];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            w[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//核心语句</span></span><br><span class="line">        sum=sum+w[i]*t[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">float</span>* <span class="title">gfilter</span><span class="params">(<span class="keyword">float</span> *b,<span class="keyword">int</span> br,<span class="keyword">float</span> *a,<span class="keyword">int</span> ar,<span class="keyword">float</span> *x,<span class="keyword">int</span> xr)</span></span></span><br><span class="line"><span class="function">    <span class="comment">//b a x br b的长度 ar a的长度 xr数据长度</span></span></span><br><span class="line"><span class="function">    <span class="comment">//use本程序定义的gtcet()和aminusone()</span></span></span><br><span class="line"><span class="function">    <span class="comment">//输入数据，b，a，x得出滤波后的y</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span>* y = (<span class="keyword">float</span> *)<span class="built_in">malloc</span>(xr* <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ti=<span class="number">0</span>;ti&lt;xr;ti++)</span><br><span class="line">        y[ti]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;xr;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//最核心语句，此处迭代</span></span><br><span class="line">        y[i]=gtcet(b,x,xr,i,br)-gtcet(aminusone(a,ar),y,xr,i<span class="number">-1</span>,ar<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//input 源数据 可修改</span></span><br><span class="line">    <span class="comment">////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">float</span> x[<span class="number">120</span>]=&#123;<span class="number">-4</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">-4</span>, <span class="number">-6</span>, <span class="number">-4</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-6</span>, <span class="number">-6</span>, <span class="number">-4</span>, <span class="number">-4</span>,\</span><br><span class="line">        <span class="number">-6</span>, <span class="number">-6</span>, <span class="number">-2</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">-16</span>, <span class="number">-38</span>, <span class="number">-60</span>, <span class="number">-84</span>,\</span><br><span class="line">        <span class="number">-90</span>, <span class="number">-66</span>, <span class="number">-32</span>, <span class="number">-4</span>, <span class="number">2</span>, <span class="number">-4</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">6</span>,\</span><br><span class="line">        <span class="number">6</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-2</span>,\</span><br><span class="line">        <span class="number">-2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">-2</span>, <span class="number">-2</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-2</span>, <span class="number">0</span>,\</span><br><span class="line">        <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-2</span>,\</span><br><span class="line">        <span class="number">-4</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-2</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-6</span>, <span class="number">-6</span>,\</span><br><span class="line">        <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">8</span>, <span class="number">-10</span>, <span class="number">-8</span>, <span class="number">-6</span>, <span class="number">-6</span>, <span class="number">-8</span>, <span class="number">-12</span>, <span class="number">-10</span>,\</span><br><span class="line">        <span class="number">-8</span>, <span class="number">-8</span>, <span class="number">-10</span>, <span class="number">-12</span>, <span class="number">-10</span>, <span class="number">-8</span>, <span class="number">-8</span>, <span class="number">-10</span>, <span class="number">-10</span>,\</span><br><span class="line">        <span class="number">-8</span>, <span class="number">-6</span>, <span class="number">-6</span>, <span class="number">-8</span>, <span class="number">-8</span>, <span class="number">-4</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-4</span>,\</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-2</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">-4</span>&#125;;</span><br><span class="line">    <span class="comment">//参数</span></span><br><span class="line">    <span class="keyword">float</span> b[<span class="number">7</span>]=&#123; <span class="number">0.0007</span>,<span class="number">0.0044</span>,<span class="number">0.0111</span>,<span class="number">0.0148</span>,<span class="number">0.0111</span>,<span class="number">0.0044</span>,<span class="number">0.0007</span>&#125;;</span><br><span class="line">    <span class="keyword">float</span> a[<span class="number">7</span>]=&#123; <span class="number">1.0000</span>,<span class="number">-3.1836</span>,<span class="number">4.6222</span>,<span class="number">-3.7795</span>,<span class="number">1.8136</span>,<span class="number">-0.4800</span>,<span class="number">0.0544</span>&#125;;</span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//不要修改</span></span><br><span class="line">    <span class="keyword">int</span> xr=<span class="keyword">sizeof</span>(x)/<span class="keyword">sizeof</span>(<span class="keyword">float</span>);</span><br><span class="line">    <span class="keyword">int</span> br=<span class="keyword">sizeof</span>(b)/<span class="keyword">sizeof</span>(<span class="keyword">float</span>);</span><br><span class="line">    <span class="keyword">int</span> ar=<span class="keyword">sizeof</span>(a)/<span class="keyword">sizeof</span>(<span class="keyword">float</span>);</span><br><span class="line">    <span class="comment">//output 滤波后数据</span></span><br><span class="line">    <span class="keyword">float</span> *y;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"参数b：\n"</span>);print(b,br);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"参数a：\n"</span>);print(a,ar);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"原数据：\n"</span>);print(x,xr);</span><br><span class="line"></span><br><span class="line">    y=gfilter(b,br,a,ar,x,xr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"滤波后数据：\n"</span>);print(y,xr);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;通过matlab对数字信号进行滤波器的设计后，我们要将设计好的参数放到嵌入式系统中进行滤波。&lt;br&gt;IIR滤波器&lt;br&gt;FIR滤波器&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="数字信号处理" scheme="https://talengu.github.io/categories/%E6%95%B0%E5%AD%97%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86/"/>
    
    
      <category term="DSP" scheme="https://talengu.github.io/tags/DSP/"/>
    
      <category term="filter" scheme="https://talengu.github.io/tags/filter/"/>
    
  </entry>
  
  <entry>
    <title>Windows笔记本开共享wifi</title>
    <link href="https://talengu.github.io/2015/04/14/shells/share_win_wifi/"/>
    <id>https://talengu.github.io/2015/04/14/shells/share_win_wifi/</id>
    <published>2015-04-14T04:39:04.000Z</published>
    <updated>2018-11-07T14:45:08.730Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>网上有很多用笔记本设置无线热点的批处理，我中和了一下。<br>复制下面代码到记事本，改后缀为bat就行了。<br>[改一下你自己定义的ssid和key]</p></blockquote><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@echo off</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set mssid=GTC</span><br><span class="line">::网络名字</span><br><span class="line">set mkey=123456789</span><br><span class="line">::大于八位密码</span><br><span class="line"></span><br><span class="line">echo ***********************************************</span><br><span class="line">echo              打开承载网络  1</span><br><span class="line">echo              关闭承载网络  2</span><br><span class="line">echo              承载网络信息  3</span><br><span class="line">echo              设置网络信息  set</span><br><span class="line">echo              退出          e</span><br><span class="line">echo        （网络名字、密码可在源文件中改）</span><br><span class="line">echo           （请以管理员身份打开!!!）</span><br><span class="line">echo ***********************************************</span><br><span class="line">:start</span><br><span class="line">set /p var=请选择:</span><br><span class="line">if %var%==1 netsh wlan start hostednetwork &amp;&amp; echo 网络名字:%mssid% 密码:%mkey% &amp;&amp; GOTO start</span><br><span class="line">if %var%==2 netsh wlan stop hostednetwork &amp;&amp; GOTO start</span><br><span class="line">if %var%==3 netsh wlan show hostednetwork &amp;&amp; echo 网络名字:%mssid% 密码:%mkey% &amp;&amp; GOTO start</span><br><span class="line">if %var%==set netsh wlan set hostednetwork mode=allow ssid=%mssid% key=%mkey% &amp;&amp; echo 网络名字:%mssid% 密码:%mkey% &amp;&amp; GOTO start</span><br><span class="line">if %var%==e pause</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;网上有很多用笔记本设置无线热点的批处理，我中和了一下。&lt;br&gt;复制下面代码到记事本，改后缀为bat就行了。&lt;br&gt;[改一下你自己定义的ssid和key]&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="常用脚本" scheme="https://talengu.github.io/categories/%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"/>
    
    
      <category term="Windows脚本" scheme="https://talengu.github.io/tags/Windows%E8%84%9A%E6%9C%AC/"/>
    
      <category term="共享wifi" scheme="https://talengu.github.io/tags/%E5%85%B1%E4%BA%ABwifi/"/>
    
      <category term="cmd" scheme="https://talengu.github.io/tags/cmd/"/>
    
  </entry>
  
  <entry>
    <title>序言</title>
    <link href="https://talengu.github.io/2015/01/01/About/"/>
    <id>https://talengu.github.io/2015/01/01/About/</id>
    <published>2014-12-31T16:00:00.000Z</published>
    <updated>2018-11-16T08:30:27.183Z</updated>
    
    <content type="html"><![CDATA[<p>欢迎来到这里～</p><a id="more"></a><p>博客这个东西很好玩，体现出一个人很多个性的东西。看了好多书籍的序，我想也为我的博客写个序。开篇名义，本博客主要记录学习工作中的知识点和生活的休闲杂记。记忆这东西很神奇，莫名其妙地记住一些事，但也不知不觉丢了些东西。在互联网或者说移动互联网之前，人们的记事方式更多的是纸质的，学习也是按照课本一页页去掌握，如今竞争的压力，信息的爆炸，技术信息发布平台多样，信息短快乱，工作与学习所用的知识点越来越多，越来越细，碎片化地学习无法避免的。</p><p>如何去记录这些碎片的知识，整理归纳的方法设计，已经迫在眉睫了。在Github上搭建一个带版本控制和评论功能的博客，我认为是个不错的想法。利用Markdown写文档比较方便，不需涉及很多格式的问题，风格想换就换，各个博客平台也支持这种语法方式。git对文本的版本控制比较舒服，我可以在多个终端进行编写，同步方便，合并后利用hexo框架就可以发布。在评论支持方面以前使用的是网易云跟帖，但这个功能网易关了，现在使用的Gitment，利用github的isuue功能的评论框架，现在仅支持github用户登录评论，但就用户面来说，我觉得够了，我写的这些博客主要是给自己看的。</p><p>对我博客的寄语。希望利用博客建立个人有效的知识体系，锻炼写文章的水平，留下生活中有趣的事物，同时传递出有趣的想法，有效的和各位大牛交流相关领域的经验，在互联网村里共同成长与进步。</p><p>人是一棵会思考的芦苇，并有一个有趣的灵魂。</p><p>不忘初心，活波严谨。</p><p><strong>感谢</strong><br>The Internet And The World.</p><p><strong>联系方式</strong>  </p><ul><li><p>QQmail: <a href="mailto:tianchenggu@qq.com" target="_blank" rel="noopener">tianchenggu@qq.com</a></p></li><li><p>Gmail:  <a href="mailto:talenapp@gmail.com" target="_blank" rel="noopener">talenapp@gmail.com</a></p></li><li><p>wechat QR</p><p><img src="/public/2015/01/01/About/WechatIMG151.jpeg" alt="WechatIMG151"></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;欢迎来到这里～&lt;/p&gt;
    
    </summary>
    
      <category term="博客搭建" scheme="https://talengu.github.io/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="关于" scheme="https://talengu.github.io/tags/%E5%85%B3%E4%BA%8E/"/>
    
  </entry>
  
</feed>
